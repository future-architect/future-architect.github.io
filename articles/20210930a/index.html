<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!--
    ███████╗██╗░░░██╗████████╗██╗░░░██╗██████╗░███████╗
    ██╔════╝██║░░░██║╚══██╔══╝██║░░░██║██╔══██╗██╔════╝
    █████╗░░██║░░░██║░░░██║░░░██║░░░██║██████╔╝█████╗░░
    ██╔══╝░░██║░░░██║░░░██║░░░██║░░░██║██╔══██╗██╔══╝░░
    ██║░░░░░╚██████╔╝░░░██║░░░╚██████╔╝██║░░██║███████╗
    ╚═╝░░░░░░╚═════╝░░░░╚═╝░░░░╚═════╝░╚═╝░░╚═╝╚══════╝
    ████████╗███████╗░█████╗░██╗░░██╗
    ╚══██╔══╝██╔════╝██╔══██╗██║░░██║
    ░░░██║░░░█████╗░░██║░░╚═╝███████║
    ░░░██║░░░██╔══╝░░██║░░██╗██╔══██║
    ░░░██║░░░███████╗╚█████╔╝██║░░██║
    ░░░╚═╝░░░╚══════╝░╚════╝░╚═╝░░╚═╝
    ██████╗░██╗░░░░░░█████╗░░██████╗░
    ██╔══██╗██║░░░░░██╔══██╗██╔════╝░
    ██████╦╝██║░░░░░██║░░██║██║░░██╗░
    ██╔══██╗██║░░░░░██║░░██║██║░░╚██╗
    ██████╦╝███████╗╚█████╔╝╚██████╔╝
    ╚═════╝░╚══════╝░╚════╝░░╚═════╝░
    Welcome engineer.
    https://www.future.co.jp/recruit/
  -->
  
  <title>GoでMQTT!!　～温湿度マイスターbotの作成～(後編) | フューチャー技術ブログ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  <meta name="description" content="はじめにこんにちは。TIG&#x2F;DXユニット所属の宮永です。 本記事は「GoでMQTT!!　～温湿度マイスターbotの作成～(前編) 」の後半パートです。 前半パートの記事をご覧になっていない方はそちらもご参照ください。  今回はAWSサービスのうちの一つAWS IoTを使用してRaspberryPiとのMQTTによる通信を行います。  AWS IoTを使用したMQTTのチュートリアルはAWS公式">
<meta property="og:type" content="article">
<meta property="og:title" content="GoでMQTT!!　～温湿度マイスターbotの作成～(後編) | フューチャー技術ブログ">
<meta property="og:url" content="https://future-architect.github.io/articles/20210930a/index.html">
<meta property="og:site_name" content="フューチャー技術ブログ">
<meta property="og:description" content="はじめにこんにちは。TIG&#x2F;DXユニット所属の宮永です。 本記事は「GoでMQTT!!　～温湿度マイスターbotの作成～(前編) 」の後半パートです。 前半パートの記事をご覧になっていない方はそちらもご参照ください。  今回はAWSサービスのうちの一つAWS IoTを使用してRaspberryPiとのMQTTによる通信を行います。  AWS IoTを使用したMQTTのチュートリアルはAWS公式">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://future-architect.github.io/images/20210930a/サムネイル2.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210930a/image.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210930a/image_2.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210930a/image_3.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210930a/image_4.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210930a/室内温湿度.jpg">
<meta property="og:image" content="https://future-architect.github.io/images/20210930a/image_5.png">
<meta property="article:published_time" content="2021-09-29T15:00:00.000Z">
<meta property="article:modified_time" content="2022-07-04T14:47:53.554Z">
<meta property="article:tag" content="IoT">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="BOT">
<meta property="article:tag" content="ハンズオン">
<meta property="article:tag" content="RaspberryPi">
<meta property="article:tag" content="AWSIoT">
<meta property="article:tag" content="MQTT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://future-architect.github.io/images/20210930a/サムネイル2.png">
  
  <link rel="alternate" href="/atom.xml" title="フューチャー技術ブログ" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes='180x180' href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes='57x57' href="/apple-touch-icon-57x57.png">
  <link rel="canonical" href="https://future-architect.github.io/articles/20210930a/">
  <meta content="IoT,Python,BOT,ハンズオン,RaspberryPi,AWSIoT,MQTT" name="keywords">
  <meta content="宮永崇史" name="author">
  <link rel="preload" as="image" href="/banner.jpg" />
  <link rel='manifest' href='/manifest.webmanifest'/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <link rel="stylesheet" href="/metronic/assets/style.css">
  <link rel="stylesheet" href="/css/theme-styles.css">
<meta name="generator" content="Hexo 5.4.2"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body class="corporate">
  <div class="wrap" itemscope itemtype="https://schema.org/TechArticle">
  <!-- BEGIN HEADER -->
<header class="header">
	<div class="header-overlay">
		<div class="header-menu"></div>
		<div class="header-title"><a href="/">Future Tech Blog</a></div>
		<div class="header-title-sub">フューチャー技術ブログ</div>
	</div>
</header>
<!-- Header END -->

  <div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/articles/">Blog</a></li>
    <li class="active">Post</li>
  </ul>
  <section id="main" class="margin-top-30">
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IoT/">IoTカテゴリ</a>
  </div>


    <h2 itemprop="name" class="article-title">GoでMQTT!!　～温湿度マイスターbotの作成～(後編)
  
  <a target="_blank" rel="noopener" href="https://github.com/future-architect/tech-blog/edit/master/source/_posts/20210930a_GoでMQTT!!　～温湿度マイスターbotの作成～(後編).md" title="Suggest Edits" class="github-edit"><i class="github-edit-icon"></i></a>
  
</h2>

    <div class="row">
  <main class="col-md-9 blog-posts">
    <article id="post-20210930a_GoでMQTT!!　～温湿度マイスターbotの作成～(後編)" class="article article-type-post blog-item" itemscope itemprop="blogPost">
      <div class="article-inner">
        
        <header class="article-header">
          <ul class="blog-info">
            <li class="blog-info-item"><a href="/articles/2021/" class="publish-date"><time datetime="2021-09-29T15:00:00.000Z" itemprop="datePublished">2021.09.30</time></a>
</li>
            <li class="blog-info-item"><li><a href="/authors/%E5%AE%AE%E6%B0%B8%E5%B4%87%E5%8F%B2" title="宮永崇史さんの記事一覧へ" class="post-author">宮永崇史</a></li></li>
            <li class="blog-info-item">
  
    
    <a href="/tags/IoT/" title="IoTタグの記事へ" class="tag-list-link">IoT</a>
  
    
    <a href="/tags/Python/" title="Pythonタグの記事へ" class="tag-list-link">Python</a>
  
    
    <a href="/tags/BOT/" title="BOTタグの記事へ" class="tag-list-link">BOT</a>
  
    
    <a href="/tags/ハンズオン/" title="ハンズオンタグの記事へ" class="tag-list-link">ハンズオン</a>
  
    
    <a href="/tags/RaspberryPi/" title="RaspberryPiタグの記事へ" class="tag-list-link">RaspberryPi</a>
  
    
    <a href="/tags/AWSIoT/" title="AWSIoTタグの記事へ" class="tag-list-link">AWSIoT</a>
  
    
    <a href="/tags/MQTT/" title="MQTTタグの記事へ" class="tag-list-link">MQTT</a>
  

</li>
          </ul>
          </header>
        
        <div class="article-entry" itemprop="articleBody">
          
            <img src="/images/20210930a/サムネイル2.png" alt="" title="Louis Reed on Unsplash" width="1200" height="675" loading="lazy">

<h1 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h1><p>こんにちは。TIG/DXユニット所属の宮永です。</p>
<p><strong>本記事は<a href="https://future-architect.github.io/articles/20210929a/">「GoでMQTT!!　～温湿度マイスターbotの作成～(前編) 」</a>の後半パートです。</strong></p>
<p>前半パートの記事をご覧になっていない方はそちらもご参照ください。</p>
<blockquote>
<p>今回はAWSサービスのうちの一つAWS IoTを使用してRaspberryPiとのMQTTによる通信を行います。</p>
</blockquote>
<p>AWS IoTを使用したMQTTのチュートリアルはAWS公式からも詳細なハンズオン記事が出ています。</p>
<ul>
<li><em><a target="_blank" rel="noopener" href="https://aws-iot-core-for-beginners.workshop.aws/phase3/step1.html">AWS IoT Core の設定 :: AWS IoT Core 初級 ハンズオン</a></em></li>
</ul>
<p>本記事はこちらのハンズオンを基にGo言語を使用してMQTTによる通信を行いました。(公式の記事はPythonで実装されています。)</p>
<p>最終的には室内の快適な温湿度を教えてくれる「温湿度マイスターbot」を作成します。</p>
<p>なお、本記事で作成したコードは</p>
<ul>
<li><em><a target="_blank" rel="noopener" href="https://github.com/orangekame3/go-mqtt">orangekame3/go-mqtt</a></em></li>
<li><em><a target="_blank" rel="noopener" href="https://github.com/orangekame3/th-meisterBot">orangekame3/th-meisterBot</a></em></li>
</ul>
<p>にて公開しています。</p>
<h1 id="前回の振り返り"><a href="#前回の振り返り" class="headerlink" title="前回の振り返り"></a>前回の振り返り</h1><p>実装は以下の手順で進めます。<br>前回の記事では<strong>「3. DHT22の温湿度情報をAWS IoTへPublish」</strong>までを行いました。</p>
<ol>
<li>DHT22から温湿度情報を取得する</li>
<li>AWS IoTを使用してRaspberryPiからのPublish動作確認</li>
<li>DHT22の温湿度情報をAWS IoTへPublish　　　　　　　　👈ココまでやりました。</li>
<li>AWS IoTで取得した温湿度情報をDynamoDBに連携</li>
<li>Boto3を使用してDynamoDBからデータをQuery、データ整形</li>
<li>取得データをmatplotlibで可視化</li>
<li>作成したプロット図をSlack APIで画像投稿</li>
</ol>
<p>本記事では<strong>「4. AWS IoTで取得した温湿度情報をDynamoDBに連携」</strong>から取り組みます。</p>
<h2 id="4-AWS-IoTで取得した温湿度情報をDynamoDBに連携"><a href="#4-AWS-IoTで取得した温湿度情報をDynamoDBに連携" class="headerlink" title="4. AWS IoTで取得した温湿度情報をDynamoDBに連携"></a>4. AWS IoTで取得した温湿度情報をDynamoDBに連携</h2><p>DynamoDBについては入門記事などが弊社ブログでも投稿されているため説明は割愛いたします。</p>
<ul>
<li><em><a href="https://future-architect.github.io/tags/DynamoDB/">DynamoDB の記事一覧 | フューチャー技術ブログ</a></em></li>
</ul>
<p>AWS IoTで受信したデータをDynamoDBに登録する方法は公式に詳細に記載されています。</p>
<ul>
<li><em><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ja_jp/iot/latest/developerguide/iot-ddb-rule.html">デバイスデータを DynamoDB テーブルに保存する - AWS IoT Core</a></em></li>
</ul>
<p>公式のドキュメントは非常に丁寧にまとめられているため、本記事では要点のみ記載します。</p>
<h3 id="テーブルの新規作成"><a href="#テーブルの新規作成" class="headerlink" title="テーブルの新規作成"></a>テーブルの新規作成</h3><p>まずはテーブルの作成です。テーブル名は任意ですが、今回は<code>mydht22</code>としました。Partition keyに<code>device_id</code>をSort keyに<code>timestamp</code>を定義しています。<br><img src="/images/20210930a/image.png" alt="image.png" width="797" height="508" loading="lazy"></p>
<h3 id="ルールの作成"><a href="#ルールの作成" class="headerlink" title="ルールの作成"></a>ルールの作成</h3><p>作成したテーブルにデータを送信するため、AWS IoT ルールの作成を行います。</p>
<p>AWS IoTコンソール上Act&gt;Ruleからルールの新規作成が行えます。SQLバージョンの使用は2016-03-23を使用しました。From句には <strong>「2. AWS IoTを使用してRaspberryPiからのPublish動作確認」</strong> の実装にてに定義したトピック名を記載してください。</p>
<p>今回の場合トピック名は「topic/to/publish」です。as句は通常のSQLと同じようにテーブル名となるため適宜定義してください。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="string">'01'</span> <span class="keyword">as</span> device_id</span><br><span class="line">,   <span class="type">Timestamp</span> <span class="keyword">as</span> <span class="type">timestamp</span></span><br><span class="line">,   Temperature <span class="keyword">as</span> temperature</span><br><span class="line">,   Humidity <span class="keyword">as</span> humidity</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">'topic/to/publish'</span></span><br></pre></td></tr></table></figure>

<p>アクション追加の際には下図<strong>「DynamoDBテーブル(DynamoDBv2)の複数列にメッセージを分割する」</strong>を追加してください。<br><img src="/images/20210930a/image_2.png" alt="DynamoDBコンソール画面" width="818" height="247" loading="lazy"></p>
<p>リソースにテーブル<code>mydht22</code>選択してください。また、今回は<code>mydht22</code>という名称でロールを新規作成しました。</p>
<img src="/images/20210930a/image_3.png" alt="ロール作成" width="982" height="616" loading="lazy">

<h3 id="疎通確認"><a href="#疎通確認" class="headerlink" title="疎通確認"></a>疎通確認</h3><p>最後にDynamoDBにデータが正しく登録されているか確認します。<br>DynamoDBコンソールにアクセスして、下図の様にデータが登録されていることを確認してください。</p>
<img src="/images/20210930a/image_4.png" alt="データ登録" width="675" height="511" loading="lazy">

<p>作成したルールに従ってデータが登録されていますね！<br>次の章では、Boto3を使用してDynamoDBからデータを取得したうえで、扱いやすいようにデータを整形します。</p>
<h2 id="5-Boto3を使用してDynamoDBからデータをQuery、データ整形"><a href="#5-Boto3を使用してDynamoDBからデータをQuery、データ整形" class="headerlink" title="5. Boto3を使用してDynamoDBからデータをQuery、データ整形"></a>5. Boto3を使用してDynamoDBからデータをQuery、データ整形</h2><p>PythonモジュールBoto3を使用してDynamoDBからデータをQuery、最新値15点ほどを抜き出してプロットします。</p>
<p>Boto3を使用したQueryは非常に簡単に行えますが、Queryで取得したデータはDecimal型を含む特殊な構造をしているため、JSONに整形する必要があります。</p>
<p>今回JSONへの整形にはこちらのモジュールを利用させていただきました。</p>
<ul>
<li><em><a target="_blank" rel="noopener" href="https://github.com/Alonreznik/dynamodb-json">Alonreznik/dynamodb-json: DynamoDB json util to load and dump strings of Dynamodb json format to python object and vise-versa</a></em></li>
</ul>
<p>それでは、以下のスクリプトによって作成したテーブル<em>mydht22</em>よりデータを取得、JSONファイルとして保存します。</p>
<blockquote>
<p>*※本環境ではAWS_PROFILEが設定してあることを前提としています。<br>AWS_PROFILEの設定方法は以下ををご参照ください。</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-profiles.html">名前付きプロファイル - AWS Command Line Interface</a>*</li>
</ul>
<figure class="highlight python"><figcaption><span>query.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dynamodb_json <span class="keyword">import</span> json_util <span class="keyword">as</span> util</span><br><span class="line"><span class="keyword">from</span> boto3.session <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">from</span> boto3.dynamodb.conditions <span class="keyword">import</span> Key</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_table</span>(<span class="params">executed_time</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    現在日時より過去７日間のデータをクエリ</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    begin = executed_time - datetime.timedelta(days=<span class="number">7</span>)</span><br><span class="line">    response = dynamodb_table.query(</span><br><span class="line">        KeyConditionExpression=Key(<span class="string">'device_id'</span>).eq(<span class="string">'01'</span>) &amp; Key(<span class="string">'timestamp'</span>).between(</span><br><span class="line">            begin.isoformat(sep = <span class="string">"T"</span>,timespec=<span class="string">"milliseconds"</span>),</span><br><span class="line">            executed_time.isoformat(sep = <span class="string">"T"</span>,timespec=<span class="string">"milliseconds"</span>)))</span><br><span class="line">    data = response[<span class="string">'Items'</span>]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unmarshall</span>(<span class="params">dynamodb_json</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    dynamodbで取得したデータを通常のJDONへ整形</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    regular_json = util.loads(dynamodb_json)</span><br><span class="line">    <span class="keyword">return</span> regular_json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    now = datetime.datetime.now(pytz.timezone(<span class="string">'Asia/Tokyo'</span>))</span><br><span class="line">    raw = query_table(now)</span><br><span class="line">    data = unmarshall(raw)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'scan_data.json'</span>, mode=<span class="string">'wt'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        json.dump(data, file, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    session = Session(profile_name=<span class="string">'default'</span>, region_name=<span class="string">'ap-northeast-1'</span>)</span><br><span class="line">    dynamodb = session.resource(<span class="string">'dynamodb'</span>)</span><br><span class="line">    dynamodb_table = dynamodb.Table(<span class="string">'mydht22'</span>)</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>上記スクリプトの実行により出力されたJSONは</p>
<figure class="highlight json"><figcaption><span>query_data.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"device_id"</span><span class="punctuation">:</span> <span class="string">"01"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"humidity"</span><span class="punctuation">:</span> <span class="number">42.5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"temperature"</span><span class="punctuation">:</span> <span class="number">26.9</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"timestamp"</span><span class="punctuation">:</span> <span class="string">"2021-09-23T17:50:42.522120086+09:00"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"device_id"</span><span class="punctuation">:</span> <span class="string">"01"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"humidity"</span><span class="punctuation">:</span> <span class="number">42.7</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"temperature"</span><span class="punctuation">:</span> <span class="number">27</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"timestamp"</span><span class="punctuation">:</span> <span class="string">"2021-09-23T17:51:45.55949297+09:00"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"device_id"</span><span class="punctuation">:</span> <span class="string">"01"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"humidity"</span><span class="punctuation">:</span> <span class="number">42.7</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"temperature"</span><span class="punctuation">:</span> <span class="number">26.9</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"timestamp"</span><span class="punctuation">:</span> <span class="string">"2021-09-23T17:52:46.600977247+09:00"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">...(省略)</span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>扱いやすいJSONファイルを取得することができました！！</p>
<p>それでは、次章で取得したデータをプロットしましょう。</p>
<h2 id="6-取得データをmatplotlibで可視化"><a href="#6-取得データをmatplotlibで可視化" class="headerlink" title="6. 取得データをmatplotlibで可視化"></a>6. 取得データをmatplotlibで可視化</h2><p>先ほど取得したデータを使用してプロットします。</p>
<p>今回はQueryによって得たデータのうち最新データ15点をプロットするようにしました。ただし、取得したデータをプロットするだけでは面白くないので不快指数を可視化できるようにしました。<br>天気予報で頻繁に耳にする不快指数ですが、以下論文にて数式化が掲載されていました。</p>
<ul>
<li><em><a target="_blank" rel="noopener" href="https://www.metsoc.jp/tenki/pdf/2001/2001_09_0661.pdf">木内豪「屋外空間における温冷感指標に関する研究 (PDF) 」 『天気』第48巻第9号、2001年、 661-671頁。</a></em></li>
</ul>
<p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.355ex;" xmlns="http://www.w3.org/2000/svg" width="2.341ex" height="1.887ex" role="img" focusable="false" viewBox="0 -677 1034.7 834.1"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(617,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></g></g></svg></mjx-container>を気温(℃)、<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 888 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g></g></svg></mjx-container>を湿度(%)としたとき、</p>
<p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="49.557ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 21904.3 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">不</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">快</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">指</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(4277.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(5333.6,0)"><g data-mml-node="mstyle"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500,0)"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(778,0)"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(1278,0)"></path></g><g data-mml-node="msub" transform="translate(1778,0)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(617,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g><g data-mml-node="mo" transform="translate(3034.9,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(4035.1,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(778,0)"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(1278,0)"></path></g><g data-mml-node="mi" transform="translate(5813.1,0)"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="mo" transform="translate(6701.1,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(7090.1,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500,0)"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(778,0)"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(1278,0)"></path></g><g data-mml-node="msub" transform="translate(8868.1,0)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(617,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g><g data-mml-node="mo" transform="translate(10125.1,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(11125.3,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(1000,0)"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(1278,0)"></path></g><g data-mml-node="mo" transform="translate(12903.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(13514.5,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(14514.7,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(1000,0)"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(1278,0)"></path></g><g data-mml-node="mo" transform="translate(16292.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g></g></g></g></g></svg></mjx-container></p>
<p>として不快指数を計算することができるそうです。</p>
<p>屋外に関する指標ですが、室内環境の調整には十分そうです。</p>
<p>また、屋内における適正温度は夏場において25 ~ 28℃、適正湿度は40 ~ 70%とのことから、該当領域に色付けをして一目で室内環境を把握できるようにしました。</p>
<ul>
<li><em><a target="_blank" rel="noopener" href="https://www.egmkt.co.jp/column/consumer/20210506_EG_067.html">温度と湿度の関係を知って快適に暮らそう！すぐに実践できる温度・湿度の調節方法もご紹介｜EGR</a></em></li>
</ul>
<p>不快指数などのメッセージは<strong>「7. 作成したプロット図をSlack APIで画像投稿」</strong>にてSlackで通知する仕組みとなっています。</p>
<figure class="highlight python"><figcaption><span>plot.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">temp, humid</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    不快指数の計算をする</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> np.<span class="built_in">round</span>(<span class="number">0.81</span> * temp + <span class="number">0.01</span> * humid *</span><br><span class="line">                    (<span class="number">0.99</span> * temp - <span class="number">14.3</span>) + <span class="number">46.3</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_latest_value</span>(<span class="params">Timestamp, Temperature, Humidity</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    データより最新値15点を取得</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    length = <span class="built_in">len</span>(Timestamp)</span><br><span class="line">    <span class="keyword">if</span> length &gt; <span class="number">15</span>:</span><br><span class="line">        Temperature = Temperature[length - <span class="number">15</span>:]</span><br><span class="line">        Humidity = Humidity[length - <span class="number">15</span>:]</span><br><span class="line">        Timestamp = Timestamp[length - <span class="number">15</span>:]</span><br><span class="line">    <span class="keyword">return</span> Timestamp, Temperature, Humidity,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">converter</span>(<span class="params">json_data</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    JSONから配列へ変換</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    Humidity = []</span><br><span class="line">    Temperature = []</span><br><span class="line">    Timestamp = []</span><br><span class="line">    temp = <span class="number">0</span></span><br><span class="line">    humid = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(json_data)):</span><br><span class="line">        temp = json_data[i][<span class="string">'temperature'</span>]</span><br><span class="line">        humid = json_data[i][<span class="string">'humidity'</span>]</span><br><span class="line">        times = json_data[i][<span class="string">'timestamp'</span>][<span class="number">5</span>:<span class="number">16</span>]</span><br><span class="line">        Humidity.append(humid)</span><br><span class="line">        Temperature.append(temp)</span><br><span class="line">        Timestamp.append(times)</span><br><span class="line">    <span class="keyword">return</span> Timestamp, Temperature, Humidity,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_figure</span>(<span class="params">Timestamp, Temperature, Humidity</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    プロット図の生成</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    plt.rcParams[<span class="string">'font.family'</span>] = <span class="string">'DejaVu Sans'</span></span><br><span class="line">    plt.rcParams[<span class="string">'mathtext.fontset'</span>] = <span class="string">'stix'</span></span><br><span class="line">    plt.rcParams[<span class="string">"font.size"</span>] = <span class="number">20</span></span><br><span class="line">    plt.rcParams[<span class="string">'xtick.labelsize'</span>] = <span class="number">10</span></span><br><span class="line">    plt.rcParams[<span class="string">'ytick.labelsize'</span>] = <span class="number">10</span></span><br><span class="line">    plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">8</span>, <span class="number">6</span>)</span><br><span class="line">    fig = plt.figure()</span><br><span class="line">    ax1 = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">    ln1 = ax1.plot(</span><br><span class="line">        Timestamp,</span><br><span class="line">        Temperature,</span><br><span class="line">        marker=<span class="string">'o'</span>,</span><br><span class="line">        markeredgewidth=<span class="number">1.</span>,</span><br><span class="line">        markeredgecolor=<span class="string">'k'</span>,</span><br><span class="line">        color=<span class="string">"orange"</span>,</span><br><span class="line">        label=<span class="string">r'$Temperature$'</span>)</span><br><span class="line">    ax2 = ax1.twinx()</span><br><span class="line">    ln2 = ax2.plot(</span><br><span class="line">        Timestamp,</span><br><span class="line">        Humidity,</span><br><span class="line">        marker=<span class="string">'o'</span>,</span><br><span class="line">        markeredgewidth=<span class="number">1.</span>,</span><br><span class="line">        markeredgecolor=<span class="string">'k'</span>,</span><br><span class="line">        color=<span class="string">"blue"</span>,</span><br><span class="line">        label=<span class="string">r'$Humidity$'</span>)</span><br><span class="line">    h1, l1 = ax1.get_legend_handles_labels()</span><br><span class="line">    h2, l2 = ax2.get_legend_handles_labels()</span><br><span class="line">    ax1.legend(h1 + h2, l1 + l2, loc=<span class="string">'upper right'</span>)</span><br><span class="line">    ax1.set_ylim([<span class="number">20</span>, <span class="number">32</span>])</span><br><span class="line">    ax2.set_ylim([<span class="number">25</span>, <span class="number">85</span>])</span><br><span class="line">    ax1.axhspan(<span class="number">25</span>, <span class="number">28</span>, color=<span class="string">"olive"</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">    ax2.axhspan(<span class="number">40</span>, <span class="number">70</span>, color=<span class="string">"royalblue"</span>, alpha=<span class="number">0.2</span>)</span><br><span class="line">    ax1.set_xlabel(<span class="string">r'$Timestamp$'</span>)</span><br><span class="line">    ax1.set_ylabel(<span class="string">r'$Temperature$'</span>)</span><br><span class="line">    ax2.set_ylabel(<span class="string">r'$Humidity$'</span>)</span><br><span class="line">    ax1.grid(<span class="literal">True</span>)</span><br><span class="line">    plt.gcf().autofmt_xdate()</span><br><span class="line">    fig_path = <span class="string">"室内温湿度.jpg"</span></span><br><span class="line">    plt.savefig(fig_path)</span><br><span class="line">    <span class="keyword">return</span> fig_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">worker</span>():</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    メインとなる関数</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    now = datetime.datetime.now(pytz.timezone(<span class="string">'Asia/Tokyo'</span>))</span><br><span class="line">    executed_time = now.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Executed:"</span>, executed_time)</span><br><span class="line">    data = query_table(now)</span><br><span class="line">    json_data = unmarshall(data)</span><br><span class="line">    Timestamp, Temperature, Humidity = converter(json_data)</span><br><span class="line">    Timestamp, Temperature, Humidity = fetch_latest_value(</span><br><span class="line">        Timestamp, Temperature, Humidity)</span><br><span class="line">    fukai = calc(Temperature[-<span class="number">1</span>], Humidity[-<span class="number">1</span>])</span><br><span class="line">    fukai_message = <span class="string">"不快指数は"</span> + <span class="built_in">str</span>(fukai) + <span class="string">"です。"</span></span><br><span class="line">    fig = generate_figure(Timestamp, Temperature, Humidity)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="出力結果"><a href="#出力結果" class="headerlink" title="出力結果"></a>出力結果</h3><img src="/images/20210930a/室内温湿度.jpg" alt="室内温湿度" width="800" height="600" loading="lazy">


<h2 id="7-作成したプロット図をSlack-APIで画像投稿"><a href="#7-作成したプロット図をSlack-APIで画像投稿" class="headerlink" title="7. 作成したプロット図をSlack APIで画像投稿"></a>7. 作成したプロット図をSlack APIで画像投稿</h2><p>それでは、上記で出力した画像をSlackに投稿します。</p>
<p>実装はこちらの準公式記事を参考にしました。</p>
<ul>
<li><em><a target="_blank" rel="noopener" href="https://qiita.com/seratch/items/8f93fd0bf815b0b1d557">Python で Slack API や Webhook を扱うなら公式 SDK（slack-sdk/slack-bolt）を使おう - Qiita</a></em></li>
</ul>
<p>Slackbotの作成などは本記事の主旨ではないため、割愛いたします。</p>
<p>先ほど作成したworker関数に以下を追加します。</p>
<figure class="highlight python"><figcaption><span>plot.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> slack_sdk.web <span class="keyword">import</span> WebClient</span><br><span class="line"></span><br><span class="line">...(省略)</span><br><span class="line"></span><br><span class="line">client = WebClient(</span><br><span class="line">        token=<span class="string">"xoxb-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>)</span><br><span class="line">    response1 = client.chat_postMessage(text=<span class="string">" Temp : "</span> + <span class="built_in">str</span>(Temperature[-<span class="number">1</span>]) + <span class="string">"℃, Humid : "</span> + <span class="built_in">str</span>(</span><br><span class="line">        Humidity[-<span class="number">1</span>]) + <span class="string">"%, message : "</span> + fukai_message, channel=<span class="string">"#home"</span>)</span><br><span class="line">    response2 = client.files_upload(channels=<span class="string">"#home"</span>, file=fig, title=<span class="string">"室内温湿度"</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>たったこれだけでSlackに自由に投稿できるとは！便利ですね。</p>
<blockquote>
<p><em>注意点が一つあります。テキストメッセージの送信の際はchannel=”#home”となっていますが、画像を投稿する際はchannels = “#home”です。</em></p>
</blockquote>
<h3 id="出力結果-1"><a href="#出力結果-1" class="headerlink" title="出力結果"></a>出力結果</h3><img src="/images/20210930a/image_5.png" alt="出力結果グラフ" width="647" height="457" loading="lazy">

<p>それでは、最後にSlack投稿を定期実行するようにしましょう。<br>定期実行には以下のモジュールを使わせていただきました。</p>
<ul>
<li><em><a target="_blank" rel="noopener" href="https://github.com/dbader/schedule">dbader/schedule: Python job scheduling for humans.</a></em></li>
</ul>
<p>2時間ごとにworkerを実行するように設定しました。<br>最終的なPythonスクリプトはこちらです。</p>
<figure class="highlight python"><figcaption><span>plot.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> slack_sdk.web <span class="keyword">import</span> WebClient</span><br><span class="line"><span class="keyword">from</span> dynamodb_json <span class="keyword">import</span> json_util <span class="keyword">as</span> util</span><br><span class="line"><span class="keyword">from</span> boto3.session <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">from</span> boto3.dynamodb.conditions <span class="keyword">import</span> Key</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> pytz</span><br><span class="line"><span class="keyword">import</span> schedule</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = Session(profile_name=<span class="string">'default'</span>, region_name=<span class="string">'ap-northeast-1'</span>)</span><br><span class="line">dynamodb = session.resource(<span class="string">'dynamodb'</span>)</span><br><span class="line">dynamodb_table = dynamodb.Table(<span class="string">'mydht22'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_table</span>(<span class="params">executed_time</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    現在日時より過去７日間のデータをクエリ</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    begin = executed_time - datetime.timedelta(days=<span class="number">7</span>)</span><br><span class="line">    response = dynamodb_table.query(</span><br><span class="line">        KeyConditionExpression=Key(<span class="string">'device_id'</span>).eq(<span class="string">'01'</span>) &amp; Key(<span class="string">'timestamp'</span>).between(</span><br><span class="line">            begin.isoformat(sep = <span class="string">"T"</span>,timespec=<span class="string">"milliseconds"</span>),</span><br><span class="line">            executed_time.isoformat(sep = <span class="string">"T"</span>,timespec=<span class="string">"milliseconds"</span>)))</span><br><span class="line">    data = response[<span class="string">'Items'</span>]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unmarshall</span>(<span class="params">dynamodb_json</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    dynamodbで取得したデータを通常のJDONへ整形</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    regular_json = util.loads(dynamodb_json)</span><br><span class="line">    <span class="keyword">return</span> regular_json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">temp, humid</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    不快指数の計算をする</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> np.<span class="built_in">round</span>(<span class="number">0.81</span> * temp + <span class="number">0.01</span> * humid *</span><br><span class="line">                    (<span class="number">0.99</span> * temp - <span class="number">14.3</span>) + <span class="number">46.3</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_latest_value</span>(<span class="params">Timestamp, Temperature, Humidity</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    データより最新値15点を取得</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    length = <span class="built_in">len</span>(Timestamp)</span><br><span class="line">    <span class="keyword">if</span> length &gt; <span class="number">15</span>:</span><br><span class="line">        Temperature = Temperature[length - <span class="number">15</span>:]</span><br><span class="line">        Humidity = Humidity[length - <span class="number">15</span>:]</span><br><span class="line">        Timestamp = Timestamp[length - <span class="number">15</span>:]</span><br><span class="line">    <span class="keyword">return</span> Timestamp, Temperature, Humidity,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">converter</span>(<span class="params">json_data</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    JSONから配列へ変換</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    Humidity = []</span><br><span class="line">    Temperature = []</span><br><span class="line">    Timestamp = []</span><br><span class="line">    temp = <span class="number">0</span></span><br><span class="line">    humid = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(json_data)):</span><br><span class="line">        temp = json_data[i][<span class="string">'temperature'</span>]</span><br><span class="line">        humid = json_data[i][<span class="string">'humidity'</span>]</span><br><span class="line">        times = json_data[i][<span class="string">'timestamp'</span>][<span class="number">5</span>:<span class="number">16</span>]</span><br><span class="line">        Humidity.append(humid)</span><br><span class="line">        Temperature.append(temp)</span><br><span class="line">        Timestamp.append(times)</span><br><span class="line">    <span class="keyword">return</span> Timestamp, Temperature, Humidity,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_figure</span>(<span class="params">Timestamp, Temperature, Humidity</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    プロット図の生成</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    plt.rcParams[<span class="string">'font.family'</span>] = <span class="string">'DejaVu Sans'</span></span><br><span class="line">    plt.rcParams[<span class="string">'mathtext.fontset'</span>] = <span class="string">'stix'</span></span><br><span class="line">    plt.rcParams[<span class="string">"font.size"</span>] = <span class="number">20</span></span><br><span class="line">    plt.rcParams[<span class="string">'xtick.labelsize'</span>] = <span class="number">10</span></span><br><span class="line">    plt.rcParams[<span class="string">'ytick.labelsize'</span>] = <span class="number">10</span></span><br><span class="line">    plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">8</span>, <span class="number">6</span>)</span><br><span class="line">    fig = plt.figure()</span><br><span class="line">    ax1 = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">    ln1 = ax1.plot(</span><br><span class="line">        Timestamp,</span><br><span class="line">        Temperature,</span><br><span class="line">        marker=<span class="string">'o'</span>,</span><br><span class="line">        markeredgewidth=<span class="number">1.</span>,</span><br><span class="line">        markeredgecolor=<span class="string">'k'</span>,</span><br><span class="line">        color=<span class="string">"orange"</span>,</span><br><span class="line">        label=<span class="string">r'$Temperature$'</span>)</span><br><span class="line">    ax2 = ax1.twinx()</span><br><span class="line">    ln2 = ax2.plot(</span><br><span class="line">        Timestamp,</span><br><span class="line">        Humidity,</span><br><span class="line">        marker=<span class="string">'o'</span>,</span><br><span class="line">        markeredgewidth=<span class="number">1.</span>,</span><br><span class="line">        markeredgecolor=<span class="string">'k'</span>,</span><br><span class="line">        color=<span class="string">"blue"</span>,</span><br><span class="line">        label=<span class="string">r'$Humidity$'</span>)</span><br><span class="line">    h1, l1 = ax1.get_legend_handles_labels()</span><br><span class="line">    h2, l2 = ax2.get_legend_handles_labels()</span><br><span class="line">    ax1.legend(h1 + h2, l1 + l2, loc=<span class="string">'upper right'</span>)</span><br><span class="line">    ax1.set_ylim([<span class="number">20</span>, <span class="number">32</span>])</span><br><span class="line">    ax2.set_ylim([<span class="number">25</span>, <span class="number">85</span>])</span><br><span class="line">    ax1.axhspan(<span class="number">25</span>, <span class="number">28</span>, color=<span class="string">"olive"</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">    ax2.axhspan(<span class="number">40</span>, <span class="number">70</span>, color=<span class="string">"royalblue"</span>, alpha=<span class="number">0.2</span>)</span><br><span class="line">    ax1.set_xlabel(<span class="string">r'$Timestamp$'</span>)</span><br><span class="line">    ax1.set_ylabel(<span class="string">r'$Temperature$'</span>)</span><br><span class="line">    ax2.set_ylabel(<span class="string">r'$Humidity$'</span>)</span><br><span class="line">    ax1.grid(<span class="literal">True</span>)</span><br><span class="line">    plt.gcf().autofmt_xdate()</span><br><span class="line">    fig_path = <span class="string">"室内温湿度.jpg"</span></span><br><span class="line">    plt.savefig(fig_path)</span><br><span class="line">    <span class="keyword">return</span> fig_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">worker</span>():</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    データを取得し、Slack APIで投稿する</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    now = datetime.datetime.now(pytz.timezone(<span class="string">'Asia/Tokyo'</span>))</span><br><span class="line">    executed_time = now.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Executed:"</span>, executed_time)</span><br><span class="line">    data = query_table(now)</span><br><span class="line">    json_data = unmarshall(data)</span><br><span class="line">    Timestamp, Temperature, Humidity = converter(json_data)</span><br><span class="line">    Timestamp, Temperature, Humidity = fetch_latest_value(</span><br><span class="line">        Timestamp, Temperature, Humidity)</span><br><span class="line">    fukai = calc(Temperature[-<span class="number">1</span>], Humidity[-<span class="number">1</span>])</span><br><span class="line">    fukai_message = <span class="string">"不快指数は"</span> + <span class="built_in">str</span>(fukai) + <span class="string">"です。"</span></span><br><span class="line">    fig = generate_figure(Timestamp, Temperature, Humidity)</span><br><span class="line">    message = <span class="string">"室内温度は"</span> + \</span><br><span class="line">        <span class="built_in">str</span>(Temperature[-<span class="number">1</span>]) + <span class="string">"度。湿度は"</span> + <span class="built_in">str</span>(Humidity[-<span class="number">1</span>]) + <span class="string">"%です。"</span> + fukai_message</span><br><span class="line">    client = WebClient(</span><br><span class="line">        token=<span class="string">"xoxb-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>)</span><br><span class="line">    response1 = client.chat_postMessage(text=<span class="string">" Temp : "</span> + <span class="built_in">str</span>(Temperature[-<span class="number">1</span>]) + <span class="string">"℃, Humid : "</span> + <span class="built_in">str</span>(</span><br><span class="line">        Humidity[-<span class="number">1</span>]) + <span class="string">"%, message : "</span> + fukai_message, channel=<span class="string">"#home"</span>)</span><br><span class="line">    response2 = client.files_upload(channels=<span class="string">"#home"</span>, file=fig, title=<span class="string">"室内温湿度"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    session = Session(profile_name=<span class="string">'default'</span>, region_name=<span class="string">'ap-northeast-1'</span>)</span><br><span class="line">    dynamodb = session.resource(<span class="string">'dynamodb'</span>)</span><br><span class="line">    dynamodb_table = dynamodb.Table(<span class="string">'mydht22'</span>)</span><br><span class="line">    schedule.every(<span class="number">2</span>).hours.do(worker)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        schedule.run_pending()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>GoとAWS IoTを使用してMQTT通信を行いました。</p>
<p>AWS IoTを使用したのは初めてだったのですが、公式のドキュメントやチュートリアルが非常に丁寧であったため、簡単に実装できました。</p>
<p>AWS以外のクラウドサービスのMQTTサポートなどの使い勝手も気になってきたため、近々まとめられればと思います。</p>
<p><strong>（2021.10.1）続編が公開されました</strong></p>
<ul>
<li><a href="/articles/20211001a/">PythonでMQTT!! ～Alexaでコマンドを送信する～  | フューチャー技術ブログ</a></li>
</ul>

          
        </div>
        <footer>
          <section class="social-area">
          <!-- シェアボタン START -->
  <ul class="social-button">
    
    <!-- Twitter -->
    <li>
      <a class="social-btn twitter-btn" target="_blank" href="https://twitter.com/share?url=https://future-architect.github.io/articles/20210930a/&related=twitterapi%2Ctwitter&text=Go%E3%81%A7MQTT!!%E3%80%80%EF%BD%9E%E6%B8%A9%E6%B9%BF%E5%BA%A6%E3%83%9E%E3%82%A4%E3%82%B9%E3%82%BF%E3%83%BCbot%E3%81%AE%E4%BD%9C%E6%88%90%EF%BD%9E(%E5%BE%8C%E7%B7%A8)%20%7C%20%E3%83%95%E3%83%A5%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E6%8A%80%E8%A1%93%E3%83%96%E3%83%AD%E3%82%B0" rel="nofollow noopener">
        <i></i><span class="social-btn-label">2</span>
      </a>
    </li>
    <!-- Facebook -->
    <li>
      <a class="social-btn fb-btn" target="_blank" href="http://www.facebook.com/share.php?u=https://future-architect.github.io/articles/20210930a/&t=Go%E3%81%A7MQTT!!%E3%80%80%EF%BD%9E%E6%B8%A9%E6%B9%BF%E5%BA%A6%E3%83%9E%E3%82%A4%E3%82%B9%E3%82%BF%E3%83%BCbot%E3%81%AE%E4%BD%9C%E6%88%90%EF%BD%9E(%E5%BE%8C%E7%B7%A8)" rel="nofollow noopener">
        <i></i><span class="social-btn-label">シェア</span>
      </a>
    </li>
    <!-- hatebu -->
    <li>
      <a class="social-btn hatebu-btn" target="_blank" href="https://b.hatena.ne.jp/entry/s/future-architect.github.io/articles/20210930a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">1</span>
      </a>
    </li>
    <!-- pocket -->
    <li>
      <a class="social-btn pocket-btn" target="_blank" href="https://getpocket.com/save?url=https://future-architect.github.io/articles/20210930a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">4</span>
      </a>
    </li>
    
  </ul>
<!-- シェアボタン END -->

          </section>
          <aside>
            <section class="related-post margin-bottom-40 nav">
              <h2 id="related"><a href="#related" class="headerlink" title="関連記事"></a>関連記事</h2>
              
  <div class="widget">
    <ul class="nav related-post-link"><li class="related-posts-item"><span>2021.09.29</span><span class="snscount">&#9825;36</span><a href=/articles/20210929a/ title="今回はAWSサービスのうちの一つAWS IoTを使用してRaspberryPiとのMQTTによる通信を行います。最終的には室内の快適な温湿度を教えてくれる「温湿度マイスターbot」を作成します。"> GoでMQTT!!　～温湿度マイスターbotの作成～(前編)</a></li><li class="related-posts-item"><span>2021.10.01</span><span class="snscount">&#9825;15</span><a href=/articles/20211001a/ title="この記事は温度と湿度、不快指数を定期投稿するbotの作成を目指してハンズオンを進める構成となっています。"> PythonでMQTT!! ～Alexaでコマンドを送信する～</a></li><li class="related-posts-item"><span>2022.09.05</span><span class="snscount">&#9825;7</span><a href=/articles/20220905a/ title="夏休み自由研究ブログ連載の8本目です。昨今の観葉植物ブームに便乗して先日ドラセナ・コンパクタという熱帯アフリカ原産の植物を購入しました。茎の縞模様とパイナップルを彷彿させるような葉っぱがとても可愛らしい植物です。ふとしたときに眺めるととても癒やされます。"><span class="newitem">NEW</span> GoでADコンバータ読み出し～観葉植物監視bot構築～</a></li><li class="related-posts-item"><span>2021.08.24</span><span class="snscount">&#9825;14</span><a href=/articles/20210824a/ title="夏の自由研究ブログ連載2021の第2本目の投稿として、Sesame3にFelicaによる施錠解錠を実装しました。Sesame3はCANDY HOUSE JAPANが開発、販売しているスマートロックです。Sesame3本体に加えてwifiモジュールを購入すると、外出先から鍵の施錠/解錠を行うことができます。"> Sesame3にICカード施錠/解錠機能を実装してみた with Go & Python</a></li><li class="related-posts-item"><span>2022.02.04</span><span class="snscount">&#9825;18</span><a href=/articles/20220204a/ title="AWS Step Functionsの動的並列処理をローカルで実行する方法をハンズオン形式でまとめました。"> Step Functionsの動的並列処理をローカルで実行する</a></li><li class="related-posts-item"><span>2022.08.03</span><span class="snscount">&#9825;19</span><a href=/articles/20220803a/ title="Go1.19のライブラリマイナーチェンジの中でも、Append系メソッドに注目して紹介します"> Go1.19で追加されたAppend系メソッド</a></li></ul>
  </div>
            </section>
            <section class="reference-post margin-bottom-40 nav">
              
  <div class="card">
    <div id="reference" class="reference-lede"><a href="#reference" class="headerlink" title="参照されている記事"></a>この記事を参照している記事</div>
    <ul class="reference-post-link"><li class="reference-posts-item"><a href=/articles/20210929a/ title="今回はAWSサービスのうちの一つAWS IoTを使用してRaspberryPiとのMQTTによる通信を行います。最終的には室内の快適な温湿度を教えてくれる「温湿度マイスターbot」を作成します。"> GoでMQTT!!　～温湿度マイスターbotの作成～(前編)</a></li><li class="reference-posts-item"><a href=/articles/20211001a/ title="この記事は温度と湿度、不快指数を定期投稿するbotの作成を目指してハンズオンを進める構成となっています。"> PythonでMQTT!! ～Alexaでコマンドを送信する～</a></li><li class="reference-posts-item"><a href=/articles/20220407a/ title="ASUSが販売しているシングルボードコンピュータTinekr Board2SにAWS Greengrassの環境を構築したので記事にまとめました。 "> TinkerBoard 2S：AWS Greengrass v1をインストールする</a></li></ul>
  </div>
            </section>
          </aside>
        </footer>
      </div>
    </article>
  </main>
  <aside class="col-md-3 blog-sidebar">
    <!-- START SIDEBAR  -->


<section class="toc-section">
  <h2 class="margin-top-30">目次</h2>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><span class="toc-text">はじめに</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E5%9B%9E%E3%81%AE%E6%8C%AF%E3%82%8A%E8%BF%94%E3%82%8A"><span class="toc-text">前回の振り返り</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-AWS-IoT%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%97%E3%81%9F%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%83%85%E5%A0%B1%E3%82%92DynamoDB%E3%81%AB%E9%80%A3%E6%90%BA"><span class="toc-text">4. AWS IoTで取得した温湿度情報をDynamoDBに連携</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90"><span class="toc-text">テーブルの新規作成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%AB%E3%83%BC%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">ルールの作成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%96%8E%E9%80%9A%E7%A2%BA%E8%AA%8D"><span class="toc-text">疎通確認</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Boto3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6DynamoDB%E3%81%8B%E3%82%89%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92Query%E3%80%81%E3%83%87%E3%83%BC%E3%82%BF%E6%95%B4%E5%BD%A2"><span class="toc-text">5. Boto3を使用してDynamoDBからデータをQuery、データ整形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%8F%96%E5%BE%97%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92matplotlib%E3%81%A7%E5%8F%AF%E8%A6%96%E5%8C%96"><span class="toc-text">6. 取得データをmatplotlibで可視化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BA%E5%8A%9B%E7%B5%90%E6%9E%9C"><span class="toc-text">出力結果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E5%9B%B3%E3%82%92Slack-API%E3%81%A7%E7%94%BB%E5%83%8F%E6%8A%95%E7%A8%BF"><span class="toc-text">7. 作成したプロット図をSlack APIで画像投稿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BA%E5%8A%9B%E7%B5%90%E6%9E%9C-1"><span class="toc-text">出力結果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%81%BE%E3%81%A8%E3%82%81"><span class="toc-text">まとめ</span></a></li></ol></li></ol>
</section>

<section class="category">
<h2 class="margin-top-30">カテゴリー</h2>
<div class="widget">
  <ul class="nav sidebar-categories margin-bottom-40">
  
  <li class=""><a href="/categories/Programming/">Programming (326)</a></li>
<li class=""><a href="/categories/Infrastructure/">Infrastructure (190)</a></li>
<li class=""><a href="/categories/Culture/">Culture (77)</a></li>
<li class=""><a href="/categories/DataScience/">DataScience (43)</a></li>
<li class=""><a href="/categories/IoT/">IoT (31)</a></li>
<li class=""><a href="/categories/DB/">DB (17)</a></li>
<li class=""><a href="/categories/Business/">Business (17)</a></li>
<li class=""><a href="/categories/Management/">Management (13)</a></li>
<li class=""><a href="/categories/DevOps/">DevOps (12)</a></li>
<li class=""><a href="/categories/VR/">VR (11)</a></li>
<li class=""><a href="/categories/Design/">Design (11)</a></li>
<li class=""><a href="/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/">認証認可 (11)</a></li>
<li class=""><a href="/categories/Security/">Security (5)</a></li>

  </ul>
</div>

</section>
<section class="podcast-link">
<h2 class="margin-top-30">Tech Cast</h2>

  <div class="class="widget-wrap">
  <div class="widget">
    <ul class="nav techcast">
      <li><a href="https://anchor.fm/futuretechcast/episodes/29-CSIG-e1mle23" title="フューチャーがお届けするポッドキャストです。#29 CSIGの見据えるセキュリティの未来は？安全な国「日本」におけるサイバーセキュリティの考え方（後編）" target="_blank" rel="noopener"> #29 CSIGの見据えるセキュリティの未来は？安全な国「日本」におけるサイバーセキュリティの考え方（後編）</a></li>
<li><a href="https://anchor.fm/futuretechcast/episodes/28-CSIG-e1m7tcs" title="フューチャーがお届けするポッドキャストです。#28 CSIGってどんな組織？サイバーセキュリティ部隊の仕事を徹底解剖！！（前編）" target="_blank" rel="noopener"> #28 CSIGってどんな組織？サイバーセキュリティ部隊の仕事を徹底解剖！！（前編）</a></li>
<li><a href="https://anchor.fm/futuretechcast/episodes/27-DX-----e1l8edo" title="フューチャーがお届けするポッドキャストです。#27 【DXアプローチ】デザインワークって何?!ミンさんに基本の"き"から教わりました - 後編" target="_blank" rel="noopener"> #27 【DXアプローチ】デザインワークって何?!ミンさんに基本の"き"から教わりました - 後編</a></li>
    </ul>
  </div>
  </div>
  
</section>
<section class="advent-calendar">
<h2 class="margin-top-30">アドベントカレンダー</h2>
<div class="widget">
  <ul class="nav-flex">
    <li><a href="http://qiita.com/advent-calendar/2021/future" title="フューチャー Advent Calendar 2021 #Qiita" target="_blank" rel="noopener">2021年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2020/future" title="フューチャー Advent Calendar 2020 #Qiita" target="_blank" rel="noopener">2020年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2019/future" title="フューチャー Advent Calendar 2019 #Qiita" target="_blank" rel="noopener">2019年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2018/future" title="フューチャー Advent Calendar 2018 #Qiita" target="_blank" rel="noopener">2018年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2017/future" title="フューチャー Advent Calendar 2017 #Qiita" target="_blank" rel="noopener">2017年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2016/future" title="フューチャー Advent Calendar 2016 #Qiita" target="_blank" rel="noopener">2016年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2015/future" title="フューチャー Advent Calendar 2015 #Qiita" target="_blank" rel="noopener">2015年</a></li>
  </ul>
</div>

</section>
<!-- END SIDEBAR -->

  </aside>
</div>

  </section>
</div>

      <!-- BEGIN PRE-FOOTER -->
    <footer>
      <div class="pre-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>About Us</h2>
              <p>経営とITをデザインする、フューチャーの技術ブログです。業務で利用している幅広い技術について紹介します。<br /><br /><a target="_blank" rel="noopener" href="http://www.future.co.jp/">http://www.future.co.jp/</a></p>
              <div class="social-btn twitter-btn twitter-follow-btn">
                <a href="https://twitter.com/intent/follow?screen_name=future_techblog " target="_blank" rel="nofollow noopener">
                  <i></i><span class="tw-btn-label">フューチャー技術ブログをフォロー</span>
                </a>
              </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 col-4 pre-footer-col">
              <h2>Contact</h2>
              <address class="margin-bottom-40">
                <a href="https://www.future.co.jp/recruit/recruit/rec-fresh/" title="新卒採用" target="_blank" rel="noopener">新卒採用</a><br>
                <a href="https://www.future.co.jp/recruit/recruit/rec-career/" title="キャリア採用" target="_blank" rel="noopener">キャリア採用</a><br>
                <a href="https://www.future.co.jp/contact_us/" title="お問い合わせページ" target="_blank" rel="noopener">お問い合わせ</a><br>
                <a href="https://www.future.co.jp/architect/socialmediapolicy/" title="ソーシャルメディアポリシー" target="_blank" rel="noopener">メディアポリシー</a><br><br>
                <a href="mailto:techblog@future.co.jp">techblog@future.co.jp</a>
              </address>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>Contents</h2>
              <a href="https://future-architect.github.io/coding-standards/" title="Future Enterprise Coding Standards" target="_blank" rel="noopener">コーディング規約</a><br>
              <a href="https://future-architect.github.io/typescript-guide/" title="仕事ですぐに使えるTypeScript" target="_blank" rel="noopener">仕事ですぐに使えるTypeScript</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>Event</h2>
              <a href="https://future.connpass.com/" title="経営とITをデザインするフューチャーの勉強会です" target="_blank" rel="noopener">connpass</a><br>
              <a href="https://www.future.co.jp/futureinsightseminar/" title="フューチャーインサイトセミナー" target="_blank" rel="noopener">Webセミナー</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>SNS</h2>
              <a href="https://github.com/future-architect" title="Future's official open source repositories" target="_blank" rel="noopener">GitHub</a><br>
              <a href="https://qiita.com/organizations/future" title="フューチャーのQiita Organizationです" target="_blank" rel="noopener">Qiita</a><br>
              <a href="https://note.future.co.jp/" title="フューチャーの公式note" target="_blank" rel="noopener">未来報</a><br>
              <a href="https://www.youtube.com/channel/UCJUSwYYd0CkGgmEKAW7QVpw" title="フューチャーYoutubeチャネル" target="_blank" rel="noopener">Youtube</a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-6 padding-top-10">
              &copy; 2022 フューチャー技術ブログ<br>
            </div>
          </div>
        </div>
      </div>
    </footer>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X1C28R8H0M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X1C28R8H0M');
  gtag('config', 'UA-74047147-1'); // 過渡期対応
</script>

  </div>
</body>
</html>
