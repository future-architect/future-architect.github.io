<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!--
    ███████╗██╗░░░██╗████████╗██╗░░░██╗██████╗░███████╗
    ██╔════╝██║░░░██║╚══██╔══╝██║░░░██║██╔══██╗██╔════╝
    █████╗░░██║░░░██║░░░██║░░░██║░░░██║██████╔╝█████╗░░
    ██╔══╝░░██║░░░██║░░░██║░░░██║░░░██║██╔══██╗██╔══╝░░
    ██║░░░░░╚██████╔╝░░░██║░░░╚██████╔╝██║░░██║███████╗
    ╚═╝░░░░░░╚═════╝░░░░╚═╝░░░░╚═════╝░╚═╝░░╚═╝╚══════╝
    ████████╗███████╗░█████╗░██╗░░██╗
    ╚══██╔══╝██╔════╝██╔══██╗██║░░██║
    ░░░██║░░░█████╗░░██║░░╚═╝███████║
    ░░░██║░░░██╔══╝░░██║░░██╗██╔══██║
    ░░░██║░░░███████╗╚█████╔╝██║░░██║
    ░░░╚═╝░░░╚══════╝░╚════╝░╚═╝░░╚═╝
    ██████╗░██╗░░░░░░█████╗░░██████╗░
    ██╔══██╗██║░░░░░██╔══██╗██╔════╝░
    ██████╦╝██║░░░░░██║░░██║██║░░██╗░
    ██╔══██╗██║░░░░░██║░░██║██║░░╚██╗
    ██████╦╝███████╗╚█████╔╝╚██████╔╝
    ╚═════╝░╚══════╝░╚════╝░░╚═════╝░
    Welcome engineer.
    https://www.future.co.jp/recruit/
  -->
  
  <title>AmazonConnect BootCampセッションでハンズオン受けてきた話 | フューチャー技術ブログ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  <meta name="description" content="本記事は フューチャー Advent Calendar 2018 2日目の記事です。 まえがき近々東京リージョンに提供されることがアナウンスされたAmazonConnectのBootCampセッション@目黒に2018年10月に参加しました。 コールセンターソリューションはGoogleもContact Center AIの開始をアナウンスするなど、混戦が予想されるホットトピックだと思います。 Ama">
<meta property="og:type" content="article">
<meta property="og:title" content="AmazonConnect BootCampセッションでハンズオン受けてきた話 | フューチャー技術ブログ">
<meta property="og:url" content="https://future-architect.github.io/articles/20181202/index.html">
<meta property="og:site_name" content="フューチャー技術ブログ">
<meta property="og:description" content="本記事は フューチャー Advent Calendar 2018 2日目の記事です。 まえがき近々東京リージョンに提供されることがアナウンスされたAmazonConnectのBootCampセッション@目黒に2018年10月に参加しました。 コールセンターソリューションはGoogleもContact Center AIの開始をアナウンスするなど、混戦が予想されるホットトピックだと思います。 Ama">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_01.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_02.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_03.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_04.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_05.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_06.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_07.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_08.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_09.png">
<meta property="og:image" content="https://future-architect.github.io/images/20181202/photo_20181202_10.png">
<meta property="article:published_time" content="2018-12-02T05:21:59.000Z">
<meta property="article:modified_time" content="2022-07-04T14:47:52.697Z">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="ハンズオン">
<meta property="article:tag" content="コールセンター">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://future-architect.github.io/images/20181202/photo_20181202_01.png">
  
  <link rel="alternate" href="/atom.xml" title="フューチャー技術ブログ" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes='180x180' href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes='57x57' href="/apple-touch-icon-57x57.png">
  <link rel="canonical" href="https://future-architect.github.io/articles/20181202/">
  <meta content="AWS,ハンズオン,コールセンター" name="keywords">
  <meta content="市川諒" name="author">
  <link rel="preload" as="image" href="/banner.jpg" />
  <link rel='manifest' href='/manifest.webmanifest'/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <link rel="stylesheet" href="/metronic/assets/style.css">
  <link rel="stylesheet" href="/css/theme-styles.css">
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="corporate">
  <div class="wrap" itemscope itemtype="https://schema.org/TechArticle">
  <!-- BEGIN HEADER -->
<header class="header">
	<div class="header-overlay">
		<div class="header-menu"></div>
		<div class="header-title"><a href="/">Future Tech Blog</a></div>
		<div class="header-title-sub">フューチャー技術ブログ</div>
	</div>
</header>
<!-- Header END -->

  <div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/articles/">Blog</a></li>
    <li class="active">Post</li>
  </ul>
  <section id="main" class="margin-top-30">
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Infrastructure/">Infrastructureカテゴリ</a>
  </div>


    <h2 itemprop="name" class="article-title">AmazonConnect BootCampセッションでハンズオン受けてきた話
  
  <a target="_blank" rel="noopener" href="https://github.com/future-architect/tech-blog/edit/master/source/_posts/20181202-amazonconnect.md" title="Suggest Edits" class="github-edit"><i class="github-edit-icon"></i></a>
  
</h2>

    <div class="row">
  <main class="col-md-9 blog-posts">
    <article id="post-20181202-amazonconnect" class="article article-type-post blog-item" itemscope itemprop="blogPost">
      <div class="article-inner">
        
        <header class="article-header">
          <ul class="blog-info">
            <li class="blog-info-item"><a href="/articles/2018/" class="publish-date"><time datetime="2018-12-02T05:21:59.000Z" itemprop="datePublished">2018.12.02</time></a>
</li>
            <li class="blog-info-item"><li><a href="/authors/%E5%B8%82%E5%B7%9D%E8%AB%92" title="市川諒さんの記事一覧へ" class="post-author">市川諒</a></li></li>
            <li class="blog-info-item">
  
    
    <a href="/tags/AWS/" title="AWSタグの記事へ" class="tag-list-link">AWS</a>
  
    
    <a href="/tags/ハンズオン/" title="ハンズオンタグの記事へ" class="tag-list-link">ハンズオン</a>
  
    
    <a href="/tags/コールセンター/" title="コールセンタータグの記事へ" class="tag-list-link">コールセンター</a>
  

</li>
          </ul>
          </header>
        
        <div class="article-entry" itemprop="articleBody">
          
            <p>本記事は <a target="_blank" rel="noopener" href="https://qiita.com/advent-calendar/2018/future">フューチャー Advent Calendar 2018 2日目</a>の記事です。</p>
<h1 id="まえがき"><a href="#まえがき" class="headerlink" title="まえがき"></a>まえがき</h1><p>近々東京リージョンに提供されることがアナウンスされたAmazonConnectのBootCampセッション@目黒に2018年10月に参加しました。</p>
<p>コールセンターソリューションはGoogleもContact Center AIの開始をアナウンスするなど、混戦が予想されるホットトピックだと思います。</p>
<p>AmazonConnectは海外・日本での導入事例も増えてきていますが、ブログはまだ数が少ないと思いますので、実際に手を動かした作った仕組みと合わせて共有します。</p>
<h2 id="AmazonConnect-Session-day1-2018-11-06"><a href="#AmazonConnect-Session-day1-2018-11-06" class="headerlink" title="AmazonConnect Session#day1 2018.11.06"></a>AmazonConnect Session#day1 2018.11.06</h2><h3 id="セールスと技術担当者からのAmazonConnectの説明"><a href="#セールスと技術担当者からのAmazonConnectの説明" class="headerlink" title="セールスと技術担当者からのAmazonConnectの説明"></a>セールスと技術担当者からのAmazonConnectの説明</h3><p>米AWSから営業のご担当とソリューションアーキテクトの方がいらっしゃって、両名からの講義という形でした。<br>完全に全編英語となりびっくりしましたが、日本AWSの方の通訳があるため安心です。</p>
<p>AWSの広告っぽくなってしまうので、サラッと記載します。</p>
<h2 id="Sales"><a href="#Sales" class="headerlink" title="Sales"></a>Sales</h2><h3 id="AmazonConnectについて"><a href="#AmazonConnectについて" class="headerlink" title="AmazonConnectについて"></a>AmazonConnectについて</h3><ul>
<li>AmazonConnectのサービス自体は1.5年前から開始され、東京リージョンでのサービスインも決定している</li>
<li>今となっては大規模な導入事例もあり、安定した実績がある。（海外では銀行やISP、アパレルなど様々）</li>
<li>もともとはAmazonのEC事業を支えるコールセンター業務向けのソリューション</li>
</ul>
<h3 id="AmazonConnectのウリ"><a href="#AmazonConnectのウリ" class="headerlink" title="AmazonConnectのウリ"></a>AmazonConnectのウリ</h3><ul>
<li>S3に録音データを保存したり、LambdaやSageMaker、Lexなどと連携させることで高度なコールセンターソリューションを提供できる</li>
<li>CRM（顧客管理システム）との連携も容易で、熟達していなくても1, 2時間で連携作業が完了できる</li>
<li>セールスポイントは利用料は使った分だけ。スケーラビリティにも優れているので、自分でスケールを意識しなくていい<ul>
<li>オペレータが5人から5,000人に増えようと、クリスマス商戦があろうと、自動でスケールする</li>
</ul>
</li>
<li>IVRやCTIみたいな大規模設備は不要で、インターネット回線だけあれば使える</li>
<li>おおよその顧客で25%程度の運用費節約ができている</li>
</ul>
<h2 id="Solution-Architect"><a href="#Solution-Architect" class="headerlink" title="Solution Architect"></a>Solution Architect</h2><h3 id="リージョン展開について"><a href="#リージョン展開について" class="headerlink" title="リージョン展開について"></a>リージョン展開について</h3><ul>
<li>東京リージョンのConnectは今現在インプリを行っている状態</li>
<li>近いところではシドニーリージョン。日本の電話番号もここで取得可能</li>
</ul>
<h3 id="AWSマネージドサービスとの連携"><a href="#AWSマネージドサービスとの連携" class="headerlink" title="AWSマネージドサービスとの連携"></a>AWSマネージドサービスとの連携</h3><p>様々なサービスと連携可能で、特に下記のサービスとの連携事例が多いそうです。</p>
<div class="scroll"><table>
<thead>
<tr>
<th>サービス</th>
<th>概要</th>
</tr>
</thead>
<tbody><tr>
<td>Lambda</td>
<td>関数を実行して、DBやEC2などと連携させる。    この子のおかげで柔軟なソリューションを構築可能。</td>
</tr>
<tr>
<td>Lex</td>
<td>対話型インターフェースサービス。    IVRで一番イヤなのは耳に電話当てたり、キーバッド触ったりが頻発するところ。    あと、問い合わせ番号はえてして長いことが多いです。    Lexを使えば、しゃべった言葉を理解して、Lambdaの引数として渡す、とかできます。    ※日本語未対応・・・</td>
</tr>
<tr>
<td>Polly</td>
<td>テキスト読み上げサービス。    自然な感じのイントネーションで文章を読み上げてくれる。    日本語対応済み。（Takumi（男性）とMizuki（女性））    SSMLにも対応しており、やろうと思えばかなり自然にできる。（初音ミク感）</td>
</tr>
<tr>
<td>S3</td>
<td>言わずとしれたストレージサービス。    録音データの保存などに使われます。</td>
</tr>
<tr>
<td>Kinesis Firehose, Streams</td>
<td>ストリーミングデータをリアルタイムに収集、処理するサービス。    ゼロ管理で若干タイムラグが発生してもいいならFirehose、    より高速な処理を求めるならStreamsをおすすめするとのこと。</td>
</tr>
<tr>
<td>Redshift</td>
<td>DWHのサービス。Kinesisなどで取得したログをクエリできるように    保存するために利用します。</td>
</tr>
<tr>
<td>Athena</td>
<td>Redshiftの友達ですが、よりライトなクエリ基盤。</td>
</tr>
<tr>
<td>Glue</td>
<td>ETL（データ準備）サービス。RedshiftやAthenaに必要な情報だけ貯めるために使います。</td>
</tr>
<tr>
<td>Quicksite</td>
<td>情報可視化基盤。ライトにやるならKinesisで取得してGlueで必要情報だけ抜いて    Athenaでクエリ環境を整えてQuicksiteで見る。</td>
</tr>
</tbody></table></div>
<p>例えば、以下のようなデモでAWSマネージドサービスとの連携が説明されました。</p>
<ul>
<li>Kibanaで表示する<a target="_blank" rel="noopener" href="https://aws.amazon.com/jp/blogs/big-data/analyzing-amazon-connect-records-with-amazon-athena-aws-glue-and-amazon-quicksight/">デモ</a>をやってた。※URLではQuicksite</li>
<li>Amazon connectのコンソールでもリアルタイム&#x2F;オンデマンドのデータを表示できる。（とはいえ可視化できるデータは少なめ）</li>
</ul>
<h3 id="3rd-Party-システムとの連携"><a href="#3rd-Party-システムとの連携" class="headerlink" title="3rd-Party システムとの連携"></a>3rd-Party システムとの連携</h3><p>引用ですが、下記のスライドで説明がありました。<br><img src="/images/20181202/photo_20181202_01.png" loading="lazy"></p>
<h3 id="CCP（ソフトフォン）の拡張"><a href="#CCP（ソフトフォン）の拡張" class="headerlink" title="CCP（ソフトフォン）の拡張"></a>CCP（ソフトフォン）の拡張</h3><p>デフォルトのソフトフォンだと、必要なCRMの情報が出力できないなど、昨今の日本のコールセンター向けとしては利用に耐えられないと思われますが、拡張が可能になっています。</p>
<h4 id="Streams-API"><a href="#Streams-API" class="headerlink" title="Streams API"></a>Streams API</h4><ul>
<li>Githubにてオープンソースで提供</li>
<li>CCP（ソフトフォン）を操作するAPI群</li>
<li>CCPの機能拡張や表示項目の追加などができる</li>
<li>iFrame with hidden divとか使うとCCPは非表示のまま、拡張された機能のみ利用可能</li>
<li>connect integration whitelisting: URLフィルタを使って、CCPにアクセスできるURLをフィルタリング可能</li>
<li>こんな<a target="_blank" rel="noopener" href="https://www.connectdemo.com/">サイト</a> もある。（AWSの中の人作のデモ環境だそうです）</li>
</ul>
<p>長くなりましたが、１日目はこのような流れで終了しました。<br>２日目は実際にハンズオンをしながらAmazonConnectでコールセンタソリューションを構築します。</p>
<h2 id="AmazonConnect-Session-day2-2018-11-07"><a href="#AmazonConnect-Session-day2-2018-11-07" class="headerlink" title="AmazonConnect Session#day2 2018.11.07"></a>AmazonConnect Session#day2 2018.11.07</h2><h3 id="Connectインスタンスの作成"><a href="#Connectインスタンスの作成" class="headerlink" title="Connectインスタンスの作成"></a>Connectインスタンスの作成</h3><img src="/images/20181202/photo_20181202_02.png" style="border:solid 1px #000000" loading="lazy">


<ul>
<li>通常2つのインスタンスを作ることが多い（本番・検証）</li>
<li>既存のAWS Directory Serviceにリンクしたり、SAML2.0認証も可能</li>
<li>自動で2つのS3Bucketが作成される。（通話履歴、出力されたレポート用と問い合わせフローログ）<ul>
<li>設定カスタマイズをする場合は、録音データの暗号化キー（KMS）の選択や録音データの保存先Bucketの変更が可能</li>
</ul>
</li>
<li>5Stepsでインスタンスに関わる全ての設定が完了する</li>
<li>CloudFormationでの構築も可能</li>
<li>後ほど、AmazonConnect &gt; インスタンスエイリアスから設定変更可能</li>
</ul>
<h3 id="インスタンスの設定"><a href="#インスタンスの設定" class="headerlink" title="インスタンスの設定"></a>インスタンスの設定</h3><img src="/images/20181202/photo_20181202_03.png" style="border:solid 1px #000000" loading="lazy">


<ul>
<li>テレフォニー：発信・着信をAmazonConnectで処理するか否かを設定</li>
<li>データストレージ：S3&#x2F;KMSの設定が可能。クレジット情報などを扱う場合は暗号化必須です</li>
<li>データストリーミング：Kinesisに対するアクセス許可設定を有効にできる</li>
<li>アプリケーション統合：CRMやWFM（ワークフォースマネジメント）システムと統合する設定が可能</li>
<li>問い合わせフロー：問い合わせフローの暗号化、Amazon Lexとの統合、問い合わせフローログの設定が可能</li>
</ul>
<p>この画面に「管理者としてログイン」ボタンがありますが、セキュリティ的に通常利用はしないそう。（パスワード忘れのときのみ）AWSのルートアカウントのような扱いですね。<br>また、CloudFrontを経由しているらしく、若干不具合（ロードが遅いなど）が起きました（研修中に403 Error結構出てました…）</p>
<h3 id="1-電話番号の取得"><a href="#1-電話番号の取得" class="headerlink" title="1. 電話番号の取得"></a>1. 電話番号の取得</h3><p>ここからはAmazonConnectの管理画面にログインして操作をします。<br><img src="/images/20181202/photo_20181202_04.png" loading="lazy"></p>
<ul>
<li>Direct Call（通常回線）とFree Dial（フリーダイヤル）が選択可能<ul>
<li>気になったのが、通常回線の050はいいとして、フリーダイヤルの0800は馴染みが無いですね</li>
</ul>
</li>
<li>電話番号の管理から電話番号の取得&#x2F;削除及び番号ごとのIVRフローの変更を行うことができる</li>
<li>日本の電話番号が取れない事象も起こり、そこのリソース枯渇もスコープに入れ、事前に確保しておくと無難です</li>
</ul>
<h3 id="2-電話応対時間の設定"><a href="#2-電話応対時間の設定" class="headerlink" title="2. 電話応対時間の設定"></a>2. 電話応対時間の設定</h3><img src="/images/20181202/photo_20181202_05.png" loading="lazy">


<ul>
<li>オペレーション時間（Hours of operation）から実際に電話が通じる時間を決められる<ul>
<li>TimezoneをAsia&#x2F;Tokyoにすること！</li>
<li>作成された段階ではキューがアタッチされていない状況になる。時間の適用を行う際はキューにアタッチをすること</li>
</ul>
</li>
</ul>
<h3 id="3-キューの作成"><a href="#3-キューの作成" class="headerlink" title="3. キューの作成"></a>3. キューの作成</h3><img src="/images/20181202/photo_20181202_06.png" loading="lazy">

<ul>
<li>先程作成したオペレーション時間（Hours of operation）との紐付けを行う</li>
<li>Outbound caller ID nameで通知される際の表示文字を決められる</li>
<li>Outbound caller ID numberで通知される電話番号を決められる</li>
<li>Outbound whisper flowでキューごとに最初の音声を変えられる</li>
<li>Maximum contacts in queueでキューに何人待たせられるかを決められる。ここは最大99になっているが、AWSへの緩和申請で上限を変えられる</li>
<li>Quick connectsで他のキューに飛ばしたり、転送したりが可能</li>
</ul>
<h3 id="4-プロンプトの作成"><a href="#4-プロンプトの作成" class="headerlink" title="4. プロンプトの作成"></a>4. プロンプトの作成</h3><img src="/images/20181202/photo_20181202_07.png" loading="lazy">


<ul>
<li>Create new promptにて相手に聞かせる音声の録音やファイルのアップロード（.wav）が可能</li>
<li>問い合わせフロー内でPollyに喋らせることも可能なので、フロー作成の際はそちらで手軽に代用も可能です</li>
<li>自然な人間の声や音楽が必要な際はここから登録して利用が必要です</li>
</ul>
<h3 id="5-問い合わせフローの作成"><a href="#5-問い合わせフローの作成" class="headerlink" title="5. 問い合わせフローの作成"></a>5. 問い合わせフローの作成</h3><img src="/images/20181202/photo_20181202_08.png" style="border:solid 1px #000000" loading="lazy">

<ul>
<li>サンプルのフローが20近くあり、それらを修正しても良いかも</li>
<li>基本はブロックをつないでいけばIVRが簡単に構築できます<ul>
<li>Lambdaやその他連携ツールへの理解があれば、現場のCS担当でも高度な改善ができるかも</li>
</ul>
</li>
<li>Contact Flows<ul>
<li>IVRで使用されるフローをグラフィカルに作成可能</li>
<li>8つのFlowを定義可能<ul>
<li>customer queue flow: キューに入ったときのフロー（ユースケース：品質改善のため録音しています、みたいな案内や録音処理、ロギング開始とか）</li>
<li>customer hold flow: 保留時にカスタマーが体験するフロー</li>
<li>customer whisper flow: エージェントが受信してから、実際に通話を初める直前にカスタマーが体験するフロー</li>
<li>outbound whisper flow: コールバックをエージェントが処理して、コールバック先が電話を取った時コールバックを受けた相手が体験するフロー（ユースケース：顧客情報を渡したり、引き継ぎ情報を渡したりできる）</li>
<li>agent hold flow: 保留時にエージェントが体験するフロー</li>
<li>agent whisper flow: エージェントが受信してから、実際に通話を初める直前にエージェントが体験するフロー（ユースケース：顧客情報を電話番号からDBに取得に行ってそれを表示するとか）</li>
<li>transfer to agent flow: あるエージェントが、別のエージェントにクイックコネクトで転送するときにあるエージェントが体験するフロー</li>
<li>transfer to queue flow: あるエージェントが、別のキューにクイックコネクトで転送するときにあるエージェントが体験するフロー</li>
</ul>
</li>
<li>これらのフローを使って、フロー全体が大きくなりすぎないよう、フローをつないで利用するのがベストプラクティスとのこと</li>
</ul>
</li>
</ul>
<h3 id="Contact-flow-designer"><a href="#Contact-flow-designer" class="headerlink" title="Contact flow designer"></a>Contact flow designer</h3><img src="/images/20181202/photo_20181202_09.png" loading="lazy">


<ul>
<li>GUIのドラッグ・アンド・ドロップでフローを構築可能</li>
<li>複雑になりがちなので、拡大縮小機能あり</li>
<li>上述しましたが、ベストプラクティスとしては小さいフローを構築し、それらを結合するのが良い</li>
<li>以下のSetやInteractはFlowの種類によって若干使えるものが違う。（例えばhold系のFlowではLoopで音楽を流すみたいな機能が使える）</li>
</ul>
<h4 id="Interact"><a href="#Interact" class="headerlink" title="Interact"></a>Interact</h4><ul>
<li>ユーザ入力などのインタラクティブな処理を行う</li>
<li>ユーザ入力の取得、保存、保留、プロンプトの再生が可能</li>
<li>すべてのコネクタを接続する必要があり、AWSで用意されているのは<ul>
<li>Error: Errorになったのをみたことは無いらしい</li>
<li>Default: 設定した番号以外をユーザが押した場合</li>
<li>Timeout: ユーザが何もしなかったとき</li>
</ul>
</li>
</ul>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><ul>
<li>working queueを使ってLambdaと連携し、Dynamoと連携することで大量のキューを捌くなどのユースケースがある</li>
<li>set contact attributesを使うことでキューの状態や3rd-PartyのAPIから取得したデータを使って顧客の氏名を取得・利用したり、LambdaでDBにアクセスしてその返り値を利用したりできる</li>
<li>Routing ProfileでQueueに対するPriorityを変更できたが、IVRの選択や属性、時間を利用してContact flow designerにおいて呼単位でPriorityを変えることが可能。（キューでの滞留時間の長いものを優先的にする、など）</li>
<li>Call back numberを利用することで、キューの滞留が解消されたらシステムから電話するようなシステムフローを構築することも可能。ユーザは一旦電話を切ることができるし、その間は課金が発生しない</li>
<li>WebページにAPIを使ってCall backやCall meの機能を使うことが可能。もちろんAttributeも利用可能。</li>
</ul>
<h4 id="Branch"><a href="#Branch" class="headerlink" title="Branch"></a>Branch</h4><ul>
<li>ユーザ属性やキューの滞留などを基にフローを分けるなんてことも可能</li>
</ul>
<h4 id="Integrate"><a href="#Integrate" class="headerlink" title="Integrate"></a>Integrate</h4><ul>
<li>Lambdaを使って様々な外部サービスと接続できる</li>
<li>通常Lambdaはcoldからの起動になるので、Timeoutはデフォルトの3秒から最大の8秒に修正しましょう（特に最初のLambdaの起動）<ul>
<li>CloudWatchで30分間隔くらいでPingすれば常にWarmにしておける。</li>
</ul>
</li>
</ul>
<h4 id="Terminate-x2F-Transfer"><a href="#Terminate-x2F-Transfer" class="headerlink" title="Terminate &#x2F; Transfer"></a>Terminate &#x2F; Transfer</h4><ul>
<li>Transfer flowを使うことで他のフローに転送することができ、フローを小さく保つことが可能</li>
<li>Transfer Queueを使うことで後でかけ直す機能が作成できる。</li>
<li>Transfer to phone numberを使うことで固定電話や携帯電話に転送することができる。もちろん、IP電話でもOK</li>
</ul>
<h4 id="エラー処理"><a href="#エラー処理" class="headerlink" title="エラー処理"></a>エラー処理</h4><ul>
<li>適切なフローに投げるか接続を切るか、の処理を行い、通話の最初に戻る、みたいなことはLoopを起こすのでやめましょう。</li>
</ul>
<h4 id="6-ルーティングプロファイルの作成"><a href="#6-ルーティングプロファイルの作成" class="headerlink" title="6. ルーティングプロファイルの作成"></a>6. ルーティングプロファイルの作成</h4><img src="/images/20181202/photo_20181202_10.png" loading="lazy">


<ul>
<li>Routing profilesはキューのグループになる -&gt; 呼をどのようにエージェントに振り分けるかのグループ</li>
<li>キューごとにプライオリティを決めることが可能<ul>
<li>優先度（Priority）は小さい方が優先される</li>
<li>遅延（Delay）はキューに転送開始するまでの最低待ち時間</li>
</ul>
</li>
<li>キューの割当により、いわゆるスキルベース（エージェントのスキルによって割当を変える）のルーティングも可能</li>
</ul>
<h4 id="7-ユーザー管理"><a href="#7-ユーザー管理" class="headerlink" title="7. ユーザー管理"></a>7. ユーザー管理</h4><ul>
<li>ユーザーマネジメントからユーザの追加&#x2F;削除が可能<ul>
<li>追加する場合は手動入力 or CSVに入力してアップロードすることも可能。</li>
<li>またはAPIから登録することも可能</li>
<li>Security Profilesからは4つのロールが選択可能（自分で自作することも可能）</li>
</ul>
</li>
</ul>
<div class="scroll"><table>
<thead>
<tr>
<th>ロール</th>
<th>説明</th>
</tr>
</thead>
<tbody><tr>
<td>Agent</td>
<td>管理者用。全リソースへのアクセスと操作ができる。</td>
</tr>
<tr>
<td>CallCenterManager</td>
<td>エージェント用。Contact Control Panel (CCP)へのアクセスのみ可能。</td>
</tr>
<tr>
<td>Admin</td>
<td>コンタクトセンター管理者用。ユーザーとアクセス権限、メトリクスおよび品質、ルーティングへのアクセスが可能。</td>
</tr>
<tr>
<td>QualityAnalyst</td>
<td>スーパーバイザー、コンタクトセンター管理者用。メトリクスおよび品質へのアクセスのみ可能。</td>
</tr>
</tbody></table></div>
<h4 id="3rd-partyへのストリーム"><a href="#3rd-partyへのストリーム" class="headerlink" title="3rd-partyへのストリーム"></a>3rd-partyへのストリーム</h4><p>レイテンシは当然気になりますよね？<br>顧客 -&gt; Stream -&gt; Speech to Textサービスのような形で日本語で話した内容を解釈してマネージドサービスと連携できるいい方法がないか知りたかったのですが、現時点（2018&#x2F;11&#x2F;07）では無いようです。<br>ただ、今後、以下は予定されているとのことです。</p>
<ul>
<li>Kinesis video streamを利用可能になる予定</li>
<li>LEXの日本語対応はまだ先（ロードマップにはある）</li>
</ul>
<h2 id="実際に作ってみた"><a href="#実際に作ってみた" class="headerlink" title="実際に作ってみた"></a>実際に作ってみた</h2><p>ECサイトで注文情報の変更・キャンセルを行う自動応答システムをイメージして、コールフローを作成しました。<br>前提として、注文番号とかお問い合わせ番号は長すぎるので、ダイアルプッシュでなく音声認識で受付ができるようにしました。</p>
<h3 id="フロー"><a href="#フロー" class="headerlink" title="フロー"></a>フロー</h3><ol>
<li>電話をかけるとDynamoDBから最近の注文情報を電話番号を基に取得して、「最近〇〇をご購入いただきましたが、これに関するご質問ですか？」と音声を流します</li>
<li>ここはIVRで分岐としました<ol start="3">
<li>AIボットで注文情報の変更　→　「Change shipping date.」「Day after tomorrow」とか言うとDynamoDBにLambda経由で更新</li>
<li>キャンセル　→　DynamoDBにLambda経由でキャンセルフラグを更新</li>
<li>オペレータに電話転送</li>
</ol>
</li>
<li>上記1と2の場合はSMSもLambda経由で送るようにしました</li>
</ol>
<h4 id="全体図"><a href="#全体図" class="headerlink" title="全体図"></a>全体図</h4><img src="/images/20181202/photo_20181202_11.png" style="border:solid 1px #000000" loading="lazy">



<h3 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h3><p>前提として、電話番号の取得などの基本的な設定は完了しているものとして進めます。</p>
<h4 id="先ずはDynamoDBにデモ用のデータを入れます。"><a href="#先ずはDynamoDBにデモ用のデータを入れます。" class="headerlink" title="先ずはDynamoDBにデモ用のデータを入れます。"></a>先ずはDynamoDBにデモ用のデータを入れます。</h4><ul>
<li>JustinさんがNorth Faceのジャケットを買った的なデータです。</li>
</ul>
<figure class="highlight sh"><figcaption><span>デモデータ投入</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ aws dynamodb put-item --table-name CustomerTable --item <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;orderId&quot;: &#123;&quot;S&quot;: &quot;100&quot;&#125;,</span></span><br><span class="line"><span class="string">    &quot;orderedItem&quot;: &#123;&quot;S&quot;: &quot;The North Face Summit L3 Ventrix 2.0 Hoodie&quot;&#125;,</span></span><br><span class="line"><span class="string">    &quot;shippingDate&quot;: &#123;&quot;S&quot;: &quot;2018-11-12&quot;&#125;,</span></span><br><span class="line"><span class="string">    &quot;customerName&quot;: &#123;&quot;S&quot;: &quot;Justin&quot;&#125;,</span></span><br><span class="line"><span class="string">    &quot;CallerID&quot;: &#123;&quot;S&quot;: &quot;+819012345678&quot;&#125;,</span></span><br><span class="line"><span class="string">    &quot;isCancel&quot;: &#123;&quot;S&quot;: &quot;False&quot;&#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="Lambdaを作成します。今回は下記の３つを作成しました。"><a href="#Lambdaを作成します。今回は下記の３つを作成しました。" class="headerlink" title="Lambdaを作成します。今回は下記の３つを作成しました。"></a>Lambdaを作成します。今回は下記の３つを作成しました。</h4><p>エラーチェックとか不要な変数とか目を瞑ってください・・・。<br>キャンセルTrueでも配送日変更できるなどツッコミどころ満載です。</p>
<pre><code>1. 注文情報の読み込み（直近の注文履歴参照用）
2. キャンセル書き込み用
3. 配送情報変更用
</code></pre>
<h5 id="注文情報の読み込み（直近の注文履歴参照用）"><a href="#注文情報の読み込み（直近の注文履歴参照用）" class="headerlink" title="注文情報の読み込み（直近の注文履歴参照用）"></a>注文情報の読み込み（直近の注文履歴参照用）</h5><figure class="highlight javascript"><figcaption><span>OrderTableRead</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">AWS</span> = <span class="built_in">require</span>(<span class="string">&quot;aws-sdk&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> docClient = <span class="keyword">new</span> <span class="variable constant_">AWS</span>.<span class="property">DynamoDB</span>.<span class="title class_">DocumentClient</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">handler</span> = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">CallerID</span> = event.<span class="property">Details</span>.<span class="property">Parameters</span>.<span class="property">CallerID</span>;</span><br><span class="line">  <span class="keyword">var</span> paramsQuery = &#123;</span><br><span class="line">    <span class="title class_">TableName</span>: <span class="string">&#x27;CustomerTable&#x27;</span>,</span><br><span class="line">    <span class="title class_">KeyConditionExpression</span>: <span class="string">&quot;CallerID = :varNumber&quot;</span>,</span><br><span class="line">    <span class="title class_">ExpressionAttributeValues</span>: &#123; <span class="string">&quot;:varNumber&quot;</span>: <span class="title class_">CallerID</span> &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  docClient.<span class="title function_">query</span>(paramsQuery, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">      <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title function_">buildResponse</span>(<span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;DynamoDB Query Results:&quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (data.<span class="property">Items</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Customer not Found in CustomerTable&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> recordFound = <span class="string">&quot;False&quot;</span>;</span><br><span class="line">        <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title function_">buildResponse</span>(<span class="literal">true</span>, recordFound));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> recordFound = <span class="string">&quot;True&quot;</span></span><br><span class="line">        <span class="keyword">var</span> customerName = data.<span class="property">Items</span>[<span class="number">0</span>].<span class="property">customerName</span>;</span><br><span class="line">        <span class="keyword">var</span> orderId = data.<span class="property">Items</span>[<span class="number">0</span>].<span class="property">orderId</span>;</span><br><span class="line">        <span class="keyword">var</span> orderedItem = data.<span class="property">Items</span>[<span class="number">0</span>].<span class="property">orderedItem</span>;</span><br><span class="line">        <span class="keyword">var</span> shippingDate = data.<span class="property">Items</span>[<span class="number">0</span>].<span class="property">shippingDate</span>;</span><br><span class="line">        <span class="keyword">var</span> isCancel = data.<span class="property">Items</span>[<span class="number">0</span>].<span class="property">isCancel</span>;</span><br><span class="line">        <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title function_">buildResponse</span>(<span class="literal">true</span>, recordFound, customerName, orderId, orderedItem, shippingDate, isCancel));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildResponse</span>(<span class="params">isSuccess, recordFound, customerName, orderId, orderedItem, shippingDate, isCancel</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">recordFound</span>: recordFound,</span><br><span class="line">        <span class="attr">customerName</span>: customerName,</span><br><span class="line">        <span class="attr">orderId</span>: orderId,</span><br><span class="line">        <span class="attr">orderedItem</span>: orderedItem,</span><br><span class="line">        <span class="attr">shippingDate</span>: shippingDate,</span><br><span class="line">        <span class="attr">isCancel</span>: isCancel,</span><br><span class="line">        <span class="attr">lambdaResult</span>: <span class="string">&quot;Success&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Lambda returned error to Connect&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">lambdaResult</span>: <span class="string">&quot;Error&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="キャンセル書き込み用"><a href="#キャンセル書き込み用" class="headerlink" title="キャンセル書き込み用"></a>キャンセル書き込み用</h5><figure class="highlight javascript"><figcaption><span>CancelOrder</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">AWS</span> = <span class="built_in">require</span>(<span class="string">&quot;aws-sdk&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> docClient = <span class="keyword">new</span> <span class="variable constant_">AWS</span>.<span class="property">DynamoDB</span>.<span class="title class_">DocumentClient</span>();</span><br><span class="line"><span class="keyword">var</span> sns = <span class="keyword">new</span> <span class="variable constant_">AWS</span>.<span class="title function_">SNS</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">handler</span> = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 発信電話番号の取得</span></span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">CallerID</span> = event.<span class="property">Details</span>.<span class="property">ContactData</span>.<span class="property">CustomerEndpoint</span>.<span class="property">Address</span>;</span><br><span class="line">  <span class="comment">// 商品名, ID</span></span><br><span class="line">  <span class="keyword">var</span> orderedItem = event.<span class="property">Details</span>.<span class="property">Parameters</span>.<span class="property">orderedItem</span>;</span><br><span class="line">  <span class="keyword">var</span> orderId = event.<span class="property">Details</span>.<span class="property">Parameters</span>.<span class="property">orderId</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> params = &#123;</span><br><span class="line">    <span class="title class_">TableName</span>: <span class="string">&quot;CustomerTable&quot;</span>,</span><br><span class="line">    <span class="title class_">Key</span>:&#123;</span><br><span class="line">        <span class="string">&quot;CallerID&quot;</span>: <span class="title class_">CallerID</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">UpdateExpression</span>: <span class="string">&quot;set isCancel = :c&quot;</span>,</span><br><span class="line">    <span class="title class_">ExpressionAttributeValues</span>: &#123;</span><br><span class="line">        <span class="string">&quot;:c&quot;</span>: <span class="string">&quot;True&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">ReturnValues</span>: <span class="string">&quot;UPDATED_NEW&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  docClient.<span class="title function_">update</span>(params, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">      <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title function_">buildResponse</span>(<span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;DynamoDB record updated:&quot;</span> + params);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">SMSparams</span> = &#123;</span><br><span class="line">                    <span class="title class_">Message</span>: <span class="string">&#x27;We changed state to cancel.\nItem Name: &#x27;</span> + orderedItem + <span class="string">&#x27;\nOrder ID: &#x27;</span> + orderId,</span><br><span class="line">                    <span class="title class_">MessageStructure</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">                    <span class="title class_">PhoneNumber</span>: <span class="title class_">CallerID</span></span><br><span class="line">                    &#125;;</span><br><span class="line">            sns.<span class="title function_">publish</span>(<span class="title class_">SMSparams</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) <span class="variable language_">console</span>.<span class="title function_">log</span>(err, err.<span class="property">stack</span>); <span class="comment">// an error occurred</span></span><br><span class="line">                    <span class="keyword">else</span>     <span class="variable language_">console</span>.<span class="title function_">log</span>(data);           <span class="comment">// successful response</span></span><br><span class="line">                    <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title function_">buildResponse</span>(<span class="literal">true</span>));</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildResponse</span>(<span class="params">isSuccess</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">lambdaResult</span>: <span class="string">&quot;Success&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Lambda returned error to Connect&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">lambdaResult</span>: <span class="string">&quot;Error&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="配送日変更用"><a href="#配送日変更用" class="headerlink" title="配送日変更用"></a>配送日変更用</h5><figure class="highlight javascript"><figcaption><span>ChangeOrderDate</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">AWS</span> = <span class="built_in">require</span>(<span class="string">&quot;aws-sdk&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> docClient = <span class="keyword">new</span> <span class="variable constant_">AWS</span>.<span class="property">DynamoDB</span>.<span class="title class_">DocumentClient</span>();</span><br><span class="line"><span class="keyword">var</span> sns = <span class="keyword">new</span> <span class="variable constant_">AWS</span>.<span class="title function_">SNS</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">handler</span> = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 発信電話番号の取得</span></span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">CallerID</span> = event.<span class="property">Details</span>.<span class="property">ContactData</span>.<span class="property">CustomerEndpoint</span>.<span class="property">Address</span>;</span><br><span class="line">  <span class="comment">// 商品名, ID</span></span><br><span class="line">  <span class="keyword">var</span> orderedItem = event.<span class="property">Details</span>.<span class="property">Parameters</span>.<span class="property">orderedItem</span>;</span><br><span class="line">  <span class="keyword">var</span> orderId = event.<span class="property">Details</span>.<span class="property">Parameters</span>.<span class="property">orderId</span>;</span><br><span class="line">  <span class="comment">// 発送日</span></span><br><span class="line">  <span class="keyword">var</span> shippingDate = event.<span class="property">Details</span>.<span class="property">Parameters</span>.<span class="property">shippingDate</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> params = &#123;</span><br><span class="line">    <span class="title class_">TableName</span>: <span class="string">&quot;CustomerTable&quot;</span>,</span><br><span class="line">    <span class="title class_">Key</span>:&#123;</span><br><span class="line">        <span class="string">&quot;CallerID&quot;</span>: <span class="title class_">CallerID</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">UpdateExpression</span>: <span class="string">&quot;set shippingDate = :s&quot;</span>,</span><br><span class="line">    <span class="title class_">ExpressionAttributeValues</span>: &#123;</span><br><span class="line">        <span class="string">&quot;:s&quot;</span>: shippingDate</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">ReturnValues</span>: <span class="string">&quot;UPDATED_NEW&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  docClient.<span class="title function_">update</span>(params, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">      <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title function_">buildResponse</span>(<span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;DynamoDB record updated:&quot;</span> + params);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">SMSparams</span> = &#123;</span><br><span class="line">                    <span class="title class_">Message</span>: <span class="string">&#x27;We changed shipping date to &#x27;</span> + shippingDate + <span class="string">&#x27;\nItem Name: &#x27;</span> + orderedItem + <span class="string">&#x27;\nOrder ID: &#x27;</span> + orderId,</span><br><span class="line">                    <span class="title class_">MessageStructure</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">                    <span class="title class_">PhoneNumber</span>: <span class="title class_">CallerID</span></span><br><span class="line">                    &#125;;</span><br><span class="line">            sns.<span class="title function_">publish</span>(<span class="title class_">SMSparams</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) <span class="variable language_">console</span>.<span class="title function_">log</span>(err, err.<span class="property">stack</span>); <span class="comment">// an error occurred</span></span><br><span class="line">                    <span class="keyword">else</span>     <span class="variable language_">console</span>.<span class="title function_">log</span>(data);           <span class="comment">// successful response</span></span><br><span class="line">                    <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title function_">buildResponse</span>(<span class="literal">true</span>));</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildResponse</span>(<span class="params">isSuccess</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">lambdaResult</span>: <span class="string">&quot;Success&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Lambda returned error to Connect&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">lambdaResult</span>: <span class="string">&quot;Error&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AmazonConnectからLambdaを呼び出すためのパーミッションの設定をします。（現状GUIからは設定不可）"><a href="#AmazonConnectからLambdaを呼び出すためのパーミッションの設定をします。（現状GUIからは設定不可）" class="headerlink" title="AmazonConnectからLambdaを呼び出すためのパーミッションの設定をします。（現状GUIからは設定不可）"></a>AmazonConnectからLambdaを呼び出すためのパーミッションの設定をします。（現状GUIからは設定不可）</h4><ul>
<li>併せてLambdaからDynamoDB&#x2F;SNSへのFullAccessも許可しておきます（デモなのでセキュリティはご愛嬌で・・・）</li>
<li>本来はアクセスすべきリソースだけ指定してください<ul>
<li>読み込みだけのLambdaならDynamoDBへのReadOnlyなど</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><figcaption><span>AmazonConnectからLambdaを呼び出すためのパーミッションの設定</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws lambda add-permission --function-name <span class="keyword">function</span>:&lt;Lambda Function名&gt; \</span><br><span class="line"> --statement-id 1 --principal connect.amazonaws.com  \</span><br><span class="line"> --action lambda:InvokeFunction --source-account &lt;AWSアカウントID&gt; \</span><br><span class="line"> --source-arn &lt;AmazonConnect ARN&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>※ ARNはAWSコンソール &gt; AmazonConnect &gt; インスタンスエイリアス名　から確認できます。<br><img src="/images/20181202/photo_20181202_12.png" style="border:solid 1px #000000" loading="lazy"></p>
</blockquote>
<h4 id="Lexとの連携を作成します。"><a href="#Lexとの連携を作成します。" class="headerlink" title="Lexとの連携を作成します。"></a>Lexとの連携を作成します。</h4><p>先ずはLexチャットボットを用意しましょう。<br>右端の<code>Test ChatBot</code>からチャットボットのテストができます。</p>
<p>今回は下記しか設定してません。</p>
<ul>
<li>Sample utterances：ここでの言葉に反応してLexがSlotを呼びます。</li>
<li>Slots：”Sure, when?”とLexが聞いて来るので、その後の言葉をAMAZON.DATE型として認識します。</li>
</ul>
<img src="/images/20181202/photo_20181202_13.png" style="border:solid 1px #000000" loading="lazy">


<h5 id="Amazon-LexとConnectを接続します。"><a href="#Amazon-LexとConnectを接続します。" class="headerlink" title="Amazon LexとConnectを接続します。"></a>Amazon LexとConnectを接続します。</h5><p>下図の通り、Lexボットを作成したリージョンとボット名を選択して追加します。</p>
<img src="/images/20181202/photo_20181202_14.png" style="border:solid 1px #000000" loading="lazy">


<h4 id="最後にフローを作成します。"><a href="#最後にフローを作成します。" class="headerlink" title="最後にフローを作成します。"></a>最後にフローを作成します。</h4><img src="/images/20181202/photo_20181202_15.png" style="border:solid 1px #000000" loading="lazy">


<p>かいつまんで説明すると、吹き出し部分が重要なところで、データの受け渡しで若干躓くところです。<br>個別に見ていきましょう。</p>
<h5 id="電話番号の取得"><a href="#電話番号の取得" class="headerlink" title="電話番号の取得"></a>電話番号の取得</h5><p>電話をかけてきた相手の電話番号はシステムの値で取得可能です。<br>宛先キーは使いやすい名称を設定すれば良いと思います。（今回はCallerIDでいきます）<br><img src="/images/20181202/photo_20181202_16.png"  class="img-middle-size" style="border:solid 1px #000000" loading="lazy"></p>
<h5 id="Lambdaの呼び出し"><a href="#Lambdaの呼び出し" class="headerlink" title="Lambdaの呼び出し"></a>Lambdaの呼び出し</h5><p>先程取得したCallerID（発信者電話番号）を引数としてセットします。<br>呼び出すLambdaのARNは関数画面から取得してきましょう。<br><img src="/images/20181202/photo_20181202_17.png"  class="img-middle-size"  style="border:solid 1px #000000" loading="lazy"></p>
<h5 id="値のチェック"><a href="#値のチェック" class="headerlink" title="値のチェック"></a>値のチェック</h5><p>Lambda関数の戻り値をチェックできます。<br>ここでは発信者電話番号をキーとした注文情報レコードの有無を確認することを想定しています。<br><img src="/images/20181202/photo_20181202_18.png" class="img-middle-size"  style="border:solid 1px #000000" loading="lazy"></p>
<h5 id="ダイヤルプッシュを取得（IVR）"><a href="#ダイヤルプッシュを取得（IVR）" class="headerlink" title="ダイヤルプッシュを取得（IVR）"></a>ダイヤルプッシュを取得（IVR）</h5><p>IVRの機能を枠ひとつでできてしまいます！<br>ここは特につまずくことなく設定可能かなと思います。<br><img src="/images/20181202/photo_20181202_19.png"  style="border:solid 1px #000000" loading="lazy"></p>
<h5 id="キャンセル関数"><a href="#キャンセル関数" class="headerlink" title="キャンセル関数"></a>キャンセル関数</h5><p>複数の引数を持つLambda関数にもちゃんとデータを渡すことができます。<br><img src="/images/20181202/photo_20181202_20.png" style="border:solid 1px #000000" loading="lazy"></p>
<h5 id="Lexで顧客の入力を取得"><a href="#Lexで顧客の入力を取得" class="headerlink" title="Lexで顧客の入力を取得"></a>Lexで顧客の入力を取得</h5><p>前項の「ダイヤルプッシュを取得（IVR）」と同様のことをLexを用いて実装可能です。<br>ボットを選択するだけなので、とても簡単に追加できます。<br><img src="/images/20181202/photo_20181202_21.png" style="border:solid 1px #000000" loading="lazy"></p>
<h5 id="配送日変更関数の呼び出し"><a href="#配送日変更関数の呼び出し" class="headerlink" title="配送日変更関数の呼び出し"></a>配送日変更関数の呼び出し</h5><p>以前までと違うのが、Lexで取得してきた値を引数としたい点です。<br>素晴らしいことにこれもGUIで簡単に取れてしまいます。<br>（Lexの部分だけ抜き取っています。）<br><img src="/images/20181202/photo_20181202_22.png" class="img-middle-size" style="border:solid 1px #000000" loading="lazy"></p>
<h5 id="完成！"><a href="#完成！" class="headerlink" title="完成！"></a>完成！</h5><p>これでフローの完成です！長丁場お疲れ様でした！<br>右上の保存・・・を押しても反映されないので、保存の右の▼をクリック→保存して発行を実行してください。</p>
<p>あとはしばらくして電話をかければ動作を確認できます！<br>多少クセはありますがとっても簡単ですね。</p>
<h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>とっても長くなってしまいましたが、２日間非常に濃い内容のセッションでした。<br>やはりLambdaとの連携がとても強力で、基幹のシステムと連携して様々な活用が想像できますね！<br>AmazonConnectならではの強みを活かしてEC2インスタンスの再起動や、運用監視向けのシステムを作られている方もいて、非常に夢が広がるツールだと思いました。</p>
<p>この実習での作品が発想勝ちだったのか、AmazonConnectサンプルコールセンター対決で優勝をいただきましてechospotをもらえました！（ありがとうございます！）<br><img src="/images/20181202/photo_20181202_23.jpeg" loading="lazy"></p>
<h2 id="参考資料"><a href="#参考資料" class="headerlink" title="参考資料"></a>参考資料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/contact-center/">Amazon Connect Contact Center Blog Channel</a></li>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/jp/blogs/contact-center/building-an-automated-ai-experience-with-amazon-connect-and-salesforce-service-cloud/">Salesforce Connector information</a></li>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/contact-center/use-amazon-connect-data-in-real-time-with-elasticsearch-and-kibana/?nc1=b_rp">Using Kibana to visualize contact center data</a></li>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/big-data/analyzing-amazon-connect-records-with-amazon-athena-aws-glue-and-amazon-quicksight/">Using Athena and Quicksight to analyze Amazon Connect Data</a></li>
<li><a target="_blank" rel="noopener" href="https://read.acloud.guru/how-to-keep-your-lambda-functions-warm-9d7e1aa6e2f0">Keeping your Lambda functions warm</a></li>
<li><a target="_blank" rel="noopener" href="https://blogs.perficient.com/2017/12/20/building-an-amazon-connect-holiday-calendar-in-4-easy-steps/">Building an automated holiday table</a></li>
</ul>

          
        </div>
        <footer>
          <section class="social-area">
          <!-- シェアボタン START -->
  <ul class="social-button">
    
    <!-- Twitter -->
    <li>
      <a class="social-btn twitter-btn" target="_blank" href="https://twitter.com/share?url=https://future-architect.github.io/articles/20181202/&related=twitterapi%2Ctwitter&text=AmazonConnect%20BootCamp%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E5%8F%97%E3%81%91%E3%81%A6%E3%81%8D%E3%81%9F%E8%A9%B1%20%7C%20%E3%83%95%E3%83%A5%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E6%8A%80%E8%A1%93%E3%83%96%E3%83%AD%E3%82%B0" rel="nofollow noopener">
        <i></i><span class="social-btn-label">ツイート</span>
      </a>
    </li>
    <!-- Facebook -->
    <li>
      <a class="social-btn fb-btn" target="_blank" href="http://www.facebook.com/share.php?u=https://future-architect.github.io/articles/20181202/&t=AmazonConnect%20BootCamp%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E5%8F%97%E3%81%91%E3%81%A6%E3%81%8D%E3%81%9F%E8%A9%B1" rel="nofollow noopener">
        <i></i><span class="social-btn-label">7</span>
      </a>
    </li>
    <!-- hatebu -->
    <li>
      <a class="social-btn hatebu-btn" target="_blank" href="https://b.hatena.ne.jp/entry/s/future-architect.github.io/articles/20181202/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">はてな</span>
      </a>
    </li>
    <!-- pocket -->
    <li>
      <a class="social-btn pocket-btn" target="_blank" href="https://getpocket.com/save?url=https://future-architect.github.io/articles/20181202/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">8</span>
      </a>
    </li>
    
  </ul>
<!-- シェアボタン END -->

          </section>
          <aside>
            <section class="related-post margin-bottom-40 nav">
              <h2 id="related"><a href="#related" class="headerlink" title="関連記事"></a>関連記事</h2>
              
  <div class="widget">
    <ul class="nav related-post-link"><li class="related-posts-item"><span>2021.08.31</span><span class="snscount">&#9825;12</span><a href=/articles/20210831a/ title="AWS初心者にとって、最初に躓きやすい部分がNWの構築かと思います。インスタンス立ててみたけど、これってどうやると他のノードと通信できるんだっけ？なんとなく通信できたけど、なんでだ？といった辺り、なんとなく有耶無耶なままにしていませんか。今回は2020年12月にローンチされたReachability Analyzerを利用して、AWS初心者向けのNW構築ハンズオン-Internal編-をやってみたいと思います。">AWS初心者向けNW構築ハンズオン-Internal編-</a></li><li class="related-posts-item"><span>2019.07.02</span><span class="snscount">&#9825;1</span><a href=/articles/20190702/ title="あるプロジェクトでデータ分析基盤を開発することになり、データレイクを中心としたソリューションについて学ぶためにAWS Datalake Hands-onに参加してきました">AWS Datalake Hands-on(2019 May)メモ</a></li><li class="related-posts-item"><span>2022.10.20</span><span class="snscount">&#9825;17</span><a href=/articles/20221020a/ title="TIG DXユニットの真野です。タイトルに書いたままの内容の記事です。おそらくDynamoDB Streams について調べたことがある方の多くの人には自明な内容だと思います。サマリです。* DynamoDB Streamsの起動順序が保たれるのは 項目単位">DynamoDB Streamsは同一ハッシュキーでもソートキーが異なれば順序保証されない</a></li><li class="related-posts-item"><span>2022.08.10</span><span class="snscount">&#9825;8</span><a href=/articles/20220810a/ title="こんにちは！2021年入社、TIGメディアユニット所属の武田です。">【メディア業界】新聞社の編集業務とフューチャーの取組み</a></li><li class="related-posts-item"><span>2022.06.07</span><span class="snscount">&#9825;52</span><a href=/articles/20220607a/ title="失敗談をテーマにした連載の5本目です。AWS Lambdaで、予約済同時実行数を1に制限して使っていたときに、初期化処理と初期化タイミングの考慮不足により、はまったことがありました。本記事ではLambdaの初期化処理についておさらいした後、はまったケースの事例や原因、対応した方法を紹介します。">AWS Lambdaの初期化処理と初期化タイミングの考慮不足によるはまりどころ</a></li><li class="related-posts-item"><span>2022.06.06</span><span class="snscount">&#9825;15</span><a href=/articles/20220606a/ title="この記事ではクラウドインフラにはつきものの、インフラコストについての失敗談をご紹介します。ぜひご一読いただき、私の屍を乗り越えていく事で、悲劇の発生を未然に防いでいただければと思います。">RDSの自動再起動によるインフラコストの悲劇</a></li></ul>
  </div>
            </section>
            <section class="reference-post margin-bottom-40 nav">
              
            </section>
          </aside>
        </footer>
      </div>
    </article>
  </main>
  <aside class="col-md-3 blog-sidebar">
    <!-- START SIDEBAR  -->


<section class="toc-section">
  <h2 class="margin-top-30">目次</h2>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%81%BE%E3%81%88%E3%81%8C%E3%81%8D"><span class="toc-text">まえがき</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AmazonConnect-Session-day1-2018-11-06"><span class="toc-text">AmazonConnect Session#day1 2018.11.06</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%82%BB%E3%83%BC%E3%83%AB%E3%82%B9%E3%81%A8%E6%8A%80%E8%A1%93%E6%8B%85%E5%BD%93%E8%80%85%E3%81%8B%E3%82%89%E3%81%AEAmazonConnect%E3%81%AE%E8%AA%AC%E6%98%8E"><span class="toc-text">セールスと技術担当者からのAmazonConnectの説明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sales"><span class="toc-text">Sales</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AmazonConnect%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><span class="toc-text">AmazonConnectについて</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AmazonConnect%E3%81%AE%E3%82%A6%E3%83%AA"><span class="toc-text">AmazonConnectのウリ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-Architect"><span class="toc-text">Solution Architect</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E5%B1%95%E9%96%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><span class="toc-text">リージョン展開について</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AWS%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%89%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA"><span class="toc-text">AWSマネージドサービスとの連携</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3rd-Party-%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA"><span class="toc-text">3rd-Party システムとの連携</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CCP%EF%BC%88%E3%82%BD%E3%83%95%E3%83%88%E3%83%95%E3%82%A9%E3%83%B3%EF%BC%89%E3%81%AE%E6%8B%A1%E5%BC%B5"><span class="toc-text">CCP（ソフトフォン）の拡張</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Streams-API"><span class="toc-text">Streams API</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AmazonConnect-Session-day2-2018-11-07"><span class="toc-text">AmazonConnect Session#day2 2018.11.07</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Connect%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">Connectインスタンスの作成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E8%A8%AD%E5%AE%9A"><span class="toc-text">インスタンスの設定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9B%BB%E8%A9%B1%E7%95%AA%E5%8F%B7%E3%81%AE%E5%8F%96%E5%BE%97"><span class="toc-text">1. 電話番号の取得</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9B%BB%E8%A9%B1%E5%BF%9C%E5%AF%BE%E6%99%82%E9%96%93%E3%81%AE%E8%A8%AD%E5%AE%9A"><span class="toc-text">2. 電話応対時間の設定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">3. キューの作成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">4. プロンプトの作成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">5. 問い合わせフローの作成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Contact-flow-designer"><span class="toc-text">Contact flow designer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Interact"><span class="toc-text">Interact</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Set"><span class="toc-text">Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Branch"><span class="toc-text">Branch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Integrate"><span class="toc-text">Integrate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Terminate-x2F-Transfer"><span class="toc-text">Terminate &#x2F; Transfer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86"><span class="toc-text">エラー処理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">6. ルーティングプロファイルの作成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E7%AE%A1%E7%90%86"><span class="toc-text">7. ユーザー管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3rd-party%E3%81%B8%E3%81%AE%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%A0"><span class="toc-text">3rd-partyへのストリーム</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9F%E9%9A%9B%E3%81%AB%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F"><span class="toc-text">実際に作ってみた</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%95%E3%83%AD%E3%83%BC"><span class="toc-text">フロー</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E4%BD%93%E5%9B%B3"><span class="toc-text">全体図</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E9%A0%86"><span class="toc-text">手順</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%88%E3%81%9A%E3%81%AFDynamoDB%E3%81%AB%E3%83%87%E3%83%A2%E7%94%A8%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%85%A5%E3%82%8C%E3%81%BE%E3%81%99%E3%80%82"><span class="toc-text">先ずはDynamoDBにデモ用のデータを入れます。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lambda%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%BE%E3%81%99%E3%80%82%E4%BB%8A%E5%9B%9E%E3%81%AF%E4%B8%8B%E8%A8%98%E3%81%AE%EF%BC%93%E3%81%A4%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F%E3%80%82"><span class="toc-text">Lambdaを作成します。今回は下記の３つを作成しました。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AmazonConnect%E3%81%8B%E3%82%89Lambda%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%81%9F%E3%82%81%E3%81%AE%E3%83%91%E3%83%BC%E3%83%9F%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%97%E3%81%BE%E3%81%99%E3%80%82%EF%BC%88%E7%8F%BE%E7%8A%B6GUI%E3%81%8B%E3%82%89%E3%81%AF%E8%A8%AD%E5%AE%9A%E4%B8%8D%E5%8F%AF%EF%BC%89"><span class="toc-text">AmazonConnectからLambdaを呼び出すためのパーミッションの設定をします。（現状GUIからは設定不可）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lex%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%BE%E3%81%99%E3%80%82"><span class="toc-text">Lexとの連携を作成します。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E5%BE%8C%E3%81%AB%E3%83%95%E3%83%AD%E3%83%BC%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%BE%E3%81%99%E3%80%82"><span class="toc-text">最後にフローを作成します。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%81%BE%E3%81%A8%E3%82%81"><span class="toc-text">まとめ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99"><span class="toc-text">参考資料</span></a></li></ol></li></ol>
</section>

<section class="category">
<h2 class="margin-top-30">カテゴリー</h2>
<div class="widget">
  <ul class="nav sidebar-categories margin-bottom-40">
  
  <li class=""><a href="/categories/Programming/">Programming (342)</a></li>
<li class=""><a href="/categories/Infrastructure/">Infrastructure (198)</a></li>
<li class=""><a href="/categories/Culture/">Culture (84)</a></li>
<li class=""><a href="/categories/DataScience/">DataScience (44)</a></li>
<li class=""><a href="/categories/IoT/">IoT (31)</a></li>
<li class=""><a href="/categories/DB/">DB (20)</a></li>
<li class=""><a href="/categories/Business/">Business (19)</a></li>
<li class=""><a href="/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/">認証認可 (18)</a></li>
<li class=""><a href="/categories/Management/">Management (13)</a></li>
<li class=""><a href="/categories/VR/">VR (12)</a></li>
<li class=""><a href="/categories/DevOps/">DevOps (12)</a></li>
<li class=""><a href="/categories/Design/">Design (11)</a></li>
<li class=""><a href="/categories/Security/">Security (6)</a></li>

  </ul>
</div>

</section>
<section class="podcast-link">
<h2 class="margin-top-30">Tech Cast</h2>

  <div class="class="widget-wrap">
  <div class="widget">
    <ul class="nav techcast">
      <li><a href="https://anchor.fm/futuretechcast/episodes/35-MLOps-e1qe4st" title="フューチャーがお届けするポッドキャストです。#35 MLOpsエンジニアって何やるの？（後編）" target="_blank" rel="noopener"><span class="newitem">NEW</span> #35 MLOpsエンジニアって何やるの？（後編）</a></li>
<li><a href="https://anchor.fm/futuretechcast/episodes/34-MLOps-e1polbj" title="フューチャーがお届けするポッドキャストです。#34 MLOpsエンジニアって何やるの？（前編）" target="_blank" rel="noopener"> #34 MLOpsエンジニアって何やるの？（前編）</a></li>
<li><a href="https://anchor.fm/futuretechcast/episodes/33-IT-e1pcaon" title="フューチャーがお届けするポッドキャストです。#33 ヘルスケアグループリーダーの中元さんと語る「医療業界におけるITコンサルとビジネスイノベーション」（後編）" target="_blank" rel="noopener"> #33 ヘルスケアグループリーダーの中元さんと語る「医療業界におけるITコンサルとビジネスイノベーション」（後編）</a></li>
    </ul>
  </div>
  </div>
  
</section>
<section class="advent-calendar">
<h2 class="margin-top-30">アドベントカレンダー</h2>
<div class="widget">
  <ul class="nav-flex">
    <li><a href="http://qiita.com/advent-calendar/2022/future" title="フューチャー Advent Calendar 2022 #Qiita" target="_blank" rel="noopener">2022年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2021/future" title="フューチャー Advent Calendar 2021 #Qiita" target="_blank" rel="noopener">2021年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2020/future" title="フューチャー Advent Calendar 2020 #Qiita" target="_blank" rel="noopener">2020年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2019/future" title="フューチャー Advent Calendar 2019 #Qiita" target="_blank" rel="noopener">2019年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2018/future" title="フューチャー Advent Calendar 2018 #Qiita" target="_blank" rel="noopener">2018年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2017/future" title="フューチャー Advent Calendar 2017 #Qiita" target="_blank" rel="noopener">2017年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2016/future" title="フューチャー Advent Calendar 2016 #Qiita" target="_blank" rel="noopener">2016年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2015/future" title="フューチャー Advent Calendar 2015 #Qiita" target="_blank" rel="noopener">2015年</a></li>
  </ul>
</div>

</section>
<!-- END SIDEBAR -->

  </aside>
</div>

  </section>
</div>

      <!-- BEGIN PRE-FOOTER -->
    <footer>
      <div class="pre-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>About Us</h2>
              <p>経営とITをデザインする、フューチャーの技術ブログです。業務で利用している幅広い技術について紹介します。<br /><br /><a target="_blank" rel="noopener" href="http://www.future.co.jp/">http://www.future.co.jp/</a></p>
              <div class="social-btn twitter-btn twitter-follow-btn">
                <a href="https://twitter.com/intent/follow?screen_name=future_techblog " target="_blank" rel="nofollow noopener">
                  <i></i><span class="tw-btn-label">フューチャー技術ブログをフォロー</span>
                </a>
              </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 col-4 pre-footer-col">
              <h2>Contact</h2>
              <address class="margin-bottom-40">
                <a href="https://www.future.co.jp/recruit/recruit/rec-fresh/" title="新卒採用" target="_blank" rel="noopener">新卒採用</a><br>
                <a href="https://www.future.co.jp/recruit/recruit/rec-career/" title="キャリア採用" target="_blank" rel="noopener">キャリア採用</a><br>
                <a href="https://www.future.co.jp/contact_us/" title="お問い合わせページ" target="_blank" rel="noopener">お問い合わせ</a><br>
                <a href="https://www.future.co.jp/architect/socialmediapolicy/" title="ソーシャルメディアポリシー" target="_blank" rel="noopener">メディアポリシー</a><br><br>
                <a href="mailto:techblog@future.co.jp">techblog@future.co.jp</a>
              </address>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>Contents</h2>
              <a href="https://future-architect.github.io/coding-standards/" title="Future Enterprise Coding Standards" target="_blank" rel="noopener">コーディング規約</a><br>
              <a href="https://future-architect.github.io/typescript-guide/" title="仕事ですぐに使えるTypeScript" target="_blank" rel="noopener">仕事ですぐに使えるTypeScript</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>Event</h2>
              <a href="https://future.connpass.com/" title="経営とITをデザインするフューチャーの勉強会です" target="_blank" rel="noopener">connpass</a><br>
              <a href="https://www.future.co.jp/futureinsightseminar/" title="フューチャーインサイトセミナー" target="_blank" rel="noopener">Webセミナー</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>SNS</h2>
              <a href="https://github.com/future-architect" title="Future's official open source repositories" target="_blank" rel="noopener">GitHub</a><br>
              <a href="https://qiita.com/organizations/future" title="フューチャーのQiita Organizationです" target="_blank" rel="noopener">Qiita</a><br>
              <a href="https://note.future.co.jp/" title="フューチャーの公式note" target="_blank" rel="noopener">未来報</a><br>
              <a href="https://www.youtube.com/channel/UCJUSwYYd0CkGgmEKAW7QVpw" title="フューチャーYoutubeチャネル" target="_blank" rel="noopener">Youtube</a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-6 padding-top-10">
              &copy; 2022 フューチャー技術ブログ<br>
            </div>
          </div>
        </div>
      </div>
    </footer>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X1C28R8H0M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X1C28R8H0M');
  gtag('config', 'UA-74047147-1'); // 過渡期対応
</script>

  </div>
</body>
</html>
