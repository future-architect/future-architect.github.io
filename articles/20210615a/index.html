<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!--
    ███████╗██╗░░░██╗████████╗██╗░░░██╗██████╗░███████╗
    ██╔════╝██║░░░██║╚══██╔══╝██║░░░██║██╔══██╗██╔════╝
    █████╗░░██║░░░██║░░░██║░░░██║░░░██║██████╔╝█████╗░░
    ██╔══╝░░██║░░░██║░░░██║░░░██║░░░██║██╔══██╗██╔══╝░░
    ██║░░░░░╚██████╔╝░░░██║░░░╚██████╔╝██║░░██║███████╗
    ╚═╝░░░░░░╚═════╝░░░░╚═╝░░░░╚═════╝░╚═╝░░╚═╝╚══════╝
    ████████╗███████╗░█████╗░██╗░░██╗
    ╚══██╔══╝██╔════╝██╔══██╗██║░░██║
    ░░░██║░░░█████╗░░██║░░╚═╝███████║
    ░░░██║░░░██╔══╝░░██║░░██╗██╔══██║
    ░░░██║░░░███████╗╚█████╔╝██║░░██║
    ░░░╚═╝░░░╚══════╝░╚════╝░╚═╝░░╚═╝
    ██████╗░██╗░░░░░░█████╗░░██████╗░
    ██╔══██╗██║░░░░░██╔══██╗██╔════╝░
    ██████╦╝██║░░░░░██║░░██║██║░░██╗░
    ██╔══██╗██║░░░░░██║░░██║██║░░╚██╗
    ██████╦╝███████╗╚█████╔╝╚██████╔╝
    ╚═════╝░╚══════╝░╚════╝░░╚═════╝░
    Welcome engineer.
    https://www.future.co.jp/recruit/
  -->
  
  <title>「リアクティブコントローラ」導入がもたらすかもしれないウェブフロントエンド設計の変化 | フューチャー技術ブログ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  <meta name="description" content="フロントエンド連載2日目のエントリーです。 あまり話題になっていないような気がしますが、Web Componentsを実装するためのフレームワークのLit-Element v3がバージョンアップして、ついでにリブランディングしてLit v2.0となりました。ロゴも変わり、ウェブサイトも新しくなりました。    Introducing “Lit” for Web Components  本当はこのL">
<meta property="og:type" content="article">
<meta property="og:title" content="「リアクティブコントローラ」導入がもたらすかもしれないウェブフロントエンド設計の変化 | フューチャー技術ブログ">
<meta property="og:url" content="https://future-architect.github.io/articles/20210615a/index.html">
<meta property="og:site_name" content="フューチャー技術ブログ">
<meta property="og:description" content="フロントエンド連載2日目のエントリーです。 あまり話題になっていないような気がしますが、Web Componentsを実装するためのフレームワークのLit-Element v3がバージョンアップして、ついでにリブランディングしてLit v2.0となりました。ロゴも変わり、ウェブサイトも新しくなりました。    Introducing “Lit” for Web Components  本当はこのL">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://future-architect.github.io/images/20210615a/スクリーンショット_2021-06-12_9.19.45.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210615a/スクリーンショット_2021-06-12_12.39.29.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210615a/スクリーンショット_2021-06-12_9.55.02.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210615a/スクリーンショット_2021-06-12_12.25.43.png">
<meta property="article:published_time" content="2021-06-14T15:00:00.000Z">
<meta property="article:modified_time" content="2022-07-04T14:47:53.435Z">
<meta property="article:tag" content="WebComponents">
<meta property="article:tag" content="フロントエンド">
<meta property="article:tag" content="設計">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://future-architect.github.io/images/20210615a/スクリーンショット_2021-06-12_9.19.45.png">
  
  <link rel="alternate" href="/atom.xml" title="フューチャー技術ブログ" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes='180x180' href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes='57x57' href="/apple-touch-icon-57x57.png">
  <link rel="canonical" href="https://future-architect.github.io/articles/20210615a/">
  <meta content="WebComponents,フロントエンド,設計" name="keywords">
  <meta content="澁川喜規" name="author">
  <link rel="preload" as="image" href="/banner.jpg" />
  <link rel='manifest' href='/manifest.webmanifest'/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <link rel="stylesheet" href="/metronic/assets/style.css">
  <link rel="stylesheet" href="/css/theme-styles.css">
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="corporate">
  <div class="wrap" itemscope itemtype="https://schema.org/TechArticle">
  <!-- BEGIN HEADER -->
<header class="header">
	<div class="header-overlay">
		<div class="header-menu"></div>
		<div class="header-title"><a href="/">Future Tech Blog</a></div>
		<div class="header-title-sub">フューチャー技術ブログ</div>
	</div>
</header>
<!-- Header END -->

  <div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/articles/">Blog</a></li>
    <li class="active">Post</li>
  </ul>
  <section id="main" class="margin-top-30">
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programmingカテゴリ</a>
  </div>


    <h2 itemprop="name" class="article-title">「リアクティブコントローラ」導入がもたらすかもしれないウェブフロントエンド設計の変化
  
  <a target="_blank" rel="noopener" href="https://github.com/future-architect/tech-blog/edit/master/source/_posts/20210615a_「リアクティブコントローラ」導入がもたらすかもしれないウェブフロントエンド設計の変化.md" title="Suggest Edits" class="github-edit"><i class="github-edit-icon"></i></a>
  
</h2>

    <div class="row">
  <main class="col-md-9 blog-posts">
    <article id="post-20210615a_「リアクティブコントローラ」導入がもたらすかもしれないウェブフロントエンド設計の変化" class="article article-type-post blog-item" itemscope itemprop="blogPost">
      <div class="article-inner">
        
        <header class="article-header">
          <ul class="blog-info">
            <li class="blog-info-item"><a href="/articles/2021/" class="publish-date"><time datetime="2021-06-14T15:00:00.000Z" itemprop="datePublished">2021.06.15</time></a>
</li>
            <li class="blog-info-item"><li><a href="/authors/%E6%BE%81%E5%B7%9D%E5%96%9C%E8%A6%8F" title="澁川喜規さんの記事一覧へ" class="post-author">澁川喜規</a></li></li>
            <li class="blog-info-item">
  
    
    <a href="/tags/WebComponents/" title="WebComponentsタグの記事へ" class="tag-list-link">WebComponents</a>
  
    
    <a href="/tags/フロントエンド/" title="フロントエンドタグの記事へ" class="tag-list-link">フロントエンド</a>
  
    
    <a href="/tags/設計/" title="設計タグの記事へ" class="tag-list-link">設計</a>
  

</li>
          </ul>
          </header>
        
        <div class="article-entry" itemprop="articleBody">
          
            <p><a href="/articles/20210614a/">フロントエンド連載</a>2日目のエントリーです。</p>
<p>あまり話題になっていないような気がしますが、Web Componentsを実装するためのフレームワークのLit-Element v3がバージョンアップして、ついでにリブランディングしてLit v2.0となりました。ロゴも変わり、<a target="_blank" rel="noopener" href="https://lit.dev/">ウェブサイトも新しく</a>なりました。</p>
<img src="/images/20210615a/スクリーンショット_2021-06-12_9.19.45.png" alt="Lit-Elementトップページ" width="1200" height="801">

<ul>
<li><a target="_blank" rel="noopener" href="https://zenn.dev/takanorip/articles/640f9fe9c6c8ca">Introducing “Lit” for Web Components</a></li>
</ul>
<p>本当はこのLitの紹介をこの連載でしようとしたのですが、上記のウェブサイトがすごく詳しいので、単に紹介するだけの記事だとあまり価値がないので、この中のコントローラ機能のみをとりあげようと思いますが、まずはWeb Componentsとは、というところを説明します。</p>
<h1 id="n回目のWeb-Components元年"><a href="#n回目のWeb-Components元年" class="headerlink" title="n回目のWeb Components元年"></a>n回目のWeb Components元年</h1><p>以前次のような記事を書きました。最初のPolymerというフレームワークが推進していたころよりも、ブラウザ対応も進み、ReactやVueといった人気のフレームワークとも気軽に組み合わせられるようになり、使えるところがぐん、と増えました。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://qiita.com/shibukawa/items/5a36147ec103d35c1b5e">2019年はWebComponents元年(2回目)！WebComponentsをReact&#x2F;Angular&#x2F;Vueと一緒に使う</a></li>
</ul>
<p>jxckさんの発表で、3回目の元年な話もあります。主にWebPackingなどのAPIの進化がこれからWeb Componentsの普及に一役買うのでは、という内容のようです。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://speakerdeck.com/jxck/web-components-first-year-v3">Web Components 元年 v3 &#x2F; Web Components first year v3</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://headlessui.dev/">Headless UI</a>がもしWeb Components版を出してくれたら、世のWeb&#x2F;CSSデザイナーの人たちのポートフォリオに載せやすいものとなって作ろう、という人は増えるのでは？という気はするのですが、それがなかったとしても、2021年は本当の元年になってくれそうな気がすごいしています。</p>
<p>Web Componentsが普及したあかつきには、多種多様なコンポーネント集が手に入り、ReactでもVueでもSvelteでもなんでもフロントエンド開発のときに各フロントエンド専用のUI部品集だけでなく「Web Components製の部品も利用の選択肢に入る」状態になると思います。そのためにはWeb Componentsで作られた部品集がたくさん世の中に作られることが大事だと思っていましたが、リニューアルされたLitのウェブサイトのフッター付近にたくさん部品集のリンクがあります。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://opensource.adobe.com/spectrum-web-components/">Adobe: Spectrum Web Components</a></li>
<li><a target="_blank" rel="noopener" href="https://auro.alaskaair.com/philosophy">Alaska Airlines: Auro Design System</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/momentum-design/momentum-ui/tree/master/web-components">Cisco Systems: Momentum UI</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/home-assistant/frontend">Home Assistant: Frontend UI</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/carbon-design-system/carbon-web-components">IBM: Carbon Web Components</a></li>
<li><a target="_blank" rel="noopener" href="https://lion-web.netlify.app/">ING Bank: Lion Web Components</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/pwa-builder/pwa-starter">Microsoft: PWA Starter</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/1-Platform">Red Hat: One Platform Components</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/SAP/ui5-webcomponents/blob/master/docs/dev/Developing%20Web%20Components.md">SAP: UI5 Web Components</a></li>
<li><a target="_blank" rel="noopener" href="https://shoelace.style/">Shoelace Components</a></li>
<li><a target="_blank" rel="noopener" href="https://vaadin.com/docs/latest/fusion/overview">Vaadin Ltd: Fusion Framework</a></li>
<li><a target="_blank" rel="noopener" href="https://clarity.design/storybook/core/">VMWare: Clarity Core</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/rough-stuff/wired-elements">Wired Elements</a></li>
</ul>
<p>注目はアラスカエアラインのフライト情報コンポーネントですね。こういうのがWeb Componentsっぽい。このサイトの、コンポーネントの背景を斜めストライプにすることでコンポーネントのビジュアルと背景の区別がつきやすくなっているの、めちゃ良いですね。Storybookとかでコンポーネント集作る人はみんなやっても良さそう。</p>
<img src="/images/20210615a/スクリーンショット_2021-06-12_12.39.29.png" alt="アラスカエアラインのコンポーネント一覧" width="1200" height="801">


<p>それらのコンポーネント集以上の起爆剤となりそうと思っているのが、Google I&#x2F;O 2021で発表されたAndroidの新UIコンセプトのMaterial Youです。</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">✨ Announcing Material You, a transformation in design at Google ✨<br> <br>Be a co-creator of your digital experiences. Coming first to Pixel with <a target="_blank" rel="noopener" href="https://twitter.com/hashtag/Android12?src=hash&amp;ref_src=twsrc%5Etfw">#Android12</a><br> <br>Learn more about the <a target="_blank" rel="noopener" href="https://twitter.com/hashtag/MaterialDesign?src=hash&amp;ref_src=twsrc%5Etfw">#MaterialDesign</a> vision 👉<a target="_blank" rel="noopener" href="https://t.co/Otb86qTQRR">https://t.co/Otb86qTQRR</a> <a target="_blank" rel="noopener" href="https://t.co/04ARxOTbVa">pic.twitter.com/04ARxOTbVa</a></p>&mdash; Material Design (@materialdesign) <a target="_blank" rel="noopener" href="https://twitter.com/materialdesign/status/1394718542562430977?ref_src=twsrc%5Etfw">May 18, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Material Designが発表されたときも、モバイルからウェブまで全部をカバーするUIコンセプトということで、CSSも提供され、<a target="_blank" rel="noopener" href="https://getmdl.io/">material-design-lite</a>というライブラリが出たり、それらを元にしたBootstrapのテーマが出たりしつつ、React向けには<a target="_blank" rel="noopener" href="https://material-ui.com/">Material UI</a>、Vue.jsには<a target="_blank" rel="noopener" href="https://vuetifyjs.com/en/">Vuetify</a>、Angularでは<a target="_blank" rel="noopener" href="https://material.angular.io/">Angular Material</a>がそれぞれ開発されています。ですが、「とりあえずこれ使っておこう」となるまでには年単位の時間がかかっていました。</p>
<p>一方で、細々と<a target="_blank" rel="noopener" href="https://github.com/material-components/material-components-web-components">Material DesignのUI部品のLit Element実装も行われている</a>な、と思っていたら、Material Design本家のチュートリアルもいつのまにか<a target="_blank" rel="noopener" href="https://material.io/develop/web/getting-started">Web Components前提</a>となっていますし、なにより、Material YouはLitで実装する&#x3D;&#x3D;Web Componentsになるよ、と中の人からレスポンスが！！</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Material You for web will be <a target="_blank" rel="noopener" href="https://twitter.com/hashtag/builtWithLit?src=hash&amp;ref_src=twsrc%5Etfw">#builtWithLit</a></p>&mdash; Elliott (@techytacos) <a target="_blank" rel="noopener" href="https://twitter.com/techytacos/status/1395564894456406016?ref_src=twsrc%5Etfw">May 21, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Material UIやVuetifyやAngular MaterialがMaterial Youに対応するか、別のそういうバージョンが実装されるよりも、Web Components版を使った方が圧倒的に早い、ということになりそうです。やったね！！</p>
<h1 id="Litの新機能のリアクティブコントローラとは何者か"><a href="#Litの新機能のリアクティブコントローラとは何者か" class="headerlink" title="Litの新機能のリアクティブコントローラとは何者か"></a>Litの新機能のリアクティブコントローラとは何者か</h1><p>Lit Elementからの変化は<a target="_blank" rel="noopener" href="https://zenn.dev/takanorip/articles/640f9fe9c6c8ca">こちら</a>をみていただくのが確実ですが軽くリストアップします。</p>
<ul>
<li>ビルド結果のサイズはより小さく(minify時で30%)、より高速に(初期表示が5-20%、更新が7-15%)</li>
<li>リアクティブコントローラというコンセプトが入った</li>
<li>experimental: Reactコンポーネントを作るアダプターが導入</li>
<li>experimental: サーバーサイドレンダリングができるようになる</li>
</ul>
<p>ここでとりあげるのはコントローラです。ライフサイクルイベントのハンドラーをどこにどう実装するのか、というのはいろいろ試行錯誤があり、クラスのメソッドだったり、Hooksが導入されたり、といろいろ変わってきました。Hooksもライフサイクルイベントのハンドラーの再利用がしやすくなる仕組みでしたが、コントローラはこのハンドラーのセットをオブジェクトして切り出しておける機能となります。Javaとかのオブジェクト指向をやっていた人にはわかりやすいものかと思います。</p>
<p>コントローラという概念自体はモバイルな開発では以前から使われているアイディアで、<a target="_blank" rel="noopener" href="https://developer.apple.com/tutorials/app-dev-training/setting-up-a-table-view">iOSの開発でも見かける</a>し、<a target="_blank" rel="noopener" href="https://medium.com/@ntaoo/widget%E3%81%8B%E3%82%89controller%E3%82%92%E5%88%86%E9%9B%A2%E3%81%99%E3%82%8B-cf2f0c646e78">Flutterにもあります</a>ね。Jetpack Composeはユーザーがロジックを定義する対象ではないのかな？<a target="_blank" rel="noopener" href="https://developer.android.com/jetpack/compose/navigation">ナビゲーション周りぐらいでしかコントローラという言葉が出てこなく</a>て、UIを持たない提供ロジックの置き場っぽい使われ方っぽいですね。一般名詞なのでフレームワークごとに用法が違ってきがちですが、iOS的なコントローラに近そうです。</p>
<p>Litのドキュメント中はたんにコントローラと書かれているところもありますが、ページや段落の初出時には「Reactive Controller」と書かれているので正式名称はこちらっぽいです。APIのインタフェース名もこれになっています。一般名詞を特定用法で振り回すのはあんまり好きじゃない（用語を大切にするはずのDDDがリポジトリとかサービスとかといった名前でよく混乱を引き起こしている）ので、この記事でもリアクティブコントローラと書くようにします。</p>
<p>Litのリアクティブコントローラの設計は単にLitに閉じるものではなく、他のフレームワークからも使えるようなアダプターが提供されようとしています。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/lit/lit/issues/1682">https://github.com/lit/lit/issues/1682</a></p>
<img src="/images/20210615a/スクリーンショット_2021-06-12_9.55.02.png" alt="litのIssue1682" width="1200" height="1154">

<h1 id="リアクティブコントローラのAPI"><a href="#リアクティブコントローラのAPI" class="headerlink" title="リアクティブコントローラのAPI"></a>リアクティブコントローラのAPI</h1><p>リアクティブコントローラを実装するにはReactiveController interfaceを実装したクラスを作ります。コンストラクタの中で呼び出している<code>addConttoller()</code>で、ホストとなるコンポーネントと接続されます。リアクティブコントローラからはホストの<code>requestUpdate()</code>メソッドを呼び出すことで変更を通知します。</p>
<p>次のサンプルはLit.devにあったタイマーのコントローラです。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">ReactiveController</span>, <span class="title class_">ReactiveControllerHost</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;lit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ClockController</span> <span class="keyword">implements</span> <span class="title class_">ReactiveController</span> &#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="title class_">ReactiveControllerHost</span>;</span><br><span class="line"></span><br><span class="line">  value = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="attr">timeout</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">private</span> _timerID?: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">host: ReactiveControllerHost, timeout = <span class="number">1000</span></span>) &#123;</span><br><span class="line">    (<span class="variable language_">this</span>.<span class="property">host</span> = host).<span class="title function_">addController</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timeout</span> = timeout;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">hostConnected</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Start a timer when the host is connected</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_timerID</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">      <span class="comment">// Update the host with new value</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">host</span>.<span class="title function_">requestUpdate</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">hostDisconnected</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Clear the timer when the host is disconnected</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">_timerID</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_timerID</span> = <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>この手のやつが欲しくなるのって、Cheetah-GridとかagGridとかのテーブルコンポーネント系や、ツリービューとかですよね。プロパティに値を入れたらその通りにステートレスで仮想DOMやらなんやらで表示される、というのが今時のウェブ開発の目指すところですが、テーブル部品が入ると途端にその構造が大きく変更されがちです。</p>
<p>そもそも、外から与えるのは初期データで、更新後のデータは内部だけ、とかの設計になっている部品なら良いのですが（ReactのuseState的な)、全部のデータを上流に戻す前提とか、更新のトリガーは中と外のどちらが担当するか、など、まあたいてい再利用できないし、そこだけ大きく重力場が歪む感じがあります。ライフサイクルメソッドを駆使する形になるし、　ReduxとかVuex的なストアとの共存もまた厳しいものがあります。</p>
<p>この手のデータは、データを取得してくるキーは少なく、実態のデータが多くなりがちです。例えば、キーとなる入力はページ番号とソートキーの2つだけど、持っているデータは1ページ分の100行のデータ、といった具合です。ReactとかVueのプログラミングモデルとちょっと相性が悪いのはこの部分かな、と思います。</p>
<p>テーブルコンポーネントの場合、固定のデータをとってくるのか、無限スクロール的にデータを取ってくるのか、ページングなのか、いくつか選択肢があります。そのあたり、ユーザーが自分の使いたいユースケースに合わせて選択できると夢が広がります。</p>
<h1 id="コントローラを外から設定する"><a href="#コントローラを外から設定する" class="headerlink" title="コントローラを外から設定する"></a>コントローラを外から設定する</h1><p>ドキュメントを隅から隅まで読んでも、コントローラをコンポーネントの外から渡すというのはサンプルはありませんでしたが、イベントとして処理すれば良さそうです。こんな感じで書けばconnectedと表示されました。これでテーブルデータの更新をお任せすることが可能な気がします。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LitElement</span>, html, css &#125; <span class="keyword">from</span> <span class="string">&#x27;lit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; customElement, property &#125; <span class="keyword">from</span> <span class="string">&#x27;lit/decorators.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@customElement</span>(<span class="string">&#x27;my-component&#x27;</span>)</span><br><span class="line"><span class="comment">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">LitElement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> controller?: <span class="title class_">ReactiveController</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> html`<span class="language-xml">&lt;div`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">firstUpdated</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> myEvent = <span class="keyword">new</span> <span class="title class_">CustomEvent</span>(<span class="string">&#x27;oninit&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">detail</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;onInit happened.&#x27;</span> &#125;,</span><br><span class="line">            <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">composed</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(myEvent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setController</span>(<span class="params">controller: ReactiveController</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">controller</span> = controller;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">oninit</span>=<span class="string">&quot;console.log&quot;</span> <span class="attr">id</span>=<span class="string">&quot;host&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">constructor</span>(<span class="params">host</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">host</span> = host;</span></span><br><span class="line"><span class="language-javascript">                host.<span class="title function_">addController</span>(<span class="variable language_">this</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">hostConnected</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;connected&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;host&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;oninit&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            e.<span class="property">target</span>.<span class="title function_">setController</span>(<span class="string">&#x27;test&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;, &#123; <span class="attr">once</span>: <span class="literal">true</span>&#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>これは生DOM APIを読んでいるので冗長な感じですが、Vueとかならイベントハンドラはタグ宣言の中で行えますし、そこまで大変ではないかなと思います。まあ、将来的にReactラッパーみたいな感じで、各コンポーネント向けのラッパーが簡単に作れるようになれば・・・</p>
<h1 id="テーブルのデータ取得用のコントローラを作ってみる"><a href="#テーブルのデータ取得用のコントローラを作ってみる" class="headerlink" title="テーブルのデータ取得用のコントローラを作ってみる"></a>テーブルのデータ取得用のコントローラを作ってみる</h1><p>みんな大好き<a href="https://future-architect.github.io/cheetah-grid/#/">Cheetah-Grid</a>のデータを取ってくるコントローラを作ってみます。ただ、サンプルとして作っているので、そこまで実用的ではないです。たいていのこの手のコンポーネントは、データ元を表すオブジェクトが提供されており、それをコンポーネントに渡せばだいたいやりたいことはできてしまいます。Cheetah-Gridも例に漏れず、<a href="https://future-architect.github.io/cheetah-grid/documents/api/js/grid_data/#using-array-object">DataSource</a>で無限スクロールな用途での内部のキャッシュやら描画やらはいい感じにやってくれます。</p>
<p>ですが、ちょっとダサいページングなUIを要望された、という想定で、ページングのデータ取得のリアクティブコントローラを実装してみます。</p>
<p>本当は<a target="_blank" rel="noopener" href="https://devlog.grapecity.co.jp/wijmo-webcomponents/">GrapeCityのWijmo</a>のサンプルみたいにカラム定義もタグで書きたかったけど、まあ今回はリアクティブコントローラのサンプルなのでそこは省略しておきます。</p>
<p>データソースはどこかのウェブサイトかもしれないし、固定テーブルかもしれないし、計算で作るかもしれません。テーブルのユーザーは次のインタフェースを実装し、その中でデータ取得を行うものとします。</p>
<figure class="highlight ts"><figcaption><span>DataSourceController.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ReactiveController</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;lit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DataSourceController</span> <span class="keyword">extends</span> <span class="title class_">ReactiveController</span> &#123;</span><br><span class="line">    <span class="title function_">setPage</span>(<span class="attr">page</span>: <span class="built_in">number</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>setPage()</code>が呼ばれたら中でデータを取得。中でホストの<code>setData()</code>を呼ぶ。</li>
<li>サーバー側で更新がかかったらそれを検知できるように、変更検知時にはホストの<code>setData()</code>を呼んでもいいものとする</li>
</ul>
<p>データをどこから取ってくるかを利用者が定義できるようになりますね。<code>ReactiveController</code>インタフェースを<code>extends</code>していますが、これにも対応することで、コンポーネントが表示されているかどうかが検知できるのでサーバー接続を開始したり終了したりといったこともコントローラ実装者が制御できるようになりますね。</p>
<p>とりあえず、何も考えず、数値と、それを7で割った余りの数値をリストアップするという実用的じゃないサンプルを作ってみます。本当はかっこいいCheetah-Gridをとりあえず固定長テーブル表示で使うWeb Componentsはこんな感じでできます。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LitElement</span>, html, css, <span class="title class_">ReactiveController</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;lit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; customElement &#125; <span class="keyword">from</span> <span class="string">&#x27;lit/decorators.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, <span class="title class_">Ref</span>, createRef &#125; <span class="keyword">from</span> <span class="string">&#x27;lit/directives/ref.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ListGrid</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cheetah-grid&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DataSourceController</span> <span class="keyword">extends</span> <span class="title class_">ReactiveController</span> &#123;</span><br><span class="line">    <span class="title function_">setPage</span>(<span class="attr">page</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@customElement</span>(<span class="string">&#x27;page-grid&#x27;</span>)</span><br><span class="line"><span class="comment">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageGrid</span> <span class="keyword">extends</span> <span class="title class_ inherited__">LitElement</span> &#123;</span><br><span class="line">    <span class="attr">tagRef</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLDivElement</span>&gt; = <span class="title function_">createRef</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> controller?: <span class="title class_">DataSourceController</span>&lt;&#123; <span class="attr">num</span>: <span class="built_in">number</span>; <span class="attr">rem</span>: <span class="built_in">number</span> &#125;&gt;;</span><br><span class="line"></span><br><span class="line">    listGrid?: <span class="title class_">ListGrid</span>&lt;&#123; <span class="attr">num</span>: <span class="built_in">number</span>; <span class="attr">rem</span>: <span class="built_in">number</span> &#125;&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> styles = css`<span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">div</span><span class="selector-class">.grid</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">600px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: solid <span class="number">1px</span> <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    `</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> html`<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid&quot;</span> </span></span><span class="subst">$&#123;ref(<span class="variable language_">this</span>.tagRef)&#125;</span><span class="language-xml"><span class="tag"> /&gt;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">firstUpdated</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;firstUpdated&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> tag = <span class="variable language_">this</span>.<span class="property">tagRef</span>.<span class="property">value</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">listGrid</span> = <span class="keyword">new</span> <span class="title class_">ListGrid</span>(&#123;</span><br><span class="line">            <span class="attr">parentElement</span>: tag,</span><br><span class="line">            <span class="attr">header</span>: [</span><br><span class="line">                &#123; <span class="attr">field</span>: <span class="string">&#x27;num&#x27;</span>, <span class="attr">caption</span>: <span class="string">&#x27;num&#x27;</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">field</span>: <span class="string">&#x27;rem&#x27;</span>, <span class="attr">caption</span>: <span class="string">&#x27;rem 7&#x27;</span> &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> myEvent = <span class="keyword">new</span> <span class="title class_">CustomEvent</span>(<span class="string">&#x27;oninit&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">detail</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;onInit happened.&#x27;</span> &#125;,</span><br><span class="line">            <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">composed</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(myEvent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setController</span>(<span class="params"></span></span><br><span class="line"><span class="params">        controller: DataSourceController&lt;&#123; num: <span class="built_in">number</span>; rem: <span class="built_in">number</span> &#125;&gt;</span></span><br><span class="line"><span class="params">    </span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">controller</span> = controller;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addController</span>(controller);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setData</span>(<span class="params">data: &#123; num: <span class="built_in">number</span>; rem: <span class="built_in">number</span> &#125;[]</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">listGrid</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">listGrid</span>.<span class="property">records</span> = data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用側はこんな感じで、コントローラを作成し、初期化のコールバックでコントローラを設定します。ページング機構を作るのがめんどくさかったので、一秒間に1ページ進むようにしています。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">page-grid</span> <span class="attr">oninit</span>=<span class="string">&quot;console.log&quot;</span> <span class="attr">id</span>=<span class="string">&quot;grid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">page-grid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">constructor</span>(<span class="params">host</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">host</span> = host;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">setPage</span>(<span class="params">page</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> data = [];</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">                    data.<span class="title function_">push</span>(&#123; <span class="attr">num</span>: i + page * <span class="number">10</span>, <span class="attr">rem</span>: (i + page * <span class="number">10</span>) % <span class="number">7</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">host</span>.<span class="title function_">setData</span>(data);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;grid&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;oninit&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">MyController</span>(e.<span class="property">target</span>);</span></span><br><span class="line"><span class="language-javascript">            e.<span class="property">target</span>.<span class="title function_">setController</span>(controller);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> page = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                controller.<span class="title function_">setPage</span>(++page);</span></span><br><span class="line"><span class="language-javascript">            &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ユーザーがデータ取得をリアクティブコントローラでカスタマイズ可能なWebComponentsのテーブルコンポーネントが簡単にできました。</p>
<img src="/images/20210615a/スクリーンショット_2021-06-12_12.25.43.png" alt="テーブルコンポーネント" width="436" height="728">

<h1 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h1><p>データソースをリアクティブコントローラとして分離する実装について解説しました。まあコントローラを外部から与えるという方法は公式ドキュメントにないので、本当にこれでいいのかは不明ですが、今まで悩みの種だった、ちょっと大きめなデータを扱うコンポーネント、テーブルとかツリービューを実装するときの光明になりそうです。仮想DOMではなく、Cheetah-GridのようにCanvas描画で超高速みたいにうたう高性能な部品に、大きめのデータをフレームワークの中でどう渡すかというところで、フレームワークとステート管理機構で、データ取得のキーだけ管理して、実体の生データはリアクティブコントローラが保持して、高性能な部品に渡す、ということになれば、ライブラリとの接合部分がスパゲティになりがちなところが簡潔になるんじゃないかと思います。</p>
<p>この機構はLitだけではなく、他のコンポーネントでも活用できそうなところもいいですね。うちの会社だと技術選定はお客さんの要望次第なところもあってここ三年でReactもVueもAngularも全部さわりました。Web ComponentsでUI部品も共通化されるといいな、といつも思っていましたが、ちょっとしたロジック、たとえばページを開いたタイミングでサーバーからデータ取得とかそういうのも再利用したり、結合が疎になってテストしやすくなるとさらに良いですね。</p>
<p>あとはMaterial YouのリリースでLit製コンポーネントをみんなが使うようになるのが楽しみですね。2021年がWeb Componentsの3回目の元年だとして、4回目と言わなくても済むぐらい広まって欲しいですね。</p>

          
        </div>
        <footer>
          <section class="social-area">
          <!-- シェアボタン START -->
  <ul class="social-button">
    
    <!-- Twitter -->
    <li>
      <a class="social-btn twitter-btn" target="_blank" href="https://twitter.com/share?url=https://future-architect.github.io/articles/20210615a/&related=twitterapi%2Ctwitter&text=%E3%80%8C%E3%83%AA%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%80%8D%E5%B0%8E%E5%85%A5%E3%81%8C%E3%82%82%E3%81%9F%E3%82%89%E3%81%99%E3%81%8B%E3%82%82%E3%81%97%E3%82%8C%E3%81%AA%E3%81%84%E3%82%A6%E3%82%A7%E3%83%96%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E8%A8%AD%E8%A8%88%E3%81%AE%E5%A4%89%E5%8C%96%20%7C%20%E3%83%95%E3%83%A5%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E6%8A%80%E8%A1%93%E3%83%96%E3%83%AD%E3%82%B0" rel="nofollow noopener">
        <i></i><span class="social-btn-label">38</span>
      </a>
    </li>
    <!-- Facebook -->
    <li>
      <a class="social-btn fb-btn" target="_blank" href="http://www.facebook.com/share.php?u=https://future-architect.github.io/articles/20210615a/&t=%E3%80%8C%E3%83%AA%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%80%8D%E5%B0%8E%E5%85%A5%E3%81%8C%E3%82%82%E3%81%9F%E3%82%89%E3%81%99%E3%81%8B%E3%82%82%E3%81%97%E3%82%8C%E3%81%AA%E3%81%84%E3%82%A6%E3%82%A7%E3%83%96%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E8%A8%AD%E8%A8%88%E3%81%AE%E5%A4%89%E5%8C%96" rel="nofollow noopener">
        <i></i><span class="social-btn-label">シェア</span>
      </a>
    </li>
    <!-- hatebu -->
    <li>
      <a class="social-btn hatebu-btn" target="_blank" href="https://b.hatena.ne.jp/entry/s/future-architect.github.io/articles/20210615a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">60</span>
      </a>
    </li>
    <!-- pocket -->
    <li>
      <a class="social-btn pocket-btn" target="_blank" href="https://getpocket.com/save?url=https://future-architect.github.io/articles/20210615a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">44</span>
      </a>
    </li>
    
  </ul>
<!-- シェアボタン END -->

          </section>
          <aside>
            <section class="related-post margin-bottom-40 nav">
              <h2 id="related"><a href="#related" class="headerlink" title="関連記事"></a>関連記事</h2>
              
  <div class="widget">
    <ul class="nav related-post-link"><li class="related-posts-item"><span>2022.02.07</span><span class="snscount">&#9825;3</span><a href=/articles/20220207a/ title="オンライン勉強会をする上で、ちょっと悩むポイントは発表順を決めることです。meetなどで表示されるユーザー一覧は、人によって表示順序が異なるため「画面上の右上の人から順番に」という技が使えなかったりします。"> オンライン勉強会の発表順を決めるサービスを作ってみた</a></li><li class="related-posts-item"><span>2021.11.24</span><span class="snscount">&#9825;232</span><a href=/articles/20211124a/ title="最近、趣味開発でフロントエンドをいじる場合とか、Reactの技術サポートで手っ取り早く使い捨ての環境を作る場合は次の組み合わせで作っています。[Vite.jsでReact + TypeScriptプロジェクト作成。Tailwind CSS。これにESLintとPrettierを入れて完了です。。"> JSレスBootstrapなdaisyUIの秘密</a></li><li class="related-posts-item"><span>2021.11.04</span><span class="snscount">&#9825;8</span><a href=/articles/20211104a/ title="秋のブログ週間連載の6本目です。FutureにはCheetah Gridという最速のウェブフロントエンド用のテーブルコンポーネントがあります。会社のお仕事コードは基本的にVue.jsが採用されることが多く、Cheetah GridもVue.js版のコンポーネントも提供されています。僕はなぜかReact案件が多くて慣れていることもあり、ちょっとしたコードもReactで書きたいと思っています。ちょっとしたツールを実装する上でかっこよくて性能が良いテーブルコンポーネントも欲しいのでCheetah GridのReact版が欲しいなとずっと思っていたので、今回作ってみました。"> Cheetah Grid を Reactから利用するためのラッパーを実装してみる</a></li><li class="related-posts-item"><span>2021.08.06</span><span class="snscount">&#9825;31</span><a href=/articles/20210806a/ title="お仕事コードで、「Cypressで頑張ったけどドラッグアンドドロップのテストができない」という相談を受けました。僕も試行錯誤してみたのですが、どうもうまくいかず・・・CypressとかのE2Eテストは、完全なユーザーの入力をエミュレーションするわけではなくて、ユーザーが入力したときに発生するであろうイベントを擬似的に作って投げているにすぎません。実際に発生するイベントよりも少ないです。例えば..."> Cypressでテスト可能なドラッグアンドドロップ実装</a></li><li class="related-posts-item"><span>2021.05.25</span><span class="snscount">&#9825;201</span><a href=/articles/20210525a/ title="Goで構造体を設計する場合、オブジェクト指向的な「型ごとの責務の分担」以外に、「どのように使われるものか」を考える必要があります。 ポインタで扱うのか？値として扱うのか？両方許可するのか？値として扱える場合にimmutable（変更不可能）なオブジェクトとするのか..."> Goの構造体の使われ方の設計</a></li><li class="related-posts-item"><span>2021.02.12</span><span class="snscount">&#9825;81</span><a href=/articles/20210212/ title="Go 1.16リリース記念連載の最終回はsignal.NotifyContextです。ご存知のように、Go 1.7でcontext.Contextが入ってから、少しずついろいろなAPIがContext対応になりました。"> Go 1.16のsignal.NotifyContext()</a></li></ul>
  </div>
            </section>
            <section class="reference-post margin-bottom-40 nav">
              
  <div class="card">
    <div id="reference" class="reference-lede"><a href="#reference" class="headerlink" title="参照されている記事"></a>この記事を参照している記事</div>
    <ul class="reference-post-link"><li class="reference-posts-item"><a href=/articles/20210614a/ title="2021の06.14～6.24にかけてフロントエンド技術をテーマにしたブログ連載を始めます。ES2021/TS/Node/Vue/Reactなどなど、ざっくりとフロントエンド界隈で話されるような技術をテーマにします。"> フロントエンド連載2021</a></li></ul>
  </div>
            </section>
          </aside>
        </footer>
      </div>
    </article>
  </main>
  <aside class="col-md-3 blog-sidebar">
    <!-- START SIDEBAR  -->


<section class="toc-section">
  <h2 class="margin-top-30">目次</h2>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#n%E5%9B%9E%E7%9B%AE%E3%81%AEWeb-Components%E5%85%83%E5%B9%B4"><span class="toc-text">n回目のWeb Components元年</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Lit%E3%81%AE%E6%96%B0%E6%A9%9F%E8%83%BD%E3%81%AE%E3%83%AA%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%A8%E3%81%AF%E4%BD%95%E8%80%85%E3%81%8B"><span class="toc-text">Litの新機能のリアクティブコントローラとは何者か</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%83%AA%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AEAPI"><span class="toc-text">リアクティブコントローラのAPI</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%82%92%E5%A4%96%E3%81%8B%E3%82%89%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><span class="toc-text">コントローラを外から設定する</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%96%E5%BE%97%E7%94%A8%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><span class="toc-text">テーブルのデータ取得用のコントローラを作ってみる</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%81%BE%E3%81%A8%E3%82%81"><span class="toc-text">まとめ</span></a></li></ol>
</section>

<section class="category">
<h2 class="margin-top-30">カテゴリー</h2>
<div class="widget">
  <ul class="nav sidebar-categories margin-bottom-40">
  
  <li class=""><a href="/categories/Programming/">Programming (315)</a></li>
<li class=""><a href="/categories/Infrastructure/">Infrastructure (188)</a></li>
<li class=""><a href="/categories/Culture/">Culture (76)</a></li>
<li class=""><a href="/categories/DataScience/">DataScience (43)</a></li>
<li class=""><a href="/categories/IoT/">IoT (29)</a></li>
<li class=""><a href="/categories/DB/">DB (17)</a></li>
<li class=""><a href="/categories/Business/">Business (15)</a></li>
<li class=""><a href="/categories/Management/">Management (13)</a></li>
<li class=""><a href="/categories/DevOps/">DevOps (12)</a></li>
<li class=""><a href="/categories/Design/">Design (11)</a></li>
<li class=""><a href="/categories/VR/">VR (10)</a></li>
<li class=""><a href="/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/">認証認可 (10)</a></li>
<li class=""><a href="/categories/Security/">Security (5)</a></li>

  </ul>
</div>

</section>
<section class="podcast-link">
<h2 class="margin-top-30">Tech Cast</h2>

  <div class="class="widget-wrap">
  <div class="widget">
    <ul class="nav techcast">
      <li><a href="https://anchor.fm/futuretechcast/episodes/27-DX-----e1l8edo" title="フューチャーがお届けするポッドキャストです。#27 【DXアプローチ】デザインワークって何?!ミンさんに基本の"き"から教わりました - 後編" target="_blank" rel="noopener"> #27 【DXアプローチ】デザインワークって何?!ミンさんに基本の"き"から教わりました - 後編</a></li>
<li><a href="https://anchor.fm/futuretechcast/episodes/26-DX-----e1l3uoo" title="フューチャーがお届けするポッドキャストです。#26 【DXアプローチ】デザインワークって何?!ミンさんに基本の"き"から教わりました - 前編" target="_blank" rel="noopener"> #26 【DXアプローチ】デザインワークって何?!ミンさんに基本の"き"から教わりました - 前編</a></li>
<li><a href="https://anchor.fm/futuretechcast/episodes/25-TechNightTerraformTerraform---e1kkjig" title="フューチャーがお届けするポッドキャストです。#25 【TechNight】Terraformエンジニア棚井さんから学ぶ「Terraform初心者を脱する瞬間」 - 後編" target="_blank" rel="noopener"> #25 【TechNight】Terraformエンジニア棚井さんから学ぶ「Terraform初心者を脱する瞬間」 - 後編</a></li>
    </ul>
  </div>
  </div>
  
</section>
<section class="advent-calendar">
<h2 class="margin-top-30">アドベントカレンダー</h2>
<div class="widget">
  <ul class="nav-flex">
    <li><a href="http://qiita.com/advent-calendar/2021/future" title="フューチャー Advent Calendar 2021 #Qiita" target="_blank" rel="noopener">2021年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2020/future" title="フューチャー Advent Calendar 2020 #Qiita" target="_blank" rel="noopener">2020年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2019/future" title="フューチャー Advent Calendar 2019 #Qiita" target="_blank" rel="noopener">2019年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2018/future" title="フューチャー Advent Calendar 2018 #Qiita" target="_blank" rel="noopener">2018年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2017/future" title="フューチャー Advent Calendar 2017 #Qiita" target="_blank" rel="noopener">2017年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2016/future" title="フューチャー Advent Calendar 2016 #Qiita" target="_blank" rel="noopener">2016年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2015/future" title="フューチャー Advent Calendar 2015 #Qiita" target="_blank" rel="noopener">2015年</a></li>
  </ul>
</div>

</section>
<!-- END SIDEBAR -->

  </aside>
</div>

  </section>
</div>

      <!-- BEGIN PRE-FOOTER -->
    <footer>
      <div class="pre-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>About Us</h2>
              <p>経営とITをデザインする、フューチャーの技術ブログです。業務で利用している幅広い技術について紹介します。<br /><br /><a target="_blank" rel="noopener" href="http://www.future.co.jp/">http://www.future.co.jp/</a></p>
              <div class="social-btn twitter-btn twitter-follow-btn">
                <a href="https://twitter.com/intent/follow?screen_name=future_techblog " target="_blank" rel="nofollow noopener">
                  <i></i><span class="tw-btn-label">フューチャー技術ブログをフォロー</span>
                </a>
              </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 col-4 pre-footer-col">
              <h2>Contact</h2>
              <address class="margin-bottom-40">
                <a href="https://www.future.co.jp/recruit/recruit/rec-fresh/" title="新卒採用" target="_blank" rel="noopener">新卒採用</a><br>
                <a href="https://www.future.co.jp/recruit/recruit/rec-career/" title="キャリア採用" target="_blank" rel="noopener">キャリア採用</a><br>
                <a href="https://www.future.co.jp/contact_us/" title="お問い合わせページ" target="_blank" rel="noopener">お問い合わせ</a><br>
                <a href="https://www.future.co.jp/architect/socialmediapolicy/" title="ソーシャルメディアポリシー" target="_blank" rel="noopener">メディアポリシー</a><br><br>
                <a href="mailto:techblog@future.co.jp">techblog@future.co.jp</a>
              </address>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>Contents</h2>
              <a href="https://future-architect.github.io/coding-standards/" title="Future Enterprise Coding Standards" target="_blank" rel="noopener">コーディング規約</a><br>
              <a href="https://future-architect.github.io/typescript-guide/" title="仕事ですぐに使えるTypeScript" target="_blank" rel="noopener">仕事ですぐに使えるTypeScript</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>Event</h2>
              <a href="https://future.connpass.com/" title="経営とITをデザインするフューチャーの勉強会です" target="_blank" rel="noopener">connpass</a><br>
              <a href="https://www.future.co.jp/futureinsightseminar/" title="フューチャーインサイトセミナー" target="_blank" rel="noopener">Webセミナー</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>SNS</h2>
              <a href="https://github.com/future-architect" title="Future's official open source repositories" target="_blank" rel="noopener">GitHub</a><br>
              <a href="https://qiita.com/organizations/future" title="フューチャーのQiita Organizationです" target="_blank" rel="noopener">Qiita</a><br>
              <a href="https://note.future.co.jp/" title="フューチャーの公式note" target="_blank" rel="noopener">未来報</a><br>
              <a href="https://www.youtube.com/channel/UCJUSwYYd0CkGgmEKAW7QVpw" title="フューチャーYoutubeチャネル" target="_blank" rel="noopener">Youtube</a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-6 padding-top-10">
              &copy; 2022 フューチャー技術ブログ<br>
            </div>
          </div>
        </div>
      </div>
    </footer>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X1C28R8H0M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X1C28R8H0M');
  gtag('config', 'UA-74047147-1'); // 過渡期対応
</script>

  </div>
</body>
</html>
