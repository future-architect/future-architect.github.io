<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!--
    ███████╗██╗░░░██╗████████╗██╗░░░██╗██████╗░███████╗
    ██╔════╝██║░░░██║╚══██╔══╝██║░░░██║██╔══██╗██╔════╝
    █████╗░░██║░░░██║░░░██║░░░██║░░░██║██████╔╝█████╗░░
    ██╔══╝░░██║░░░██║░░░██║░░░██║░░░██║██╔══██╗██╔══╝░░
    ██║░░░░░╚██████╔╝░░░██║░░░╚██████╔╝██║░░██║███████╗
    ╚═╝░░░░░░╚═════╝░░░░╚═╝░░░░╚═════╝░╚═╝░░╚═╝╚══════╝
    ████████╗███████╗░█████╗░██╗░░██╗
    ╚══██╔══╝██╔════╝██╔══██╗██║░░██║
    ░░░██║░░░█████╗░░██║░░╚═╝███████║
    ░░░██║░░░██╔══╝░░██║░░██╗██╔══██║
    ░░░██║░░░███████╗╚█████╔╝██║░░██║
    ░░░╚═╝░░░╚══════╝░╚════╝░╚═╝░░╚═╝
    ██████╗░██╗░░░░░░█████╗░░██████╗░
    ██╔══██╗██║░░░░░██╔══██╗██╔════╝░
    ██████╦╝██║░░░░░██║░░██║██║░░██╗░
    ██╔══██╗██║░░░░░██║░░██║██║░░╚██╗
    ██████╦╝███████╗╚█████╔╝╚██████╔╝
    ╚═════╝░╚══════╝░╚════╝░░╚═════╝░
    Welcome engineer.
    https://www.future.co.jp/recruit/
  -->
  
  <title>医薬品副作用データベースから医薬品同士の関係を学習・評価・可視化する | フューチャー技術ブログ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  <meta name="description" content="こんにちは！Strategic AI Groupの金子です。 夏の自由研究ブログ連載2021として医薬品副作用データベースにWord2Vecを適用し性能を評価、医薬品-原疾患-有害事象の可視化を行いました。 はじめに本記事で作成したプログラムは医薬品の情報を扱っていますが、医療機器には該当せず人の疾病の診断、治療、予防を目的としておりません。本記事の内容に基づいて医学的判断は行わないようお願い">
<meta property="og:type" content="article">
<meta property="og:title" content="医薬品副作用データベースから医薬品同士の関係を学習・評価・可視化する | フューチャー技術ブログ">
<meta property="og:url" content="https://future-architect.github.io/articles/20210901a/index.html">
<meta property="og:site_name" content="フューチャー技術ブログ">
<meta property="og:description" content="こんにちは！Strategic AI Groupの金子です。 夏の自由研究ブログ連載2021として医薬品副作用データベースにWord2Vecを適用し性能を評価、医薬品-原疾患-有害事象の可視化を行いました。 はじめに本記事で作成したプログラムは医薬品の情報を扱っていますが、医療機器には該当せず人の疾病の診断、治療、予防を目的としておりません。本記事の内容に基づいて医学的判断は行わないようお願い">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/top.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/Mikolov13a.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/Mikolov13b.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/読み込み成功.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/総合感冒剤.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/サリチル酸メチル候補.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/サリチル酸メチル近傍.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/サリチル酸メチル近傍限定.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/薬効分類ありのみ検索.png">
<meta property="og:image" content="https://future-architect.github.io/images/20210901a/薬効分類二桁PCA2D.png">
<meta property="article:published_time" content="2021-08-31T15:00:00.000Z">
<meta property="article:modified_time" content="2024-02-20T05:41:28.743Z">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="ヘルスケア">
<meta property="article:tag" content="Word2Vec">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://future-architect.github.io/images/20210901a/top.png">
  
  <link rel="alternate" href="/atom.xml" title="フューチャー技術ブログ" type="application/atom+xml">
  
  <link rel="icon" href="/logo.svg" sizes="any" type="image/svg+xml">
  <link rel="mask-icon" href="/logo.svg" sizes="any" color="#0bd">
  <link rel="icon alternate" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes='180x180' href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes='57x57' href="/apple-touch-icon-57x57.png">
  <link rel="canonical" href="https://future-architect.github.io/articles/20210901a/">
  <meta content="Python,ヘルスケア,Word2Vec" name="keywords">
  <meta content="金子剛士" name="author">
  <link rel="preload" as="image" href="/banner.jpg" />
  <link rel='manifest' href='/manifest.webmanifest'/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <link rel="stylesheet" href="/metronic/assets/style.css">
  <link rel="stylesheet" href="/css/theme-styles.css">
<meta name="generator" content="Hexo 5.4.2"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body class="corporate">
  <div class="wrap" itemscope itemtype="https://schema.org/TechArticle">
  <!-- BEGIN HEADER -->
<header class="header">
	<div class="header-overlay">
		<div class="header-menu"></div>
		<div class="header-title"><a href="/">Future Tech Blog</a></div>
		<div class="header-title-sub">フューチャー技術ブログ</div>
	</div>
</header>
<!-- Header END -->

  <div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/articles/">Blog</a></li>
    <li class="active">Post</li>
  </ul>
  <section id="main" class="margin-top-30">
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DataScience/">DataScienceカテゴリ</a>
  </div>


    <h2 itemprop="name" class="article-title">医薬品副作用データベースから医薬品同士の関係を学習・評価・可視化する
  
  <a target="_blank" rel="noopener" href="https://github.com/future-architect/tech-blog/edit/master/source/_posts/20210901a_医薬品副作用データベースから医薬品同士の関係を学習・評価・可視化する.md" title="Suggest Edits" class="github-edit"><i class="github-edit-icon"></i></a>
  
</h2>

    <div class="row">
  <main class="col-md-9 blog-posts">
    <article id="post-20210901a_医薬品副作用データベースから医薬品同士の関係を学習・評価・可視化する" class="article article-type-post blog-item" itemscope itemprop="blogPost">
      <div class="article-inner">
        
        <header class="article-header">
          <ul class="blog-info">
            <li class="blog-info-item"><a href="/articles/2021/" class="publish-date"><time datetime="2021-08-31T15:00:00.000Z" itemprop="datePublished">2021.09.01</time></a>
</li>
            <li class="blog-info-item"><li><a href="/authors/%E9%87%91%E5%AD%90%E5%89%9B%E5%A3%AB" title="金子剛士さんの記事一覧へ" class="post-author">金子剛士</a></li></li>
            <li class="blog-info-item">
  
    
    <a href="/tags/Python/" title="Pythonタグの記事へ" class="tag-list-link">Python</a>
  
    
    <a href="/tags/ヘルスケア/" title="ヘルスケアタグの記事へ" class="tag-list-link">ヘルスケア</a>
  
    
    <a href="/tags/Word2Vec/" title="Word2Vecタグの記事へ" class="tag-list-link">Word2Vec</a>
  

</li>
          </ul>
          </header>
        
        <div class="article-entry" itemprop="articleBody">
          
            <img src="/images/20210901a/top.png" alt="" width="600" height="490" loading="lazy">

<p>こんにちは！Strategic AI Groupの金子です。</p>
<p><a href="/articles/20210823a/">夏の自由研究ブログ連載2021</a>として医薬品副作用データベースにWord2Vecを適用し性能を評価、医薬品-原疾患-有害事象の可視化を行いました。</p>
<h1 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h1><p>本記事で作成したプログラムは医薬品の情報を扱っていますが、医療機器には該当せず人の疾病の診断、治療、予防を目的としておりません。本記事の内容に基づいて医学的判断は行わないようお願いします。</p>
<p>この記事は「用語解説」・「実装」・「実験と評価」・「Embedding projectorによる可視化」の4章に分かれております。</p>
<ul>
<li>「用語解説」の章ではこの記事を書いた背景と記事で出てくる用語について解説しています。</li>
<li>「実装」の章では実装に用いたデータ・手法とそのコードについて記載しています。</li>
<li>「実験と評価」の章では実験の定量評価と、得られた医薬品同士の結果について考察を行っています。</li>
<li>「Embedding projectorによる可視化」の章ではウェブアプリを用いた可視化の方法について紹介しています。</li>
</ul>
<p>サムネイルの結果を確認したい場合は<a target="_blank" rel="noopener" href="https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/nadare881/jader_w2v_data/master/config.json">Publish済みのEmbedding Projectorのページ</a>からすぐに見ることができます。</p>
<h1 id="背景・用語解説"><a href="#背景・用語解説" class="headerlink" title="背景・用語解説"></a>背景・用語解説</h1><h2 id="背景・概要について"><a href="#背景・概要について" class="headerlink" title="背景・概要について"></a>背景・概要について</h2><p>今回の自由研究は、Word2Vecを自然言語以外の分野に適用する際の改善手法の検討と、結果の可視化方法の勉強を目的として行いました。</p>
<p>Word2Vecは自然言語処理以外にも使われており、ECサイトの閲覧履歴を文章として扱うことで学習し獲得した商品の分散表現を協調フィルタリングに活用する<a target="_blank" rel="noopener" href="https://arxiv.org/ftp/arxiv/papers/1603/1603.04259.pdf">Item2Vec</a>のような手法が研究されています。それらの手法では推薦精度をもってモデルの評価を行いますが、得られた分散表現の自体の類似度の評価についてではないためその分散表現を用いてデータの分析を行えるかは分からないといった問題があります。本記事では薬効分類番号を用い、医薬品の分散表現の評価を行うことでWord2Vecに対する様々な改善が分析の役に立つかについて定量的に評価を行いました。また、医薬品と原疾患などの関係は医薬品の添付文章などを参照することで検討できるため、定量評価の妥当性についても考察しました。</p>
<h2 id="用語解説"><a href="#用語解説" class="headerlink" title="用語解説"></a>用語解説</h2><h3 id="Word2Vecとは"><a href="#Word2Vecとは" class="headerlink" title="Word2Vecとは"></a>Word2Vecとは</h3><p>Word2Vecは自然言語処理でよく使われる、単語を表現する固定長のベクトルを学習するための手法です。ある単語とその周囲の単語の関係からベクトルを学習することで、例えば下記の図のように<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1310.4546.pdf">国と首都の関係性などを表現できる</a>ようになります。<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></p>
<img src="/images/20210901a/Mikolov13a.png" alt="Mikolov13a.png" width="495" height="349" loading="lazy">

<p>また、Word2Vecで得られた表現には加法構築性があります。学習した単語の分散表現同士で足し算する例(「王様」-「男」+「女」 = 「女王」)は聞いたことがある人も多いと思います。この性質から、前述のとおり自然言語以外の分野でもWord2Vecは広く使われています。</p>
<h3 id="医薬品副作用データベース-JADERとは"><a href="#医薬品副作用データベース-JADERとは" class="headerlink" title="医薬品副作用データベース JADERとは"></a>医薬品副作用データベース JADERとは</h3><p>医薬品副作用データベース(Japanese Adverse Drug Event Report database：JADER)は<a target="_blank" rel="noopener" href="https://www.pmda.go.jp/index.html">独立行政法人 医薬品医療機器総合機構(以下PMDA)</a>が公表している「副作用が疑われる症例報告に関する情報」についてのデータベースです。このデータセットは平成25年度以降に医療機関等から報告のあった国内の副反応疑い報告が調査・研究のために利用できるようcsv形式によりまとめられています。</p>
<p>一つの症例報告は以下の4つのテーブルに分割され、それぞれ識別番号によって紐づけられます。</p>
<ul>
<li>患者の年齢や性別、報告者の資格といった症例一覧テーブル(demoテーブル)</li>
<li>症例発症時に同時に併用していた薬を含む医薬品情報テーブル(drugテーブル)</li>
<li>発生した副作用が疑われる有害事象についての副作用テーブル(reacテーブル)</li>
<li>患者がもともと持っていた疾患に関する原疾患テーブル(histテーブル)</li>
</ul>
<p>今回は、2021/7/23にPMDAの医薬品副作用データベース（英名：Japanese Adverse Drug Event Report database、略称；JADER）から取得したデータを用い実験を行いました。<br>一つの識別番号によって結びついた情報を一つの文章として捉えWord2Vecを実装します。</p>
<h3 id="薬価基準収載医薬品コードとは"><a href="#薬価基準収載医薬品コードとは" class="headerlink" title="薬価基準収載医薬品コードとは"></a>薬価基準収載医薬品コードとは</h3><p>薬価基準収載医薬品コードは厚生労働省が管理する薬価ごとに設定された英数12桁のコードです。薬価基準収載医薬品コードのうち上位4桁は薬効分類番号で日本標準商品分類の中分類87の次の4桁に対応しています。例えばアスピリンには1143と3399が振られており、これは以下のような意味を持ちます。<a target="_blank" rel="noopener" href="https://www.e-stat.go.jp/classifications/terms/30">分類検索システム</a>で実際に検索することができます。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1143: 神経系及び感覚器官用医薬品   &gt;  中枢神経系用薬   &gt;  解熱鎮痛消炎剤   &gt;  サリチル酸系製剤；アスピリン等</span><br><span class="line">3399: 代謝性医薬品   &gt;  血液・体液用薬   &gt;  その他の血液・体液用薬   &gt;  他に分類されない血液・体液用薬</span><br></pre></td></tr></table></figure>
<p>JADER記載の医薬品名と薬価基準収載医薬品コードを紐づけるために厚生労働省のHPからデータを取得しました。<br>薬価基準収載医薬品コードの出典は2021/8/17に取得した以下のページです。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.mhlw.go.jp/topics/2021/04/tp20210401-01.html">薬価基準収載品目リスト及び後発医薬品に関する情報について（令和3年8月12日適用）</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mhlw.go.jp/seisakunitsuite/bunya/kenkou_iryou/iryouhoken/shohosen_210401.html">処方箋に記載する一般名処方の標準的な記載（一般名処方マスタ）について（令和3年6月18日適用）</a></li>
</ul>
<p>また、薬効分類の名称については総務省のHPからデータを取得しました。<br>日本標準商品分類の出典は2021/8/17に取得した以下のページです。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.e-stat.go.jp/classifications/terms/30">日本標準商品分類(平成2年[1990年]6月改定)</a></li>
</ul>
<p>これらのページに記載されたファイルについて編集・加工を行い計算に用いました。</p>
<h1 id="実装"><a href="#実装" class="headerlink" title="実装"></a>実装</h1><p>この章ではデータセットの基本的な統計情報と実装した手法の解説、コードの紹介を行います。</p>
<h2 id="データセット基本情報"><a href="#データセット基本情報" class="headerlink" title="データセット基本情報"></a>データセット基本情報</h2><p>JADERのデータセットについて、693295件の報告を元に学習を行いました。<br>各テーブルに含まれるユニークな語彙数とレコード数は以下の通りです。</p>
<div class="scroll"><table>
<thead>
<tr>
<th align="left"></th>
<th align="right">ユニークな語彙数</th>
<th align="right">レコード数</th>
</tr>
</thead>
<tbody><tr>
<td align="left">医薬品情報テーブル</td>
<td align="right">10106</td>
<td align="right">3875874</td>
</tr>
<tr>
<td align="left">副作用テーブル</td>
<td align="right">9681</td>
<td align="right">1096193</td>
</tr>
<tr>
<td align="left">原疾患テーブル</td>
<td align="right">9903</td>
<td align="right">1392614</td>
</tr>
</tbody></table></div>
<p>医薬品の名称のうち、2071件は薬効分類番号との紐づけができたため、この2071件の類似度を用いて得られたベクトルの評価を行います。紐づけができた薬効分類番号は377種類ありました。</p>
<h2 id="手法解説"><a href="#手法解説" class="headerlink" title="手法解説"></a>手法解説</h2><h3 id="Skip-gramとCBOW"><a href="#Skip-gramとCBOW" class="headerlink" title="Skip-gramとCBOW"></a>Skip-gramとCBOW</h3><p>Word2Vecの学習で現在よく使われる手法は二種類あります。周囲の単語からある単語を予測するCBOW(Countinuous Bag-of-Words)モデルと、ある単語から周囲の単語を予測するSkip-gramモデルです。一般にCBOWよりもSkip-gramの方が計算時間はかかる分精度が高いのですが、実装が簡単であるのと拡張しやすいことから本記事ではCBOWをベースに実装を行います。<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup></p>
<img src="/images/20210901a/Mikolov13b.png" alt="Mikolov13b.png" width="494" height="291" loading="lazy">

<h3 id="Negative-Sampling"><a href="#Negative-Sampling" class="headerlink" title="Negative Sampling"></a>Negative Sampling</h3><p>CBOWもSkip-gramも多クラス分類としてN種類の単語のどれに分類されるか毎回計算することは可能です。しかし、今回の場合単語の種類が30000ほどあるので毎回30000種類の分類の確率を計算するのでは時間がかかってしまいます。そこでサンプルごとにすべての負例を計算するのではなく、ある分布からランダムに5~20程度負例をサンプリングして計算を行うことで高速化します。負例は以下の分布からサンプリングします。</p>
<p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.858ex;" xmlns="http://www.w3.org/2000/svg" width="23.058ex" height="6.161ex" role="img" focusable="false" viewBox="0 -1460 10191.6 2723.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(675,-150) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(1149.3,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1538.3,0)"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="mo" transform="translate(2254.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2921,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(3976.8,0)"><g data-mml-node="mrow" transform="translate(1709.1,710)"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(767,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1156,0)"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="msup" transform="translate(1872,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mi" transform="translate(422,363) scale(0.707)"><path data-c="1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(220,-920)"><g data-mml-node="munderover"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"></path></g><g data-mml-node="mi" transform="translate(1089,477.1) scale(0.707)"><path data-c="1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1263,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g><g data-mml-node="mi" transform="translate(2552.3,0)"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(3319.3,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(3708.3,0)"><g data-mml-node="mi"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="mi" transform="translate(749,-150) scale(0.707)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g></g><g data-mml-node="msup" transform="translate(4850.2,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="TeXAtom" transform="translate(422,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path></g></g></g></g><rect width="5974.8" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p>
<p>alphaはgensimのデフォルトパラメータだと0.75です。αは1だと元の分布そのままで、小さくなるほどレアなサンプルを重視するようになります。今回はalpha=0.75で統一しました。</p>
<h3 id="nDCG"><a href="#nDCG" class="headerlink" title="nDCG"></a>nDCG</h3><p>今回の評価指標はnormalized Discounted Cumulative Gain(nDCG)によって行います。nDCGは検索やレコメンド等でよく使われるランキング手法で、理想的な順位付けにどれくらい近い結果が出せたかをランキングの下位ほど重みを小さくしながら計算します。<br>具体的な計算式は以下の通りです。</p>
<p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="12.966ex" height="1.998ex" role="img" focusable="false" viewBox="0 -725.5 5731 883.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(451,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="msub" transform="translate(917,0)"><g data-mml-node="mi"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(331,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mo" transform="translate(1819.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msup" transform="translate(2875.5,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" transform="translate(484,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></g><g data-mml-node="mo" transform="translate(4230.8,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(5231,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.819ex;" xmlns="http://www.w3.org/2000/svg" width="28.305ex" height="6.757ex" role="img" focusable="false" viewBox="0 -1740.7 12511 2986.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(828,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(1588,0)"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2374,0)"><g data-mml-node="mo"><path data-c="40" d="M56 347Q56 429 86 498T164 612T270 680T386 705Q522 705 622 603T722 349Q722 126 608 126Q541 126 513 176Q512 177 512 179T510 182L509 183Q508 183 503 177T487 163T464 146T429 132T385 126Q311 126 251 186T190 347Q190 448 251 508T385 568Q426 568 460 548T509 511T531 479H555Q580 479 582 478Q586 477 587 468Q588 454 588 338V260Q588 200 593 182T619 163Q641 163 655 178T674 223T680 273T682 325V330Q682 426 647 500Q611 569 544 618T388 668Q271 668 184 577T96 347Q96 216 180 121T396 26Q421 26 446 28T493 34T535 43T573 52T605 63T629 72T647 80T657 84H716Q722 78 722 74Q722 65 675 45T547 7T392 -11Q255 -11 156 90T56 347ZM274 347Q274 266 308 214T390 162Q420 162 449 182T498 235L504 245V449L498 459Q453 532 387 532Q347 532 311 483T274 347Z"></path></g></g><g data-mml-node="mi" transform="translate(3152,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(3950.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(5006.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(5457.6,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="msub" transform="translate(5923.6,0)"><g data-mml-node="mi"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(331,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">１</text></g></g></g><g data-mml-node="mo" transform="translate(7233.9,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="munderover" transform="translate(8234.1,0)"><g data-mml-node="mo"><path data-c="2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path></g><g data-mml-node="TeXAtom" transform="translate(148.2,-1087.9) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(537.8,1150) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="mfrac" transform="translate(9844.8,0)"><g data-mml-node="mrow" transform="translate(562.1,676)"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(451,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="msub" transform="translate(917,0)"><g data-mml-node="mi"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(331,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g><g data-mml-node="mrow" transform="translate(220,-686)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(278,0)"></path><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(778,0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1311,-241.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mo" transform="translate(1714.6,0)"><path data-c="2061" d=""></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1881.2,0)"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g><rect width="2426.2" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.219ex;" xmlns="http://www.w3.org/2000/svg" width="27.345ex" height="5.344ex" role="img" focusable="false" viewBox="0 -1381 12086.5 2362"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(600,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(1428,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(2188,0)"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2974,0)"><g data-mml-node="mo"><path data-c="40" d="M56 347Q56 429 86 498T164 612T270 680T386 705Q522 705 622 603T722 349Q722 126 608 126Q541 126 513 176Q512 177 512 179T510 182L509 183Q508 183 503 177T487 163T464 146T429 132T385 126Q311 126 251 186T190 347Q190 448 251 508T385 568Q426 568 460 548T509 511T531 479H555Q580 479 582 478Q586 477 587 468Q588 454 588 338V260Q588 200 593 182T619 163Q641 163 655 178T674 223T680 273T682 325V330Q682 426 647 500Q611 569 544 618T388 668Q271 668 184 577T96 347Q96 216 180 121T396 26Q421 26 446 28T493 34T535 43T573 52T605 63T629 72T647 80T657 84H716Q722 78 722 74Q722 65 675 45T547 7T392 -11Q255 -11 156 90T56 347ZM274 347Q274 266 308 214T390 162Q420 162 449 182T498 235L504 245V449L498 459Q453 532 387 532Q347 532 311 483T274 347Z"></path></g></g><g data-mml-node="mi" transform="translate(3752,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(4550.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(5606.6,0)"><g data-mml-node="mrow" transform="translate(1403.5,676)"><g data-mml-node="mi"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(828,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(1588,0)"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2374,0)"><g data-mml-node="mo"><path data-c="40" d="M56 347Q56 429 86 498T164 612T270 680T386 705Q522 705 622 603T722 349Q722 126 608 126Q541 126 513 176Q512 177 512 179T510 182L509 183Q508 183 503 177T487 163T464 146T429 132T385 126Q311 126 251 186T190 347Q190 448 251 508T385 568Q426 568 460 548T509 511T531 479H555Q580 479 582 478Q586 477 587 468Q588 454 588 338V260Q588 200 593 182T619 163Q641 163 655 178T674 223T680 273T682 325V330Q682 426 647 500Q611 569 544 618T388 668Q271 668 184 577T96 347Q96 216 180 121T396 26Q421 26 446 28T493 34T535 43T573 52T605 63T629 72T647 80T657 84H716Q722 78 722 74Q722 65 675 45T547 7T392 -11Q255 -11 156 90T56 347ZM274 347Q274 266 308 214T390 162Q420 162 449 182T498 235L504 245V449L498 459Q453 532 387 532Q347 532 311 483T274 347Z"></path></g></g><g data-mml-node="mi" transform="translate(3152,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="mrow" transform="translate(220,-686)"><g data-mml-node="mi"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(828,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(1588,0)"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2374,0)"><g data-mml-node="mo"><path data-c="40" d="M56 347Q56 429 86 498T164 612T270 680T386 705Q522 705 622 603T722 349Q722 126 608 126Q541 126 513 176Q512 177 512 179T510 182L509 183Q508 183 503 177T487 163T464 146T429 132T385 126Q311 126 251 186T190 347Q190 448 251 508T385 568Q426 568 460 548T509 511T531 479H555Q580 479 582 478Q586 477 587 468Q588 454 588 338V260Q588 200 593 182T619 163Q641 163 655 178T674 223T680 273T682 325V330Q682 426 647 500Q611 569 544 618T388 668Q271 668 184 577T96 347Q96 216 180 121T396 26Q421 26 446 28T493 34T535 43T573 52T605 63T629 72T647 80T657 84H716Q722 78 722 74Q722 65 675 45T547 7T392 -11Q255 -11 156 90T56 347ZM274 347Q274 266 308 214T390 162Q420 162 449 182T498 235L504 245V449L498 459Q453 532 387 532Q347 532 311 483T274 347Z"></path></g></g><g data-mml-node="msub" transform="translate(3152,0)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="TeXAtom" transform="translate(554,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(969,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1420,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(1970,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(2436,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2869,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g></g><rect width="6240" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p>
<p>relは関連度で、今回は薬効分類番号が何段階一致しているかで計算します。relの最大はすべて一致している時で2^4-1=15、最小は全て一致していない時で0です。DCGはすべての組み合わせで計算することは計算時間的に困難なため、ランキングの上位K個で評価します。今回はK=100のnDCG@100で計算しました。</p>
<h2 id="コード"><a href="#コード" class="headerlink" title="コード"></a>コード</h2><h3 id="ライブラリの読み込みとデータセットの読み込み"><a href="#ライブラリの読み込みとデータセットの読み込み" class="headerlink" title="ライブラリの読み込みとデータセットの読み込み"></a>ライブラリの読み込みとデータセットの読み込み</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> groupby</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm.notebook <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># csvの読み込み</span></span><br><span class="line">demo_df = pd.read_csv(<span class="string">"../input/pmdacasereport202107/demo202107.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line">drug_df = pd.read_csv(<span class="string">"../input/pmdacasereport202107/drug202107.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line">hist_df = pd.read_csv(<span class="string">"../input/pmdacasereport202107/hist202107.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line">reac_df = pd.read_csv(<span class="string">"../input/pmdacasereport202107/reac202107.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="データセットの用意"><a href="#データセットの用意" class="headerlink" title="データセットの用意"></a>データセットの用意</h3><p>今回はgensimによる実装とtensorflowによる実装を行います。gensimは各単語を文字列で、tensorflowではidに変換した上で用意する必要があります。ただしgensimは自然言語処理用に作られているライブラリなので、今回のように語順の関係ないデータを食わせる場合は事前にshuffleするといった工夫が必要です。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 一つの症例に対し重複した有害事象を除く</span></span><br><span class="line">unique_reac_df = reac_df.drop_duplicates([<span class="string">"識別番号"</span>, <span class="string">"有害事象"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一つの症例に対し被疑薬のみに絞り医薬品の重複を除く</span></span><br><span class="line">unique_drug_df = drug_df.sort_values(by=[<span class="string">"識別番号"</span>, <span class="string">"医薬品の関与"</span>], ascending=[<span class="literal">True</span>, <span class="literal">False</span>]).drop_duplicates([<span class="string">"識別番号"</span>, <span class="string">"医薬品（一般名）"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一つの症例に対し重複した有害事象を除く</span></span><br><span class="line">unique_hist_df = hist_df.drop_duplicates([<span class="string">"識別番号"</span>, <span class="string">"原疾患等"</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1-indexed でidを付与</span></span><br><span class="line">drug_map_df = pd.DataFrame([{<span class="string">"drug_id"</span>: i, <span class="string">"医薬品（一般名）"</span>: k} <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(unique_drug_df[<span class="string">"医薬品（一般名）"</span>].unique(), start=<span class="number">1</span>)])</span><br><span class="line">reac_map_df = pd.DataFrame([{<span class="string">"reac_id"</span>: i, <span class="string">"有害事象"</span>: k} <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(unique_reac_df[<span class="string">"有害事象"</span>].unique(), start=<span class="number">1</span>)])</span><br><span class="line">hist_map_df = pd.DataFrame([{<span class="string">"hist_id"</span>: i, <span class="string">"原疾患等"</span>: k} <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(unique_hist_df[<span class="string">"原疾患等"</span>].unique(), start=<span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line">drug_map_df[<span class="string">"common_id"</span>] = drug_map_df[<span class="string">"drug_id"</span>]</span><br><span class="line">reac_map_df[<span class="string">"common_id"</span>] = reac_map_df[<span class="string">"reac_id"</span>] - <span class="number">1</span> + drug_map_df[<span class="string">"common_id"</span>].<span class="built_in">max</span>()</span><br><span class="line">hist_map_df[<span class="string">"common_id"</span>] = hist_map_df[<span class="string">"hist_id"</span>] - <span class="number">1</span> + reac_map_df[<span class="string">"common_id"</span>].<span class="built_in">max</span>()</span><br><span class="line">common_id_size = hist_map_df[<span class="string">"common_id"</span>].<span class="built_in">max</span>()+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">drug_map = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">zip</span>(drug_map_df[<span class="string">"医薬品（一般名）"</span>], drug_map_df[<span class="string">"drug_id"</span>])}</span><br><span class="line">drug_map_r = {v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">zip</span>(drug_map_df[<span class="string">"医薬品（一般名）"</span>], drug_map_df[<span class="string">"drug_id"</span>])}</span><br><span class="line"></span><br><span class="line">reac_map = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">zip</span>(reac_map_df[<span class="string">"有害事象"</span>], reac_map_df[<span class="string">"reac_id"</span>])}</span><br><span class="line">reac_map_r = {v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">zip</span>(reac_map_df[<span class="string">"有害事象"</span>], reac_map_df[<span class="string">"reac_id"</span>])}</span><br><span class="line"></span><br><span class="line">hist_map = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">zip</span>(hist_map_df[<span class="string">"原疾患等"</span>], hist_map_df[<span class="string">"hist_id"</span>])}</span><br><span class="line">hist_map_r = {v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">zip</span>(hist_map_df[<span class="string">"原疾患等"</span>], hist_map_df[<span class="string">"hist_id"</span>])}</span><br><span class="line"></span><br><span class="line"><span class="comment"># データセットの作成</span></span><br><span class="line">data_dic = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">type_dic = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## tensorflowに入れる用のデータ</span></span><br><span class="line">common_data = []</span><br><span class="line"></span><br><span class="line"><span class="comment">## gensimに入れる用のデータ</span></span><br><span class="line">drug_only_sentences = []</span><br><span class="line">triple_sentences = []</span><br><span class="line">triple_sentences_dic = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## negative sampling実装のためのデータ</span></span><br><span class="line">distribution = np.zeros(common_id_size)</span><br><span class="line"></span><br><span class="line">tmp_df = unique_drug_df.merge(drug_map_df, on=<span class="string">"医薬品（一般名）"</span>, how=<span class="string">"left"</span>)</span><br><span class="line">tmp_df = tmp_df.sort_values(by = <span class="string">"識別番号"</span>)[[<span class="string">"識別番号"</span>, <span class="string">"common_id"</span>, <span class="string">"医薬品（一般名）"</span>]]</span><br><span class="line"><span class="keyword">for</span> report_id, group <span class="keyword">in</span> tqdm(groupby(tmp_df.values, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>]), total=unique_drug_df[<span class="string">"識別番号"</span>].nunique()):</span><br><span class="line">    val = np.vstack(<span class="built_in">list</span>(group))</span><br><span class="line">    data_dic[report_id].extend(val[:, <span class="number">1</span>].tolist())</span><br><span class="line"></span><br><span class="line">    drug_only_sentences.append(val[:, <span class="number">2</span>].tolist())</span><br><span class="line">    triple_sentences_dic[report_id].extend(val[:, <span class="number">2</span>].tolist())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tmp_df = unique_reac_df.merge(reac_map_df, on=<span class="string">"有害事象"</span>, how=<span class="string">"left"</span>)</span><br><span class="line">tmp_df = tmp_df.sort_values(by = <span class="string">"識別番号"</span>)[[<span class="string">"識別番号"</span>, <span class="string">"common_id"</span>, <span class="string">"有害事象"</span>]]</span><br><span class="line"><span class="keyword">for</span> report_id, group <span class="keyword">in</span> tqdm(groupby(tmp_df.values, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>]), total=unique_reac_df[<span class="string">"識別番号"</span>].nunique()):</span><br><span class="line">    val = np.vstack(<span class="built_in">list</span>(group))</span><br><span class="line">    data_dic[report_id].extend(val[:, <span class="number">1</span>].tolist())</span><br><span class="line"></span><br><span class="line">    triple_sentences_dic[report_id].extend(val[:, <span class="number">2</span>].tolist())</span><br><span class="line"></span><br><span class="line">tmp_df = unique_hist_df.merge(hist_map_df, on=<span class="string">"原疾患等"</span>, how=<span class="string">"left"</span>)</span><br><span class="line">tmp_df = tmp_df.sort_values(by = <span class="string">"識別番号"</span>)[[<span class="string">"識別番号"</span>, <span class="string">"common_id"</span>, <span class="string">"原疾患等"</span>]]</span><br><span class="line"><span class="keyword">for</span> report_id, group <span class="keyword">in</span> tqdm(groupby(tmp_df.values, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>]), total=unique_hist_df[<span class="string">"識別番号"</span>].nunique()):</span><br><span class="line">    val = np.vstack(<span class="built_in">list</span>(group))</span><br><span class="line">    data_dic[report_id].extend(val[:, <span class="number">1</span>].tolist())</span><br><span class="line"></span><br><span class="line">    triple_sentences_dic[report_id].extend(val[:, <span class="number">2</span>].tolist())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> report_id <span class="keyword">in</span> tqdm(data_dic.keys()):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data_dic[report_id]) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    data_ = data_dic[report_id]</span><br><span class="line">    type_ = type_dic[report_id]</span><br><span class="line">    ixs = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(data_)))</span><br><span class="line">    shuffle(ixs)</span><br><span class="line">    common_data.append([data_[ix] <span class="keyword">for</span> ix <span class="keyword">in</span> ixs])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> data_:</span><br><span class="line">        distribution[d] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> triple_sentences_dic.items():</span><br><span class="line">    shuffle(v)</span><br><span class="line">    triple_sentences.append(v)</span><br></pre></td></tr></table></figure>

<h3 id="評価指標の用意"><a href="#評価指標の用意" class="headerlink" title="評価指標の用意"></a>評価指標の用意</h3><p>nDCGの評価の為にデータを加工します。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line"></span><br><span class="line"><span class="comment"># 評価用データセットの作成</span></span><br><span class="line"></span><br><span class="line">ippanmei_df = pd.read_csv(<span class="string">"../input/ippanmeishohoumaster/ippanmeishohoumaster_210618.csv"</span>, encoding=<span class="string">"cp932"</span>, header=<span class="number">2</span>).rename({<span class="string">"一般名コード"</span>: <span class="string">'薬価基準収載医薬品コード'</span>}, axis=<span class="number">1</span>)</span><br><span class="line">tp0_df = pd.read_csv(<span class="string">"../input/ippanmeishohoumaster/tp20210812-01_01.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line">tp1_df = pd.read_csv(<span class="string">"../input/ippanmeishohoumaster/tp20210812-01_02.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line">tp2_df = pd.read_csv(<span class="string">"../input/ippanmeishohoumaster/tp20210812-01_03.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line">tp3_df = pd.read_csv(<span class="string">"../input/ippanmeishohoumaster/tp20210401-01_04.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line">tp4_df = pd.read_csv(<span class="string">"../input/ippanmeishohoumaster/tp20210812-01_05.csv"</span>, encoding=<span class="string">"cp932"</span>)</span><br><span class="line">drug_code_df = pd.concat([tp0_df, tp1_df, tp2_df, tp3_df, tp4_df, ippanmei_df])</span><br><span class="line"></span><br><span class="line">drug_code_df[<span class="string">"code0"</span>] = drug_code_df[<span class="string">'薬価基準収載医薬品コード'</span>].<span class="built_in">str</span>.<span class="built_in">slice</span>(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">drug_code_df[<span class="string">"code1"</span>] = drug_code_df[<span class="string">'薬価基準収載医薬品コード'</span>].<span class="built_in">str</span>.<span class="built_in">slice</span>(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">drug_code_df[<span class="string">"code2"</span>] = drug_code_df[<span class="string">'薬価基準収載医薬品コード'</span>].<span class="built_in">str</span>.<span class="built_in">slice</span>(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">drug_code_df[<span class="string">"code3"</span>] = drug_code_df[<span class="string">'薬価基準収載医薬品コード'</span>].<span class="built_in">str</span>.<span class="built_in">slice</span>(<span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">drug_code_df = drug_code_df[[<span class="string">"成分名"</span>, <span class="string">"code0"</span>, <span class="string">"code1"</span>, <span class="string">"code2"</span>, <span class="string">"code3"</span>]].drop_duplicates([<span class="string">"成分名"</span>, <span class="string">"code3"</span>]).rename({<span class="string">"成分名"</span>: <span class="string">"医薬品（マージ）"</span>}, axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">drug_count_df = unique_drug_df[<span class="string">"医薬品（一般名）"</span>].value_counts()\</span><br><span class="line">                                                  .reset_index()\</span><br><span class="line">                                                  .rename({<span class="string">"index"</span>: <span class="string">"医薬品（一般名）"</span>, <span class="string">"医薬品（一般名）"</span>: <span class="string">"count"</span>}, axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正規化</span></span><br><span class="line">replace_dict = {<span class="string">"インスリン　ヒト"</span>: <span class="string">"インスリン ヒト"</span>, <span class="string">"（遺伝子組換え）"</span>: <span class="string">""</span>, <span class="string">"　"</span>: <span class="string">""</span>}</span><br><span class="line">zen = <span class="string">"！＂＃＄％＆＇（）＊＋，－．／０１２３４５６７８９：；＜＝＞？＠ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ［＼］＾＿｀&gt;？＠ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ｛｜｝～"</span></span><br><span class="line">han = zen.translate(<span class="built_in">str</span>.maketrans({<span class="built_in">chr</span>(<span class="number">0xFF01</span> + i): <span class="built_in">chr</span>(<span class="number">0x21</span> + i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">94</span>)}))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> z, h <span class="keyword">in</span> <span class="built_in">zip</span>(zen, han):</span><br><span class="line">    replace_dict[z] = h</span><br><span class="line"></span><br><span class="line">drug_count_df[<span class="string">"医薬品（マージ）"</span>] = drug_count_df[<span class="string">"医薬品（一般名）"</span>]</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> replace_dict.items():</span><br><span class="line">    drug_count_df[<span class="string">"医薬品（マージ）"</span>] = drug_count_df[<span class="string">"医薬品（マージ）"</span>].<span class="built_in">str</span>.replace(k, v)</span><br><span class="line">drug_count_df[<span class="string">"医薬品（マージ）"</span>] = drug_count_df[<span class="string">"医薬品（マージ）"</span>].apply(<span class="keyword">lambda</span> x: re.sub(<span class="string">r"\(.*?\)"</span>, <span class="string">""</span>, x).rstrip(<span class="string">" "</span>))</span><br><span class="line"></span><br><span class="line">drug_count_df = drug_count_df.merge(drug_map_df,</span><br><span class="line">                                    on=<span class="string">"医薬品（一般名）"</span>,</span><br><span class="line">                                    how=<span class="string">"left"</span>)</span><br><span class="line">drug_count_df = drug_count_df.merge(drug_code_df,</span><br><span class="line">                                    on=<span class="string">"医薬品（マージ）"</span>,</span><br><span class="line">                                    how=<span class="string">"left"</span>)</span><br><span class="line">drug_code_map_r = drug_count_df.groupby(<span class="string">"common_id"</span>).apply(<span class="keyword">lambda</span> x: x[<span class="string">"医薬品（一般名）"</span>].values[<span class="number">0</span>] + <span class="string">"【{}】"</span>.<span class="built_in">format</span>(<span class="string">","</span>.join(x[<span class="string">"code3"</span>].fillna(<span class="string">""</span>).astype(<span class="built_in">str</span>))))</span><br><span class="line"></span><br><span class="line">score_dict = {k: {} <span class="keyword">for</span> k <span class="keyword">in</span> drug_count_df[~drug_count_df[<span class="string">"code0"</span>].isna()][<span class="string">"drug_id"</span>].unique()}</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">for</span> g, df <span class="keyword">in</span> drug_count_df[~drug_count_df[<span class="string">"code0"</span>].isna()].groupby(<span class="string">f"code<span class="subst">{i}</span>"</span>):</span><br><span class="line">        <span class="keyword">for</span> a, b <span class="keyword">in</span> combinations(df[<span class="string">"drug_id"</span>].unique(), <span class="number">2</span>):</span><br><span class="line">            score_dict[a][b] = <span class="built_in">max</span>(score_dict[a].get(b, <span class="number">0</span>), i+<span class="number">1</span>)</span><br><span class="line">            score_dict[b][a] = <span class="built_in">max</span>(score_dict[b].get(a, <span class="number">0</span>), i+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">denominator = [<span class="number">1</span>] + [np.log2(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, top_k+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">dcg_perfect = {}</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> score_dict.items():</span><br><span class="line">    score = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s, d <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">sorted</span>(v.values(), reverse=<span class="literal">True</span>)[:top_k], denominator):</span><br><span class="line">        score += (<span class="number">2</span>**s - <span class="number">1</span>) / d</span><br><span class="line">    dcg_perfect[k] = score</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_ndcg</span>(<span class="params">drug_embedding</span>):</span><br><span class="line">    exist_keys_list = <span class="built_in">sorted</span>(<span class="built_in">list</span>(score_dict.keys()))</span><br><span class="line">    predictions = np.take(exist_keys_list, np.argsort(-np.dot(drug_embedding[exist_keys_list], drug_embedding[exist_keys_list].T)))[:, <span class="number">1</span>:top_k+<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    dcg = {}</span><br><span class="line">    <span class="keyword">for</span> k, pred <span class="keyword">in</span> <span class="built_in">zip</span>(exist_keys_list, predictions):</span><br><span class="line">        score = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> p, d <span class="keyword">in</span> <span class="built_in">zip</span>(pred, denominator):</span><br><span class="line">            score += (<span class="number">2</span>**(score_dict[k].get(p, <span class="number">0</span>)) - <span class="number">1</span>) / d</span><br><span class="line">        dcg[k] = score</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (pd.Series(dcg) / pd.Series(dcg_perfect)).mean()</span><br></pre></td></tr></table></figure>

<h3 id="メタデータの用意"><a href="#メタデータの用意" class="headerlink" title="メタデータの用意"></a>メタデータの用意</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"../input/fek/FEK_download.csv"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    fek_df = pd.DataFrame([row[:<span class="number">3</span>] <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">list</span>(reader)[<span class="number">2</span>:]], columns=[<span class="string">"分類コード"</span>,<span class="string">"項目名"</span>,<span class="string">"本籍"</span>])</span><br><span class="line">fek_df[<span class="string">"分類コード87"</span>] = fek_df[<span class="string">"分類コード"</span>].apply(<span class="keyword">lambda</span> x: x[<span class="number">2</span>:] <span class="keyword">if</span> x[:<span class="number">2</span>] == <span class="string">"87"</span> <span class="keyword">else</span> <span class="string">""</span>)</span><br><span class="line">fek_df[<span class="string">"type"</span>] = <span class="string">"drug"</span></span><br><span class="line"></span><br><span class="line">dfs = []</span><br><span class="line">df = drug_map_df[[<span class="string">"common_id"</span>, <span class="string">"医薬品（一般名）"</span>]].rename({<span class="string">"医薬品（一般名）"</span>: <span class="string">"label"</span>}, axis=<span class="number">1</span>)</span><br><span class="line">df[<span class="string">"type"</span>] = <span class="string">"drug"</span></span><br><span class="line">dfs.append(df)</span><br><span class="line"></span><br><span class="line">df = reac_map_df[[<span class="string">"common_id"</span>, <span class="string">"有害事象"</span>]].rename({<span class="string">"有害事象"</span>: <span class="string">"label"</span>}, axis=<span class="number">1</span>)</span><br><span class="line">df[<span class="string">"type"</span>] = <span class="string">"reac"</span></span><br><span class="line">dfs.append(df)</span><br><span class="line"></span><br><span class="line">df = hist_map_df[[<span class="string">"common_id"</span>, <span class="string">"原疾患等"</span>]].rename({<span class="string">"原疾患等"</span>: <span class="string">"label"</span>}, axis=<span class="number">1</span>)</span><br><span class="line">df[<span class="string">"type"</span>] = <span class="string">"hist"</span></span><br><span class="line">dfs.append(df)</span><br><span class="line"></span><br><span class="line">meta_df = pd.concat(dfs).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正規化</span></span><br><span class="line">replace_dict = {<span class="string">"インスリン　ヒト"</span>: <span class="string">"インスリン ヒト"</span>, <span class="string">"（遺伝子組換え）"</span>: <span class="string">""</span>, <span class="string">"　"</span>: <span class="string">""</span>}</span><br><span class="line">zen = <span class="string">"！＂＃＄％＆＇（）＊＋，－．／０１２３４５６７８９：；＜＝＞？＠ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ［＼］＾＿｀&gt;？＠ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ｛｜｝～"</span></span><br><span class="line">han = zen.translate(<span class="built_in">str</span>.maketrans({<span class="built_in">chr</span>(<span class="number">0xFF01</span> + i): <span class="built_in">chr</span>(<span class="number">0x21</span> + i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">94</span>)}))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> z, h <span class="keyword">in</span> <span class="built_in">zip</span>(zen, han):</span><br><span class="line">    replace_dict[z] = h</span><br><span class="line"></span><br><span class="line">meta_df[<span class="string">"医薬品（マージ）"</span>] = meta_df[<span class="string">"label"</span>]</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> replace_dict.items():</span><br><span class="line">    meta_df[<span class="string">"医薬品（マージ）"</span>] = meta_df[<span class="string">"医薬品（マージ）"</span>].<span class="built_in">str</span>.replace(k, v)</span><br><span class="line">meta_df[<span class="string">"医薬品（マージ）"</span>] = meta_df[<span class="string">"医薬品（マージ）"</span>].apply(<span class="keyword">lambda</span> x: re.sub(<span class="string">r"\(.*?\)"</span>, <span class="string">""</span>, x).rstrip(<span class="string">" "</span>))</span><br><span class="line"></span><br><span class="line">drug_code_df[<span class="string">"type"</span>] = <span class="string">"drug"</span></span><br><span class="line">meta_df = meta_df.merge(drug_code_df,</span><br><span class="line">                        on=[<span class="string">"医薬品（マージ）"</span>, <span class="string">"type"</span>],</span><br><span class="line">                        how=<span class="string">"left"</span>)</span><br><span class="line"><span class="keyword">del</span> meta_df[<span class="string">"医薬品（マージ）"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    meta_df = meta_df.merge(fek_df[[<span class="string">"分類コード87"</span>, <span class="string">"項目名"</span>, <span class="string">"type"</span>]].rename({<span class="string">"分類コード87"</span>: <span class="string">f"code<span class="subst">{i}</span>"</span>, <span class="string">"項目名"</span>: <span class="string">f"name<span class="subst">{i}</span>"</span>}, axis=<span class="number">1</span>),</span><br><span class="line">                            on=[<span class="string">f"code<span class="subst">{i}</span>"</span>, <span class="string">"type"</span>],</span><br><span class="line">                            how=<span class="string">"left"</span>)</span><br><span class="line"></span><br><span class="line">meta_df[<span class="string">"type_label"</span>] = <span class="string">"【"</span> + meta_df[<span class="string">"type"</span>] + <span class="string">"】 "</span> + meta_df[<span class="string">"label"</span>]</span><br></pre></td></tr></table></figure>

<h3 id="tensorflow用モジュールの実装"><a href="#tensorflow用モジュールの実装" class="headerlink" title="tensorflow用モジュールの実装"></a>tensorflow用モジュールの実装</h3><h4 id="Samplerの実装"><a href="#Samplerの実装" class="headerlink" title="Samplerの実装"></a>Samplerの実装</h4><p>Tensorflowの学習用のデータを作成するsamplerを実装します。正例は以下の様に実装します。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OneVsOtherSampler</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data, window=<span class="number">5</span>, batch_size=<span class="number">2</span>**<span class="number">13</span></span>):</span><br><span class="line">        self.data = data</span><br><span class="line">        self.window = window</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line"></span><br><span class="line">        ixs = []</span><br><span class="line">        <span class="keyword">for</span> i, d <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(d)):</span><br><span class="line">                ixs.append([i, j])</span><br><span class="line">        self.ixs = np.vstack(ixs)</span><br><span class="line"></span><br><span class="line">        self.size = <span class="built_in">len</span>(ixs)</span><br><span class="line">        self.step = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stream</span>(<span class="params">self</span>):</span><br><span class="line">        X = []</span><br><span class="line">        y = []</span><br><span class="line">        orders = np.arange(self.size)</span><br><span class="line">        np.random.shuffle(orders)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> step, order <span class="keyword">in</span> <span class="built_in">enumerate</span>(orders):</span><br><span class="line">            self.step = step</span><br><span class="line">            ix = self.ixs[order]</span><br><span class="line"></span><br><span class="line">            tmp = self.data[ix[<span class="number">0</span>]][<span class="built_in">max</span>(<span class="number">0</span>, ix[<span class="number">1</span>]-self.window):ix[<span class="number">1</span>]] + self.data[ix[<span class="number">0</span>]][ix[<span class="number">1</span>]+<span class="number">1</span>:ix[<span class="number">1</span>] + <span class="number">1</span> + self.window]</span><br><span class="line">            X.append([<span class="number">0</span>] * (<span class="number">2</span> * self.window - <span class="built_in">len</span>(tmp)) + tmp)</span><br><span class="line">            y.append(self.data[ix[<span class="number">0</span>]][ix[<span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(X) == self.batch_size:</span><br><span class="line">                <span class="keyword">yield</span> X, y</span><br><span class="line">                X = []</span><br><span class="line">                y = []</span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<h4 id="negative-sampler"><a href="#negative-sampler" class="headerlink" title="negative sampler"></a>negative sampler</h4><p>負例は与えられた分布を元に二分探索を用いながらサンプリングします。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NegativeSampler</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, distribution, num_negatives=<span class="number">5</span>, alpha=<span class="number">3</span>/<span class="number">4</span></span>):</span><br><span class="line">        self.num_negatives = num_negatives</span><br><span class="line"></span><br><span class="line">        self.alpha = alpha</span><br><span class="line">        distribution = np.array(distribution)  / <span class="built_in">sum</span>(distribution)</span><br><span class="line">        self.distribution = np.where(distribution == <span class="number">0</span>, <span class="number">0</span>, np.power(distribution, self.alpha))</span><br><span class="line">        self.cumsum_distribution = np.cumsum(self.distribution) / np.<span class="built_in">sum</span>(self.distribution)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sample</span>(<span class="params">self, y</span>):</span><br><span class="line">        <span class="keyword">return</span> np.searchsorted(self.cumsum_distribution, np.random.random((<span class="built_in">len</span>(y), self.num_negatives)))</span><br></pre></td></tr></table></figure>

<h4 id="model"><a href="#model" class="headerlink" title="model"></a>model</h4><p>embeddingの抽出部分とCBOWの部分を分離します。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EmbeddingModel</span>(tf.keras.Model):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, emb_size, emb_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>(EmbeddingModel, self).__init__()</span><br><span class="line">        self.embedding_layer = tf.keras.layers.Embedding(emb_size, emb_dim, mask_zero=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, X</span>):</span><br><span class="line">        X = self.embedding_layer(X)</span><br><span class="line">        <span class="keyword">return</span> X</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StandardModel</span>(tf.keras.Model):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, query_model, target_model</span>):</span><br><span class="line">        <span class="built_in">super</span>(StandardModel, self).__init__()</span><br><span class="line">        self.query_model = query_model</span><br><span class="line">        self.query_pool = tf.keras.layers.GlobalAveragePooling1D()</span><br><span class="line">        self.target_model = target_model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, X, y, target, X_exist_mask, target_mask, training=<span class="literal">False</span></span>):</span><br><span class="line">        X = self.query_model(X)</span><br><span class="line">        X = self.query_pool(X, X_exist_mask)</span><br><span class="line">        X = tf.expand_dims(X, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        W = self.target_model(y)</span><br><span class="line"></span><br><span class="line">        pred = tf.reduce_sum(X*W, axis=-<span class="number">1</span>)</span><br><span class="line">        pred = tf.where(target_mask, pred, -<span class="number">1e9</span>)</span><br><span class="line">        <span class="keyword">return</span> pred</span><br></pre></td></tr></table></figure>

<h4 id="gensim用学習コード"><a href="#gensim用学習コード" class="headerlink" title="gensim用学習コード"></a>gensim用学習コード</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gensim.models <span class="keyword">import</span> word2vec</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_gensim</span>(<span class="params">sentences</span>):</span><br><span class="line">    logging.basicConfig(<span class="built_in">format</span>=<span class="string">'%(asctime)s : %(levelname)s : %(message)s'</span>, level=logging.INFO)</span><br><span class="line"></span><br><span class="line">    model = word2vec.Word2Vec(vector_size=<span class="number">128</span>, min_count=<span class="number">1</span>, window=<span class="number">15</span>, workers=<span class="number">6</span>, negative=<span class="number">15</span>)</span><br><span class="line">    model.build_vocab(sentences, progress_per=<span class="number">10000</span>)</span><br><span class="line">    model.train(sentences, total_examples=model.corpus_count, epochs=<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure>

<h4 id="tensorflow用学習用コード"><a href="#tensorflow用学習用コード" class="headerlink" title="tensorflow用学習用コード"></a>tensorflow用学習用コード</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> adabelief_tf <span class="keyword">import</span> AdaBeliefOptimizer</span><br><span class="line">emb_dim = <span class="number">128</span></span><br><span class="line">batch_size = <span class="number">2</span>**<span class="number">13</span></span><br><span class="line">num_negatives = <span class="number">15</span></span><br><span class="line"></span><br><span class="line">sampler = OneVsOtherSampler(common_data, window=<span class="number">15</span>, batch_size=batch_size)</span><br><span class="line">negative_sampler = NegativeSampler(distribution,</span><br><span class="line">                                   num_negatives=num_negatives)</span><br><span class="line"></span><br><span class="line"><span class="comment"># inputとprojectionで重みを共有</span></span><br><span class="line">common_model = EmbeddingModel(common_id_size, emb_dim)</span><br><span class="line">standard_model = StandardModel(common_model, common_model)</span><br><span class="line"></span><br><span class="line">loss_object = tf.keras.losses.CategoricalCrossentropy(from_logits=<span class="literal">True</span>)</span><br><span class="line">optimizer = AdaBeliefOptimizer(learning_rate=<span class="number">.02</span>, weight_decay=<span class="number">0.</span>, epsilon=<span class="number">1e-14</span>, print_change_log = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">train_loss = tf.keras.metrics.Mean(name=<span class="string">'train_loss'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess</span>(<span class="params">X, y</span>):</span><br><span class="line">    X = tf.keras.preprocessing.sequence.pad_sequences(X, dtype=<span class="string">"int32"</span>, value=<span class="number">0</span>, padding=<span class="string">"pre"</span>)</span><br><span class="line"></span><br><span class="line">    y_neg = tf.constant(negative_sampler.sample(y), dtype=<span class="string">"int32"</span>)</span><br><span class="line">    y = np.hstack([np.array(y).reshape(-<span class="number">1</span>, <span class="number">1</span>), y_neg])</span><br><span class="line"></span><br><span class="line">    X_exist_mask = X &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    target = tf.concat([tf.ones((batch_size, <span class="number">1</span>)), tf.zeros((batch_size, num_negatives))], axis=<span class="number">1</span>)</span><br><span class="line">    target_mask = tf.concat([tf.ones((batch_size, <span class="number">1</span>), dtype=<span class="string">"bool"</span>),</span><br><span class="line">                             (y[:, [<span class="number">0</span>]] != y[:, <span class="number">1</span>:])], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> X, y, target, X_exist_mask, target_mask</span><br><span class="line"></span><br><span class="line"><span class="meta">@tf.function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward_step</span>(<span class="params">X, y, target, X_exist_mask, target_mask</span>):</span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">        pred = model(X, y, target, X_exist_mask, target_mask, training=<span class="literal">True</span>)</span><br><span class="line">        loss = loss_object(target, pred)</span><br><span class="line">    gradients = tape.gradient(loss, model.trainable_variables)</span><br><span class="line">    <span class="keyword">return</span> pred, loss, gradients</span><br><span class="line"></span><br><span class="line"><span class="meta">@tf.function(<span class="params">experimental_relax_shapes=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_gradients</span>(<span class="params">gradients</span>):</span><br><span class="line">    optimizer.apply_gradients(<span class="built_in">zip</span>(gradients, model.trainable_variables))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tqdm(total=<span class="number">2</span>) <span class="keyword">as</span> pbar:</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        gradients_list = []</span><br><span class="line">        <span class="keyword">for</span> X, y <span class="keyword">in</span> sampler.stream():</span><br><span class="line">            pred, loss, gradients = forward_step(*preprocess(X, y))</span><br><span class="line">            apply_gradients(gradients)</span><br><span class="line"></span><br><span class="line">            train_loss(loss)</span><br><span class="line">            learning_text = <span class="string">"[{:.2f} %] "</span>.<span class="built_in">format</span>(<span class="number">100</span> * sampler.step / sampler.size)</span><br><span class="line">            progress_text = <span class="string">"train | Loss: {:.5f} "</span>.<span class="built_in">format</span>(train_loss.result())</span><br><span class="line">            pbar.set_postfix_str(learning_text + progress_text)</span><br><span class="line"></span><br><span class="line">        train_loss.reset_states()</span><br><span class="line">        pbar.update(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h1 id="実験と評価"><a href="#実験と評価" class="headerlink" title="実験と評価"></a>実験と評価</h1><h2 id="学習と定量評価"><a href="#学習と定量評価" class="headerlink" title="学習と定量評価"></a>学習と定量評価</h2><h3 id="実験1-医薬品の情報のみで学習-vs-医薬品-副作用-原疾患で学習"><a href="#実験1-医薬品の情報のみで学習-vs-医薬品-副作用-原疾患で学習" class="headerlink" title="実験1: 医薬品の情報のみで学習 vs 医薬品+副作用+原疾患で学習"></a>実験1: 医薬品の情報のみで学習 vs 医薬品+副作用+原疾患で学習</h3><p>まずはgensimを用いてデータセットに関する検討を行います。</p>
<p>word2vecについて医薬品の情報のみで学習させたものと副作用、原疾患の情報を加えて学習させたもので比較を行いました。</p>
<p>学習のパラメータについては以下のように設定し、後はgensimのデフォルトパラメータを用いました。</p>
<div class="scroll"><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">パラメータ名</th>
<th align="right">値</th>
</tr>
</thead>
<tbody><tr>
<td align="right">0</td>
<td align="left">epoch</td>
<td align="right">10</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">vector_size</td>
<td align="right">128</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">min_count</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">window</td>
<td align="right">15</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">workers</td>
<td align="right">6</td>
</tr>
<tr>
<td align="right">5</td>
<td align="left">negative</td>
<td align="right">15</td>
</tr>
</tbody></table></div>
<p>医薬品のベクトルについてコサイン類似度を用い近傍を取得し評価した結果、nDCG@10はそれぞれ以下のようになりました。</p>
<div class="scroll"><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">モデル名</th>
<th align="right">nDCG@100</th>
</tr>
</thead>
<tbody><tr>
<td align="right">0</td>
<td align="left">gensim 医薬品のみ</td>
<td align="right">0.3883</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">gensim 副作用+原疾患あり</td>
<td align="right">0.4030</td>
</tr>
</tbody></table></div>
<p>医薬品の類似度を計算する場合でも、医薬品以外の情報も合わせて学習を行うことで精度が上がることが分かりました。</p>
<h3 id="実験2-医薬品-副作用-原疾患のデータについてTensorFlowで実装"><a href="#実験2-医薬品-副作用-原疾患のデータについてTensorFlowで実装" class="headerlink" title="実験2: 医薬品+副作用+原疾患のデータについてTensorFlowで実装"></a>実験2: 医薬品+副作用+原疾患のデータについてTensorFlowで実装</h3><p>上記の実験を元に、三種類のデータを用いてtensorflowで学習させたものと比較しました。<br>ただし、tensorflowでの学習はepoch数を2にし、batch sizeは8192にした上で、後のパラメータはgensimに揃えました。</p>
<p>結果は</p>
<div class="scroll"><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">モデル名</th>
<th align="right">nDCG@100</th>
</tr>
</thead>
<tbody><tr>
<td align="right">2</td>
<td align="left">tensorflow 副作用+原疾患あり</td>
<td align="right">0.4191</td>
</tr>
</tbody></table></div>
<p>となり、TensorFlow実装の方が良いスコアとなりました。</p>
<h3 id="実験3-Tensorflowモデルのチューニング"><a href="#実験3-Tensorflowモデルのチューニング" class="headerlink" title="実験3: Tensorflowモデルのチューニング"></a>実験3: Tensorflowモデルのチューニング</h3><p>tensorflowモデルに以下の改善を行いました。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2010.01412">Sharpness-Aware Minimization</a>及び<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2102.11600.pdf">Adaptive Sharpness-Aware Minimization</a>の実装</li>
<li>バッチサイズを8192 -&gt; 65536に変更(Gradient Accumulationを使用)</li>
<li>エポック数を2 -&gt; 20に変更</li>
<li>Warmup + Cosine Annealingによる学習率管理</li>
<li>Metric learningの追加(AdaCosベース独自実装)</li>
</ul>
<div class="scroll"><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">モデル名</th>
<th align="right">nDCG@100</th>
</tr>
</thead>
<tbody><tr>
<td align="right">3</td>
<td align="left">nadare baseline</td>
<td align="right">0.4640</td>
</tr>
</tbody></table></div>
<p>自然言語以外に適用するWord2Vecにおいても、一般的な深層学習のテクニックが有効であることが分かりました。</p>
<h3 id="実験結果まとめ"><a href="#実験結果まとめ" class="headerlink" title="実験結果まとめ"></a>実験結果まとめ</h3><p>全ての結果をまとめるとこのようになります。</p>
<div class="scroll"><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">モデル名</th>
<th align="right">nDCG@100</th>
</tr>
</thead>
<tbody><tr>
<td align="right">0</td>
<td align="left">gensim 医薬品のみ</td>
<td align="right">0.3883</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">gensim 副作用+原疾患あり</td>
<td align="right">0.4030</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">tensorflow 副作用+原疾患あり</td>
<td align="right">0.4191</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">nadare baseline</td>
<td align="right">0.4640</td>
</tr>
</tbody></table></div>
<p>これらの結果のうち、1番と3番についてembeddingの評価を行っていきます。</p>
<h2 id="類似ベクトルの確認と考察"><a href="#類似ベクトルの確認と考察" class="headerlink" title="類似ベクトルの確認と考察"></a>類似ベクトルの確認と考察</h2><p>出現数の多い医薬品のなかから薬効分類番号が一つのみ振られているものについて、薬効分類番号の上一桁が被らないよう出現数順に選び、コサイン類似度で近傍を取得しました。選んだ医薬品は以下になります。</p>
<div class="scroll"><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">医薬品（一般名）</th>
<th align="right">薬効分類番号</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
</tr>
</thead>
<tbody><tr>
<td align="right">20</td>
<td align="left">アセトアミノフェン</td>
<td align="right">1141</td>
<td align="left">神経系及び感覚器官用医薬品</td>
<td align="left">中枢神経系用薬</td>
<td align="left">解熱鎮痛消炎剤</td>
<td align="left">アニリン系製剤；メフェナム酸，フルフェナム酸等</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">アムロジピンベシル酸塩</td>
<td align="right">2171</td>
<td align="left">個々の器官系用医薬品</td>
<td align="left">循環器官用薬</td>
<td align="left">血管拡張剤</td>
<td align="left">冠血管拡張剤</td>
</tr>
<tr>
<td align="right">27</td>
<td align="left">アロプリノール</td>
<td align="right">3943</td>
<td align="left">代謝性医薬品</td>
<td align="left">その他の代謝性医薬品</td>
<td align="left">痛風治療剤</td>
<td align="left">アロプリノール製剤</td>
</tr>
<tr>
<td align="right">26</td>
<td align="left">フルオロウラシル</td>
<td align="right">4223</td>
<td align="left">組織細胞機能用医薬品</td>
<td align="left">腫瘍用薬</td>
<td align="left">代謝拮抗剤</td>
<td align="left">フルオロウラシル系製剤</td>
</tr>
<tr>
<td align="right">855</td>
<td align="left">五苓散</td>
<td align="right">5200</td>
<td align="left">生薬及び漢方処方に基づく医薬品</td>
<td align="left">漢方製剤</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="right">57</td>
<td align="left">リバビリン</td>
<td align="right">6250</td>
<td align="left">病原生物に対する医薬品</td>
<td align="left">化学療法剤</td>
<td align="left">抗ウイルス剤</td>
<td align="left"></td>
</tr>
<tr>
<td align="right">213</td>
<td align="left">イオパミドール</td>
<td align="right">7219</td>
<td align="left">治療を主目的としない医薬品</td>
<td align="left">診断用薬（体外診断用医薬品を除く。）</td>
<td align="left">Ｘ線造影剤</td>
<td align="left">その他のＸ線造影剤</td>
</tr>
<tr>
<td align="right">93</td>
<td align="left">オキシコドン塩酸塩水和物</td>
<td align="right">8119</td>
<td align="left">麻薬</td>
<td align="left">アルカロイド系麻薬（天然麻薬）</td>
<td align="left">あへんアルカロイド系麻薬</td>
<td align="left">その他のあへんアルカロイド系麻薬</td>
</tr>
</tbody></table></div>
<h3 id="医薬品同士の類似度の確認"><a href="#医薬品同士の類似度の確認" class="headerlink" title="医薬品同士の類似度の確認"></a>医薬品同士の類似度の確認</h3><p>選んだ医薬品と類似した医薬品を探すため、コサイン類似度で近傍を取得しました。（【】内は薬効分類番号）</p>
<h4 id="gensim-副作用-原疾患あり"><a href="#gensim-副作用-原疾患あり" class="headerlink" title="gensim 副作用+原疾患あり"></a>gensim 副作用+原疾患あり</h4><div class="scroll"><table>
<thead>
<tr>
<th align="left">0</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
<th align="left">5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">アセトアミノフェン【1141】</td>
<td align="left">ロキソプロフェンナトリウム水和物【1149,2649】</td>
<td align="left">炭酸水素ナトリウム・無水リン酸二水素ナトリウム【2359】</td>
<td align="left">アズレンスルホン酸ナトリウム水和物【2323,2260,2399】</td>
<td align="left">ペンブロリズマブ【】</td>
<td align="left">1141001【】</td>
</tr>
<tr>
<td align="left">アムロジピンベシル酸塩【2171】</td>
<td align="left">ニフェジピン【2171】</td>
<td align="left">ベニジピン塩酸塩【2171】</td>
<td align="left">シルニジピン【2149】</td>
<td align="left">アゼルニジピン【2149】</td>
<td align="left">エホニジピン塩酸塩エタノール付加物【2149】</td>
</tr>
<tr>
<td align="left">アロプリノール【3943】</td>
<td align="left">フェブキソスタット【3949】</td>
<td align="left">トピロキソスタット【3949】</td>
<td align="left">ベンズブロマロン【3949】</td>
<td align="left">痛風治療剤【】</td>
<td align="left">プロベネシド【3942】</td>
</tr>
<tr>
<td align="left">フルオロウラシル【4223】</td>
<td align="left">５－ＦＵ【】</td>
<td align="left">カペシタビン【4223】</td>
<td align="left">1181107【】</td>
<td align="left">テガフール・ギメラシル・オテラシルカリウム配合剤【4229】</td>
<td align="left">５－Ｆ【】</td>
</tr>
<tr>
<td align="left">五苓散【5200】</td>
<td align="left">桂枝茯苓丸【】</td>
<td align="left">当帰芍薬散【】</td>
<td align="left">真武湯【】</td>
<td align="left">半夏厚朴湯【】</td>
<td align="left">柴胡桂枝湯【】</td>
</tr>
<tr>
<td align="left">リバビリン【6250】</td>
<td align="left">レジパスビル　アセトン付加物・ソホスブビル【】</td>
<td align="left">ソラフェニブ【】</td>
<td align="left">ribavirin【】</td>
<td align="left">グレカプレビル水和物・ピブレンタスビル【6250】</td>
<td align="left">prednisolone valerate acetate【】</td>
</tr>
<tr>
<td align="left">イオパミドール【7219】</td>
<td align="left">イオヘキソール【7219】</td>
<td align="left">イオメプロール【7219】</td>
<td align="left">イオベルソール【7219】</td>
<td align="left">イオプロミド【7219】</td>
<td align="left">ガドブトロール【7290】</td>
</tr>
<tr>
<td align="left">オキシコドン塩酸塩水和物【8119】</td>
<td align="left">モルヒネ硫酸塩水和物【8114】</td>
<td align="left">トラマドール塩酸塩【1149】</td>
<td align="left">ヒドロモルフォン塩酸塩【8119】</td>
<td align="left">フェンタニル【8219】</td>
<td align="left">モルヒネ塩酸塩水和物【8114】</td>
</tr>
</tbody></table></div>
<h4 id="nadare-baseline"><a href="#nadare-baseline" class="headerlink" title="nadare baseline"></a>nadare baseline</h4><div class="scroll"><table>
<thead>
<tr>
<th align="left">0</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
<th align="left">5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">アセトアミノフェン【1141】</td>
<td align="left">ロキソプロフェンナトリウム水和物【1149,2649】</td>
<td align="left">UNKNOWNDUG【】</td>
<td align="left">セフカペン　ピボキシル塩酸塩水和物【】</td>
<td align="left">麻黄湯【】</td>
<td align="left">ラニナミビルオクタン酸エステル水和物【6250】</td>
</tr>
<tr>
<td align="left">アムロジピンベシル酸塩【2171】</td>
<td align="left">カンデサルタン　シレキセチル【2149】</td>
<td align="left">バルサルタン【2149】</td>
<td align="left">オルメサルタン　メドキソミル【2149】</td>
<td align="left">ニフェジピン【2171】</td>
<td align="left">テルミサルタン【2149】</td>
</tr>
<tr>
<td align="left">アロプリノール【3943】</td>
<td align="left">クエン酸カリウム・クエン酸ナトリウム水和物【3949】</td>
<td align="left">ベンズブロマロン【3949】</td>
<td align="left">球形吸着炭【3929】</td>
<td align="left">プロベネシド【3942】</td>
<td align="left">中枢神経系用薬【】</td>
</tr>
<tr>
<td align="left">フルオロウラシル【4223】</td>
<td align="left">レボホリナートカルシウム【3929】</td>
<td align="left">オキサリプラチン【4291】</td>
<td align="left">イリノテカン塩酸塩水和物【4240】</td>
<td align="left">アフリベルセプト　ベータ（遺伝子組換え）【】</td>
<td align="left">パニツムマブ（遺伝子組換え）【】</td>
</tr>
<tr>
<td align="left">五苓散【5200】</td>
<td align="left">真武湯【】</td>
<td align="left">柴苓湯【】</td>
<td align="left">桂枝茯苓丸【】</td>
<td align="left">補中益気湯【】</td>
<td align="left">人参養栄湯【】</td>
</tr>
<tr>
<td align="left">リバビリン【6250】</td>
<td align="left">ペグインターフェロン　アルファ－２ｂ（遺伝子組換え）【】</td>
<td align="left">シメプレビルナトリウム【】</td>
<td align="left">テラプレビル【】</td>
<td align="left">ペグインターフェロン　アルファ－２ａ（遺伝子組換え）【】</td>
<td align="left">ソホスブビル【6250】</td>
</tr>
<tr>
<td align="left">イオパミドール【7219】</td>
<td align="left">イオメプロール【7219】</td>
<td align="left">イオヘキソール【7219】</td>
<td align="left">イオベルソール【7219】</td>
<td align="left">イオプロミド【7219】</td>
<td align="left">アミノ安息香酸エチル・パラブチルアミノ安息香酸ジエチルアミノエチル塩酸塩【2710】</td>
</tr>
<tr>
<td align="left">オキシコドン塩酸塩水和物【8119】</td>
<td align="left">プロクロルペラジンマレイン酸塩【1172】</td>
<td align="left">モルヒネ硫酸塩水和物【8114】</td>
<td align="left">フェンタニル【8219】</td>
<td align="left">モルヒネ塩酸塩水和物【8114】</td>
<td align="left">ナルデメジントシル酸塩【2359】</td>
</tr>
</tbody></table></div>
<h4 id="考察"><a href="#考察" class="headerlink" title="考察"></a>考察</h4><p>医薬品間の類似度については、薬効分類番号から分かるように類似した薬物が取れています。薬効分類番号が異なるのに上位に来ている薬物、例えばフルオロウラシルとレボホリナートカルシウムについてですが、レボホリナートカルシウムにはフルオラシルと併用することで抗腫瘍効果を高める効果があるそうです。他にも目視で結果を確認したところ、多剤併用療法が用いられる医薬品については薬効分類番号が近くない場合でも上位に類似した医薬品が現れる傾向が確認できました。</p>
<h3 id="医薬品-原疾患の類似度の確認"><a href="#医薬品-原疾患の類似度の確認" class="headerlink" title="医薬品-原疾患の類似度の確認"></a>医薬品-原疾患の類似度の確認</h3><p>医薬品と原疾患のベクトルについてコサイン類似度で近傍を取得しました。</p>
<h4 id="gensim-副作用-原疾患あり-1"><a href="#gensim-副作用-原疾患あり-1" class="headerlink" title="gensim 副作用+原疾患あり"></a>gensim 副作用+原疾患あり</h4><div class="scroll"><table>
<thead>
<tr>
<th align="left"></th>
<th align="left">0</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
</tr>
</thead>
<tbody><tr>
<td align="left">アセトアミノフェン</td>
<td align="left">過敏症</td>
<td align="left">脾臓辺縁帯リンパ腫第３期</td>
<td align="left">回復期患者</td>
<td align="left">ドーパ反応性ジストニア</td>
<td align="left">矮小腎</td>
</tr>
<tr>
<td align="left">アムロジピンベシル酸塩</td>
<td align="left">視床出血</td>
<td align="left">一過性脳虚血発作</td>
<td align="left">腫瘍随伴性ネフローゼ症候群</td>
<td align="left">脳幹出血</td>
<td align="left">拡張期血圧低下</td>
</tr>
<tr>
<td align="left">アロプリノール</td>
<td align="left">尿毒症性アシドーシス</td>
<td align="left">高血圧</td>
<td align="left">酸素消費量</td>
<td align="left">高カリウム血症</td>
<td align="left">腎硬化症</td>
</tr>
<tr>
<td align="left">フルオロウラシル</td>
<td align="left">子宮頚部癌第４期</td>
<td align="left">好中球減少性感染</td>
<td align="left">遠隔転移を伴う肝癌</td>
<td align="left">腹膜転移</td>
<td align="left">遠隔転移を伴う肛門癌</td>
</tr>
<tr>
<td align="left">五苓散</td>
<td align="left">補充現象</td>
<td align="left">偽アルドステロン症</td>
<td align="left">硬膜下血腫除去</td>
<td align="left">閉経期症状</td>
<td align="left">中毒性皮疹</td>
</tr>
<tr>
<td align="left">リバビリン</td>
<td align="left">肝炎ウイルス関連腎症</td>
<td align="left">Ｂ型肝炎ｅ抗原陰性</td>
<td align="left">Ｂ型肝炎ｅ抗原陽性</td>
<td align="left">耳管炎</td>
<td align="left">予防</td>
</tr>
<tr>
<td align="left">イオパミドール</td>
<td align="left">ヘパリン中和療法</td>
<td align="left">過期産児</td>
<td align="left">腎病変部切除</td>
<td align="left">アルコールによる宿酔</td>
<td align="left">橈骨動脈脈拍異常</td>
</tr>
<tr>
<td align="left">オキシコドン塩酸塩水和物</td>
<td align="left">癌疼痛</td>
<td align="left">腫瘍熱</td>
<td align="left">免疫性腸炎</td>
<td align="left">肝転移</td>
<td align="left">中枢神経系転移</td>
</tr>
</tbody></table></div>
<h4 id="nadare-baseline-1"><a href="#nadare-baseline-1" class="headerlink" title="nadare baseline"></a>nadare baseline</h4><div class="scroll"><table>
<thead>
<tr>
<th align="left"></th>
<th align="left">0</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
</tr>
</thead>
<tbody><tr>
<td align="left">アセトアミノフェン</td>
<td align="left">発熱</td>
<td align="left">口腔咽頭痛</td>
<td align="left">インフルエンザ</td>
<td align="left">上咽頭炎</td>
<td align="left">ウイルス感染</td>
</tr>
<tr>
<td align="left">アムロジピンベシル酸塩</td>
<td align="left">高血圧</td>
<td align="left">高脂血症</td>
<td align="left">糖尿病</td>
<td align="left">脳出血</td>
<td align="left">視床出血</td>
</tr>
<tr>
<td align="left">アロプリノール</td>
<td align="left">高尿酸血症</td>
<td align="left">痛風</td>
<td align="left">血中尿酸増加</td>
<td align="left">痛風性関節炎</td>
<td align="left">コケーン症候群</td>
</tr>
<tr>
<td align="left">フルオロウラシル</td>
<td align="left">再発直腸癌</td>
<td align="left">再発結腸癌</td>
<td align="left">食道扁平上皮癌</td>
<td align="left">遠隔転移を伴う直腸Ｓ状結腸癌</td>
<td align="left">肛門扁平上皮癌</td>
</tr>
<tr>
<td align="left">五苓散</td>
<td align="left">硬膜下血腫</td>
<td align="left">補充現象</td>
<td align="left">脛骨内側過労性症候群</td>
<td align="left">冷感</td>
<td align="left">頭蓋骨骨折</td>
</tr>
<tr>
<td align="left">リバビリン</td>
<td align="left">慢性Ｃ型肝炎</td>
<td align="left">ウイルス血症</td>
<td align="left">Ｃ型肝炎</td>
<td align="left">腟膿瘍</td>
<td align="left">Ｃ型肝炎ＲＮＡ陽性</td>
</tr>
<tr>
<td align="left">イオパミドール</td>
<td align="left">コンピュータ断層撮影</td>
<td align="left">肝新生物</td>
<td align="left">膵新生物</td>
<td align="left">大動脈造影</td>
<td align="left">尿路造影</td>
</tr>
<tr>
<td align="left">オキシコドン塩酸塩水和物</td>
<td align="left">癌疼痛</td>
<td align="left">骨転移</td>
<td align="left">腫瘍熱</td>
<td align="left">歯肉損傷</td>
<td align="left">骨痛</td>
</tr>
</tbody></table></div>
<h4 id="考察-1"><a href="#考察-1" class="headerlink" title="考察"></a>考察</h4><p>医薬品-原疾患との関係でも、定量評価におけるスコアがより高い後者の手法の方がより薬効分類の名称から推測できる原疾患に近いものが得られました。特にWord2Vecで学習した後近傍をとる場合、正規化を行わない内積では関連度が低く出現頻度の高いアイテムが、正規化を行った場合は類似度がたまたま高いマイナーなアイテムが出てしまうといった問題が起こるのですが、metric learningを用い学習中にコサイン類似度をもって学習を行った場合は、その医薬品に関連のある原疾患に加え、「発熱」・「高血圧」といったコーパス全体での出現頻度が高い原疾患も適切に上位に類似アイテムとして表示されました。</p>
<h3 id="医薬品-有害事象の類似度の確認"><a href="#医薬品-有害事象の類似度の確認" class="headerlink" title="医薬品-有害事象の類似度の確認"></a>医薬品-有害事象の類似度の確認</h3><p>医薬品と有害事象のベクトルについてコサイン類似度で近傍を取得しました。</p>
<h4 id="gensim-副作用-原疾患あり-2"><a href="#gensim-副作用-原疾患あり-2" class="headerlink" title="gensim 副作用+原疾患あり"></a>gensim 副作用+原疾患あり</h4><div class="scroll"><table>
<thead>
<tr>
<th align="left"></th>
<th align="left">0</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
</tr>
</thead>
<tbody><tr>
<td align="left">アセトアミノフェン</td>
<td align="left">過敏症</td>
<td align="left">患者による企図的医療機器除去</td>
<td align="left">乏渇感症</td>
<td align="left">多形紅斑</td>
<td align="left">巨核球異常</td>
</tr>
<tr>
<td align="left">アムロジピンベシル酸塩</td>
<td align="left">スプルー様腸疾患</td>
<td align="left">視床出血</td>
<td align="left">一過性脳虚血発作</td>
<td align="left">脾臓スキャン異常</td>
<td align="left">脳幹出血</td>
</tr>
<tr>
<td align="left">アロプリノール</td>
<td align="left">高血圧</td>
<td align="left">中心性チアノーゼ</td>
<td align="left">高カリウム血症</td>
<td align="left">腎硬化症</td>
<td align="left">ＣＤ４リンパ球増加</td>
</tr>
<tr>
<td align="left">フルオロウラシル</td>
<td align="left">２型過敏症</td>
<td align="left">注射に伴う反応</td>
<td align="left">子宮頚部癌第４期</td>
<td align="left">好中球減少性感染</td>
<td align="left">遠隔転移を伴う肝癌</td>
</tr>
<tr>
<td align="left">五苓散</td>
<td align="left">偽アルドステロン症</td>
<td align="left">閉経期症状</td>
<td align="left">中毒性皮疹</td>
<td align="left">腸間膜静脈硬化症</td>
<td align="left">肝脾膿瘍</td>
</tr>
<tr>
<td align="left">リバビリン</td>
<td align="left">肝炎ウイルス関連腎症</td>
<td align="left">抗インターフェロン抗体陽性</td>
<td align="left">プロトロンビン量異常</td>
<td align="left">Ｃ型肝炎ＲＮＡ増加</td>
<td align="left">肝臓血管腫</td>
</tr>
<tr>
<td align="left">イオパミドール</td>
<td align="left">ヒスタミン濃度増加</td>
<td align="left">トリプターゼ増加</td>
<td align="left">立毛</td>
<td align="left">橈骨動脈脈拍異常</td>
<td align="left">血管拡張術</td>
</tr>
<tr>
<td align="left">オキシコドン塩酸塩水和物</td>
<td align="left">癌疼痛</td>
<td align="left">腫瘍熱</td>
<td align="left">免疫性腸炎</td>
<td align="left">肝転移</td>
<td align="left">中枢神経系転移</td>
</tr>
</tbody></table></div>
<h4 id="nadare-baseline-2"><a href="#nadare-baseline-2" class="headerlink" title="nadare baseline"></a>nadare baseline</h4><div class="scroll"><table>
<thead>
<tr>
<th align="left"></th>
<th align="left">0</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
</tr>
</thead>
<tbody><tr>
<td align="left">アセトアミノフェン</td>
<td align="left">中毒性表皮壊死融解症</td>
<td align="left">スティーヴンス・ジョンソン症候群</td>
<td align="left">胆管消失症候群</td>
<td align="left">尿細管間質性腎炎</td>
<td align="left">皮膚粘膜眼症候群</td>
</tr>
<tr>
<td align="left">アムロジピンベシル酸塩</td>
<td align="left">血管内ガス</td>
<td align="left">肉芽腫性皮膚炎</td>
<td align="left">毛孔性紅色粃糠疹</td>
<td align="left">コントロール不良の血圧</td>
<td align="left">スプルー様腸疾患</td>
</tr>
<tr>
<td align="left">アロプリノール</td>
<td align="left">線維性心内膜炎</td>
<td align="left">痛風</td>
<td align="left">好酸球増加と全身症状を伴う薬物反応</td>
<td align="left">低亜鉛血症</td>
<td align="left">痛風性関節炎</td>
</tr>
<tr>
<td align="left">フルオロウラシル</td>
<td align="left">白血球減少症</td>
<td align="left">好中球減少症</td>
<td align="left">咽頭知覚不全</td>
<td align="left">埋込み部位離開</td>
<td align="left">閉塞性瘢痕ヘルニア</td>
</tr>
<tr>
<td align="left">五苓散</td>
<td align="left">高血圧切迫症</td>
<td align="left">多形日光疹</td>
<td align="left">偽アルドステロン症</td>
<td align="left">腸間膜静脈硬化症</td>
<td align="left">薬物性肝障害</td>
</tr>
<tr>
<td align="left">リバビリン</td>
<td align="left">網膜症</td>
<td align="left">陰嚢出血</td>
<td align="left">Ｂ細胞性前リンパ球性白血病</td>
<td align="left">パートナーの自然流産</td>
<td align="left">抑うつ症状</td>
</tr>
<tr>
<td align="left">イオパミドール</td>
<td align="left">造影剤アレルギー</td>
<td align="left">ショック</td>
<td align="left">アナフィラキシーショック</td>
<td align="left">アナフィラキシー様ショック</td>
<td align="left">くしゃみ</td>
</tr>
<tr>
<td align="left">オキシコドン塩酸塩水和物</td>
<td align="left">丘疹状蕁麻疹</td>
<td align="left">溢流性下痢</td>
<td align="left">譫妄</td>
<td align="left">逆説疼痛</td>
<td align="left">癌疼痛</td>
</tr>
</tbody></table></div>
<h4 id="考察-2"><a href="#考察-2" class="headerlink" title="考察"></a>考察</h4><p>医薬品-有害事象間でも後者の手法の方がより添付文章等で確認できる有害事象が現れていると考えられます。一方で、前者のオキシコドン塩酸塩水和物に対する癌疼痛や後者のアロプリノールに対する痛風は有害事象というよりは原疾患に見えます。これらの例についてはデータセット由来の問題か手法の問題化は検討する必要があります。</p>
<h3 id="類似ベクトルの確認のまとめ"><a href="#類似ベクトルの確認のまとめ" class="headerlink" title="類似ベクトルの確認のまとめ"></a>類似ベクトルの確認のまとめ</h3><p>薬効分類を用いて定量評価しスコアの高かった手法は、医薬品-医薬品の類似度に加え医薬品-原疾患や医薬品-有害事象間でも良い近傍を得られることが分かりました。この結果を踏まえ、最も評価の高かったnadare baselineについてEmbedding projectorによる可視化する方法を紹介します。</p>
<h1 id="Embedding-projectorによる可視化"><a href="#Embedding-projectorによる可視化" class="headerlink" title="Embedding projectorによる可視化"></a>Embedding projectorによる可視化</h1><p><a target="_blank" rel="noopener" href="https://projector.tensorflow.org/">Embedding projector</a>はgoogleの開発するTensorBoardの機能の一つのEmbedding projectorのブラウザ版で、ベクトルとベクトルに関するメタデータを読み込むことでインタラクティブにベクトルの可視化を行うことができます。</p>
<p>今回はnadare baselineで学習させたベクトルを公開します。<br>次のリンクからEmbedding projectorのページに飛んでください。<a target="_blank" rel="noopener" href="https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/nadare881/jader_w2v_data/master/config.json">リンク</a></p>
<p>なお、これから下の図表は公開しているベクトルよりも古いバージョンでの結果のため、上記のリンクで得られる結果とは異なる場合があります。</p>
<p>読み込みに成功すると以下のようにベクトルの散布図が表示され、点にマウスオーバーするとそのベクトルの値が表示されます。<br><img src="/images/20210901a/読み込み成功.png" alt="読み込み成功.png" width="1200" height="580" loading="lazy"></p>
<p>そのままベクトルをクリックするとそのベクトルの近傍のベクトルが表示されます。<br><img src="/images/20210901a/総合感冒剤.png" alt="総合感冒剤.png" width="1200" height="589" loading="lazy"></p>
<h2 id="メタデータから検索する。"><a href="#メタデータから検索する。" class="headerlink" title="メタデータから検索する。"></a>メタデータから検索する。</h2><p>今回はメタデータとして以下のデータを用意しました。</p>
<div class="scroll"><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">列名</th>
<th align="left">内容</th>
</tr>
</thead>
<tbody><tr>
<td align="right">0</td>
<td align="left">common_id</td>
<td align="left">drug-reac-hist全体でユニークなID、重複あり</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">label</td>
<td align="left">医薬品の一般名、原疾患名、有害事象の名前</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">type</td>
<td align="left">drug, reac, histのいずれか</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">code0</td>
<td align="left">対応する薬効分類番号の上1桁の数字, 一部の医薬品のみ</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">code1</td>
<td align="left">対応する薬効分類番号の上2桁の数字, 一部の医薬品のみ</td>
</tr>
<tr>
<td align="right">5</td>
<td align="left">code2</td>
<td align="left">対応する薬効分類番号の上3桁の数字, 一部の医薬品のみ</td>
</tr>
<tr>
<td align="right">6</td>
<td align="left">code3</td>
<td align="left">対応する薬効分類番号の上4桁の数字, 一部の医薬品のみ</td>
</tr>
<tr>
<td align="right">7</td>
<td align="left">name0</td>
<td align="left">対応する薬効分類番号の上1桁の名称, 一部の医薬品のみ</td>
</tr>
<tr>
<td align="right">8</td>
<td align="left">name1</td>
<td align="left">対応する薬効分類番号の上2桁の名称, 一部の医薬品のみ</td>
</tr>
<tr>
<td align="right">9</td>
<td align="left">name2</td>
<td align="left">対応する薬効分類番号の上3桁の名称, 一部の医薬品のみ</td>
</tr>
<tr>
<td align="right">10</td>
<td align="left">name3</td>
<td align="left">対応する薬効分類番号の上4桁の名称, 一部の医薬品のみ</td>
</tr>
<tr>
<td align="right">11</td>
<td align="left">type_label</td>
<td align="left">type と labelを同時に表記</td>
</tr>
</tbody></table></div>
<p>画面左のLabel byで表示名を変更できるので、type_labelに設定します。<br>その上で、画面右の検索boxから医薬品を検索してみましょう。</p>
<p>筆者は腰痛持ちなので、たびたびお世話になる「サリチル酸メチル」を入力します。<br><img src="/images/20210901a/サリチル酸メチル候補.png" alt="サリチル酸メチル候補.png" width="1200" height="576" loading="lazy"><br>候補がいくつか出てくるので、その中からサリチル酸メチルを選択するとサリチル酸メチルの近傍の値が表示されます。バップ剤(湿布の一種)や湿布に関連した成分が出ています。<br><img src="/images/20210901a/サリチル酸メチル近傍.png" alt="サリチル酸メチル近傍.png" width="1200" height="559" loading="lazy"></p>
<p>右のneighborのスライダーを調節した上で「Isolate X points」をクリックすると近傍のみ表示することができます。<br><img src="/images/20210901a/サリチル酸メチル近傍限定.png" alt="サリチル酸メチル近傍限定.png" width="1200" height="580" loading="lazy"></p>
<h2 id="メタデータから絞り込み・色分けする"><a href="#メタデータから絞り込み・色分けする" class="headerlink" title="メタデータから絞り込み・色分けする"></a>メタデータから絞り込み・色分けする</h2><p>薬効分類番号のあるデータに絞って表示し、分類番号ごとに色分けして上手く表示できるか確認します。<br>右のSearchの正規表現オンオフボタン「.*」を押し、正規表現での検索を有効にします。<br>Searchに「^[0-9]」を入力すると薬効分類番号のあるデータのみが選べるので、その状態で「Isolate 2230 points」をクリックすると絞り込みができます。<br><img src="/images/20210901a/薬効分類ありのみ検索.png" alt="薬効分類ありのみ検索.png" width="1200" height="579" loading="lazy"></p>
<p>絞り込んだ状態で色を付けて確認してみましょう。<br>左のLabel byを「name1」にし、Color byを「code1」にすると薬効分類番号の上二桁で色付けされた状態で表示されます。<br>左下のチェックボックスを外すと二次元で描画できるので、その状態の図を表示します。<br><img src="/images/20210901a/薬効分類二桁PCA2D.png" alt="薬効分類二桁PCA2D.png" width="1200" height="582" loading="lazy"></p>
<p>左下のUMAP, T-SNEを押すと他の次元圧縮の方法が使えます。<br>UMAPを押すと次元圧縮の計算が行われます。<br>Neighborsを50で計算すると下の図のように見やすくなりました。UMAPやt-SNEでの圧縮後の距離は元空間の距離から崩れてしまうので注意が必要ですが、これによって得られたベクトルが他のタスクに使えるかなどをざっくり判断することができます。</p>
<img src="/images/20210901a/薬効分類二桁umap2D.png" alt="薬効分類二桁umap2D.png" width="1200" height="578" loading="lazy">

<h1 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h1><p>今回はword2vecを用いて医薬品副作用データベースから医薬品の埋め込み表現を獲得できました。さらにtensorflowで様々なテクニックを使うことでより良い表現を得られ、その効果について定量・定性評価により確認できました。</p>
<p>ただ、gensim実装に比べてtensorflow実装は計算時間が大幅にかかり、現状だとtensorflowの方はGPUを使ってもgensimの30~60倍の計算時間がかかります。今後はこの辺りを改善しつつ、より良い埋め込み表現の獲得を目指していきたいと思います。</p>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="vertical-align: top; padding-right: 10px;">1.</span><span style="vertical-align: top;">Tomas Mikolov, Ilya Sutskever, Kai Chen, Gregory S. Corrado, Jeffrey Dean. Distributed Representations of Words and Phrases and their Compositionality. NIPS, 2013</span><a href="#fnref:1" rev="footnote"> ↩</a></li><li id="fn:2"><span style="vertical-align: top; padding-right: 10px;">2.</span><span style="vertical-align: top;">Tomas Mikolov, Ilya Sutskever, Kai Chen, Gregory S. Corrado, Jeffrey Dean. Efficient Estimation of Word Representations in Vector Space. CoRR, 2013</span><a href="#fnref:2" rev="footnote"> ↩</a></li></ol></div></div>
          
        </div>
        <footer>
          <section class="social-area">
          <!-- シェアボタン START -->
  <ul class="social-button">
    
    <!-- Twitter -->
    <li>
      <a class="social-btn twitter-btn" target="_blank" href="https://twitter.com/share?url=https://future-architect.github.io/articles/20210901a/&related=twitterapi%2Ctwitter&text=%E5%8C%BB%E8%96%AC%E5%93%81%E5%89%AF%E4%BD%9C%E7%94%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E5%8C%BB%E8%96%AC%E5%93%81%E5%90%8C%E5%A3%AB%E3%81%AE%E9%96%A2%E4%BF%82%E3%82%92%E5%AD%A6%E7%BF%92%E3%83%BB%E8%A9%95%E4%BE%A1%E3%83%BB%E5%8F%AF%E8%A6%96%E5%8C%96%E3%81%99%E3%82%8B%20%7C%20%E3%83%95%E3%83%A5%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E6%8A%80%E8%A1%93%E3%83%96%E3%83%AD%E3%82%B0" rel="nofollow noopener">
        <i></i><span class="social-btn-label">62</span>
      </a>
    </li>
    <!-- Facebook -->
    <li>
      <a class="social-btn fb-btn" target="_blank" href="http://www.facebook.com/share.php?u=https://future-architect.github.io/articles/20210901a/&t=%E5%8C%BB%E8%96%AC%E5%93%81%E5%89%AF%E4%BD%9C%E7%94%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E5%8C%BB%E8%96%AC%E5%93%81%E5%90%8C%E5%A3%AB%E3%81%AE%E9%96%A2%E4%BF%82%E3%82%92%E5%AD%A6%E7%BF%92%E3%83%BB%E8%A9%95%E4%BE%A1%E3%83%BB%E5%8F%AF%E8%A6%96%E5%8C%96%E3%81%99%E3%82%8B" rel="nofollow noopener">
        <i></i><span class="social-btn-label">シェア</span>
      </a>
    </li>
    <!-- hatebu -->
    <li>
      <a class="social-btn hatebu-btn" target="_blank" href="https://b.hatena.ne.jp/entry/s/future-architect.github.io/articles/20210901a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">2</span>
      </a>
    </li>
    <!-- pocket -->
    <li>
      <a class="social-btn pocket-btn" target="_blank" href="https://getpocket.com/save?url=https://future-architect.github.io/articles/20210901a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">6</span>
      </a>
    </li>
    
  </ul>
<!-- シェアボタン END -->

          </section>
          <aside>
            <section class="related-post margin-bottom-40 nav">
              <h2 id="related"><a href="#related" class="headerlink" title="関連記事"></a>関連記事</h2>
              
  <div class="widget">
    <ul class="nav related-post-link"><li class="related-posts-item"><span>2021.03.25</span><span class="snscount">&#9825;18</span><a href=/articles/20210325/ title="自然言語処理でよく使われるWord2VecやTransformerをログデータやテーブルデータの予測・分析に活用するためのオレオレベースラインの紹介を行います。対象読者は既にWord2VecやTransformerについて知識があり、その上自身で改造を行いたい人や...">Transformerを用いた表現学習・推薦の実装</a></li><li class="related-posts-item"><span>2020.08.01</span><span class="snscount">&#9825;6</span><a href=/articles/20200801/ title="こんにちは。SAIG所属の農見と申します。この度、研究で用いた[B細胞エピトープ予測用データセット]を公開したので、その解説をします。簡単に言うと、B細胞エピトープが分かればワクチン作成の大きな助けになる、だからCOVID-19の原因ウイルスであるSARS-CoV-2が持つタンパク質のB細胞エピトープを予測して...">Kaggleにワクチン開発用のデータを公開しました & コード解説</a></li><li class="related-posts-item"><span>2023.12.12</span><span class="snscount">&#9825;8</span><a href=/articles/20231212a/ title="Dev ContainersのPython環境を作っていきます。">Dev Containersの始め方(2) : Python環境</a></li><li class="related-posts-item"><span>2023.11.16</span><span class="snscount">&#9825;137</span><a href=/articles/20231116a/ title="Python Distilledという本がオライリーから出版されました。作者のDave Beazleyはかなり昔からPythonを使い込んでいる人ですので、この本には信頼しかない、と思い読んでみました">Python Distilledは幅広い人にPythonの基礎を叩き込む本</a></li><li class="related-posts-item"><span>2023.10.30</span><span class="snscount">&#9825;458</span><a href=/articles/20231030b/ title="腰が痛くて仕事にならない、プログラマーこそが天職なのにこの痛みと一生付き合っていかないといけないのか…と思っている方は結構多いのではないでしょうか？">腰痛と闘うプログラマー</a></li><li class="related-posts-item"><span>2023.07.27</span><span class="snscount">&#9825;5</span><a href=/articles/20230727a/ title="エキスパートPythonプログラミング改訂4版が本屋に並び始めました。電子版も購入できます。改訂というと「ちょっと追加されたところを翻訳するだけで丸儲けやんけ」と思われる方もいるかもしれませんが、過去の中で一番大きく改訂されており、新規に一冊訳すのとほぼ変わらない、大変な翻訳作業になりました。">エキスパートPythonプログラミング改訂4版が発売されました</a></li></ul>
  </div>
            </section>
            <section class="reference-post margin-bottom-40 nav">
              
  <div class="card">
    <div id="reference" class="reference-lede"><a href="#reference" class="headerlink" title="参照されている記事"></a>この記事を参照している記事</div>
    <ul class="reference-post-link"><li class="reference-posts-item"><a href=/articles/20220613a/ title="Future Tech Night #17「embeddingの活用」と「MLOps」のAI勉強会を開催し、「embeddingを用いた分析・検索・推薦の技術」というタイトルで発表しました。当日の勉強会の様子は[YouTubeで公開しており...">Future Tech Night #17 embeddingを用いた分析・検索・推薦の技術</a></li><li class="reference-posts-item"><a href=/articles/20220602b/ title="Strategic AI Group所属の金子です。普段は推薦に関連する実装やデータ分析を行っています。先日Kaggleで開催された[H&M Personalized Fashion Recommendations]コンペに単独で参加し、2952チーム中46位をとりました。今回の参加記では以下の内容を紹介します。">H&M Personalized Fashion Recommendations 参加記 (46th/2952)</a></li><li class="reference-posts-item"><a href=/articles/20210823a/ title="夏の自由研究連載2021を始めます！という記事です">夏の自由研究連載2021を始めます</a></li></ul>
  </div>
            </section>
          </aside>
        </footer>
      </div>
    </article>
  </main>
  <aside class="col-md-3 blog-sidebar">
    <!-- START SIDEBAR  -->


<section class="toc-section">
  <h2 class="margin-top-30">目次</h2>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><span class="toc-text">はじめに</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E3%83%BB%E7%94%A8%E8%AA%9E%E8%A7%A3%E8%AA%AC"><span class="toc-text">背景・用語解説</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E3%83%BB%E6%A6%82%E8%A6%81%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><span class="toc-text">背景・概要について</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E8%AA%9E%E8%A7%A3%E8%AA%AC"><span class="toc-text">用語解説</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Word2Vec%E3%81%A8%E3%81%AF"><span class="toc-text">Word2Vecとは</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BB%E8%96%AC%E5%93%81%E5%89%AF%E4%BD%9C%E7%94%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9-JADER%E3%81%A8%E3%81%AF"><span class="toc-text">医薬品副作用データベース JADERとは</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%96%AC%E4%BE%A1%E5%9F%BA%E6%BA%96%E5%8F%8E%E8%BC%89%E5%8C%BB%E8%96%AC%E5%93%81%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A8%E3%81%AF"><span class="toc-text">薬価基準収載医薬品コードとは</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9F%E8%A3%85"><span class="toc-text">実装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E5%9F%BA%E6%9C%AC%E6%83%85%E5%A0%B1"><span class="toc-text">データセット基本情報</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E6%B3%95%E8%A7%A3%E8%AA%AC"><span class="toc-text">手法解説</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Skip-gram%E3%81%A8CBOW"><span class="toc-text">Skip-gramとCBOW</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Negative-Sampling"><span class="toc-text">Negative Sampling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nDCG"><span class="toc-text">nDCG</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%B3%E3%83%BC%E3%83%89"><span class="toc-text">コード</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><span class="toc-text">ライブラリの読み込みとデータセットの読み込み</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E7%94%A8%E6%84%8F"><span class="toc-text">データセットの用意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A9%95%E4%BE%A1%E6%8C%87%E6%A8%99%E3%81%AE%E7%94%A8%E6%84%8F"><span class="toc-text">評価指標の用意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%94%A8%E6%84%8F"><span class="toc-text">メタデータの用意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tensorflow%E7%94%A8%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A3%85"><span class="toc-text">tensorflow用モジュールの実装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Sampler%E3%81%AE%E5%AE%9F%E8%A3%85"><span class="toc-text">Samplerの実装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#negative-sampler"><span class="toc-text">negative sampler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#model"><span class="toc-text">model</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gensim%E7%94%A8%E5%AD%A6%E7%BF%92%E3%82%B3%E3%83%BC%E3%83%89"><span class="toc-text">gensim用学習コード</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tensorflow%E7%94%A8%E5%AD%A6%E7%BF%92%E7%94%A8%E3%82%B3%E3%83%BC%E3%83%89"><span class="toc-text">tensorflow用学習用コード</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9F%E9%A8%93%E3%81%A8%E8%A9%95%E4%BE%A1"><span class="toc-text">実験と評価</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E7%BF%92%E3%81%A8%E5%AE%9A%E9%87%8F%E8%A9%95%E4%BE%A1"><span class="toc-text">学習と定量評価</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9F%E9%A8%931-%E5%8C%BB%E8%96%AC%E5%93%81%E3%81%AE%E6%83%85%E5%A0%B1%E3%81%AE%E3%81%BF%E3%81%A7%E5%AD%A6%E7%BF%92-vs-%E5%8C%BB%E8%96%AC%E5%93%81-%E5%89%AF%E4%BD%9C%E7%94%A8-%E5%8E%9F%E7%96%BE%E6%82%A3%E3%81%A7%E5%AD%A6%E7%BF%92"><span class="toc-text">実験1: 医薬品の情報のみで学習 vs 医薬品+副作用+原疾患で学習</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9F%E9%A8%932-%E5%8C%BB%E8%96%AC%E5%93%81-%E5%89%AF%E4%BD%9C%E7%94%A8-%E5%8E%9F%E7%96%BE%E6%82%A3%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6TensorFlow%E3%81%A7%E5%AE%9F%E8%A3%85"><span class="toc-text">実験2: 医薬品+副作用+原疾患のデータについてTensorFlowで実装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9F%E9%A8%933-Tensorflow%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0"><span class="toc-text">実験3: Tensorflowモデルのチューニング</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9F%E9%A8%93%E7%B5%90%E6%9E%9C%E3%81%BE%E3%81%A8%E3%82%81"><span class="toc-text">実験結果まとめ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%9E%E4%BC%BC%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%81%A8%E8%80%83%E5%AF%9F"><span class="toc-text">類似ベクトルの確認と考察</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BB%E8%96%AC%E5%93%81%E5%90%8C%E5%A3%AB%E3%81%AE%E9%A1%9E%E4%BC%BC%E5%BA%A6%E3%81%AE%E7%A2%BA%E8%AA%8D"><span class="toc-text">医薬品同士の類似度の確認</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gensim-%E5%89%AF%E4%BD%9C%E7%94%A8-%E5%8E%9F%E7%96%BE%E6%82%A3%E3%81%82%E3%82%8A"><span class="toc-text">gensim 副作用+原疾患あり</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nadare-baseline"><span class="toc-text">nadare baseline</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%80%83%E5%AF%9F"><span class="toc-text">考察</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BB%E8%96%AC%E5%93%81-%E5%8E%9F%E7%96%BE%E6%82%A3%E3%81%AE%E9%A1%9E%E4%BC%BC%E5%BA%A6%E3%81%AE%E7%A2%BA%E8%AA%8D"><span class="toc-text">医薬品-原疾患の類似度の確認</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gensim-%E5%89%AF%E4%BD%9C%E7%94%A8-%E5%8E%9F%E7%96%BE%E6%82%A3%E3%81%82%E3%82%8A-1"><span class="toc-text">gensim 副作用+原疾患あり</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nadare-baseline-1"><span class="toc-text">nadare baseline</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%80%83%E5%AF%9F-1"><span class="toc-text">考察</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BB%E8%96%AC%E5%93%81-%E6%9C%89%E5%AE%B3%E4%BA%8B%E8%B1%A1%E3%81%AE%E9%A1%9E%E4%BC%BC%E5%BA%A6%E3%81%AE%E7%A2%BA%E8%AA%8D"><span class="toc-text">医薬品-有害事象の類似度の確認</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gensim-%E5%89%AF%E4%BD%9C%E7%94%A8-%E5%8E%9F%E7%96%BE%E6%82%A3%E3%81%82%E3%82%8A-2"><span class="toc-text">gensim 副作用+原疾患あり</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nadare-baseline-2"><span class="toc-text">nadare baseline</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%80%83%E5%AF%9F-2"><span class="toc-text">考察</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%9E%E4%BC%BC%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81"><span class="toc-text">類似ベクトルの確認のまとめ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Embedding-projector%E3%81%AB%E3%82%88%E3%82%8B%E5%8F%AF%E8%A6%96%E5%8C%96"><span class="toc-text">Embedding projectorによる可視化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8B%E3%82%89%E6%A4%9C%E7%B4%A2%E3%81%99%E3%82%8B%E3%80%82"><span class="toc-text">メタデータから検索する。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8B%E3%82%89%E7%B5%9E%E3%82%8A%E8%BE%BC%E3%81%BF%E3%83%BB%E8%89%B2%E5%88%86%E3%81%91%E3%81%99%E3%82%8B"><span class="toc-text">メタデータから絞り込み・色分けする</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><span class="toc-text">おわりに</span></a></li></ol>
</section>

<section class="category">
<h2 class="margin-top-30">カテゴリー</h2>
<div class="widget">
  <ul class="nav sidebar-categories margin-bottom-40">
  
  <li class=""><a href="/categories/Programming/">Programming (434)</a></li>
<li class=""><a href="/categories/Infrastructure/">Infrastructure (261)</a></li>
<li class=""><a href="/categories/Culture/">Culture (98)</a></li>
<li class=""><a href="/categories/DataScience/">DataScience (61)</a></li>
<li class=""><a href="/categories/IoT/">IoT (35)</a></li>
<li class=""><a href="/categories/DB/">DB (25)</a></li>
<li class=""><a href="/categories/DevOps/">DevOps (23)</a></li>
<li class=""><a href="/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/">認証認可 (21)</a></li>
<li class=""><a href="/categories/Business/">Business (21)</a></li>
<li class=""><a href="/categories/Management/">Management (17)</a></li>
<li class=""><a href="/categories/Security/">Security (15)</a></li>
<li class=""><a href="/categories/VR/">VR (13)</a></li>
<li class=""><a href="/categories/Design/">Design (11)</a></li>

  </ul>
</div>

</section>
<section class="podcast-link">
<h2 class="margin-top-30">Tech Cast</h2>

  <div class="class="widget-wrap">
  <div class="widget">
    <ul class="nav techcast">
      
    </ul>
  </div>
  </div>
  
</section>
<section class="advent-calendar">
<h2 class="margin-top-30">アドベントカレンダー</h2>
<div class="widget">
  <ul class="nav-flex">
    <li><a href="http://qiita.com/advent-calendar/2023/future" title="フューチャー Advent Calendar 2023 #Qiita" target="_blank" rel="noopener">2023年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2022/future" title="フューチャー Advent Calendar 2022 #Qiita" target="_blank" rel="noopener">2022年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2021/future" title="フューチャー Advent Calendar 2021 #Qiita" target="_blank" rel="noopener">2021年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2020/future" title="フューチャー Advent Calendar 2020 #Qiita" target="_blank" rel="noopener">2020年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2019/future" title="フューチャー Advent Calendar 2019 #Qiita" target="_blank" rel="noopener">2019年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2018/future" title="フューチャー Advent Calendar 2018 #Qiita" target="_blank" rel="noopener">2018年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2017/future" title="フューチャー Advent Calendar 2017 #Qiita" target="_blank" rel="noopener">2017年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2016/future" title="フューチャー Advent Calendar 2016 #Qiita" target="_blank" rel="noopener">2016年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2015/future" title="フューチャー Advent Calendar 2015 #Qiita" target="_blank" rel="noopener">2015年</a></li>
  </ul>
</div>

</section>
<!-- END SIDEBAR -->

  </aside>
</div>

  </section>
</div>

      <!-- BEGIN PRE-FOOTER -->
    <footer>
      <div class="pre-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>About Us</h2>
              <p>経営とITをデザインする、フューチャーの技術ブログです。業務で利用している幅広い技術について紹介します。<br /><br /><a target="_blank" rel="noopener" href="http://www.future.co.jp/">http://www.future.co.jp/</a></p>
              <div class="social-btn twitter-btn twitter-follow-btn">
                <a href="https://twitter.com/intent/follow?screen_name=future_techblog " target="_blank" rel="nofollow noopener">
                  <i></i><span class="tw-btn-label">フューチャー技術ブログをフォロー</span>
                </a>
              </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 col-4 pre-footer-col">
              <h2>Contact</h2>
              <address class="margin-bottom-40">
                <a href="https://www.future.co.jp/recruit/recruit/rec-fresh/" title="新卒採用" target="_blank" rel="noopener">新卒採用</a><br>
                <a href="https://www.future.co.jp/recruit/recruit/rec-career/" title="キャリア採用" target="_blank" rel="noopener">キャリア採用</a><br>
                <a href="https://www.future.co.jp/contact_us/" title="お問い合わせページ" target="_blank" rel="noopener">お問い合わせ</a><br>
                <a href="https://www.future.co.jp/architect/socialmediapolicy/" title="ソーシャルメディアポリシー" target="_blank" rel="noopener">メディアポリシー</a><br><br>
                <a href="mailto:techblog@future.co.jp">techblog@future.co.jp</a>
              </address>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>Contents</h2>
              <a href="https://future-architect.github.io/coding-standards/" title="Future Enterprise Coding Standards" target="_blank" rel="noopener">コーディング規約</a><br>
              <a href="https://future-architect.github.io/typescript-guide/" title="仕事ですぐに使えるTypeScript" target="_blank" rel="noopener">仕事ですぐに使えるTypeScript</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>Event</h2>
              <a href="https://future.connpass.com/" title="経営とITをデザインするフューチャーの勉強会です" target="_blank" rel="noopener">connpass</a><br>
              <a href="https://www.future.co.jp/futureinsightseminar/" title="フューチャーインサイトセミナー" target="_blank" rel="noopener">Webセミナー</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>SNS</h2>
              <a href="https://github.com/future-architect" title="Future's official open source repositories" target="_blank" rel="noopener">GitHub</a><br>
              <a href="https://qiita.com/organizations/future" title="フューチャーのQiita Organizationです" target="_blank" rel="noopener">Qiita</a><br>
              <a href="https://note.future.co.jp/" title="フューチャーの公式note" target="_blank" rel="noopener">未来報</a><br>
              <a href="https://www.youtube.com/channel/UCJUSwYYd0CkGgmEKAW7QVpw" title="フューチャーYoutubeチャネル" target="_blank" rel="noopener">Youtube</a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-6 padding-top-10">
              &copy; 2024 フューチャー技術ブログ<br>
            </div>
          </div>
        </div>
      </div>
    </footer>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X1C28R8H0M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X1C28R8H0M');
  gtag('config', 'UA-74047147-1'); // 過渡期対応
</script>

  </div>
</body>
</html>
