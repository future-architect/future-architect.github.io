<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</title>
  <icon>https://future-architect.github.io/feed_icon.png</icon>
  <subtitle>Future Tech Blog</subtitle>
  <link href="https://future-architect.github.io/atom.xml" rel="self"/>
  
  <link href="https://future-architect.github.io/"/>
  <updated>2023-01-25T01:31:16.566Z</updated>
  <id>https://future-architect.github.io/</id>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Go 1.20 Wrapping multiple errors</title>
    <link href="https://future-architect.github.io/articles/20230126a/"/>
    <id>https://future-architect.github.io/articles/20230126a/</id>
    <published>2023-01-25T15:00:00.000Z</published>
    <updated>2023-01-25T01:31:16.566Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20230126a/top.png" alt="" width="800" height="492"><h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ï¼TIG ã®å·å£ã§ã™ã€‚<br>æœ¬è¨˜äº‹ã¯ <a href="/articles/20230123a/">Go 1.20ãƒªãƒªãƒ¼ã‚¹é€£è¼‰</a>   ã®3æœ¬ç›®ã§ã™ã€‚<strong>Wrapping multiple errors</strong> ã«ã¤ã„ã¦ãŠè©±ã—ã¾ã™ã€‚</p><p>Release Note ã§ã¯ã€<a href="https://tip.golang.org/doc/go1.20#errors">ã“ã¡ã‚‰</a> ã®ç®‡æ‰€ã«ãªã‚Šã¾ã™ã€‚<br>Proposal ã¯ã€<a href="https://github.com/golang/go/issues/53435">ã“ã¡ã‚‰</a> ã«ãªã‚Šã¾ã™ã€‚</p><h2 id="ä½•ãŒå¤‰ã‚ã£ãŸã‹ï¼Ÿ"><a href="#ä½•ãŒå¤‰ã‚ã£ãŸã‹ï¼Ÿ" class="headerlink" title="ä½•ãŒå¤‰ã‚ã£ãŸã‹ï¼Ÿ"></a>ä½•ãŒå¤‰ã‚ã£ãŸã‹ï¼Ÿ</h2><p>ã•ã¦å…·ä½“çš„ã«ä½•ãŒå¤‰ã‚ã£ãŸã‹ã‚’ã¯ã˜ã‚ã«ãŠã•ãˆã¦ãŠãã¾ã™ã€‚</p><blockquote><p>Go 1.20 expands support for error wrapping to permit an error to wrap multiple other errors.<br>An error e can wrap more than one error by providing an Unwrap method that returns a []error.<br>The errors.Is and errors.As functions have been updated to inspect multiply wrapped errors.<br>The fmt.Errorf function now supports multiple occurrences of the %w format verb, which will cause it to return an error that wraps all of those error operands.<br>The new function errors.Join returns an error wrapping a list of errors.</p></blockquote><p>è¦ç´„ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã§ã—ã‚‡ã†ã‹ã€‚ ï¼ˆä»¥é™ã€wrapping multiple errors ã¯ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã¨è¨˜è¼‰ã—ã¾ã™ã€‚ï¼‰</p><ul><li>ã‚¨ãƒ©ãƒ¼ã®ãƒ©ãƒƒãƒ—ãŒæ‹¡å¼µã•ã‚Œã¦ã€è¤‡æ•°ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒ©ãƒƒãƒ—ã—ãŸãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</li><li>error å‹ã¯ã€ <code>[]error</code> ã‚’è¿”ã™ <code>Unwrap</code> ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã€ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</li><li>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã«é–¢ã—ã¦ã€ <code>errors.Is</code> é–¢æ•°ã¨ <code>errors.As</code> é–¢æ•°ã«ã‚ˆã‚Šã€æ¤œæŸ»ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</li><li><code>fmt.Errorf</code> é–¢æ•°ã¨ <code>errors.Join</code> é–¢æ•°ã«ã‚ˆã‚Šã€ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</li><li><strong>ï¼ˆãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã‚’ []error ã«å¾©å…ƒã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯è¨€åŠã—ã¦ã„ã¾ã›ã‚“ã€‚ï¼‰</strong></li></ul><h2 id="ç›®æ¬¡"><a href="#ç›®æ¬¡" class="headerlink" title="ç›®æ¬¡"></a>ç›®æ¬¡</h2><p>ãã‚Œã§ã¯ä»¥é™ã€ä¸‹è¨˜ã®é †ã«å‰‡ã£ã¦ãŠè©±ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚</p><ol><li>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®ä½œæˆæ–¹æ³•</li><li>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®æ¤œæŸ»æ–¹æ³•</li><li>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã‚’ []error ã«å¾©å…ƒã™ã‚‹æ–¹æ³•</li><li>ã©ã‚“ãªã¨ãã«ä½¿ãˆã‚‹ã‹ï¼Ÿ</li></ol><p>ã¾ãŸã€æœ¬ç¨¿ã§ã¯ä»¥ä¸‹ã® version ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go version</span><br><span class="line">go version go1.20rc3 darwin/amd64</span><br></pre></td></tr></table></figure><h1 id="ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®ä½œæˆæ–¹æ³•"><a href="#ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®ä½œæˆæ–¹æ³•" class="headerlink" title="ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®ä½œæˆæ–¹æ³•"></a>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®ä½œæˆæ–¹æ³•</h1><p>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®ä½œæˆæ–¹æ³•ã«é–¢ã—ã¦ã¯ã€å…ˆè¿°ã®é€šã‚Šä»¥ä¸‹ã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">err1 := errors.New(<span class="string">&quot;err1&quot;</span>)</span><br><span class="line">err2 := errors.New(<span class="string">&quot;err2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// errors.Joins ã‚’ä½¿ã†æ–¹æ³•</span></span><br><span class="line">errByErrors := errors.Join(err1, err2)</span><br><span class="line">log.Println(reflect.TypeOf(errByErrors)) <span class="comment">// *errors.joinError</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fmt.Errorf ã‚’ä½¿ã†æ–¹æ³•</span></span><br><span class="line">errByFmt := fmt.Errorf(<span class="string">&quot;err: %w, %w&quot;</span>, err1, err2)</span><br><span class="line">log.Println(reflect.TypeOf(errByFmt)) <span class="comment">// *fmt.wrapErrors</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ãŸã ã—ãã‚Œãã‚Œä½œæˆã•ã‚Œã‚‹ error ã®å‹ã¯ç•°ãªã‚Šã¾ã™ã€‚è©³ç´°ã¯ã€ä»¥ä¸‹ã‚’å‚ç…§ãã ã•ã„ã€‚<br>ã¾ãŸã“ã¡ã‚‰ã®å®Ÿè£…ã‚’è¦‹ã‚‹ã¨ã€ã©ã¡ã‚‰ã‚‚ã€<code>[]error</code> ã‚’è¿”ã™ <code>Unwrap</code> ãƒ¡ã‚½ãƒƒãƒ‰ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚</p><ul><li><a href="https://cs.opensource.google/go/go/+/refs/tags/go1.20rc3:src/errors/join.go;l=34">errors.joinError</a></li><li><a href="https://cs.opensource.google/go/go/+/refs/tags/go1.20rc3:src/fmt/errors.go;l=54">fmt.wrapErrors</a></li></ul><h1 id="ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®æ¤œæŸ»æ–¹æ³•"><a href="#ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®æ¤œæŸ»æ–¹æ³•" class="headerlink" title="ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®æ¤œæŸ»æ–¹æ³•"></a>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã®æ¤œæŸ»æ–¹æ³•</h1><p>ä»Šã¾ã§ã¯ã€ <code>errors.Is</code>, <code>errors.As</code> ã‚’ä½¿ã£ã¦ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã®æ¤œæŸ»ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚<br>ä»Šå¾Œã¯ã“ã‚Œã‚‰ã®é–¢æ•°ãŒã€ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã«ã‚‚å¯¾å¿œã™ã‚‹ã‚ˆã†ã§ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">err1 := errors.New(<span class="string">&quot;err1&quot;</span>)</span><br><span class="line">err2 := errors.New(<span class="string">&quot;err2&quot;</span>)</span><br><span class="line">err3 := errors.New(<span class="string">&quot;err3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// errors.Joins ã‚’ä½¿ã†æ–¹æ³•</span></span><br><span class="line">errByErrors := errors.Join(err1, err2)</span><br><span class="line">log.Println(</span><br><span class="line">errors.Is(errByErrors, err1), <span class="comment">// true</span></span><br><span class="line">errors.Is(errByErrors, err2), <span class="comment">// true</span></span><br><span class="line">errors.Is(errByErrors, err3), <span class="comment">// false</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// fmt.Errorf ã‚’ä½¿ã†æ–¹æ³•</span></span><br><span class="line">errByFmt := fmt.Errorf(<span class="string">&quot;err: %w, %w&quot;</span>, err1, err2)</span><br><span class="line">log.Println(</span><br><span class="line">errors.Is(errByFmt, err1), <span class="comment">// true</span></span><br><span class="line">errors.Is(errByFmt, err2), <span class="comment">// true</span></span><br><span class="line">errors.Is(errByFmt, err3), <span class="comment">// false</span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬çš„ãªè€ƒãˆæ–¹ã¯ã€æ—¢å­˜ã®ã‚‚ã®ã¨å¤‰æ›´ã¯ãªã•ãã†ã§ã™ã€‚<br>æ—¢å­˜ã®ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã®æ©Ÿæ§‹ã¨äº’æ›æ€§ã‚’ä¿ã¤ã‚ˆã†ã« <code>Unwrap() error</code> ã¨ <code>Unwrap() []error</code> ãƒ¡ã‚½ãƒƒãƒ‰ã®ã©ã¡ã‚‰ã§ã‚‚å†å¸°çš„ã«å‡¦ç†ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ãã†ã§ã™ã­ã€‚</p><ul><li><a href="https://cs.opensource.google/go/go/+/refs/tags/go1.20rc3:src/errors/wrap.go;l=43">errors.Is</a></li><li><a href="https://cs.opensource.google/go/go/+/refs/tags/go1.20rc3:src/errors/wrap.go;l=92">errors.As</a></li></ul><h1 id="ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã‚’-error-ã«å¾©å…ƒã™ã‚‹æ–¹æ³•"><a href="#ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã‚’-error-ã«å¾©å…ƒã™ã‚‹æ–¹æ³•" class="headerlink" title="ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã‚’ []error ã«å¾©å…ƒã™ã‚‹æ–¹æ³•"></a>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã‚’ []error ã«å¾©å…ƒã™ã‚‹æ–¹æ³•</h1><p>ã“ã¡ã‚‰ã«é–¢ã—ã¦ã¯è¨€åŠãŒãªã‹ã£ãŸã®ã§ã€ç‰¹åˆ¥ä½•ã‹å°‚ç”¨ã®é–¢æ•°ãŒå¢—ãˆãŸã‚Šã¨ã„ã†ã“ã¨ã¯ä»Šã®ã¨ã“ã‚ãªã•ãã†ã§ã™ã­ã€‚<br>ã“ã¡ã‚‰ã‚’å®Ÿç¾ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ğŸ‘†ã® <code>errors.Is</code>, <code>errors.As</code> ç­‰ã®å®Ÿè£…ã‚’è¦‹ã¦ã„ãŸã ã„ãŸæ–¹ã¯ã‚ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ãªã‘ã‚Œã°ãªã‚‰ãªã•ãã†ã§ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">err1 := errors.New(<span class="string">&quot;err1&quot;</span>)</span><br><span class="line">err2 := errors.New(<span class="string">&quot;err2&quot;</span>)</span><br><span class="line"></span><br><span class="line">errByErrors := errors.Join(err1, err2)</span><br><span class="line"><span class="keyword">if</span> errs, ok := errByErrors.(<span class="keyword">interface</span>&#123; Unwrap() []<span class="type">error</span> &#125;); ok &#123;</span><br><span class="line"><span class="keyword">for</span> _, err := <span class="keyword">range</span> errs.Unwrap() &#123;</span><br><span class="line">log.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã¡ãªã¿ã«ã€ãã®ã¾ã¾ <code>errors.Unwrap</code> ã‚’åˆ©ç”¨ã—ãŸéš›ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã« nil ãŒè¿”ã£ã¦ãã¦ã—ã¾ã„ã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">err1 := errors.New(<span class="string">&quot;err1&quot;</span>)</span><br><span class="line">err2 := errors.New(<span class="string">&quot;err2&quot;</span>)</span><br><span class="line"></span><br><span class="line">errByErrors := errors.Join(err1, err2)</span><br><span class="line">log.Println(errors.Unwrap(errByErrors)) <span class="comment">// nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã“ã¡ã‚‰ã¯ã‚„ã‚„ãŠã‹ã—ãªæŒ™å‹•ã§ã¯ã‚ã‚Šã¾ã™ãŒã€<code>errors.Unwrap</code> ã®å®Ÿè£…ã‚’è¦‹ã‚‹ã¨ç†è§£ã§ãã¾ã™ã€‚<br>ãƒãƒ«ãƒã‚¨ãƒ©ãƒ¼ã¯ã€<code>Unwrap() []error</code> ãƒ¡ã‚½ãƒƒãƒ‰ã¯æŒã£ã¦ã„ã¦ã‚‚ã€<code>Unwrap() error</code> ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã£ã¦ã„ãªã„ã‹ã‚‰ã§ã™ã­ã€‚</p><ul><li><a href="https://cs.opensource.google/go/go/+/refs/tags/go1.20rc3:src/errors/wrap.go;l=16">errors.Unwrap</a></li></ul><h1 id="åˆ©ç”¨ã™ã‚‹å ´é¢"><a href="#åˆ©ç”¨ã™ã‚‹å ´é¢" class="headerlink" title="åˆ©ç”¨ã™ã‚‹å ´é¢"></a>åˆ©ç”¨ã™ã‚‹å ´é¢</h1><p>åˆ©ç”¨ã™ã‚‹å ´é¢ã¨ã—ã¦ã¯ã€ãƒ‘ãƒƒã¨æ€ã„ã¤ãã‚‚ã®ã¨ã—ã¦ã¯ã€Œãƒ™ã‚¹ãƒˆã‚¨ãƒ•ã‚©ãƒ¼ãƒˆçš„ãªè¤‡æ•°å‡¦ç†ã€ãªã©ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã‹ã€‚</p><p>ä¾‹ãˆã°ã€ã€Œãƒ™ã‚¹ãƒˆã‚¨ãƒ•ã‚©ãƒ¼ãƒˆçš„ã«å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦ä¸€äººãšã¤ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¦ã„ãã€‚ã€ãªã©ã®å ´é¢ã§ã¯ä½¿ãˆãã†ã§ã™ã€‚<br>ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚ï¼ˆä¸€æ‹¬ã§å‡¦ç†ã§ãã‚‹ã‚ˆã†ã«æ¨¡ç´¢ã™ã‚‹ã¹ãã¨ã‹ã€‚ä¸¦åˆ—ã«å‡¦ç†ã‚’ã—ãŸæ–¹ãŒè‰¯ã„ã¨ã‹ã€‚è‰²ã€…ã‚ã‚‹ã‹ã‚‚ã§ã™ãŒã€ãã®è¾ºã®ãŠè©±ã¯ã„ã£ãŸã‚“ãŠã„ã¦ãŠãã¾ã™ï¼ï¼ï¼ï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">userIDs := []<span class="type">string</span>&#123;</span><br><span class="line"><span class="string">&quot;userID1&quot;</span>,</span><br><span class="line"><span class="string">&quot;userID2&quot;</span>,</span><br><span class="line"><span class="string">&quot;userID3&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> userIDs &#123;</span><br><span class="line">err := sendEmail(userIDs[i])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="comment">// err ãŒã‚ã£ã¦ã‚‚ã€log ã ã‘å‡ºåŠ›ã™ã‚‹</span></span><br><span class="line">log.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sendEmail</span><span class="params">(userID <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="comment">// Email ã‚’é€ä¿¡ã™ã‚‹</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã“ã®ã¨ãã€<code>run()</code> ã®è¿”ã‚Šå€¤ã« error ã‚’å¢—ã‚„ã—ãŸã„ã¨ãªã£ãŸã¨ãã«ãªã‹ãªã‹ã©ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã‹æ‚©ã¾ã—ããªã‚‹ã“ã¨ãŒæƒ³åƒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚<br>ä»Šã¾ã§ã§ã‚ã‚Œã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è£½ã®ã‚‚ã®ã‚’ä½¿ã£ãŸã‚Šè‡ªä½œã®ã‚¨ãƒ©ãƒ¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œæˆã—ãŸã‚Šã—ã¦å®Ÿç¾ã—ã¦ã„ãŸæ–¹ã‚‚ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><ul><li><a href="https://github.com/hashicorp/go-multierror">https://github.com/hashicorp/go-multierror</a></li><li><a href="https://github.com/uber-go/multierr">https://github.com/uber-go/multierr</a></li></ul><p>ãã‚ŒãŒä»Šå¾Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦æ›¸ãç›´ã›ã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã‹ãªã¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">userIDs := []<span class="type">string</span>&#123;</span><br><span class="line"><span class="string">&quot;userID1&quot;</span>,</span><br><span class="line"><span class="string">&quot;userID2&quot;</span>,</span><br><span class="line"><span class="string">&quot;userID3&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> errs []<span class="type">error</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> userIDs &#123;</span><br><span class="line">err := sendEmail(userIDs[i])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">errs = <span class="built_in">append</span>(errs, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> errors.Join(errs...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sendEmail</span><span class="params">(userID <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="comment">// Email ã‚’é€ä¿¡ã™ã‚‹å‡¦ç†</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ãŠã‚ã‚Šã«"><a href="#ãŠã‚ã‚Šã«" class="headerlink" title="ãŠã‚ã‚Šã«"></a>ãŠã‚ã‚Šã«</h1><p>æ–°ã—ãæ‹¡å¼µã•ã‚ŒãŸ Wrapping multiple erros ã«ã¤ã„ã¦ã®è¨˜äº‹ã§ã—ãŸï¼<br>ç”¨é€”ãŒãŸãã•ã‚“ã‚ã‚‹ã¨ã„ã†ã‚ã‘ã§ã¯ãªã„æ°—ã‚‚ã—ã¾ã™ãŒã€ä»Šå¾Œã® error handling ã®æ‰‹æ³•ã®ä¸€ã¤ã¨ã—ã¦ãŠã•ãˆã¦ãŠã„ãŸã»ã†ãŒè‰¯ã„ã‚‚ã®ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ŸğŸ¤”</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20230126a/top.png&quot; alt=&quot;&quot; width=&quot;800&quot; height=&quot;492&quot;&gt;

&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="Go" scheme="https://future-architect.github.io/tags/Go/"/>
    
    <category term="ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°" scheme="https://future-architect.github.io/tags/%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0/"/>
    
    <category term="Go1.20" scheme="https://future-architect.github.io/tags/Go1-20/"/>
    
  </entry>
  
  <entry>
    <title>Go1.20ãƒªãƒªãƒ¼ã‚¹é€£è¼‰ contextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®WithCancelCauseã¨Cause</title>
    <link href="https://future-architect.github.io/articles/20230125a/"/>
    <id>https://future-architect.github.io/articles/20230125a/</id>
    <published>2023-01-24T15:00:00.000Z</published>
    <updated>2023-01-25T01:31:41.615Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20230125a/top.png" alt="" width="800" height="433"><h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>TIGçœŸé‡ã§ã™ã€‚<a href="/articles/20230123a/">Go 1.20ãƒªãƒªãƒ¼ã‚¹é€£è¼‰</a>ã®2æœ¬ç›®ã¯ã€<a href="https://tip.golang.org/doc/go1.20#minor_library_changes">Minor changes to the library</a>ã® context ã«ã¤ã„ã¦ã§ã™ã€‚Go 1.7ã§ <code>context.Context</code>ãŒå…¥ã£ã¦ã‹ã‚‰ã€contextç•Œéšˆã«ãŠã„ã¦ä¹…ã—ã¶ã‚Šã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ã™ã€‚</p><p>contextã®æ­´å²ã‚„ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆã¯ã€æ¾å·ã•ã‚“ã®<a href="https://future-architect.github.io/articles/20210212/">Go 1.16ã®signal.NotifyContext() </a> è¨˜äº‹ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã®ã§ã€ãœã²ç¢ºèªãã ã•ã„ã€‚contextè‡ªä½“ã«ã®èª¬æ˜ã¯ã€ã•ã(H.Saki)ã•ã‚“ã® <a href="https://zenn.dev/hsaki/books/golang-context">ã‚ˆãã‚ã‹ã‚‹contextã®ä½¿ã„æ–¹ </a>ã¨ã„ã†Zenn Bookã‚’èª­ã‚€ã¨ã™ã”ãè©³ã—ããªã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><p>ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã«ã¯ã€<code>WithCancelCause()</code>ã¨ <code>Cause()</code> é–¢æ•°ãŒè¿½åŠ ã•ã‚Œã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç†ç”±ã‚’è¿½åŠ ãƒ»å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ã„ã†å†…å®¹ã§ã™ã€‚ãªãœã‹2023.1.22æ™‚ç‚¹(go 1.20rc3)ã ã¨GoDocã«ã¯<code>WithDeadlineCause()</code>ãƒ»<code>WithTimeoutCause()</code> ãŒã‚ã‚‹ã‚‚ã®ã®å®Ÿè£…ã¯ç„¡ãã€<a href="https://github.com/golang/go/issues/56661">context: add APIs for writing and reading cancelation cause #51365</a> ã‚’è¦‹ã‚‹é™ã‚Šã€Go 1.21ã§è¿½åŠ ã•ã‚Œãã†ã§ã™ã€‚</p><blockquote><p><strong>Go 1.20ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚ˆã‚Šï¼ˆ2023.1.22 DRAFT RELEASE NOTESã‚ˆã‚Šï¼‰</strong><br>The new WithCancelCause function provides a way to cancel a context with a given error. That error can be retrieved by calling the new Cause function.<br>æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸWithCancelCauseé–¢æ•°ã¯errorä»˜ãã§contextã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹æ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚errorã¯æ–°ã—ãè¿½åŠ ã—ãŸCauseé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§å–å¾—ã§ãã¾ã™ã€‚</p></blockquote><p>GoDocã®contextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®<a href="https://pkg.go.dev/context@master#WithCancelCause">func WithCancelCause</a>ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚‚æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚</p><figure class="highlight go"><figcaption><span>GoDocã®WithCancelCauseã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ï¼ˆgo 1.20rc3æ™‚ç‚¹ãªã®ã§è’ã„ï¼‰</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctx, cancel := context.WithCancelCause(parent)</span><br><span class="line">cancel(myError)</span><br><span class="line">ctx.Err() <span class="comment">// returns context.Canceled</span></span><br><span class="line">context.Cause(ctx) <span class="comment">// returns myError</span></span><br></pre></td></tr></table></figure><p>ãƒ„ã‚¤ãƒ¼ãƒˆã§ç™ºè¡¨ã•ã‚ŒãŸéš›ã®åå¿œã‚’è¦‹ã‚‹ã¨ã€å–œã³ã®å£°ãŒå¤šæ•°ã§ã—ãŸã€‚</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Probably in Go 1.20:<br><br>context.WithCancelCause ğŸ‰<br><br>ctx.Err() will return why a context is canceled if that context is derived with a cancel cause. Instead of mere `Canceled` and `DeadlineExceeded` errors.<br><br>Proposal â†’ <a href="https://t.co/H1jMbp5HGM">https://t.co/H1jMbp5HGM</a><a href="https://twitter.com/hashtag/golang?src=hash&amp;ref_src=twsrc%5Etfw">#golang</a> <a href="https://t.co/bRFFXB1DFx">pic.twitter.com/bRFFXB1DFx</a></p>&mdash; inanc (@inancgumus) <a href="https://twitter.com/inancgumus/status/1599073261169430528?ref_src=twsrc%5Etfw">December 3, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>ãƒ—ãƒ­ãƒãƒ¼ã‚µãƒ«ã¯<a href="https://github.com/golang/go/issues/51365">context: add APIs for writing and reading cancelation cause #51365</a> ã§ã™ã€‚èµ·ç¥¨ãŒ2022.2.26ã§ã™ã®ã§ã€ã“ã‚Œã ã‘è¦‹ã‚Œã°10ãƒ¶æœˆã»ã©ã§å…¥ã£ãŸã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚å®Ÿéš›ã¯ãã‚Œä»¥å‰ã«ã‚‚ä¼¼ãŸã‚ˆã†ãªè­°è«–ãŒã‚ã‚Šã€ä¾‹ãˆã°<a href="https://github.com/golang/go/issues/26356">context: ease debugging of where a context was canceled? #26356</a> ã¯2018å¹´ã«ã€<a href="https://github.com/golang/go/issues/46273">proposal: context: add WithCancelReason #46273</a>ã¯2021å¹´ã«èµ·ç¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚#26356ã‚„#46273ã«ã¦æ¡ä»¶ã€å¯¾å¿œæ¡ˆã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®å®Ÿè£…ãªã©ãŒæ•´ç†ã•ã‚ŒãŸã“ã¨ãŒã‚ã£ã¦ã“ãå®Ÿç¾ã§ããŸã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã˜ã‚ƒãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚</p><h2 id="ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã©ã“ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‹ãƒ‡ãƒãƒƒã‚¯é›£ã—ã„å•é¡Œ"><a href="#ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã©ã“ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‹ãƒ‡ãƒãƒƒã‚¯é›£ã—ã„å•é¡Œ" class="headerlink" title="ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã©ã“ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‹ãƒ‡ãƒãƒƒã‚¯é›£ã—ã„å•é¡Œ"></a>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã©ã“ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‹ãƒ‡ãƒãƒƒã‚¯é›£ã—ã„å•é¡Œ</h2><p>Go 1.20ã‚ˆã‚Šå‰ã®æ™‚ä»£ã§ã¯ã€contextã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ã‚ˆãä¸ŠãŒã‚‹èª²é¡Œã«ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒã©ã“ã§è¡Œã‚ã‚ŒãŸã‹åˆ‡ã‚Šåˆ†ã‘ã—ã«ãã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã€ŒWho the hell canceled my context?ï¼ˆã ã‚ŒãŒç§ã®contextã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã‹ï¼Ÿï¼‰ã€ã¨å†—è«‡æ··ã˜ã‚Šã§ã®æ‚©ã¿ã‚’ã¡ã‚‡ãã¡ã‚‡ãèãã¾ã™ã€‚</p><p>ä¾‹ãˆã°ã€ä¸‹è¨˜ã®ã‚ˆã†ã«å¤šæ®µã«contextã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®šã™ã‚‹ã‚±ãƒ¼ã‚¹ã§ã™ã€‚ä»®ã«ä¸€ç•ªä¸‹æµã® <code>callHeavyWebAPI()</code> é–¢æ•°ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ãŸã„ã¨ã—ã¾ã™ã€‚</p><figure class="highlight go"><figcaption><span>Go1.19ä»¥å‰ã§ã®å®Ÿè£…ä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;context&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">time.AfterFunc(<span class="number">10</span>*time.Second, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; cancel() &#125;) <span class="comment">// å…¨ä½“ã§10ç§’ã¾ã§</span></span><br><span class="line"><span class="comment">// ... ä½•ã‹ã—ã‚‰ã®å‰å‡¦ç†ãªã©</span></span><br><span class="line"><span class="keyword">go</span> doHeavyTask(ctx)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doHeavyTask</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">ctx, cancel := context.WithCancel(ctx)</span><br><span class="line">time.AfterFunc(<span class="number">5</span>*time.Second, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; cancel() &#125;) <span class="comment">// doHeavyTaské–¢æ•°ã§æœ€å¤§5ç§’ã¾ã§</span></span><br><span class="line"><span class="comment">// ... ä½•ã‹ã—ã‚‰ã®å‡¦ç†</span></span><br><span class="line">callHeavyWebAPI(ctx)</span><br><span class="line"><span class="comment">// ... ä½•ã‹ã—ã‚‰ã®å‡¦ç†</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">callHeavyWebAPI</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">ctx, cancel := context.WithCancel(ctx)</span><br><span class="line">time.AfterFunc(<span class="number">3</span>*time.Second, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; cancel() &#125;) <span class="comment">// callHeavyWebAPIé–¢æ•°ã§æœ€å¤§3ç§’ã¾ã§</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line"><span class="keyword">switch</span> ctx.Err() &#123;</span><br><span class="line"><span class="keyword">case</span> context.DeadlineExceeded:</span><br><span class="line">fmt.Println(<span class="string">&quot;context timeout exceeded&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> context.Canceled:</span><br><span class="line">fmt.Println(<span class="string">&quot;context canceled&quot;</span>) <span class="comment">// â˜…ã©ã“ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸï¼ŸğŸ˜­</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="comment">// ...å¤–éƒ¨APIå‘¼ã³å‡ºã—ãªã©ã®å‡¦ç†</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å¾Œã®<code>select</code> ã®éƒ¨åˆ†ã®å®Ÿè£…ã®ã‚ˆã†ã«ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã‹ã¯ <code>ctx.Err()</code> ã‚’è¦‹ã‚‹ã“ã¨ã§åˆ¤æ–­ã§ãã¾ã™ã€‚ã—ã‹ã—ã€<code>main()</code>, <code>doHeavyTask()</code>, <code>callHeavyWebAPI()</code> é–¢æ•°ãã‚Œãã‚Œã§è¨­å®šã•ã‚ŒãŸã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®ã©ã‚ŒãŒç›´æ¥ã®åŸå› ã‹ã¯åˆ¤æ–­ãŒä»˜ãã¾ã›ã‚“ã€‚</p><p>å›é¿æ–¹æ³•ã¨ã—ã¦ã¯ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç†ç”±ã‚’é€£æºã™ã‚‹ãŸã‚ã® <code>channel</code> ã‚’å¼•ãå›ã™ã“ã¨ã‚’æ¤œè¨ã™ã‚‹ãªã©ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ãŒã€ã‘ã£ã“ã†å¤§å¤‰ãã†ã§ã™ã€‚</p><h2 id="contextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«WithCancelCauseã¨Causeã‚’è¿½åŠ "><a href="#contextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«WithCancelCauseã¨Causeã‚’è¿½åŠ " class="headerlink" title="contextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«WithCancelCauseã¨Causeã‚’è¿½åŠ "></a>contextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«WithCancelCauseã¨Causeã‚’è¿½åŠ </h2><p>ã“ã‚Œã‚’è§£æ±ºã™ã‚‹æ–¹æ³•ã¨ã—ã¦ã€<code>context.WithCancelCause()</code>ã¨ <code>Cause()</code> é–¢æ•°ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚<code>context.WithCancelCause()</code>ã¯ã»ã¼ <code>WithCancel()</code>ã¨ä½¿ã„å‹æ‰‹ãŒåŒã˜ã§ã™ãŒã€<code>CancelCauseFunc(cause error)</code> ã¨å¼•æ•°ã« <code>cause</code>ã‚’å–ã‚‹éƒ¨åˆ†ãŒç•°ãªã‚Šã¾ã™ã€‚ã“ã“ã« <code>error</code> ã‚’æ¸¡ã™ã¨ä½•ãŒç†ç”±ã§<code>context</code>ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‹åˆ†ã‹ã‚Šã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>Go1.20ä»¥é™ã®å®Ÿè£…ä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;context&quot;</span><br><span class="line">&quot;errors&quot;</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="addition">+var (</span></span><br><span class="line"><span class="addition">+ErrTimeoutOuter  = errors.New(&quot;outer timeout&quot;)</span></span><br><span class="line"><span class="addition">+ErrTimeoutMiddle = errors.New(&quot;middle timeout&quot;)</span></span><br><span class="line"><span class="addition">+ErrTimeoutInner  = errors.New(&quot;inner timeout&quot;)</span></span><br><span class="line"><span class="addition">+)</span></span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">ctx, cancel := context.WithCancelCause(context.Background())</span><br><span class="line"><span class="deletion">-time.AfterFunc(10*time.Second, func() &#123; cancel() &#125;) // å…¨ä½“ã§10ç§’ã¾ã§</span></span><br><span class="line"><span class="addition">+time.AfterFunc(10*time.Second, func() &#123; cancel(ErrTimeoutOuter) &#125;) // å…¨ä½“ã§10ç§’ã¾ã§</span></span><br><span class="line">// ... ä½•ã‹ã—ã‚‰ã®å‰å‡¦ç†ãªã©</span><br><span class="line">go doHeavyTask(ctx)</span><br><span class="line">// ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func doHeavyTask(ctx context.Context) &#123;</span><br><span class="line">ctx, cancel := context.WithCancelCause(ctx)</span><br><span class="line"><span class="deletion">-time.AfterFunc(5*time.Second, func() &#123; cancel() &#125;) // doHeavyTaské–¢æ•°ã§æœ€å¤§5ç§’ã¾ã§</span></span><br><span class="line"><span class="addition">+time.AfterFunc(5*time.Second, func() &#123; cancel(ErrTimeoutMiddle) &#125;) // doHeavyTaské–¢æ•°ã§æœ€å¤§5ç§’ã¾ã§</span></span><br><span class="line">// ... ä½•ã‹ã—ã‚‰ã®å‡¦ç†</span><br><span class="line">callHeavyWebAPI(ctx)</span><br><span class="line">// ... ä½•ã‹ã—ã‚‰ã®å‡¦ç†</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func callHeavyWebAPI(ctx context.Context) &#123;</span><br><span class="line">ctx, cancel := context.WithCancelCause(ctx)</span><br><span class="line"><span class="deletion">-time.AfterFunc(3*time.Second, func() &#123; cancel() &#125;) // callHeavyWebAPIé–¢æ•°ã§æœ€å¤§3ç§’ã¾ã§</span></span><br><span class="line"><span class="addition">+time.AfterFunc(3*time.Second, func() &#123; cancel(ErrTimeoutInner) &#125;) // callHeavyWebAPIé–¢æ•°ã§æœ€å¤§3ç§’ã¾ã§</span></span><br><span class="line"></span><br><span class="line">for &#123;</span><br><span class="line">select &#123;</span><br><span class="line">case &lt;-ctx.Done():</span><br><span class="line">switch ctx.Err() &#123;</span><br><span class="line">case context.DeadlineExceeded:</span><br><span class="line">fmt.Println(&quot;context timeout exceeded&quot;)</span><br><span class="line">case context.Canceled:</span><br><span class="line"><span class="deletion">-fmt.Println(&quot;context canceled&quot;) // â˜…ã©ã“ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸï¼ŸğŸ˜­</span></span><br><span class="line"><span class="addition">+switch context.Cause(ctx) &#123;</span></span><br><span class="line"><span class="addition">+case ErrTimeoutOuter:</span></span><br><span class="line"><span class="addition">+fmt.Println(&quot;mainã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ã‚ˆã‚Šã‚­ãƒ£ãƒ³ã‚»ãƒ«&quot;)</span></span><br><span class="line"><span class="addition">+case ErrTimeoutMiddle:</span></span><br><span class="line"><span class="addition">+fmt.Println(&quot;doHeavyTaskã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ã‚ˆã‚Šã‚­ãƒ£ãƒ³ã‚»ãƒ«&quot;)</span></span><br><span class="line"><span class="addition">+case ErrTimeoutInner:</span></span><br><span class="line"><span class="addition">+fmt.Println(&quot;callHeavyTaskã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ã‚ˆã‚Šã‚­ãƒ£ãƒ³ã‚»ãƒ«&quot;)</span></span><br><span class="line"><span class="addition">+default:</span></span><br><span class="line"><span class="addition">+fmt.Println(&quot;ãã®ä»–ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«&quot;)</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return</span><br><span class="line">default:</span><br><span class="line">// ...å¤–éƒ¨APIå‘¼ã³å‡ºã—ãªã©ã®å‡¦ç†</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡è¦ãªè€ƒãˆæ–¹ã¨ã—ã¦ã€<code>cancel(err)</code> ã‚’è¨­å®šã—ã¦ã‚‚ã€<code>ctx.Err()</code>ã®å€¤ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚<code>ctx.Err()</code> ã¯å¾“æ¥ã©ãŠã‚Šã€<code>context.DeadlineExceeded</code> ã‚„ <code>context.Canceled</code> ãŒå–å¾—ã§ãã¾ã™ã€‚ã¤ã¾ã‚Šäº’æ›æ€§ãŒä¿ãŸã‚Œã¦ã„ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ç†ç”±ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã—ãŸã„å ´åˆã®ã¿ã€<code>context.Cause(ctx)</code> ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚æœ€åˆã¯ä½¿ã„åˆ†ã‘ãªã‚“ã ã‚ã†ã¨ã‹ã€ã‚„ã‚„é¢å€’ã ãªã¨æ€ã„ã¾ã—ãŸãŒã€è€ƒãˆã¦ã¿ã‚‹ã¨é †å½“ãªåˆ¤æ–­ã§ã™ã€‚</p><ul><li><code>ctx.Err()</code><ul><li>DoneãŒæœªè¨­å®šã®å ´åˆã€<code>nil</code> ã‚’è¿”ã™</li><li>DoneãŒè¨­å®šã•ã‚ŒãŸã‚‰ã€<code>context.Canceled</code> ã‹ <code>context.DeadlineExceeded</code> ã‚’è¿”ã™</li></ul></li><li><code>context.Cause(ctx)</code><ul><li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã—ãŸç‹¬è‡ªã® <code>error</code> ã‚’è¿”ã™ã€‚è¨­å®šã—ãŸå ´åˆã€<code>ctx.Err()</code>ã¯ <code>context.Canceled</code> ã‚’è¿”ã™</li></ul></li></ul><p>ã“ã‚Œã‹ã‚‰æ–°è¦ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ãŸã„äººã¯ã€ <code>ctx.Err()</code> ã‚’ç”¨ã„ãšã€ä¸€æ°—ã« <code>context.Cause(ctx)</code> ã‚’ä½¿ã£ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p><p><code>Cause()</code>ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã« <code>context.Context</code> ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«<code>Cause()</code>ã¨ã„ã£ãŸé–¢æ•°ã‚’è¿½åŠ ã—ã¦ãã‚ŒãŸæ–¹ãŒåˆ©ç”¨è€…ã¨ã—ã¦ã¯ä¾¿åˆ©ã˜ã‚ƒãªã„ã‹ã¨æ€ã„ã¾ã™ã‚ˆã­ã€‚ã“ã‚Œã¯<a href="https://go.dev/doc/go1compat">Go1äº’æ›æ€§ãƒãƒªã‚·ãƒ¼</a>ã«æ›¸ã„ã¦ã‚ã‚‹ã‚ˆã†ã«ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æ–°ã—ã„é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯è¨±å¯ã•ã‚Œã¦ãªã„ã¨ã„ã†ã“ã¨ã§å¦å®šã•ã‚Œã¦ã„ã¾ã—ãŸï¼ˆãã®ãŸã‚ã€context.Contextã‚’å¼•æ•°ã«ã¨ã‚‹ç¾åœ¨ã®ã‹ãŸã¡ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ï¼‰ã€‚</p><figure class="highlight diff"><figcaption><span>äº’æ›æ€§ã‚’ã¶ã£å£Šã™APIã‚¤ãƒ¡ãƒ¼ã‚¸</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type Context interface &#123;</span><br><span class="line">Deadline() (deadline time.Time, ok bool)</span><br><span class="line">Done() &lt;-chan struct&#123;&#125;</span><br><span class="line">Err() error</span><br><span class="line">Value(key any) any</span><br><span class="line"><span class="addition">+Cause() error // â˜…å¾Œæ–¹äº’æ›æ€§ã‚’å£Šã™ãŸã‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æ–°è¦é–¢æ•°ã®è¿½åŠ ã¯ã§ããªã„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°‘ã—ã ã‘æƒœã—ã„æ°—ã‚‚ã—ã¾ã™ãŒã€ã™ãã«è¦šãˆã‚‰ã‚Œã‚‹ãƒ¬ãƒ™ãƒ«ã‹ãªã¨æ€ã„ã¾ã™ã€‚</p><h2 id="ä½¿ã„æ–¹ã«ã¤ã„ã¦"><a href="#ä½¿ã„æ–¹ã«ã¤ã„ã¦" class="headerlink" title="ä½¿ã„æ–¹ã«ã¤ã„ã¦"></a>ä½¿ã„æ–¹ã«ã¤ã„ã¦</h2><p>è¿½åŠ ã•ã‚ŒãŸé–¢æ•°ã«ã¤ã„ã¦ã€ãƒ‘ãƒƒã¨ã©ã†ã„ã†æŒ™å‹•ã«ãªã‚‹ã‹ç¢ºä¿¡ãŒæŒã¦ãªã‹ã£ãŸ3ã‚±ãƒ¼ã‚¹ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚</p><h3 id="1-cancel-nil-ã‚’å‘¼ã‚“ã ã‚‰ï¼Ÿ"><a href="#1-cancel-nil-ã‚’å‘¼ã‚“ã ã‚‰ï¼Ÿ" class="headerlink" title="1. cancel(nil) ã‚’å‘¼ã‚“ã ã‚‰ï¼Ÿ"></a>1. cancel(nil) ã‚’å‘¼ã‚“ã ã‚‰ï¼Ÿ</h3><p>çµè«–â†’ <code>context.Cause(ctx)</code> ãŒ <code>context.Canceled</code>ã‚’è¿”ã—ã¾ã™ã€‚å°‘ã—æ„å¤–ãªçµæœã«æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx, cancel := context.WithCancelCause(context.Background())</span><br><span class="line">cancel(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(ctx.Err() == context.Canceled)          <span class="comment">// true</span></span><br><span class="line">fmt.Println(context.Cause(ctx) == context.Canceled) <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>nil</code> ã‚’è¿”ã•ãªã„ã“ã¨ã§ã€<code>ctx.Err()</code> ã‚’ç”¨ã„ãš <code>context.Cause()</code> ã§ <code>context</code> ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒã§ãã‚‹ã‚ˆã†ã™ã‚‹ãŸã‚ã®ç†ç”±ã ã¨æ€ã„ã¾ã™ã€‚</p><h3 id="2å›å‘¼ã‚“ã ã‚‰ã©ã†ãªã‚‹ï¼Ÿ"><a href="#2å›å‘¼ã‚“ã ã‚‰ã©ã†ãªã‚‹ï¼Ÿ" class="headerlink" title="2å›å‘¼ã‚“ã ã‚‰ã©ã†ãªã‚‹ï¼Ÿ"></a>2å›å‘¼ã‚“ã ã‚‰ã©ã†ãªã‚‹ï¼Ÿ</h3><p>çµè«–â†’ æœ€åˆã«è¨­å®šã•ã‚ŒãŸ <code>cause</code> ãŒå¸¸ã«å–å¾—ã•ã‚Œã‚‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx, cancel := context.WithCancelCause(context.Background())</span><br><span class="line">cancel(errors.New(<span class="string">&quot;1. timeout&quot;</span>))</span><br><span class="line">cancel(errors.New(<span class="string">&quot;2. connection dropped&quot;</span>))</span><br><span class="line"></span><br><span class="line">fmt.Println(context.Cause(ctx)) <span class="comment">// 1. timeout</span></span><br><span class="line">fmt.Println(context.Cause(ctx)) <span class="comment">// 1. timeout</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-è¦ªå­contextã§ãã‚Œãã‚Œcancelã•ã›ãŸå ´åˆ"><a href="#3-è¦ªå­contextã§ãã‚Œãã‚Œcancelã•ã›ãŸå ´åˆ" class="headerlink" title="3. è¦ªå­contextã§ãã‚Œãã‚Œcancelã•ã›ãŸå ´åˆ"></a>3. è¦ªå­contextã§ãã‚Œãã‚Œ<code>cancel</code>ã•ã›ãŸå ´åˆ</h3><p>ä¾‹ãˆã°ã€ä¸‹è¨˜ã®ã‚ˆã†ã«è¦ªå­contextã‚’ä½œæˆã—ã€è¦ªâ†’å­ã®é †ç•ªã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã›ã¾ã—ãŸã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">parentCtx, parentCancel := context.WithCancelCause(context.Background())</span><br><span class="line">childCtx, childCancel := context.WithCancelCause(parentCtx)</span><br><span class="line"></span><br><span class="line">parentCancel(errors.New(<span class="string">&quot;parent timeout&quot;</span>))</span><br><span class="line">childCancel(errors.New(<span class="string">&quot;child timeout&quot;</span>))</span><br><span class="line"></span><br><span class="line">fmt.Println(context.Cause(parentCtx)) <span class="comment">// parent timeout</span></span><br><span class="line">fmt.Println(context.Cause(childCtx))  <span class="comment">// parent timeout</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã“ã®ä¾‹ã®å ´åˆã¯ã€è¦ªã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«å†…å®¹ãŒå„ªå…ˆã•ã‚Œã‚‹ã¾ã™ã€‚ <code>parentCancel</code>ã€<code>childCancel</code> ã®å‘¼ã³å‡ºã—ä½ç½®ã‚’å¤‰ãˆã¦ã¿ã‚‹ã¨å‡ºåŠ›ãŒå¤‰ã‚ã‚‹ã®ã§ï¼ˆåŸºæœ¬ã¯å­ã¯è¦ªã«å½±éŸ¿ã—ãªã„ã€‚è¦ªãŒå…ˆã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ã„ãŸã‚‰ã€å­ã¯ãã‚Œã‚’å¼•ãç¶™ãï¼‰ã€å‹•ã‹ã—ã¦ã¿ã‚‹ã¨è‰¯ã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚</p><h2 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h2><ul><li>å¾“æ¥ã§ã¯ã€ç‰¹ã«è¦ªå­é–¢ä¿‚ã‚’æŒã£ãŸ<code>context</code>ã§ãã‚Œãã‚Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒç™ºç”Ÿã—ã†ã‚‹ã¨ãã«åˆ‡ã‚Šåˆ†ã‘ãŒé›£ã—ã‹ã£ãŸãŒã€Go 1.20 ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸã€ <code>WithCancelCause()</code> ã¨ <code>context.Cause()</code> ã§è§£æ±ºã§ãã€ã©ã“ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‚“ã å•é¡Œã‚’è§£æ±ºã«å°ã„ã¦ãã‚Œã‚‹</li><li>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ <code>context.Context</code> ã¸ã®é–¢æ•°è¿½åŠ ã§ã¯ãªãã€<code>context</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã§ã‚ã‚‹</li></ul><p>æ¬¡ã¯å·å£ã•ã‚“ã®<a href="/articles/20230126a/">Wrapping multiple errors</a>ã§ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20230125a/top.png&quot; alt=&quot;&quot; width=&quot;800&quot; height=&quot;433&quot;&gt;

&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="Go" scheme="https://future-architect.github.io/tags/Go/"/>
    
    <category term="Go1.20" scheme="https://future-architect.github.io/tags/Go1-20/"/>
    
  </entry>
  
  <entry>
    <title>Go 1.20ãƒªãƒªãƒ¼ã‚¹é€£è¼‰ãŒå§‹ã¾ã‚Šã¾ã™ï¼†ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã®ç´¹ä»‹ï¼†è½ã¡ç©‚æ‹¾ã„</title>
    <link href="https://future-architect.github.io/articles/20230123a/"/>
    <id>https://future-architect.github.io/articles/20230123a/</id>
    <published>2023-01-22T15:00:00.000Z</published>
    <updated>2023-01-25T01:31:59.720Z</updated>
    
    <content type="html"><![CDATA[<p>ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã®ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°æ’ä¾‹ã®Goã®æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒªãƒªãƒ¼ã‚¹è¨˜å¿µã®ãƒ–ãƒ­ã‚°ãŒå§‹ã¾ã‚Šã¾ã™ã€‚ã“ã®åŸ·ç­†æ™‚ç‚¹ã§rc3ãŒå‡ºã¦ã„ã¾ã™ã€‚ã‹ã¤ã¦ã“ã‚“ãªé †èª¿ãªã“ã¨ãŒã‚ã£ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><div class="scroll"><table><thead><tr><th align="center">Date</th><th align="left">Title</th><th align="left">Author</th></tr></thead><tbody><tr><td align="center">1&#x2F;23(æœˆ)</td><td align="left">ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã®ç´¹ä»‹ï¼†è½ã¡ç©‚æ‹¾ã„</td><td align="left">æ¾å·å–œè¦</td></tr><tr><td align="center">1&#x2F;24(ç«)</td><td align="left"><a href="/articles/20230125a/">contextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®WithCancelCauseã¨Cause</a></td><td align="left">çœŸé‡éš¼è¨˜ã•ã‚“</td></tr><tr><td align="center">1&#x2F;25(ç«)</td><td align="left"><a href="/articles/20230126a/">Wrapping multiple errors</a></td><td align="left">å·å£ç¿”å¤§ã•ã‚“</td></tr><tr><td align="center">1&#x2F;26(ç«)</td><td align="left">timeã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ</td><td align="left">å®®æ°¸å´‡å²ã•ã‚“</td></tr><tr><td align="center">1&#x2F;27(ç«)</td><td align="left">HTTP ResponseController</td><td align="left">è¾»å¤§å¿—éƒã•ã‚“</td></tr><tr><td align="center">1&#x2F;30(æœˆ)</td><td align="left">ã€ŒNew ReverseProxy Rewrite hookã€ã‚’ã‚¼ãƒ­ã‹ã‚‰ç†è§£ã™ã‚‹</td><td align="left">æ£šäº•é¾ä¹‹ä»‹ã•ã‚“</td></tr><tr><td align="center">1&#x2F;31(ç«)</td><td align="left">vet</td><td align="left">ä»Šæ³‰æ™ºç¾©ã•ã‚“</td></tr><tr><td align="center">2&#x2F;1(æ°´)</td><td align="left">go build ã«è¿½åŠ ã•ã‚Œã‚‹ cover ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆåˆ©ç”¨ä¾‹ä»˜ãï¼‰</td><td align="left">è—¤äº•äº®ä½‘ã•ã‚“</td></tr></tbody></table></div><p>åˆå›ã¯ã€ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã®ç´¹ä»‹ã¤ã„ã§ã«ã€ä»–ã®äººãŒè§¦ã‚Œãªã„æ®‹ã£ãŸãƒã‚¿ã‚‚ç´¹ä»‹ã—ã¾ã™ã€‚</p><h1 id="ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã¨ã¯"><a href="#ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã¨ã¯" class="headerlink" title="ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã¨ã¯"></a>ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã¨ã¯</h1><p>ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒãƒ¼ã‚¶ãƒ«ã§ææ¡ˆã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚</p><ul><li><a href="https://github.com/golang/go/issues/51317">proposal: arena: new package providing memory arenas</a></li></ul><p>Goã¯ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚¿ã‚’å‚™ãˆãŸè¨€èªã§ã™ãŒã€ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚¿ã¯å®Ÿè¡Œæ™‚ã«ã‚³ã‚¹ãƒˆãŒå¤šå°‘ã‹ã‹ã‚Šã¾ã™ã€‚ãƒ¡ãƒ¢ãƒªã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€ä»–ã‹ã‚‰å‚ç…§ã•ã‚Œã¦ã„ãªã„ã‹ã©ã†ã‹ã‚’æ¢ç´¢ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚ãƒ¡ãƒ¢ãƒªã‚¢ãƒªãƒ¼ãƒŠã¨ã—ã¦ã€ã‚ã‚‰ã‹ã˜ã‚GCå¯¾è±¡å¤–ã®ãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’æ‰‹å‹•ã§ç¢ºä¿ã™ã‚‹ã“ã¨ã§ã€GCãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¢ç´¢ã™ã‚‹ã‚³ã‚¹ãƒˆãªã©ãŒç¯€ç´„ã§ãã¦ã€15%ã»ã©ã®æ€§èƒ½å‘ä¸ŠãŒã‚ã£ãŸã€ã¨ãƒ—ãƒ­ãƒãƒ¼ã‚¶ãƒ«ã«ã¯ã‚ã‚Šã¾ã™ã€‚</p><p>ã—ã‹ã—ã€ãƒ¡ãƒ¢ãƒªã®è§£æ”¾ã‚’æ‰‹å‹•ã§è¡Œã†å¿…è¦ãŒã‚ã£ãŸã‚Šã€æœ¬è³ªçš„ã«ã€Œå±é™ºã€ãªæ©Ÿèƒ½ã§ã‚ã‚‹ã—ã€ãƒ—ãƒ­ãƒãƒ¼ã‚¶ãƒ«ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ä½¿ã„æ–¹ï¼ˆprotobufã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã¨ã‹ï¼‰ä»¥å¤–ã¯ã»ã¨ã‚“ã©ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å¯„ä¸ã—ãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚</p><h2 id="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒãªã„ï¼Ÿã©ã“ã«ã‚ã‚‹ã®ï¼Ÿ"><a href="#ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒãªã„ï¼Ÿã©ã“ã«ã‚ã‚‹ã®ï¼Ÿ" class="headerlink" title="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒãªã„ï¼Ÿã©ã“ã«ã‚ã‚‹ã®ï¼Ÿ"></a>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒãªã„ï¼Ÿã©ã“ã«ã‚ã‚‹ã®ï¼Ÿ</h2><p>Goã¯é–‹ç™ºç‰ˆã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚‚å…¬é–‹ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚ã•ã£ããã€arenaãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p><p><a href="https://pkg.go.dev/std@go1.20rc3">https://pkg.go.dev/std@go1.20rc3</a></p><p>ã¨æ€ã£ãŸã‘ã©ãªã„ï¼Ÿã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€ç¢ºã‹ã«<code>$GOROOT/src/arena</code>ãƒ•ã‚©ãƒ«ãƒ€ã¯å­˜åœ¨ã—ã¾ã™ã€‚ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹ãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã®godocã§è¦‹ã‚‰ã‚Œãã†ãªã®ã§godocã‚’å…¥ã‚Œã¦è¦‹ã¦ã¿ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go install golang.org/x/tools/cmd/godoc@latest</span><br><span class="line">$ godoc</span><br></pre></td></tr></table></figure><p>ã—ã‹ã—ã€ã“ã‚Œã§ã‚‚ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¯è¡¨ç¤ºã•ã‚Œãšã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã—ã‹è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚</p><img src="/images/20230123a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2023-01-18_0.08.44.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2023-01-18_0.08.44.png" width="1200" height="684" loading="lazy"><p>ã“ã®æ©Ÿèƒ½ã¯ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã§å‹•ãã‚‚ã®ã§ã€ãƒ“ãƒ«ãƒ‰ã®æ™‚ã«ç’°å¢ƒå¤‰æ•°ãŒå¿…è¦ã ã£ãŸã“ã¨ã‚’æ€ã„å‡ºã—ã€ã“ã‚Œã‚’æŒ‡å®šã™ã‚‹ã¨ã‚ˆã†ã‚„ãè¦‹ã‚Œã¾ã—ãŸï¼æ©Ÿèƒ½ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ã€‚ã€€ã¡ãªã¿ã«ã€ã“ã‚Œã‚’æ›¸ãæ™‚ã«ã¾ã£ãŸãé•ã†<a href="https://pkg.go.dev/github.com/google/gapid@v1.6.1/core/memory/arena">åŒåã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</a>ã‚’è¦‹ã¦ã€ãµã‚€ãµã‚€ã¨èª­ã‚“ã§ã„ãŸã®ã§ã™ãŒã€æœ¬å®¶ã®æ–¹ã¯æ¤œç´¢ã§ã¯å‡ºã¦ã“ãªã„ã®ã§ã¿ãªã•ã¾ã‚‚ãŠæ°—ã‚’ã¤ã‘ãã ã•ã„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ GOEXPERIMENT=arenas godoc</span><br></pre></td></tr></table></figure><img src="/images/20230123a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2023-01-18_0.13.05.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2023-01-18_0.13.05.png" width="758" height="402" loading="lazy"><p>ä½¿ã„æ–¹ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ã€‚</p><ul><li>ã¾ãšã¯ <code>arena.NewArena()</code>ã§<code>*Arena</code>ã‚’ä½œæˆ</li><li>ä½¿ã„çµ‚ã‚ã£ãŸã‚‰ <code>Free()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™</li><li><code>arena.MakeSlice[Type](arena)</code>ã‚„<code>arena.New[Type](arena)</code>ã¨ã„ã£ãŸé–¢æ•°ã‚’ä½¿ã£ã¦ã‚¢ãƒªãƒ¼ãƒŠå†…éƒ¨ã®ãƒ¡ãƒ¢ãƒªã‚’åˆ©ç”¨</li><li><code>arena.Clone(obj)</code>ã‚’ä½¿ã†ã¨ã€ã‚¢ãƒªãƒ¼ãƒŠãŒçµ‚äº†ã—ã¦ã‚‚æ®‹ã‚‹ã‚ˆã†ã€ãƒ’ãƒ¼ãƒ—ã«å€¤ã‚’ç§»å‹•ã™ã‚‹(æµ…ã„ã‚³ãƒ”ãƒ¼)</li></ul><p>Goã¯ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ãŒä½¿ãˆãªã„ã®ã§ã™ãŒã€ãã®ã‹ã‚ã‚Šã«ã€1ç•ªç›®ã®å¼•æ•°ã«å€¤ã‚’å–ã‚‹ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ãªãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’ç”¨æ„ã™ã‚‹ã¨ã„ã†ã€Cè¨€èªã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã—ã¦ã„ã‚‹æ™‚ä»£ã®ã‚ˆã†ãªè¨­è¨ˆã‚’ã™ã‚‹ã“ã¨ã§ä»£æ›¿ã™ã‚‹ã¨ã„ã†ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã­ã€‚</p><h2 id="ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯"><a href="#ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯" class="headerlink" title="ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯"></a>ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯</h2><p>å°ã•ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãŸãã•ã‚“ç¢ºä¿ã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§æ€§èƒ½å·®ãŒå‡ºã‚‹ã¨ã„ã†ã“ã¨ã§ã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒªãƒ³ã‚¯ãƒ‰ãƒªã‚¹ãƒˆã®container&#x2F;listã‚’ã¡ã‚‡ã³ã£ã¨æ”¹é€ ã—ã¦ã¿ã¾ã—ãŸã€‚<code>Element</code>ã¯ãƒã‚¤ãƒ³ã‚¿ãŒ3ã¤ã¨<code>interface&#123;&#125;</code>ã‚’1ã¤æŒã¤æ§‹é€ ä½“ã§ã™ã€‚<code>interface</code>ã«ãƒã‚¤ãƒ³ã‚¿ã‚’å…¥ã‚Œã‚‹ã¨ã—ãŸã‚‰ï¼”ï¼ãƒã‚¤ãƒˆ(ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã¯ãƒã‚¤ãƒ³ã‚¿2ã¤ä¿æŒã™ã‚‹ã®ã§)ã®å€¤ã®ãƒ¡ãƒ¢ãƒªã®ç¢ºä¿ã«arenaã‚’åˆ©ç”¨ã™ã‚‹ã€ã¨ã„ã†ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™ã€‚</p><p>æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã®ãƒ¡ãƒ¢ãƒªç¢ºä¿éƒ¨åˆ†ã‚’ã„ã˜ã‚‹ã ã‘ã§ã‚ã‚Œã°ã€ãã‚“ãªã«é›£ã—ããªã„ã§ã™ã­ã€‚</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+import (</span></span><br><span class="line"><span class="addition">+&quot;arena&quot;</span></span><br><span class="line"><span class="addition">+)</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"> // Element is an element of a linked list.</span><br><span class="line"> type Element struct &#123;</span><br><span class="line"> // Next and previous pointers in the doubly-linked list of elements.</span><br><span class="line"><span class="meta">@@ -48,6 +52,7 @@</span></span><br><span class="line"> type List struct &#123;</span><br><span class="line"> root Element // sentinel list element, only &amp;root, root.prev, and root.next are used</span><br><span class="line"> len  int     // current list length excluding (this) sentinel element</span><br><span class="line"><span class="addition">+a    *arena.Arena</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> // Init initializes or clears list l.</span><br><span class="line"><span class="meta">@@ -59,8 +64,16 @@</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> // New returns an initialized list.</span><br><span class="line"><span class="deletion">-func New() *List &#123; return new(List).Init() &#125;</span></span><br><span class="line"><span class="addition">+func NewWithArena(a *arena.Arena) *List &#123;</span></span><br><span class="line"><span class="addition">+r := arena.New[List](a)</span></span><br><span class="line"><span class="addition">+r.a = a</span></span><br><span class="line"><span class="addition">+return r.Init()</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line"></span><br><span class="line"> // Len returns the number of elements of list l.</span><br><span class="line"> // The complexity is O(1).</span><br><span class="line"> func (l *List) Len() int &#123; return l.len &#125;</span><br><span class="line"><span class="meta">@@ -101,7 +114,9 @@</span></span><br><span class="line"></span><br><span class="line"> // insertValue is a convenience wrapper for insert(&amp;Element&#123;Value: v&#125;, at).</span><br><span class="line"> func (l *List) insertValue(v any, at *Element) *Element &#123;</span><br><span class="line"><span class="deletion">-return l.insert(&amp;Element&#123;Value: v&#125;, at)</span></span><br><span class="line"><span class="addition">+e := arena.New[Element](l.a)</span></span><br><span class="line"><span class="addition">+e.Value = v</span></span><br><span class="line"><span class="addition">+return l.insert(e, at)</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚é€šå¸¸ã®å®Ÿè£…ã€arenaåˆ©ç”¨ã€ä¸­ã«å…¥ã‚Œã‚‹è¦ç´ ã‚‚arenaã‚’åˆ©ç”¨ã®3ã¤ã§ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™ã€‚ä¸€å›ã«å…¥ã‚Œã‚‹è¦ç´ æ•°ã‚’è¦ç´ æ•°ã‚’1ä¸‡ã€10ä¸‡ã€100ä¸‡ã¨å¤‰ãˆã¦ã¿ã¦ã„ã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> list2</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;arena&quot;</span></span><br><span class="line"><span class="string">&quot;container/list&quot;</span></span><br><span class="line"><span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> V <span class="keyword">struct</span> &#123;</span><br><span class="line">n <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkListWithoutArena</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line">l := list.New()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">l.PushBack(&amp;V&#123;i&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkListWithArena</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line">a := arena.NewArena()</span><br><span class="line">l := NewWithArena(a)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">l.PushBack(&amp;V&#123;i&#125;) <span class="comment">// valueã¯arenaä½¿ã‚ãš</span></span><br><span class="line">&#125;</span><br><span class="line">a.Free()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkListWithArena2</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line">a := arena.NewArena()</span><br><span class="line">l := NewWithArena(a)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">v := arena.New[V](a) <span class="comment">// valueã‚‚arenaåˆ©ç”¨</span></span><br><span class="line">v.n = i</span><br><span class="line">l.PushBack(v)</span><br><span class="line">&#125;</span><br><span class="line">a.Free()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çµæœã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚1ä¸‡è¦ç´ ç¨‹åº¦ã ã¨ã»ã¨ã‚“ã©å·®ãŒã¤ãã¾ã›ã‚“ã€‚10ä¸‡ãã‚‰ã„ã«ãªã‚‹ã¨ã ã„ã¶å·®ãŒãƒ»ãƒ»ãƒ»ã¨ã„ã†æ„Ÿã˜ã§ã™ã€‚ã¡ãªã¿ã«ã€æœ€åˆã«æ›¸ã„ãŸã¨ãã¯<code>Free()</code>ã‚’æ›¸ãå¿˜ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ãã†ã—ãŸã‚‰å‡¦ç†æ™‚é–“ãŒ3å€ã«ãªã£ã¦ã¾ã—ãŸã€‚è¦æ³¨æ„ã§ã™ã€‚</p><div class="scroll"><table><thead><tr><th align="center">æ–¹å¼ï¼¼è¦ç´ æ•°</th><th align="center">10,000</th><th align="center">100,000</th><th align="center">1,000,000</th></tr></thead><tbody><tr><td align="center">æ¨™æº–ã®ãƒ¡ãƒ¢ãƒªæˆ¦ç•¥</td><td align="center">0.30mS</td><td align="center">4.58mS</td><td align="center">62.07mS</td></tr><tr><td align="center">arenaåˆ©ç”¨(Elementã®ã¿)</td><td align="center">0.29mS (-4.2%)</td><td align="center">2.77mS (-39.5%)</td><td align="center">28.00mS (-54.9%)</td></tr><tr><td align="center">arenaåˆ©ç”¨(valueã‚‚åˆ©ç”¨)</td><td align="center">0.28mS (-8.4%)</td><td align="center">2.65mS (-42.1%)</td><td align="center">26.80mS (-56.8%)</td></tr></tbody></table></div><h2 id="ã©ã“ã§ä½¿ãˆã‚‹ã®ã‹ï¼Ÿ"><a href="#ã©ã“ã§ä½¿ãˆã‚‹ã®ã‹ï¼Ÿ" class="headerlink" title="ã©ã“ã§ä½¿ãˆã‚‹ã®ã‹ï¼Ÿ"></a>ã©ã“ã§ä½¿ãˆã‚‹ã®ã‹ï¼Ÿ</h2><p>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã‚ãŒã‚‹ï¼ç´ æ•µï¼ã˜ã‚ƒã‚æ˜æ—¥ã‹ã‚‰ã‚¬ãƒ³ã‚¬ãƒ³ä½¿ã†ï¼ã¨ã„ã†ã“ã¨ã«ã¯ãªã‚‰ãªãã†ãªã®ãŒä»Šå›ã®æ©Ÿèƒ½ã§ã™ã€‚ãªã‚“ã¨ã„ã£ã¦ã‚‚ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ãƒ•ãƒ©ã‚°ã‚’ã‚»ãƒƒãƒˆã—ãªã„ã¨ä½¿ãˆã¾ã›ã‚“ã€‚å¾Œè¿°ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’è€ƒãˆã‚‹ã¨ã€APIã®å½¢ãŒã‚¢ãƒªãƒ¼ãƒŠåˆ©ç”¨ã¨ãã†ã§ãªã„å ´åˆã§å¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€å…¬é–‹ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ã¨ã€å¾Œæ–¹äº’æ›æ€§ã‚’è€ƒãˆã‚‹ã¨ã€æœ€ä½ã§ã‚‚1.21ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã€1.20ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹æœ€ä½ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãªã£ã¦ã‹ã‚‰ã€ã¨ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã‚‚ãã‚‚ExperimentalãŒå¤–ã‚Œã¦ã‹ã‚‰ãã®æ¬¡ã€ã®æ–¹ãŒã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã‚‚ã¡ã‚ã‚“ã€å€‹åˆ¥ã®ã‚¢ãƒ—ãƒªã§ä½¿ã†ãªã‚‰è‡ªå·±è²¬ä»»ã§ã™ãã«ã§ã‚‚ä½¿ãˆã‚‹ã¨ã¯æ€ã„ã¾ã™ã€‚</p><h2 id="ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã¯ä½•ãŒã‚ã‚‹ã‹ï¼Ÿ"><a href="#ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã¯ä½•ãŒã‚ã‚‹ã‹ï¼Ÿ" class="headerlink" title="ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã¯ä½•ãŒã‚ã‚‹ã‹ï¼Ÿ"></a>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã¯ä½•ãŒã‚ã‚‹ã‹ï¼Ÿ</h2><p>ãã‚‚ãã‚‚ã€å°ã•ã„ãƒ¡ãƒ¢ãƒªã‚’ãŸãã•ã‚“ä½¿ã†ã€ã¨ã„ã†ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒã©ã“ã«ã‚ã‚‹ã®ã‹ã€ã¨ã„ã†ã¨ã“ã‚ãŒå•é¡Œã§ã™ã€‚ä¸€ç•ªè€ƒãˆã‚‰ã‚Œã‚‹ã®ãŒä½•ã‹ã—ã‚‰ã®æœ¨æ§‹é€ ã®å‡¦ç†ã§ã™ã­ã€‚ã‚ã¨ã¯å¸¸é§ãƒ—ãƒ­ã‚»ã‚¹ã§ãŸãã•ã‚“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ‰±ã†ã‚±ãƒ¼ã‚¹ã§ã™ã€‚è€ƒãˆã‚‰ã‚Œã‚‹ã®ã¯ã ã„ãŸã„ã“ã‚“ãªæ„Ÿã˜ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><ul><li>XMLã®ãƒ‘ãƒ¼ã‚¹ï¼ˆExcelã®ãƒ‘ãƒ¼ã‚¹)</li><li>è¨€èªå‡¦ç†ç³»ã®æ§‹æ–‡æœ¨</li><li>HTMLã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆDOMãƒ„ãƒªãƒ¼ï¼‰</li><li>RDBè‡ªä½œå‹¢ï¼ˆã‚¿ãƒ—ãƒ«ãªã©ã®å†…éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼‰</li></ul><p>ä¸€ç•ªä¸ŠãŒä¸€ç•ªæœ‰æœ›ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãªæ°—ãŒã—ã¦ã„ã¾ã™ã€‚ã¨ã„ã†ã®ã‚‚ã€å‰è·ã§ä½œã£ãŸExcelã‹ã‚‰ã®ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã¯ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–ã‚‹ã¨ã€ã»ã¨ã‚“ã©ãŒãƒ¡ãƒ¢ãƒªç¢ºä¿ã®å‡¦ç†æ™‚é–“ã§ã—ãŸã€‚Goã®xmlãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯<a href="https://github.com/golang/go/issues/21823">å‡¦ç†ãŒé…ã„ã¨ã„ã†issue</a>ã‚‚ä¸ŠãŒã£ã¦ã„ãŸã‚Šã—ã¾ã™ã€‚æœ€è¿‘ã®Goã§ã¯è©¦ã—ã¦ã„ãªã„ã§ã™ãŒã€attributeã¨ã‹ã‚’ãƒ‘ãƒ¼ã‚¹ã®ã¨ãã«ãã‚Œãã‚Œãƒ¡ãƒ¢ãƒªç¢ºä¿ã—ã¦æ ¼ç´ã—ã¦ã„ã‚‹ã‚ˆã†ãªã¨ã“ã‚ãŒé…ã‹ã£ãŸã¨è¨˜æ†¶ã—ã¦ã„ã¾ã™ã€‚</p><h2 id="ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã¨APIè¨­è¨ˆã®è€ƒå¯Ÿ"><a href="#ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã¨APIè¨­è¨ˆã®è€ƒå¯Ÿ" class="headerlink" title="ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã¨APIè¨­è¨ˆã®è€ƒå¯Ÿ"></a>ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã¨APIè¨­è¨ˆã®è€ƒå¯Ÿ</h2><p>ã‚‚ã†1ã¤ã‚ã‚‹ã®ãŒã€Arenaã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®æˆ¦ç•¥ã‚’ã©ã†ã™ã‚‹ã‹ã€ã§ã™ã€‚ãŸã¨ãˆã°ã€Excelã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹ã§ã‚ã‚Œã°1ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã«Arenaã‚’ä½œã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚ãŸã ã—ã€åŒæ™‚å‡¦ç†æ•°ã®æœ€å¤§ãŒè¦‹ãˆã¦ã„ã¦ã€æœ€å¤§ãƒ¡ãƒ¢ãƒªé‡ãŒè¦‹ç©ã‚‚ã‚Œã‚‹ã®ã§ã‚ã‚Œã°ã€è¤‡æ•°ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã™ã‚‹ã®ã«ã€1ã¤ã®Arenaã‚’å…±æœ‰ã—ã€sync.Poolçš„ãªå†åˆ©ç”¨ã®ä»•çµ„ã¿ã‚‚ä½œã£ã¦è¼‰ã›ã‚‹ã€ã¨ã„ã†ã®ãŒä¸€ç•ªåŠ¹ç‡ã‚ˆããªã‚Šãã†ã§ã™ã€‚</p><p>ãŸã ã—ã€Arenaä¸Šã®ãƒ¡ãƒ¢ãƒªã®è§£æ”¾ã¯Arenaä¸€æ‹¬ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å¾ã€…ã«ãƒ¡ãƒ¢ãƒªãŒå°‘ãªããªã£ãŸã‹ã‚‰ã¨ã„ã£ã¦ã€ã€Œã˜ã‚ƒã‚GCå®Ÿè¡Œã—ã¦é–‹ã‘ã‚ˆã†ã€ã¿ãŸã„ãªã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚ˆã†ãªä»•çµ„ã¿ã‚’ä½œã‚‹ã®ã§ã‚ã‚Œã°ã€è‡ªåˆ†ã§ç¢ºä¿ã—ãŸãƒ¡ãƒ¢ãƒªã®é‡ã‚‚è¦‹ãªãŒã‚‰ã€ã¨ãã©ãArenaã«ãƒ¡ãƒ¢ãƒªã‚’è¿”ã™ã€ã¿ãŸã„ãªãƒ¡ãƒ¢ãƒªç®¡ç†ã®ä»•çµ„ã¿ã‚’è‡ªä½œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p><p>åƒ•ãŒæœ€åˆã«é–“é•ã£ã¦èª­ã‚“ã§ã„ãŸ<a href="https://pkg.go.dev/github.com/google/gapid@v1.6.1/core/memory/arena">Googleè£½ã®åŒåã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</a>ã§ã¯<code>context.Context</code>ã«Arenaã‚’ç™»éŒ²ã—ãŸã‚Šå–ã‚Šå‡ºã›ã‚‹APIãŒã‚ã‚Šã¾ã—ãŸãŒã€ã“ã‚Œã¨åŒã˜ã‚ˆã†ã«<code>context.Context</code>ã¨åŒã˜ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã§ä½¿ã†ã€ã¨ã„ã†ã®ã‚‚1ã¤ã®æ‰‹ã‹ã¨æ€ã„ã¾ã™ã€‚ãã†ã™ã‚‹ã¨ã€ã‚ã‚‹ç¨‹åº¦ã¾ã¨ã¾ã£ãŸå‡¦ç†å˜ä½ã§Arenaã‚’å…±æœ‰ã™ã‚‹ã€ã¨ã„ã£ãŸã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã—ã€ã‚¢ãƒªãƒ¼ãƒŠåˆ©ç”¨ã¨ãã†ã§ãªã„å ´åˆã«APIã‚’å¤‰ãˆãšã«ã§ãã¾ã™ï¼ˆã‚ã¾ã‚Šè‰¯ã„ã“ã¨ã§ã‚‚ãªã„ã‹ã‚‚ã§ã™ãŒï¼‰ã€‚ãƒ—ãƒ­ãƒãƒ¼ã‚¶ãƒ«ã®è­°è«–ã®ä¸­ã§ã‚‚ã“ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆå˜ä½ã§ã®è§£æ”¾ã¨ã„ã†ã®ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚</p><p>ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®APIã¨ã—ã¦ã¯ã€æœ€ä½é™ã€Arenaã‚’å¤–ã‹ã‚‰æ¸¡ã›ã‚‹ã‚ˆã†ã«ã€ã¨ã„ã†å£ã®ç”¨æ„ã™ã‚Œã°ã€ä½¿ã†å´ã§ã€ã“ã‚Œã‚‰ã®æˆ¦ç•¥ã‚’åˆ©ç”¨è€…ãŒé¸ã¹ã‚‹ã®ã§è‰¯ã•ãã†ã§ã™ã­ã€‚ã‚ã¨ã¯ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§è¿”ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ’ãƒ¼ãƒ—ã«ã™ã‚‹ã‹ã€Arenaã®ä¸Šã«ä½œã‚‹ã‹ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã§ãã‚‹å¿…è¦ã‚‚ã‚ã‚Šãã†ã§ã™ã€‚ãŸã¨ãˆã°ã€Excelã®ãƒ‘ãƒ¼ã‚¹ã§ã‚ã‚Œã°ã€XMLã®ãƒ¡ãƒ¢ãƒªã¯Arenaä¸Šã«ãŠã„ã¦ã€Excelã¨ã—ã¦å‡¦ç†ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä½¿ã„çµ‚ã‚ã£ãŸã‚‰XMLã®ãƒ¡ãƒ¢ãƒªã‚’è§£æ”¾ã—ã¦ã‚ã’ã¦ã€ãƒ–ãƒƒã‚¯ã®å€¤ã¯ãƒ’ãƒ¼ãƒ—ã«ãŠã„ã¦ãŠãã“ã¨ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¿”ã™ã€ã¨ã„ã†ã®ãŒå¯èƒ½ã§ã™ã€‚æœ€çµ‚çš„ã«è¿”ã™ãƒ–ãƒƒã‚¯ãŒArenaã ã¨ã€ãã‚Œã‚’ä½¿ã†é–“ã¯Arenaã®è§£æ”¾ã¯ã§ãã¾ã›ã‚“ã€‚ãŸã ã—ã€Excelã‹ã‚‰å€¤ã‚’èª­ã¿å–ã£ã¦ä½œã£ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå¿…è¦ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ã‚ã‚Œã°ã€ãƒ–ãƒƒã‚¯ãŒArenaã§ã‚‚è‰¯ã„ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ãŸã‚‰ä¸è¦ã«ãªã‚‹)ã¨ãªã‚Šã¾ã™ã€‚èª°ãŒã©ã†ä½¿ã†ã‹ã§ã©ã¡ã‚‰ã«ã‚ã‚‹ã¨è‰¯ã„ã‹ãŒå¤‰ã‚ã£ã¦ãã¦ã—ã¾ã†ã®ã§ã€æ±ç”¨çš„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œã‚‹ãªã‚‰æ˜ç¤ºçš„ã«æŒ‡å®šã§ãã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚</p><p>ãƒ“ãƒ«ãƒ‰æ™‚ã«ç’°å¢ƒå¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹ã®ã§ã™ãŒã€ç’°å¢ƒå¤‰æ•°ã ã¨æ¡ä»¶ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«ä½¿ãˆãªã„ã®ã§ã€åˆ¥é€”ãƒ“ãƒ«ãƒ‰ã‚¿ã‚°ã§Arenaãªã—ç‰ˆã®ã¿ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚ˆã†ã«ã€ã¨ã„ã†ã®ã‚‚1.21ãŒå‡ºã‚‹ã¾ã§ã¯å¿…è¦ãã†ã§ã™ã­ã€‚</p><h2 id="Arenaã‹ã‚‰è¿½ã„å‡ºã•ã‚Œãªã„ã‚ˆã†ã«æ°—ã‚’ä»˜ã‘ã‚‹-x2F-é–‹æ”¾å¾Œã¯Arenaã‚’è§¦ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹"><a href="#Arenaã‹ã‚‰è¿½ã„å‡ºã•ã‚Œãªã„ã‚ˆã†ã«æ°—ã‚’ä»˜ã‘ã‚‹-x2F-é–‹æ”¾å¾Œã¯Arenaã‚’è§¦ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹" class="headerlink" title="Arenaã‹ã‚‰è¿½ã„å‡ºã•ã‚Œãªã„ã‚ˆã†ã«æ°—ã‚’ä»˜ã‘ã‚‹&#x2F;é–‹æ”¾å¾Œã¯Arenaã‚’è§¦ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹"></a>Arenaã‹ã‚‰è¿½ã„å‡ºã•ã‚Œãªã„ã‚ˆã†ã«æ°—ã‚’ä»˜ã‘ã‚‹&#x2F;é–‹æ”¾å¾Œã¯Arenaã‚’è§¦ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹</h2><p>Arenaã‚’æ´»ç”¨ã™ã‚‹ã«ã¯ã€ãã“ã§ãƒ¡ãƒ¢ãƒªã‚’ç¢ºä¿ã—ã¦ã€ãã“ã‚’ãã¡ã‚“ã¨ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€Goã®å ´åˆã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ãŒä¾¿åˆ©ã‹ã¤å¼·åŠ›ãªã®ã§ã€ãƒ’ãƒ¼ãƒ—å´ã«ãƒ¡ãƒ¢ãƒªãŒç¢ºä¿ã•ã‚Œã¦GCå¯¾è±¡ã«ãªã£ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚Arenaã‚’ã›ã£ã‹ãä½¿ã†ã®ã§ã‚ã‚Œã°ã€Arenaã‹ã‚‰è¿½ã„å‡ºã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><ul><li>ã‚¹ãƒ©ã‚¤ã‚¹ã¯<code>arena.MakeSlice[Type](a)</code>ã§æ¯å›ç¢ºä¿ã™ã‚‹ã€‚å¯å¤‰é•·ã¨ã—ã¦ä½¿ãŠã†ã¨ã—ã¦<code>append()</code>ã‚’ã™ã‚‹ã¨ã€ä¼¸é•·ã™ã‚‹ãŸã‚ã«æ–°ã—ã„ãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«ãƒ’ãƒ¼ãƒ—ã«é€ƒã’ã¦ã„ã£ã¦ã—ã¾ã„ã€Arenaã‹ã‚‰å¤–ã«å‡ºã¦ã—ã¾ã†ã®ã§ã€æ¬¡ã®ã‚ˆã†ã«ä¼¸é•·ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯å†åº¦<code>arena.MakeSlice[Type](a)</code>ã§ç¢ºä¿ã—ã¦ã‚³ãƒ”ãƒ¼ã‚’è‡ªå‰ã§ã‚„ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ãŸã ã—ã€ä¼¸é•·ã—ãŸã¨ãã«ã€å‰ã®ã‚¹ãƒ©ã‚¤ã‚¹ã®ãƒ¡ãƒ¢ãƒªãŒArenaã‚’è§£æ”¾ã™ã‚‹ã¾ã§ã¯æ®‹ã‚Šç¶šã‘ã‚‹ãŸã‚ã€ã‚„ã¯ã‚ŠåŸºæœ¬çš„ã«å›ºå®šé•·ã®ã¿ã§é‹ç”¨ã§ã€å¯å¤‰é•·ã§æ‰±ã‚ãªã„æ–¹ãŒè‰¯ã•ãã†ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">mem := arena.NewArena()</span><br><span class="line">s := arena.MakeSlice[<span class="type">int</span>](mem, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">s = Append(mem, s, <span class="number">11</span>)</span><br><span class="line">log.Println(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Append</span>[<span class="title">T</span> <span class="title">any</span>]<span class="params">(mem *arena.Arena, s []T, v T)</span></span> []T &#123;</span><br><span class="line">l := <span class="built_in">len</span>(s)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">cap</span>(s) == l &#123;</span><br><span class="line">newS := arena.MakeSlice[T](mem, l+<span class="number">1</span>, l*<span class="number">2</span>)</span><br><span class="line"><span class="built_in">copy</span>(newS, s)</span><br><span class="line">newS[l] = v</span><br><span class="line"><span class="keyword">return</span> newS</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">append</span>(s, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>æ–‡å­—åˆ—ã‚‚ã€<code>[]byte</code>ã¨ã—ã¦Arenaã«ç½®ã„ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ˆä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰å‚ç…§ï¼‰ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">src := <span class="string">&quot;source string&quot;</span></span><br><span class="line"></span><br><span class="line">mem := arena.NewArena()</span><br><span class="line"><span class="keyword">defer</span> mem.Free()</span><br><span class="line"></span><br><span class="line">bs := arena.MakeSlice[<span class="type">byte</span>](mem, <span class="built_in">len</span>(src), <span class="built_in">len</span>(src))</span><br><span class="line"><span class="built_in">copy</span>(bs, src)</span><br><span class="line">str := unsafe.String(&amp;bs[<span class="number">0</span>], <span class="built_in">len</span>(bs))</span><br></pre></td></tr></table></figure><ul><li>mapã‚„chanã¯Arenaã‚’ä½¿ã†ç‰ˆãŒãªã„ã®ã§ã€å¿…è¦ã§ã‚ã‚Œã°ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ãŸã ã—ã€chanã¯ãã“ã¾ã§å¤§é‡ã«ä½œã£ã¦ãƒ»ãƒ»ãƒ»ã¨ã„ã†ã“ã¨ã‚‚ãªã•ãã†ãªã®ã§ã€å•é¡Œã¯ãªã„æ°—ãŒã—ã¾ã™ã€‚mapãŒå¿…è¦ã§ã‚ã‚Œã°é ‘å¼µã£ã¦å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã­ã€‚</li></ul><p>æ–‡å­—åˆ—ã¯<a href="https://uptrace.dev/blog/posts/go-memory-arena.html">Uptraceã®ãƒ–ãƒ­ã‚°</a>ã®ãƒ–ãƒ­ã‚°ã‹ã‚‰å¼•ç”¨ã—ã¾ã—ãŸã€‚</p><p>ã‚‚ã†1ã¤ã¯ã‚¢ãƒªãƒ¼ãƒŠãŒè§£æ”¾ã•ã‚ŒãŸå¾Œã«ã‚¢ãƒªãƒ¼ãƒŠã®ä¸­ã®ãƒ¡ãƒ¢ãƒªã‚’è§¦ã‚‰ãªã„ã€ã¨ã„ã†ã®ã‚‚ã‚ã‚Šã¾ã™ã€‚<code>go run -asan main.go</code>ã®ã‚ˆã†ã«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã‚’æœ‰åŠ¹ã«ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¯æ¤œçŸ¥ã§ãã¾ã™ã€‚ã‚¢ãƒªãƒ¼ãƒŠè§£æ”¾å¾Œã‚‚åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å€¤ã¯<code>arena.Clone()</code>ã‚’ä½¿ã£ã¦ã€ãƒ’ãƒ¼ãƒ—ã«é€ƒã—ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚</p><h2 id="ã‚¢ãƒªãƒ¼ãƒŠã®ã¾ã¨ã‚"><a href="#ã‚¢ãƒªãƒ¼ãƒŠã®ã¾ã¨ã‚" class="headerlink" title="ã‚¢ãƒªãƒ¼ãƒŠã®ã¾ã¨ã‚"></a>ã‚¢ãƒªãƒ¼ãƒŠã®ã¾ã¨ã‚</h2><p>ãƒã‚¤ã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã§æ€§èƒ½ãŒ2å€ä»¥ä¸Šã«ãªã‚‹ã€ã¨ã„ã†ã®ã‚’ã‚„ã£ã¦ã¿ã¾ã—ãŸã€‚Uptraceã®ãƒ–ãƒ­ã‚°ã§ã‚‚2åˆ†æ¢ç´¢ã®ã‚³ãƒ¼ãƒ‰ã‚’æ”¹é€ ã—ã¦ä½¿ã£ã¦ã„ãŸã®ã§ã€ã“ã®æ‰‹ã®å°ã•ãªãƒ¡ãƒ¢ãƒªã‚’ãŸãã•ã‚“ä½¿ã†ã‚±ãƒ¼ã‚¹ã«é©ç”¨ã™ã‚‹ã¨è‰¯ã•ãã†ã§ã™ã€‚</p><p>ãŸã ã—ã€APIãƒ‡ã‚¶ã‚¤ãƒ³ã‚’è€ƒãˆã‚‹ã¨ã€æ±ç”¨çš„ãªè¨­è¨ˆã‚’ä½œã‚‹ã®ã¯çµæ§‹å¤§å¤‰ãã†ã ãªã€ã¨æ€ã„ã¾ã—ãŸã€‚</p><h1 id="ãã®ä»–ã®å°ãƒã‚¿"><a href="#ãã®ä»–ã®å°ãƒã‚¿" class="headerlink" title="ãã®ä»–ã®å°ãƒã‚¿"></a>ãã®ä»–ã®å°ãƒã‚¿</h1><p>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¨ã‹cgoå‘¨ã‚Šã¨ã‹ç´°ã‹ãã„ã‚ã„ã‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã™ã€‚CGoä¾å­˜ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å®Ÿè£…ã•ã‚Œã¦ã„ãŸmacOSãŒéä¾å­˜ã«ãªã£ãŸã‚Šã—ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®macä¸Šã®ãƒ“ãƒ«ãƒ‰ã¨ã‚¯ãƒ­ã‚¹ãƒ“ãƒ«ãƒ‰ã§é•ã„ãŒãªããªã‚Šã¾ã—ãŸï¼ˆä»–ã®CGoä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãªã„å ´åˆï¼‰ã€‚ã¾ã‚ã€å¤§ããå®Ÿè£…ãŒå¤‰ã‚ã‚‹ã¨ã‹ã«é–¢ã‚ã‚‹ã‚‚ã®ã¯ä»Šã®ã¨ã“ã‚ãªã•ãã†ï¼ŸCPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã”ã¨ã«ç´°ã‹ãã‹ãåˆ†ã‘ãŸã„ï¼ˆARMã®ä¸­ã®å‘½ä»¤ã‚»ãƒƒãƒˆã”ã¨ã¨ã‹ï¼‰äººå‘ã‘ã«ãƒ“ãƒ«ãƒ‰ã‚¿ã‚°ã¨ã‹è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ãŒã€å¤šãã®äººã«ã¯é–¢ä¿‚ãªã„ã‹ãªï¼Ÿ<br>ã‚ã¨ã¯ã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒæ·»ä»˜ã•ã‚Œãªããªã£ã¦ã€é…å¸ƒç‰©ãŒå°ã•ããªã£ã¦ã„ã¾ã™ã€‚ã¾ã‚ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’ã™ã‚‹å ´åˆãªã©ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ãŸã®ã§ã€ãã‚Œã¨åŒã˜ã‚ˆã†ãªæ„Ÿã˜ã®æ‰±ã„ã«ãªã£ãŸã ã‘ã§ã€åˆå›ãƒ“ãƒ«ãƒ‰ãŒã¡ã‚‡ã£ã¨é…ã„ã‹ãªï¼Ÿãã‚‰ã„ã®ã‚‚ã®ã§ã™ã€‚äºŒé…¸åŒ–ç‚­ç´ ã‚’æ¸›ã‚‰ã•ãªã„ã¨ï¼ã¨ã„ã†ä¼šç¤¾ã•ã‚“ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã£ã¦ä½¿ã†ã¨ã„ã„ã‹ã‚‚ï¼Ÿ</p><h2 id="ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç³»"><a href="#ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç³»" class="headerlink" title="ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç³»"></a>ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç³»</h2><h3 id="unsafe"><a href="#unsafe" class="headerlink" title="unsafe"></a><code>unsafe</code></h3><p>æ–‡å­—åˆ—ã¨ãƒã‚¤ãƒˆåˆ—ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼ã‚’ã—ãªã„å¤‰æ›ã€ã‚¹ãƒ©ã‚¤ã‚¹ã®è£ã®é…åˆ—ã®å–å¾—ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚<a href="https://pkg.go.dev/github.com/valyala/fasthttp">github.com&#x2F;valyala&#x2F;fasthttp</a>ã¯ãªã‚‹ã¹ãstringã‚’ä½œã‚‰ãªã„ã“ã¨ã§é«˜é€Ÿãªãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’é”æˆã—ã¦ã„ã‚‹ï¼ˆã¨æ€ã†ï¼‰ã®ã§ã™ãŒã€net&#x2F;httpã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚‚åŒã˜ãã‚‰ã„ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¢ãƒƒãƒ—ã‚’æœŸå¾…ã—ã¡ã‚ƒã„ã¾ã™ã­ã€‚</p><h3 id="åœ§ç¸®ç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª"><a href="#åœ§ç¸®ç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª" class="headerlink" title="åœ§ç¸®ç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª"></a>åœ§ç¸®ç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</h3><p><code>archive/tar</code>ã¨<code>archive/zip</code>ã§ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã®å¤–ã ã£ãŸã‚Šã€çµ¶å¯¾ãƒ‘ã‚¹ãŒå…¥ã‚‹ã¨<code>ErrInsecurePath</code>ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒå¯¾ç­–ã§ã™ã­ã€‚<code>GODEBUG=tarinsecurepath=0</code>ã¨ã‹<code>GODEBUG=zipinsecurepath=0</code>ã‚’è¨­å®šã—ã¦å®Ÿè¡Œã™ã‚Œã°å‰ã¨åŒã˜å‹•ä½œã«ã¯ãªã‚Šã¾ã™ã€‚</p><h3 id="æš—å·ç³»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª"><a href="#æš—å·ç³»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª" class="headerlink" title="æš—å·ç³»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª"></a>æš—å·ç³»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</h3><p><code>crypto/ecdh</code>ã§æ¥•å††æš—å·ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¿½åŠ ã«ãªã‚Šã¾ã—ãŸã€‚<a href="https://qiita.com/lemiyachi/items/c20a18b172c6f192a262">RSAã®çµ‚ã‚ã‚Šã®å§‹ã¾ã‚Š - æš—å·ç§»è¡Œå†ã³</a>ã«ã‚ã‚‹ã‚ˆã†ã«ã€æš—å·å¼·åº¦ã‚’å¼·ãã—ã‚ˆã†ã€ã¨ã„ã†æµã‚ŒãŒã¾ãŸæ¥ãã†ãªã®ã§ã€è¦æ³¨ç›®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚<br>ã‚ã¨ã¯<code>crypto/ecdsa</code>ã¨ã‹<code>crypto/rsa</code>ã¨ã‹ã‚ãšã‚‰ã—ãã€æ€§èƒ½ãŒæ‚ªããªã‚‹æ”¹å–„ã§ã™ãŒã€å‡¦ç†é€Ÿåº¦ãŒå®šæ•°æ™‚é–“ã§çµ‚ã‚ã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ã„ã†ã“ã¨ã§ã€å‡¦ç†ã™ã‚‹æ™‚é–“ã§å†…å®¹ãŒæ¨æ¸¬ã§ãã¡ã‚ƒã†ç³»ã®æœ€è¿‘ãŸã¾ã«è©±é¡Œã«ãªã‚‹ç³»çµ±ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã§ã™ã‹ã­ã€‚</p><h3 id="io-OffsetWriter"><a href="#io-OffsetWriter" class="headerlink" title="io.OffsetWriter"></a><code>io.OffsetWriter</code></h3><p><code>io.Reader</code>ã«ã¯<code>io.SectionReader</code>ã¨ã„ã†ã€ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼‹ã‚µã‚¤ã‚ºåˆ¶é™ã€<code>io.LimitReader</code>ã¨ã„ã†ã‚µã‚¤ã‚ºåˆ¶é™ã®Readerã¯ã‚ã‚Šã¾ã—ãŸãŒã€å®Ÿã¯<code>io.Writer</code>ã¨ã—ã¦ã¯ã‚ªãƒ•ã‚»ãƒƒãƒˆç³»ã®ã¯ãªã‹ã£ãŸã‚“ã§ã™ã­ã€‚æ›¸ãè¾¼ã¿ä¸Šé™ã®Writerï¼ˆ<code>LimitWriterï¼Ÿ</code>)ã¯ãªã•ãã†ãªã®ã§ã€èª°ã‹ææ¡ˆã™ã‚‹ã¨è‰¯ã„æ°—ãŒã—ã¾ã™ã€‚</p><h3 id="math-rand"><a href="#math-rand" class="headerlink" title="math/rand"></a><code>math/rand</code></h3><p>åœ°å‘³ã«å¤‰æ›´ãŒå¤šã„ã§ã™ã€‚1.20ã‹ã‚‰ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä¹±æ•°ã®ç¨®ãŒå›ºå®šå€¤ã§ãªããªã‚Šã¾ã—ãŸã€‚1.19ã¾ã§ã¯é–“é•ã£ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œã®ä»•æ–¹ã‚’é˜²ããŸã‚ã«ã€å¸¸ã«åŒã˜ä¹±æ•°ãŒå¤‰ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¦ã€é–‹ç™ºè€…ã«é©åˆ‡ãªç¨®ã®è¨­å®šã‚’å³ã™æŒ™å‹•ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚å®Ÿè¡Œæ™‚ã«<code>GODEBUG=randautoseed=0</code>ã‚’ã¤ã‘ã‚‹ã¨ã€ä»¥å‰ã¨åŒã˜æŒ™å‹•ã«ãªã‚Šã¾ã™ã€‚ã“ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªä¹±æ•°ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã®ä¹±æ•°ã®ç¨®ã‚’è¨­å®šã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª<code>rand.Seed()</code>ã¯å»ƒæ­¢ã«ãªã£ã¦ã„ã¾ã™ã€‚ç¨®ã‚’å›ºå®šã—ãŸä¹±æ•°ãŒå¿…è¦ãªå ´åˆã¯ã€ä¹±æ•°ç”Ÿæˆå™¨ã‚’æ˜ç¤ºçš„ã«ä½œã£ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚<br>ã‚ã¨ã€<code>rand.Read()</code>ã‚‚å»ƒæ­¢ã«ãªã£ã¦ã„ã¾ã™ã€‚ãƒ©ãƒ³ãƒ€ãƒ ãªãƒã‚¤ãƒˆåˆ—å–å¾—ã¨ã„ã†ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç”¨é€”ã§ã‚ˆãã‚ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§é–“é•ã£ã¦ä½¿ã‚ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã‹ã£ãŸã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿ<code>crypto/rand</code>ã®<code>Read</code>ã‚’ä½¿ãˆã¨ãªã£ã¦ã„ã¾ã™ã­ã€‚</p><h3 id="regexp"><a href="#regexp" class="headerlink" title="regexp"></a><code>regexp</code></h3><p>æ­£è¦è¡¨ç¾ã§ãƒ¡ãƒ¢ãƒªã‚’æ¶ˆè²»ã—ã™ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã«<code>syntax.ErrLarge</code>ãŒè¿”ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚Go 1.19ã®ãƒ‘ãƒƒãƒãƒªãƒªãƒ¼ã‚¹ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã•ã‚ŒãŸã®ã§ã™ãŒã€ãã®ã¨ãã¯æ–°ã—ã„APIã‚’å°å…¥ã—ãªã„ãƒ«ãƒ¼ãƒ«ã«å¾“ã„ã€<code> syntax.ErrInternalError</code>ã‚’ä¸€æ™‚çš„ã«è¿”ã—ã¦ã„ãŸãŒã€1.20ã‹ã‚‰ã¯ä¸Šè¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒæ–°è¦ã§ä½œã‚‰ã‚ŒãŸã¨ã®ã“ã¨ã§ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã®ã‚„ã‚Šæ–¹ã¨ã—ã¦å‚è€ƒã«ãªã‚Šã¾ã™ã­ã€‚</p><h2 id="ã•ã„ã”ã«"><a href="#ã•ã„ã”ã«" class="headerlink" title="ã•ã„ã”ã«"></a>ã•ã„ã”ã«</h2><p>æ˜æ—¥(1&#x2F;24)ã¯çœŸé‡ã•ã‚“ã® <a href="/articles/20230125a/">contextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®WithCancelCauseã¨Cause</a>ã§ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã®ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°æ’ä¾‹ã®Goã®æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒªãƒªãƒ¼ã‚¹è¨˜å¿µã®ãƒ–ãƒ­ã‚°ãŒå§‹ã¾ã‚Šã¾ã™ã€‚ã“ã®åŸ·ç­†æ™‚ç‚¹ã§rc3ãŒå‡ºã¦ã„ã¾ã™ã€‚ã‹ã¤ã¦ã“ã‚“ãªé †èª¿ãªã“ã¨ãŒã‚ã£ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ&lt;/p&gt;
&lt;div class=&quot;scroll&quot;&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="Go" scheme="https://future-architect.github.io/tags/Go/"/>
    
    <category term="ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹" scheme="https://future-architect.github.io/tags/%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9/"/>
    
    <category term="Go1.20" scheme="https://future-architect.github.io/tags/Go1-20/"/>
    
  </entry>
  
  <entry>
    <title>MailSlurperã‚’ä½¿ã£ã¦6æ¡ã®ã‚³ãƒ¼ãƒ‰ã®é€ä¿¡ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹</title>
    <link href="https://future-architect.github.io/articles/20230120a/"/>
    <id>https://future-architect.github.io/articles/20230120a/</id>
    <published>2023-01-19T15:00:00.000Z</published>
    <updated>2023-01-19T23:56:32.500Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥å‰ã€èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®hankoã®ç´¹ä»‹ã®ä¸­ã§ã€hankoãŒãƒ†ã‚¹ãƒˆã§ä½¿ã£ã¦ã„ã‚‹MailSlurperã¨ã„ã†ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ãŒé¢ç™½ã„ã¨ã„ã†ç´¹ä»‹ã‚’ã—ã¾ã—ãŸã€‚</p><p><a href="https://future-architect.github.io/articles/20220902a/">https://future-architect.github.io/articles/20220902a/</a></p><p>ãƒ†ã‚¹ãƒˆã«ãŠã„ã¦ã¯ã€ãƒ¢ãƒƒã‚¯ã¯ä½¿ã†ã‚‚ã®ã®ã€ãƒ¢ãƒƒã‚¯ã‚’å·®ã—è¾¼ã‚€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã¯ãªãã¦ã€ã‚¤ãƒ³ãƒ•ãƒ©ãƒ¬ãƒ™ãƒ«ã§ä»•æ›ã‘ã‚‹æ–¹ãŒã„ã„ã‚ˆã€ã¨ã„ã†ã®ã¯ã»ã¼ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ã¨ãªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><ul><li>RDBã‚’ä½¿ã†ã«ã¯ã€Dockerã§ã•ã£ã¨PostgreSQLã‚’å·®ã—è¾¼ã‚€</li><li>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®HTTPã®å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã†ã«ã¯ã€<a href="https://mswjs.io/">Mock Service Worker</a>ã¨ã‹<a href="https://docs.cypress.io/api/commands/intercept">Cypressã®intercept</a>ã‚’ä½¿ã†</li></ul><p>ã‚‚ã¡ã‚ã‚“ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§H2ã¨ã‹SQLiteã¨ã‹ã®ãƒ­ãƒ¼ã‚«ãƒ«ã§ç°¡å˜ã«ä½¿ãˆã‚‹DBMSã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãªã‚‰ãã‚Œã‚’ä½¿ã†ã®ã‚‚æ‰‹ã§ã™ãŒã€ã¨ã‚‚ã‹ãã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®ãƒ¢ãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã®ã¯ãªã—ã€ã¨ã„ã†æ„Ÿã˜ã§ã™ã­ã€‚</p><p>ã¨ã„ã†ã®ã‚‚ã€ã‚„ã‚Šæ–¹ã‚’é–“é•ãˆã‚‹ã¨ã€ãƒ¢ãƒƒã‚¯ã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã€ã‚³ãƒ¼ãƒ‰é‡ã®ã‚ã‚Šã«å“è³ªãŒã‚ãŒã‚‰ãªã„ã¨ã‹ã€çµå±€å®Ÿã‚·ã‚¹ãƒ†ãƒ ã®æŒ™å‹•ã®å¤‰åŒ–ã«æ°—ã¥ã‘ãšã«ä¸å…·åˆãŒé˜²æ­¢ã§ããªã„ã¨ã‹ã€ãƒ¢ãƒƒã‚¯ã‚’ã‚³ãƒ¼ãƒ‰ã§ä½œã‚‹ã®ã¯ã‚ã¾ã‚Šã‚ˆããªã„ã¨ã„ã†è«–èª¿ã§ã™ã­ã€‚ãªã‚‹ã¹ãä¸Šæµã§ãƒ¢ãƒƒã‚¯ã™ã‚Œã°ã€ãã®ã‚ˆã†ãªå•é¡Œã¯æ¸›ã‚Šã¾ã™ã€‚å°†æ¥çš„ã«ã¯ãƒ¢ãƒƒã‚¯ã®æŒ™å‹•ãŒæ­£ã—ã„ã‹ã®æ¤œè¨¼ã¨ã‹ãã†ã„ã†ã‚ãŸã‚Šã®é€²åŒ–ã‚‚ã‚ã‚‹ã‹ãªã€ã¨æ€ã„ã¤ã¤ã€æ¥½ã«æˆæœãŒå‡ºã‚‹ãªã‚‰ãã¡ã‚‰ã‚’ä»Šã¯é¸æŠã™ã¹ãã¨æ€ã„ã¾ã™ã€‚</p><p>ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã„ã¦ã‚‚ã€MailSlurperã‚’ä½¿ãˆã°è‰¯ã•ãã†ãªã®ã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚æœ€è¿‘ã‚ˆãè¦‹ã‹ã‘ã‚‹ã€6æ¡ã®æ•°å­—ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã®èªè¨¼ã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚</p><h1 id="MailSlurper"><a href="#MailSlurper" class="headerlink" title="MailSlurper"></a>MailSlurper</h1><p><a href="https://www.mailslurper.com/">MailSlurper</a>ã¯ã€MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼å…¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã™ã€‚SMTPã§ãƒ¡ãƒ¼ãƒ«ã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ãã®ãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã§ãã¾ã™ã€‚ã¾ãŸã€REST APIã‚‚æä¾›ã•ã‚Œã¦ãŠã‚Šã€å—ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚’APIã§å–ã‚Šå‡ºã›ã¾ã™ã€‚Goè£½ã§è»½ãã€Dockerã§æ°—è»½ã«èµ·å‹•ã§ãã¾ã™ã€‚</p><p>ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã¯1ã¤ã§ã€æ¥ãŸãƒ¡ãƒ¼ãƒ«ã¯ã™ã¹ã¦ä¸€ã‹æ‰€ã«é›†ã¾ã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹ã¨ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«å¿…è¦ã¨ã„ã†è¨­å®šãŒã§ãã€æœ¬ç•ªç’°å¢ƒã§ã‚‚ä½¿ã†ã“ã¨ã‚’æƒ³å®šã—ã¦ãã†ã§ã™ãŒã€ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ä½¿ã†ã«ã‚‚ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ãŒ1ã¤ã—ã‹ãªã„ã¨ä¸ä¾¿ã§ã™ã—ã€å—ä¿¡å¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆèµ·å‹•ã¨ã‹ãŒãªã„ã®ã§ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†ã®ãƒˆãƒªã‚¬ãƒ¼ã«ã™ã‚‹ã«ã‚‚å°‘ã—å¿ƒã‚‚ã¨ãªãã€ä»Šã®ã¨ã“ã‚ã¯ãƒ†ã‚¹ãƒˆç”¨é€”ãŒãƒ™ã‚¹ãƒˆã‹ãªã€ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</p><p>GitHubã‚’è¦‹ã¦ã‚‚ã“ã“ã—ã°ã‚‰ãã¯ã‚ã¾ã‚Šæ›´æ–°ã•ã‚Œã¦ã„ãªã„ã®ã§ã™ãŒã€SMTPã¯æ©Ÿèƒ½çš„ã«ã¯æ¯ã‚Œã¦ã„ã‚‹ã®ã§å•é¡Œãªã„ã§ã—ã‚‡ã†ã€‚</p><h1 id="6æ¡ã®æ•°å€¤ã®ç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£"><a href="#6æ¡ã®æ•°å€¤ã®ç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£" class="headerlink" title="6æ¡ã®æ•°å€¤ã®ç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£"></a>6æ¡ã®æ•°å€¤ã®ç”Ÿæˆã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</h1><p>ã¿ãªã•ã‚“ã€<a href="https://www.oreilly.co.jp/books/9784873119038/">Real World HTTP</a>ã¯ã™ã§ã«ã”è¦§ã«ãªã‚‰ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã®ã§ã€ãŠæ‰‹å…ƒã®æœ¬ã®ã€Œ14.8.5ã€€ã‚¿ã‚¤ãƒ ãƒ™ãƒ¼ã‚¹ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆTOTPï¼‰ã€ã‚’è¦‹ã‚Œã°è©³ã—ã„ã“ã¨ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã€è©³ç´°ã«ã¤ã„ã¦ã¯èªã‚Šã¾ã›ã‚“ãŒã€ç§˜å¯†éµã¨ã—ã¦ç”¨æ„ã—ãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ã‚‚ã¨ã«ã€æ—¥æ™‚æƒ…å ±ã‚’åŠ ãˆã¦6æ¡ã®æ•°å€¤ã‚’ç”Ÿæˆã—ã¾ã™ã€‚Goãªã‚‰ github.com&#x2F;pquerna&#x2F;otp&#x2F;totp ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹ã®ãŒç°¡å˜ã§ã™ã€‚</p><p>6æ¡ã®æ•°å€¤ã®è¨ˆç®—ã¯RFCã§æ±ºã‚ã‚‰ã‚ŒãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«åŸºã¥ã„ã¦è¡Œã„ã¾ã™ã€‚é«˜ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚Œã°ã€äº‹å‰ã«ç§˜å¯†éµã‚’Google Authenticatorãªã©ã®ã‚¢ãƒ—ãƒªã«ç™»éŒ²ã—ã¦ãŠãã€TOTPã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«å¾“ã£ã¦å‡ºåŠ›ã—ãŸæ•°å€¤ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ã‚Šã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚‚åŒã˜è¨ˆç®—ã‚’ã™ã‚‹ã“ã¨ã§ç…§åˆã—ã¾ã™ã€‚ç§˜å¯†éµãã®ã‚‚ã®ã¯æœ€åˆã®ç™»éŒ²æ™‚ä»¥å¤–ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æµã‚Œã‚‹ã“ã¨ãŒãªã„ãŸã‚ã€é€šä¿¡çµŒè·¯ãŒå®‰å…¨ã§ãªãã¦ã‚‚æ¯”è¼ƒçš„å®‰å…¨ã§ã™ã€‚ä»®ã«é€šä¿¡ãŒå‚å—ã•ã‚Œã¦ã‚‚ã€ãã®ã‚³ãƒ¼ãƒ‰ã¯30ç§’ï¼ˆãŸã„ã¦ã„ã®ã‚µãƒ¼ãƒ“ã‚¹ã®å ´åˆï¼‰ã—ã‹æœ‰åŠ¹ã§ãªã„ã‹ã‚‰ã§ã™ã€‚</p><p>ä¸€æ–¹ã§ã€ã‚ã¾ã‚Šãƒ—ãƒ­å‘ã‘ã®ã‚µãƒ¼ãƒ“ã‚¹å‡ºãªã„å ´åˆã¯ã€åŒã˜TOTPã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚ã£ã¦ã‚‚ã€åˆ¥ã®ä½¿ã„æ–¹ã‚’ã—ã¾ã™ã€‚ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„SMSã€éŸ³å£°é€šè©±ã§6æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¼ãˆã€ãã‚Œã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚µãƒ¼ãƒãƒ¼ç”»é¢ã§å…¥åŠ›ã—ã¦æˆ»ã™ã“ã¨ã§ç…§åˆã—ã¾ã™ã€‚é€šä¿¡çµŒè·¯ã®å‚å—ã«å¯¾ã™ã‚‹å¼·åº¦ã¯åŒã˜ã§ã™ãŒã€ä»®ã«SIMã‚¹ãƒ¯ãƒƒãƒ—æ”»æ’ƒã‚’å—ã‘ãŸã‚Šã€ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚¯ãƒ©ãƒƒã‚¯ã•ã‚Œã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã¦ã—ã¾ã†ã¨çªç ´ã§ãã¦ã—ã¾ã†ã®ã§ã€æ‰‹å…ƒã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«è§¦ã‚‰ã‚Œãªã‘ã‚Œã°å®‰å¿ƒã®å‰è¿°ã®æ–¹æ³•ã‚ˆã‚Šã¯ã‚„ã‚„å®‰å…¨æ€§ã¯è½ã¡ã¾ã™ï¼ˆã‚‚ã¡ã‚ã‚“ã€ç§˜å¯†éµã‚’ãã®ãƒ‡ãƒã‚¤ã‚¹ã«ã—ã‹å…¥ã‚Œã¦ã„ãªã„ã¨ã„ã†å‰æã§ï¼‰ã€‚</p><p>å¾Œè€…ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯å¢—ãˆã¦ã„ã‚‹ã®ã§ã€ãã‚Œã‚’MailSlurperã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã™ã€‚</p><h1 id="ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ä½œæˆ"><a href="#ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ä½œæˆ" class="headerlink" title="ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ä½œæˆ"></a>ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ä½œæˆ</h1><p>ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ç”Ÿæˆã¯â€github.com&#x2F;pquerna&#x2F;otpâ€ã§ç°¡å˜ã«ã§ãã¾ã™ã€‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç”Ÿæˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ã«è¡Œã„ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ä¿å­˜ã—ã¾ã™ã€‚å¾ŒåŠã®ã‚³ãƒ¼ãƒ‰ã¯ã€ã™ã§ã«ç™»éŒ²æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦è¡Œã†å‰æãªã®ã§ã€ã‚ã‚‰ã‹ã˜ã‚ä½œã£ã¦ãŠã„ã¦ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«åˆ©ç”¨ã—ã¾ã™ã€‚ç™»éŒ²ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/pquerna/otp/totp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    key, err := totp.Generate(totp.GenerateOpts&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;key: %s\n&quot;</span>, key.Secret())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•"><a href="#ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•" class="headerlink" title="ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•"></a>ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•</h1><p>ãƒ†ã‚¹ãƒˆã®ãŸã‚ã®MailSlurperã‚’èµ·å‹•ã—ã¦ãŠãã¾ã™ã€‚docker composeã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ã‚¦ã‚§ãƒ–ã®ç®¡ç†ç”»é¢ã€APIã€SMTPãƒãƒ¼ãƒˆã®3ã¤ã‚’é–‹ã‘ã¦ãŠãã¾ã™ã€‚ãªãŠã€å…¬å¼ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ãªãã€é‡è‰¯ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå¤šã„ã®ã§ã™ãŒã€<a href="https://hub.docker.com/r/marcopas/docker-mailslurper">marcopas&#x2F;docker-mailslurper</a> ãŒä¸€ç•ªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå……å®Ÿã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight yaml"><figcaption><span>docker-compose.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mailslurper:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">marcopas/docker-mailslurper:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;8080:8080&#x27;</span> <span class="comment"># web UI</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;8085:8085&#x27;</span> <span class="comment"># API</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;2500:2500&#x27;</span> <span class="comment"># smtp</span></span><br></pre></td></tr></table></figure><p>ã‚ã¨ã¯èµ·å‹•ã™ã‚‹ã ã‘ã§ã™ã€‚ <a href="http://localhost:8080/">http://localhost:8080</a> ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker compose up</span><br></pre></td></tr></table></figure><img src="/images/20230120a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2023-01-16_1.41.30.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2023-01-16_1.41.30.png" width="1200" height="684" loading="lazy"><h1 id="ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆ"><a href="#ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆ" class="headerlink" title="ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆ"></a>ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆ</h1><p>ã“ã‚Œã‹ã‚‰ä½œã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€6æ¡ã®èªè¨¼ã‚³ãƒ¼ãƒ‰ã¤ãã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ãã®6æ¡ã®æ•°å€¤ãŒæ­£ã—ã„ã‚‚ã®ã‹ã©ã†ã‹ã®æ¤œè¨¼ã‚’æ¥ãªã„ã¾ã™ã€‚</p><p>MailSlurperã¯<a href="https://github.com/mailslurper/mailslurper/wiki/Email-Endpoints">REST APIã‚’æä¾›ã—ã¦ã„ã¾ã™</a>ã€‚é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—ã—ã¦ãã¾ã™ã€‚å–å¾—ã«ã‚ãŸã£ã¦ã¯ã€é€ä¿¡ã‚‚ã¨ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„é€ä¿¡å…ˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚‚ã§ãã¾ã™ã€‚</p><p>ã¾ãšã¯ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ã¨ã—ã¦ã€ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚’ã¨ã£ã¦ãã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ã¿ã¾ã™ã€‚6æ¡ã®æ•°å€¤ã‚’å–ã‚Šå‡ºã—ã¾ã™ã€‚é€ä¿¡å…ˆã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã†ã‚ˆã†ã«ã—ã¾ã™ã€‚åŒæ™‚ã«ãƒ†ã‚¹ãƒˆã‚’ä¸¦è¡Œã§èµ°ã‚‰ã›ãŸã¨ã—ã¦ã‚‚ã€é€ä¿¡å…ˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã‚’åˆ†ã‘ã¦ãŠã‘ã°ãƒ†ã‚¹ãƒˆãŒå¹²æ¸‰ã™ã‚‹ã“ã¨ãŒãªããªã‚Šã¾ã™ã€‚ä»Šå›ã¯Goã§å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> authcode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;net/url&quot;</span></span><br><span class="line"><span class="string">&quot;regexp&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// json2goã§ä½œæˆã—ãŸã€MailSlurperã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ä¸€è¦§ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹</span></span><br><span class="line"><span class="keyword">type</span> MailSlurperResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">MailItems    []MailItem <span class="string">`json:&quot;mailItems&quot;`</span></span><br><span class="line">TotalPages   <span class="type">int</span>        <span class="string">`json:&quot;totalPages&quot;`</span></span><br><span class="line">TotalRecords <span class="type">int</span>        <span class="string">`json:&quot;totalRecords&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MailItem <span class="keyword">struct</span> &#123;</span><br><span class="line">ID          <span class="type">string</span>   <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">DateSent    <span class="type">string</span>   <span class="string">`json:&quot;dateSent&quot;`</span></span><br><span class="line">FromAddress <span class="type">string</span>   <span class="string">`json:&quot;fromAddress&quot;`</span></span><br><span class="line">ToAddresses []<span class="type">string</span> <span class="string">`json:&quot;toAddresses&quot;`</span></span><br><span class="line">Subject     <span class="type">string</span>   <span class="string">`json:&quot;subject&quot;`</span></span><br><span class="line">Body        <span class="type">string</span>   <span class="string">`json:&quot;body&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// toã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã®ãƒ¡ãƒ¼ãƒ«ã®å–ã‚Šå‡ºã—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReceiveMail</span><span class="params">(t *testing.T, host, to <span class="type">string</span>)</span></span> []MailItem &#123;</span><br><span class="line">t.Helper()</span><br><span class="line">u, err := url.Parse(host)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">u.Path = <span class="string">&quot;/mail&quot;</span></span><br><span class="line">q := url.Values&#123;&#125;</span><br><span class="line">q.Set(<span class="string">&quot;to&quot;</span>, to)</span><br><span class="line">u.RawQuery = q.Encode()</span><br><span class="line"></span><br><span class="line">res, err := http.Get(u.String())</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">d := json.NewDecoder(res.Body)</span><br><span class="line">r := MailSlurperResponse&#123;&#125;</span><br><span class="line">err = d.Decode(&amp;r)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> r.MailItems</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å–ã‚Šå‡ºã™ï¼ˆè£ã§ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æƒ…å ±å–å¾—ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReceivePassCode</span><span class="params">(t *testing.T, host, to <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">t.Helper()</span><br><span class="line">mails := ReceiveMail(t, host, to)</span><br><span class="line"></span><br><span class="line">p := regexp.MustCompile(<span class="string">`\d&#123;6&#125;`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, m := <span class="keyword">range</span> mails &#123;</span><br><span class="line"><span class="keyword">return</span> p.FindString(m.Body)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæˆã—ãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚çŸ­ãæ›¸ã‘ã¾ã™ã­ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> authcode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestValidate</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">secret := <span class="string">&quot;LB6BHGYD63JCWM4BBPHCSRBXGZYKGDI3&quot;</span> <span class="comment">// äº‹å‰ã«ä½œæˆã—ã¦ãŠã„ãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ</span></span><br><span class="line">    <span class="comment">// ã“ã‚Œã‹ã‚‰ä½œæˆã™ã‚‹ã€ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰é€ä¿¡å‡¦ç†</span></span><br><span class="line">err := SendPassCode(<span class="string">&quot;localhost:2500&quot;</span>, <span class="string">&quot;test user&quot;</span>, <span class="string">&quot;test@example.com&quot;</span>, secret)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">t.Errorf(<span class="string">&quot;error should be nil: %v&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">code := ReceivePassCode(t, <span class="string">&quot;http://localhost:8085&quot;</span>, <span class="string">&quot;test@example.com&quot;</span>)</span><br><span class="line">    <span class="comment">// ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</span></span><br><span class="line"><span class="keyword">if</span> !Validate(code, secret) &#123;</span><br><span class="line">t.Error(<span class="string">&quot;validation failed&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®<code>/mail</code>ã«<code>to</code>ã‚¯ã‚¨ãƒªãƒ¼ã‚’ã¤ã‘ã¦å¸°ã£ã¦ãã‚‹JSONã‚’ã„ã˜ã‚‹ã ã‘ãªã®ã§ã€ä»–ã®è¨€èªã§ã‚‚ã™ãã«å®Ÿè£…ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><h1 id="ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ãƒ¡ãƒ¼ãƒ«é€ä¿¡"><a href="#ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ãƒ¡ãƒ¼ãƒ«é€ä¿¡" class="headerlink" title="ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ãƒ¡ãƒ¼ãƒ«é€ä¿¡"></a>ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ãƒ¡ãƒ¼ãƒ«é€ä¿¡</h1><p>ç™»éŒ²æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆã‚µãƒ¼ãƒãƒ¼ã¯ã€åå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŠã‚ˆã³ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’çŸ¥ã£ã¦ã„ã‚‹ï¼‰ã«å¯¾ã—ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦é€ä¿¡ã—ã¾ã™ã€‚ãªãŠã€ãƒ¬ã‚¬ã‚·ãƒ¼ãªã‚‚ã‚ã‚‚ã‚ã®å¡Šã§ã‚ã‚‹ãƒ¡ãƒ¼ãƒ«ã§æ—¥æœ¬èªã‚’æ­£ã—ãé€ä¿¡ã™ã‚‹ã«ã‚ãŸã£ã¦ã¯ã€ä»¥ä¸‹ã®Qiitaè¨˜äº‹ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚</p><ul><li><a href="https://qiita.com/yamasaki-masahide/items/a9f8b43eeeaddbfb6b44">go ã§ utf8ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡</a></li></ul><p>ä¸Šè¨˜ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ãŸã®ãŒä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> authcode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/base64&quot;</span></span><br><span class="line"><span class="string">&quot;net/mail&quot;</span></span><br><span class="line"><span class="string">&quot;net/smtp&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/pquerna/otp/totp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šè¨˜ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‹ã‚‰ã€add76crlf, utf8Split, encodeSubjectã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã“ã¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ãƒ¡ãƒ¼ãƒ«ã®ä½œæˆ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenerateMessage</span><span class="params">(toUserName, toAddress, secret <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">from := mail.Address&#123;<span class="string">&quot;Myã‚µãƒ¼ãƒ“ã‚¹&quot;</span>, <span class="string">&quot;noreply@my-service.com&quot;</span>&#125;</span><br><span class="line">to := mail.Address&#123;toUserName, toAddress&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> msg bytes.Buffer</span><br><span class="line">msg.WriteString(<span class="string">&quot;From: &quot;</span> + from.String() + <span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">msg.WriteString(<span class="string">&quot;To: &quot;</span> + to.String() + <span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">msg.WriteString(encodeSubject(<span class="string">&quot;Myã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼ã‚³ãƒ¼ãƒ‰&quot;</span>))</span><br><span class="line">msg.WriteString(<span class="string">&quot;MIME-Version: 1.0\r\n&quot;</span>)</span><br><span class="line">msg.WriteString(<span class="string">&quot;Content-Type: text/plain; charset=\&quot;utf-8\&quot;\r\n&quot;</span>)</span><br><span class="line">msg.WriteString(<span class="string">&quot;Content-Transfer-Encoding: base64\r\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">code, err := totp.GenerateCode(secret, time.Now())</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> body bytes.Buffer</span><br><span class="line">body.WriteString(<span class="string">&quot;èªè¨¼ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã§ã™\n\n&quot;</span> + code + <span class="string">&quot;\n\nMyã‚µãƒ¼ãƒ“ã‚¹&quot;</span>)</span><br><span class="line">msg.WriteString(<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">msg.WriteString(add76crlf(base64.StdEncoding.EncodeToString(body.Bytes())))</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> msg.Bytes(), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ãƒ¡ãƒ¼ãƒ«é€ä¿¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendPassCode</span><span class="params">(host, toUserName, toAddress, secret <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">msg, err := GenerateMessage(toUserName, toAddress, secret)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">err = smtp.SendMail(</span><br><span class="line">host,</span><br><span class="line"><span class="literal">nil</span>,</span><br><span class="line"><span class="string">&quot;noreply@my-service.com&quot;</span>,</span><br><span class="line">[]<span class="type">string</span>&#123;toAddress&#125;,</span><br><span class="line">msg,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã•ã‚ŒãŸãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Validate</span><span class="params">(passcode, secret <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="keyword">return</span> totp.Validate(passcode, secret)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆã»ã©ã®ãƒ†ã‚¹ãƒˆã«å¯¾ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€æ­£ã—ããƒ†ã‚¹ãƒˆã‚’ãƒ‘ã‚¹ã—ã¾ã™ã€‚ç°¡å˜ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ä¼´ã†ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆãŒã§ãã¾ã—ãŸã€‚</p><h1 id="ãƒ†ã‚¹ãƒˆã®å¾Œå§‹æœ«"><a href="#ãƒ†ã‚¹ãƒˆã®å¾Œå§‹æœ«" class="headerlink" title="ãƒ†ã‚¹ãƒˆã®å¾Œå§‹æœ«"></a>ãƒ†ã‚¹ãƒˆã®å¾Œå§‹æœ«</h1><p>ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ç¶šã‘ã‚‹ã¨ã€ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã«ãƒ¡ãƒ¼ãƒ«ãŒæºœã¾ã‚Šç¶šã‘ã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ã‚’æ¶ˆè²»ã™ã‚‹é‡ã¯å¤§ã—ãŸã“ã¨ãŒãªã„ã¨ã¯ã„ãˆã€å¢—ãˆç¶šã‘ã‚‹ã®ã¯ç²¾ç¥è¡›ç”Ÿä¸Šè‰¯ããªã„ã§ã™ã€‚å¹¸ã„ã€MailSlurperã¯ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã®ãƒªã‚»ãƒƒãƒˆã‚‚APIã§æä¾›ã—ã¦ãã‚Œã¦ã„ã¾ã™ã®ã§ã€ãã‚Œã‚’ä½¿ã£ã¦ã¿ã¾ã™ã€‚</p><p>ã¾ãšã¯å…ˆã»ã©ã®ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ãƒªã‚»ãƒƒãƒˆã®é€ä¿¡ã‚’è¡Œã†ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ResetMailSlumper</span><span class="params">(host <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">u, err := url.Parse(host)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">u.Path = <span class="string">&quot;/mail&quot;</span></span><br><span class="line"></span><br><span class="line">req, _ := http.NewRequest(<span class="string">&quot;DELETE&quot;</span>, u.String(), strings.NewReader(<span class="string">`&#123;&quot;pruneCode&quot;: &quot;all&quot;&#125;`</span>))</span><br><span class="line">req.Header.Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">http.DefaultClient.Do(req)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œå‰ã«ãƒªã‚»ãƒƒãƒˆã‚’å‘¼ã¶ã‚ˆã†ã«ã—ã¾ã™ã€‚å¾Œå§‹æœ«ã ã¨ã€å®Ÿè¡Œå¾Œã®æ–¹ãŒè‡ªç„¶ã«æ€ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãƒ†ã‚¹ãƒˆã®ãƒªã‚½ãƒ¼ã‚¹ã®ãƒªã‚»ãƒƒãƒˆã‚’å¾Œã«ã—ã¦ã—ã¾ã†ã¨ã€å•é¡Œç™ºç”Ÿæ™‚ã«çµæœã‚’è¿½ã„ã‹ã‘ã‚‹ã®ãŒå¤§å¤‰ã«ãªã‚‹ãŸã‚ã€åƒ•ã¯å…¨ä½“ã®å®Ÿè¡Œå‰ã«ã‚¯ãƒªã‚¢ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMain</span><span class="params">(m *testing.M)</span></span> &#123;</span><br><span class="line">ResetMailSlumper(<span class="string">&quot;http://localhost:8085&quot;</span>)</span><br><span class="line">code := m.Run()</span><br><span class="line">os.Exit(code)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>ã“ã‚Œã§å®ŸSMTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã€ãã‚Œã‚’MailSlurperã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã—ãŸã€‚REST APIã®ãŠã‹ã’ã§ã€ãƒ˜ãƒ«ãƒ‘ãƒ¼ã•ãˆç”¨æ„ã—ã¦ã—ã¾ãˆã°ã€ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã®ã¯ç°¡å˜ã§ã™ã€‚</p><p>ã“ã‚Œã ã‘ä½¿ã„ã‚„ã™ã„ã¨ãªã‚‹ã¨ã€éåŒæœŸé€šä¿¡ç³»ã¯å…¨éƒ¨SMTPã«å¯„ã›ãŸããªã£ã¦ãã‚‹æ°—ã‚‚ã—ã¾ã™ã€‚ã¾ã‚æœ¬ç•ªç’°å¢ƒã®å®‰å®šç¨¼åƒã‚’è€ƒãˆã‚‹ã¨å®Ÿéš›ã«ã‚„ã‚‹ã“ã¨ã¯ãªã„ã§ã™ãŒã€MailSlurperã¯é€ä¿¡çµæœã‚’è¦‹ã‚‹ã®ã‚‚ã§ãã¦ã€é–‹ç™ºä½“é¨“ã¯ã‹ãªã‚Šè‰¯ã„ã§ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;ä»¥å‰ã€èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®hankoã®ç´¹ä»‹ã®ä¸­ã§ã€hankoãŒãƒ†ã‚¹ãƒˆã§ä½¿ã£ã¦ã„ã‚‹MailSlurperã¨ã„ã†ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ãŒé¢ç™½ã„ã¨ã„ã†ç´¹ä»‹ã‚’ã—ã¾ã—ãŸã€‚&lt;/p&gt;
&lt;p&gt;&lt;a</summary>
        
      
    
    
    
    <category term="Infrastructure" scheme="https://future-architect.github.io/categories/Infrastructure/"/>
    
    
    <category term="Go" scheme="https://future-architect.github.io/tags/Go/"/>
    
    <category term="MailSlurper" scheme="https://future-architect.github.io/tags/MailSlurper/"/>
    
    <category term="TOTP" scheme="https://future-architect.github.io/tags/TOTP/"/>
    
    <category term="ãƒ¡ãƒ¼ãƒ«" scheme="https://future-architect.github.io/tags/%E3%83%A1%E3%83%BC%E3%83%AB/"/>
    
  </entry>
  
  <entry>
    <title>VPC Service Controlã§Google Cloudç’°å¢ƒã‚’ã‚¬ãƒƒãƒãƒªå®ˆã‚‹</title>
    <link href="https://future-architect.github.io/articles/20230119a/"/>
    <id>https://future-architect.github.io/articles/20230119a/</id>
    <published>2023-01-18T15:00:00.000Z</published>
    <updated>2023-01-19T02:55:50.208Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h2><p>ã“ã‚“ã«ã¡ã¯ã€æœ¬è¨˜äº‹ã§ã¯Google Cloudã®VPC Service Controlsã‚’åˆ©ç”¨ã—ã¦ã€ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’è¡Œã†æ–¹æ³•ã«ã¤ã„ã¦Terraformã‚³ãƒ¼ãƒ‰ä»˜ãã§ç´¹ä»‹ã—ã¦ã„ããŸã¾ã™ã€‚</p><p>æ˜¨ä»Šã§ã¯ã€å€‹äººæƒ…å ±æ¼æ´©ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒå°½ãã¾ã›ã‚“ã€‚å°‘ã—å¤ã„ãƒ‡ãƒ¼ã‚¿ã§ã¯ã‚ã‚Šã¾ã™ãŒã€2012å¹´ï½2021å¹´ã«æ¼æ´©ãƒ»ç´›å¤±ã—ãŸå¯èƒ½æ€§ã®ã‚ã‚‹å€‹äººæƒ…å ±ã¯ç´¯è¨ˆã§1å„„1979ä¸‡äººåˆ†ã«ã®ã¼ã‚Šã€2022å¹´ã‚’å«ã‚ã‚‹ã¨ã‚‚ã£ã¨å¤šããªã‚Šãã†ã§ã™ã€‚<br><a href="https://webtan.impress.co.jp/n/2022/03/22/42500#:~:text=%E6%9D%B1%E4%BA%AC%E5%95%86%E5%B7%A5%E3%83%AA%E3%82%B5%E3%83%BC%E3%83%81%E3%81%AF%E3%80%812021,%E3%82%82%E6%9C%80%E5%A4%9A%E8%A8%98%E9%8C%B2%E3%81%A0%E3%81%A8%E3%81%84%E3%81%86%E3%80%82">å€‹äººæƒ…å ±æ¼ãˆã„ã€10å¹´é–“ã§æ—¥æœ¬ã®äººå£ã¨ã»ã¼åŒã˜äººæ•°åˆ†ãŒä¸Šå ´ä¼æ¥­ã‹ã‚‰æµå‡ºãƒ»ç´›å¤±ã€æ±äº¬å•†å·¥ãƒªã‚µãƒ¼ãƒèª¿ã¹ã€‘</a></p><p>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‚’èµ·ã“ã•ãªã„ãŸã‚ã«ã‚‚ã€åŸºæœ¬çš„ã«ã¯ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ‹’å¦ã—ã€ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹äººã‚’çµã£ã¦ç©´ã‚ã‘ã™ã‚‹ãªã©ã€ã—ã£ã‹ã‚Šã¨ãƒ‡ãƒ¼ã‚¿ã‚’å®ˆã£ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ãã‚“ãªè¦æ±‚ã«ç­”ãˆã‚‹ã®ãŒVPC Service Controlsã«ãªã‚Šã¾ã™ã€‚</p><h2 id="VPC-Service-Controlsã¨ã¯"><a href="#VPC-Service-Controlsã¨ã¯" class="headerlink" title="VPC Service Controlsã¨ã¯"></a>VPC Service Controlsã¨ã¯</h2><p><a href="https://cloud.google.com/vpc-service-controls/docs/overview?hl=ja">VPC Service Controlsã®æ¦‚è¦</a></p><p>VPC Service Controlsã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€Google Cloudã®ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¢ƒç•Œã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>ä¾‹ãˆã°ã€BigQueryã‚„Cloud Storageã«å€‹äººã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹æƒ…å ±ï¼ˆä¾‹ï¼šèº«é•·ã€ä½“é‡ã€æ€§åˆ¥ã€å¹´é½¢ï¼‰ã‚„ç”»åƒãŒç½®ã‹ã‚Œã¦ã„ã‚‹å ´åˆã€VPC Service Controlsã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§<strong>ãã‚Œã‚‰ã®ãƒªã‚½ãƒ¼ã‚¹ã«é™ã‚‰ã‚ŒãŸäººé–“ã®ã¿ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½</strong>ã¨ãªã‚Šã¾ã™ã€‚</p><p>ã¾ãŸå¢ƒç•Œã®å†…å¤–ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ç§»å‹•ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒå¯èƒ½ãªãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ãŒå¢ƒç•Œã®å¤–ã¸æŒã¡å‡ºã•ã‚Œã‚‹ã“ã¨ã‚‚é˜²ãã¾ã™ï¼ˆå¢ƒç•Œã‚’è¶…ãˆã‚‹é€šä¿¡ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã™ï¼‰ã€‚</p><img src="/images/20230119a/a864e1b2-7cd3-c69c-bf63-fe2b21622b6d.png" alt="" width="1200" height="640" loading="lazy"><p>ã“ã¡ã‚‰ã®ç”»åƒã®ã‚ˆã†ã«ã€å¢ƒç•Œï¼ˆService Perimeterï¼‰å†…ã«å­˜åœ¨ã™ã‚‹BigQueryã¯èªè¨¼ã•ã‚ŒãŸVPCã€VMï¼ˆGCEï¼‰ã‹ã‚‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã¨ãªã‚Šã€èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ã¯å¢ƒç•Œå†…ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ»å¢ƒç•Œå¤–ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å…±ã«åˆ¶é™ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p><p>ç¾åœ¨ã€VPC Service ControlsãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€è¦§ã¯ã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚<br><a href="https://cloud.google.com/vpc-service-controls/docs/supported-products?hl=ja">VPC Service Controlã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¨åˆ¶é™äº‹é …</a></p><h3 id="Cloud-IAMã¨ã¯é•ã†ã®ï¼Ÿ"><a href="#Cloud-IAMã¨ã¯é•ã†ã®ï¼Ÿ" class="headerlink" title="Cloud IAMã¨ã¯é•ã†ã®ï¼Ÿ"></a>Cloud IAMã¨ã¯é•ã†ã®ï¼Ÿ</h3><p>Cloud IAMã‚‚ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã€<strong>è©³ç´°ãªIDãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’ä¸»</strong>ã¨ã—ã¦ã„ã¾ã™ã€‚IDãƒ™ãƒ¼ã‚¹ãªã®ã§ä¾‹ãˆã°ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€æ‰€å±ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã©ã‚’åŸºã«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚</p><p>VPC Service Controlsã¯ãã‚Œã«åŠ ãˆã¦ã€å¢ƒç•Œå…¨ä½“ã¸ã®ä¸Šã‚Šï¼ˆIngressï¼‰ãƒ»ä¸‹ã‚Šï¼ˆEgressï¼‰ãƒ‡ãƒ¼ã‚¿ã®åˆ¶å¾¡ãªã©ã€<strong>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®å¢ƒç•Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒå¯èƒ½</strong>ã¨ãªã‚Šã¾ã™ã€‚</p><p>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã¯ã€ä¾‹ãˆã°ã€Œã©ã“ï¼ˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã€ã€ã€Œã ã‚Œï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€<strong>ã‚°ãƒ«ãƒ¼ãƒ—ã¯ç¾åœ¨ä¸å¯</strong>ï¼‰ã€ã€ã€Œä½•ã§ï¼ˆOSï¼‰ã€ãªã©ã‚¢ã‚¯ã‚»ã‚¹å…ƒã®èƒŒæ™¯ã‹ã‚‰ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å¯å¦ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚</p><p>ã©ã¡ã‚‰ãŒè‰¯ã„ãƒ»æ‚ªã„ã¨ã„ã†ã®ã¯ç„¡ãã€ä½µç”¨ã™ã‚‹ã“ã¨ã§ã‚ˆã‚Šå¼·å›ºãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ç¯‰ãã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚</p><h2 id="BigQueryã‚’ä½¿ã£ã¦æŒ™å‹•ã‚’ç¢ºèª"><a href="#BigQueryã‚’ä½¿ã£ã¦æŒ™å‹•ã‚’ç¢ºèª" class="headerlink" title="BigQueryã‚’ä½¿ã£ã¦æŒ™å‹•ã‚’ç¢ºèª"></a>BigQueryã‚’ä½¿ã£ã¦æŒ™å‹•ã‚’ç¢ºèª</h2><h3 id="Organizationã®è¨­å®šãŒå¿…è¦"><a href="#Organizationã®è¨­å®šãŒå¿…è¦" class="headerlink" title="Organizationã®è¨­å®šãŒå¿…è¦"></a>Organizationã®è¨­å®šãŒå¿…è¦</h3><p>VPC Service Controlã‚’å§‹ã‚ã‚‹ã«ã¯OrganizationãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚Organizationã®è¨­å®šã«ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå¿…è¦ã¨ãªã‚‹ãŸã‚ã€Google Domainãªã©ã§å–å¾—ã™ã‚‹ï¼ˆå¹´é–“1200å††ï½ï¼‰å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚‚ã—ã€æ—¢ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ãŠæŒã¡ã®å ´åˆã¯ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½œã£ã¦ã€ãã‚Œã‚’Organizationã¸é©ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚</p><p>Organizationã®ä½œæˆæ–¹æ³•ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã™ã‚‹ã¨ã‚ˆã„ã§ã™ã€‚<br><a href="https://qiita.com/suzuyui/items/947867f52897417ee31b#1-%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E5%8F%96%E5%BE%97">GCP ã§çµ„ç¹”ã‚’ä½œæˆã—ã¦å…±æœ‰ VPC æ§‹ç¯‰ - 1.ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—</a></p><h3 id="ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹"><a href="#ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹" class="headerlink" title="ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹"></a>ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹</h3><p>ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã¯ã€ä»¥å¾Œå‡ºã¦ãã‚‹ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚„ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œãªã©ã€å…¨ã¦ã®Access Context Managerãƒªã‚½ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒ†ãƒŠï¼ˆç®±ï¼‰ã§ã™ã€‚</p><p>Organizationã«å¯¾ã—ã¦Organizationãƒ¬ãƒ™ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã—ã€çµ„ç¹”å†…ã®ãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã‚¹ã‚³ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚</p><figure class="highlight sh"><figcaption><span>access_context_manager_access_policy.tf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resource <span class="string">&quot;google_access_context_manager_access_policy&quot;</span> <span class="string">&quot;access_policy&quot;</span> &#123;</span><br><span class="line">  parent = <span class="string">&quot;organizations/1234567890123&quot;</span></span><br><span class="line">  title  = <span class="string">&quot;Test access policy&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>parent</code>ã«ã¯è‡ªèº«ã®Organization IDã‚’å…¥åŠ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€<code>title</code>ãŒOrganizationã®ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã®åå‰ã¨ãªã‚Šã¾ã™ã€‚</p><p>ä½œæˆã™ã‚‹ã¨ã€Organizationâ†’ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£â†’VPC Service Controlsä¸Šã«ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚</p><img src="/images/20230119a/d0b0a574-e85f-3509-49bc-263a2ec8b6f5.jpeg" alt="" width="1120" height="334" loading="lazy"><h3 id="IDåˆ¶å¾¡ã‚’ã‚„ã£ã¦ã¿ã‚‹"><a href="#IDåˆ¶å¾¡ã‚’ã‚„ã£ã¦ã¿ã‚‹" class="headerlink" title="IDåˆ¶å¾¡ã‚’ã‚„ã£ã¦ã¿ã‚‹"></a>IDåˆ¶å¾¡ã‚’ã‚„ã£ã¦ã¿ã‚‹</h3><p>IDåˆ¶å¾¡ã‚’è¡Œã£ã¦ã¿ã¾ã™ã€‚<br>é€šå¸¸ã¯ç”»åƒã®ã‚ˆã†ã«BigQueryã®Dataset, tableã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><img src="/images/20230119a/da83249a-b466-c2eb-8ea7-9e5fe5e9abfc.jpeg" alt="" width="894" height="396" loading="lazy"><p>ã“ã‚Œã«å¯¾ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªBigQueryã¸ã®å†…å‘ãã®ã¿ã‚’è¨±å¯ã—ãŸã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‚’è¨­å®šã—ã¦ã¿ã¾ã™ã€‚</p><img src="/images/20230119a/755d759c-cde1-42d1-c0c4-e62dc1425a89.png" alt="" width="930" height="348" loading="lazy"><h4 id="ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½œæˆã™ã‚‹"><a href="#ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½œæˆã™ã‚‹" class="headerlink" title="ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½œæˆã™ã‚‹"></a>ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½œæˆã™ã‚‹</h4><p><a href="https://cloud.google.com/access-context-manager/docs/overview#access-levels">ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«</a>ã§ã¯ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹æ¡ä»¶ã‚’å®šç¾©ã—ã¾ã™ã€‚<br>ä¾‹ãˆã°ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„IDï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰ã‚’ç”¨ã„ãŸã‚¢ã‚¯ã‚»ã‚¹æ¡ä»¶ã‚’<code>AND</code>ã‚„<code>OR</code>ã‚’ä½¿ã£ã¦å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã®æ¡ä»¶ã«é©ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ãŒãƒªã‚½ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚<br>Terraformã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</p><figure class="highlight sh"><figcaption><span>access_context_manager_access_level.tf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">resource <span class="string">&quot;google_access_context_manager_access_level&quot;</span> <span class="string">&quot;id&quot;</span> &#123;</span><br><span class="line">  parent = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>&quot;</span></span><br><span class="line">  name   = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>/accessLevels/specified_id&quot;</span></span><br><span class="line">  title  = <span class="string">&quot;Specified ID&quot;</span></span><br><span class="line"></span><br><span class="line">  basic &#123;</span><br><span class="line">    conditions &#123;</span><br><span class="line">      // ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹æ¡ä»¶</span><br><span class="line">      // ã“ã“ã§æ°—ã‚’ä»˜ã‘ãŸã„ã®ãŒã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å‰ã«user:ã‚’ã¤ã‘ã‚‹ã“ã¨</span><br><span class="line">      // ServiceAccountã®å ´åˆã¯serviceAccount:&#123;emailid&#125;</span><br><span class="line">      // ã¾ãŸã€ã‚°ãƒ«ãƒ¼ãƒ—ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„</span><br><span class="line">      members = [</span><br><span class="line">        <span class="string">&quot;user:xxx@yyy.com&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‚’ä½œæˆã™ã‚‹"><a href="#ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‚’ä½œæˆã™ã‚‹" class="headerlink" title="ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‚’ä½œæˆã™ã‚‹"></a>ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‚’ä½œæˆã™ã‚‹</h4><p>VPC Service Controlsã®ä¸»å½¹ã§ã™ã€‚æŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ã‹ã‚‰ä¿è­·ã™ã‚‹ãŸã‚ã®å¢ƒç•Œã‚’ä½œã‚Šã¾ã™ã€‚</p><p>ä»¥ä¸‹ã®ã‚ˆã†ã«Terraformã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã€ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‚’ä½œæˆã—ã¾ã™ã€‚</p><figure class="highlight sh"><figcaption><span>access_context_manager_service_perimeters.tf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">resource <span class="string">&quot;google_access_context_manager_service_perimeter&quot;</span> <span class="string">&quot;service_perimeter_qiita&quot;</span> &#123;</span><br><span class="line">  parent = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>&quot;</span></span><br><span class="line">  name   = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>/servicePerimeters/restrict_bigquery&quot;</span></span><br><span class="line">  title  = <span class="string">&quot;restrict_bigquery&quot;</span></span><br><span class="line">  status &#123;</span><br><span class="line">    // å¢ƒç•Œã‚’ä½œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ—æŒ™ã™ã‚‹</span><br><span class="line">    restricted_services = [</span><br><span class="line">      <span class="string">&quot;bigquery.googleapis.com&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    // å¢ƒç•Œã‚’ä½œã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</span><br><span class="line">    resources = [</span><br><span class="line">      <span class="string">&quot;projects/123456789012&quot;</span> // Project IDã§æŒ‡å®šã™ã‚‹</span><br><span class="line">    ]</span><br><span class="line">    // ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«</span><br><span class="line">    access_levels = [</span><br><span class="line">      google_access_context_manager_access_level.access_level_id.name</span><br><span class="line">    ]</span><br><span class="line">    // å†…å‘ããƒãƒªã‚·ãƒ¼</span><br><span class="line">    ingress_policies &#123;</span><br><span class="line">      ingress_from &#123;</span><br><span class="line">        // IDã‚¿ã‚¤ãƒ—ã¯identitiesã§æŒ‡å®šã™ã‚‹ãŸã‚ã€UNSPECIFIEDã«ãªã‚‹</span><br><span class="line">        identity_type = <span class="string">&quot;IDENTITY_TYPE_UNSPECIFIED&quot;</span></span><br><span class="line">        // å†…å‘ãå…ƒã®ID</span><br><span class="line">        identities = [</span><br><span class="line">          <span class="string">&quot;user:xxx@yyy.com&quot;</span> // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æŒ‡å®šã™ã‚‹</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">      ingress_to &#123;</span><br><span class="line">        // å¢ƒç•Œå†…ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å†…ã€ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</span><br><span class="line">        resources = [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">        // è¨±å¯ã™ã‚‹æ“ä½œ</span><br><span class="line">        operations &#123;</span><br><span class="line">          service_name = <span class="string">&quot;bigquery.googleapis.com&quot;</span></span><br><span class="line">          // è¨±å¯ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆAPIï¼‰ã‚’æŒ‡å®šã™ã‚‹</span><br><span class="line">          // ä»Šå›ã¯å…¨ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ãŸã‚ã€*ã«ãªã£ã¦ã„ã‚‹</span><br><span class="line">          method_selectors &#123;</span><br><span class="line">            method = <span class="string">&quot;*&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã®<code>members</code>ã€ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã®<code>ingress_from</code>ã®<code>identities</code>ã€ã©ã¡ã‚‰ã‚‚ID<code>&quot;user:xxx@yyy.com&quot;</code>ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚</p><p>ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«å´ã§ã¯<code>restricted_services</code>å…¨ä½“ã«å¯¾ã—ã¦ã®åˆ¶å¾¡ã«ãªã‚Šã¾ã™ã€‚ä»Šå›ã¯BigQueryã®ã¿ã—ã‹å…¥ã£ã¦ãŠã‚Šã¾ã›ã‚“ãŒã€Cloud Storageãªã©ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹å…¥ã‚Œã‚‹ã“ã¨ãŒã§ãã€<code>restricted_services</code>ã«å…¥ã£ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹å…¨ã¦ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«å´ã§ã®<code>members</code>è¨­å®šãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«å´ã§è¨±å¯ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯Ingress&#x2F;Egressä¸¡æ–¹ã®æ“ä½œãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚</p><p>ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œå´ã®<code>identities</code>ã¯Terraformã‚³ãƒ¼ãƒ‰ã®æ§‹æˆã‚’è¦‹ã‚‹ã¨ã‚ã‹ã‚‹ã‚ˆã†ã«ã€å†…å‘ãï¼ˆIngressï¼‰ãƒ»å¤–å‘ãï¼ˆEgressï¼‰ã§ã€å°šä¸”ã¤APIæ¯ã§é©ç”¨ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã§ã™ã‚ŠæŠœã‘ãŸå ´åˆã«Ingress&#x2F;Egressã§ã®ãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚</p><p>ä»Šå›ã®å ´åˆã ã¨BigQueryã®ã¿ã—ã‹ãªã„ã®ã§<code>identities</code>ã®æŒ‡å®šã¯ä¸è¦ã§ã™ãŒã€å‚è€ƒã®ãŸã‚ã«è¨˜è¼‰ã—ã¦ãŠã‚Šã¾ã™ã€‚</p><h4 id="èªè¨¼ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹"><a href="#èªè¨¼ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹" class="headerlink" title="èªè¨¼ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹"></a>èªè¨¼ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹</h4><p>ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã§è¨±å¯ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§BigQueryã‚’è¦‹ã¦ã¿ã‚‹ã¨å…ˆã»ã©ã¨åŒã˜ã‚ˆã†ã«ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p><img src="/images/20230119a/da83249a-b466-c2eb-8ea7-9e5fe5e9abfc_2.jpeg" alt="" width="894" height="396" loading="lazy"><p>æ¬¡ã«èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚</p><img src="/images/20230119a/7f3f9c23-2e49-3aea-acaa-2e29d774582b.jpeg" alt="" width="1200" height="223" loading="lazy"><p>å³ä¸Šã«èµ¤å­—ã§<code>VPC Service Controls: Request is prohibited by organization&#39;s policy. vpcServiceControlsUniqueIdentifier: -ZWUwU96cNc6_jcWbyKhbCfz9canAZcNkQjPcb4uEhOY00WbG64xVw.</code>ã¨è¡¨ç¤ºã•ã‚Œã€ã‚¯ã‚¨ãƒªãŒå®Ÿè¡Œã§ããªããªã£ã¦ã„ã¾ã™ã€‚<br>ã“ã¡ã‚‰ã®åŸå› ã¨ã—ã¦ã¯ä»Šå›å†…å‘ãï¼ˆIngressï¼‰ã®ã¿ã—ã‹è¨±å¯ã—ã¦ã„ãªã‹ã£ãŸãŸã‚ã€ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œå¤–ã¸ã®ãƒ‡ãƒ¼ã‚¿æŒã¡å‡ºã—ãŒæ‹’å¦ã•ã‚ŒãŸã“ã¨ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚</p><img src="/images/20230119a/fbf4eb92-8842-ec33-9104-afeec96066bd.png" alt="" width="816" height="280" loading="lazy"><h5 id="å°‘ã—å¯„ã‚Šé“ï¼šãƒãƒªã‚·ãƒ¼é•åã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"><a href="#å°‘ã—å¯„ã‚Šé“ï¼šãƒãƒªã‚·ãƒ¼é•åã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°" class="headerlink" title="å°‘ã—å¯„ã‚Šé“ï¼šãƒãƒªã‚·ãƒ¼é•åã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"></a>å°‘ã—å¯„ã‚Šé“ï¼šãƒãƒªã‚·ãƒ¼é•åã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h5><p>ãƒãƒªã‚·ãƒ¼é•åã®ç†ç”±ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€Google Cloudã§ã¯VPC Service Controls ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚<br><a href="https://cloud.google.com/vpc-service-controls/docs/troubleshooter?hl=ja">VPC Service Controls ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã‚‹å•é¡Œã®è¨ºæ–­</a></p><p>ä¸Šè¨˜ã®ã‚ˆã†ã«ãƒãƒªã‚·ãƒ¼é•åãŒç™ºç”Ÿã—ãŸéš›ã€<code>vpcServiceControlsUniqueIdentifier:</code>ä»¥é™ã®æ–‡å­—åˆ—ã‚’VPC Service Controls ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å…¥åŠ›ã™ã‚‹ã¨é•åç†ç”±ãŒç¢ºèªã§ãã¾ã™ã€‚</p><img src="/images/20230119a/b666ebc4-5fc7-cfee-b484-e523c7d96640.png" alt="" width="823" height="663" loading="lazy"><p>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¡Œã‚ã‚ŒãŸå‹•ä½œã¨é•åç†ç”±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p><img src="/images/20230119a/0e0f69b8-fb59-c4a1-12b4-bb8e739f200f.png" alt="" width="949" height="463" loading="lazy">ä¸Šè¨˜ã®ãƒãƒªã‚·ãƒ¼é•åç†ç”±ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œå¤–ã§`tables.getData`ãŒè¡Œã‚ã‚ŒãŸã“ã¨ãŒåŸå› ã®ã‚ˆã†ã§ã™ã€‚ã¾ãŸã€ã“ã®ã“ã¨ã‹ã‚‰ã‚¯ã‚¨ãƒªå®Ÿè¡Œã®éš›ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®è£å´ã§ã¯APIï¼ˆ`tables.getData`ï¼‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‹ã‚Šã¾ã™ã€‚<h4 id="èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹"><a href="#èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹" class="headerlink" title="èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹"></a>èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹</h4><p>ã¾ãŸã€èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p><img src="/images/20230119a/898b2891-6500-d523-2d73-a9ea1c6c24e4.png" alt="" width="1200" height="287" loading="lazy"><p>ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã™ã‚‰è¦‹ãˆãšã€ã‚¯ã‚¨ãƒªã‚’æ‰“ã¨ã†ã¨ã™ã‚‹ã¨å³ä¸Šã«èµ¤å­—ã§<code>VPC Service Controls: Request is prohibited by organization&#39;s policy.</code>ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚</p><img src="/images/20230119a/263efca8-74e1-8ad3-3501-b668c6e69473.png" alt="" width="777" height="331" loading="lazy"><p>èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§<code>bq</code>ã‚³ãƒãƒ³ãƒ‰ã§ã‚‚åŒæ§˜ã«ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ bq query --use_legacy_sql=<span class="literal">false</span> --project_id &lt;YOUR_PROJECT_ID&gt;  <span class="string">&#x27;select worker_id from `****-service-three.svc3_dataset.test_table`&#x27;</span></span><br><span class="line"></span><br><span class="line">BigQuery error <span class="keyword">in</span> query operation: VPC Service Controls: Request is prohibited by organization<span class="string">&#x27;s policy.</span></span><br><span class="line"><span class="string">vpcServiceControlsUniqueIdentifier: ***.</span></span><br></pre></td></tr></table></figure><p><code>bq</code>ã‚³ãƒãƒ³ãƒ‰ã§ã‚‚ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚<br>ä»¥ä¸Šã‚ˆã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•ŒãŒä½œã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚</p><h3 id="IPåˆ¶å¾¡ã‚’åŠ ãˆã¦ã¿ã‚‹"><a href="#IPåˆ¶å¾¡ã‚’åŠ ãˆã¦ã¿ã‚‹" class="headerlink" title="IPåˆ¶å¾¡ã‚’åŠ ãˆã¦ã¿ã‚‹"></a>IPåˆ¶å¾¡ã‚’åŠ ãˆã¦ã¿ã‚‹</h3><p>ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã«GCEã®VMã«ä»˜ä¸ã•ã‚ŒãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ã€å…ˆã»ã©ã¨åŒæ§˜ã®ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‚’ä½œæˆã—ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">resource <span class="string">&quot;google_access_context_manager_access_level&quot;</span> <span class="string">&quot;id_and_ip&quot;</span> &#123;</span><br><span class="line">  parent = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>&quot;</span></span><br><span class="line">  name   = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>/accessLevels/specified_id_and_ip&quot;</span></span><br><span class="line">  title  = <span class="string">&quot;Specified ID and IP&quot;</span></span><br><span class="line"></span><br><span class="line">  basic &#123;</span><br><span class="line">    <span class="comment"># combining_functionã§å„æ¡ä»¶ã®çµ„ã¿åˆã‚ã›æ¡ä»¶ã‚’æŒ‡å®šã™ã‚‹</span></span><br><span class="line">    <span class="comment"># ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ANDã«ãªã‚‹</span></span><br><span class="line">    combining_function = <span class="string">&quot;AND&quot;</span></span><br><span class="line">    conditions &#123;</span><br><span class="line">      members = [</span><br><span class="line">        <span class="string">&quot;user:xxx@yyy.com&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">    conditions &#123;</span><br><span class="line">      ip_subnetworks = [</span><br><span class="line">        <span class="string">&quot;xx.xx.xx.xx/32&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆã»ã©ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã ã£ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰Google Cloudã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®BigQueryã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚<br><img src="/images/20230119a/77f9a4f8-2a73-f0d1-400a-e306ffb1b765.png" alt="" width="1200" height="123" loading="lazy"></p><p>ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã£ãŸã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚</p><img src="/images/20230119a/9de770bd-ea00-9238-2464-906a4bc2561a.png" alt="" width="795" height="320" loading="lazy"><p>æ¬¡ã«æŒ‡å®šã•ã‚ŒãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®VMã«èªè¨¼æ¸ˆã¿ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§<code>gcloud auth login</code>ã—ã¦ã‹ã‚‰<code>bq</code>ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦ã¿ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bq query --use_legacy_sql=<span class="literal">false</span> --project_id &lt;YOUR_PROJECT_ID&gt;  <span class="string">&#x27;select worker_id from `****-service-three.svc3_dataset.test_table`&#x27;</span></span><br><span class="line">+-----------+</span><br><span class="line">| worker_id |</span><br><span class="line">+-----------+</span><br><span class="line">|         1 |</span><br><span class="line">|         4 |</span><br><span class="line">|         3 |</span><br><span class="line">|         5 |</span><br><span class="line">|         2 |</span><br><span class="line">+-----------+</span><br></pre></td></tr></table></figure><p>ç„¡äº‹ã«ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚</p><img src="/images/20230119a/27b0c988-2a46-cf62-d7c1-910a171c2e00.png" alt="" width="925" height="338" loading="lazy"><p>ã“ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã§ã¯å€‹ã€…ã®IPã‚„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åˆ©ç”¨ã—ãŸç´°ã‹ã„åˆ¶å¾¡ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚<br>ä»–ã«ã‚‚OSã®æŒ‡å®šï¼ˆæœ‰æ–™ï¼‰ã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ­ãƒƒã‚¯ã‚’è¦æ±‚ã™ã‚‹ãªã©ã‚’è¨­å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚</p><h2 id="å¿œç”¨ç·¨"><a href="#å¿œç”¨ç·¨" class="headerlink" title="å¿œç”¨ç·¨"></a>å¿œç”¨ç·¨</h2><h3 id="Service-Perimeterã§å®ˆã‚‰ã‚ŒãŸ2ã¤ã®BigQueryé–“ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’JOINã™ã‚‹"><a href="#Service-Perimeterã§å®ˆã‚‰ã‚ŒãŸ2ã¤ã®BigQueryé–“ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’JOINã™ã‚‹" class="headerlink" title="Service Perimeterã§å®ˆã‚‰ã‚ŒãŸ2ã¤ã®BigQueryé–“ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’JOINã™ã‚‹"></a>Service Perimeterã§å®ˆã‚‰ã‚ŒãŸ2ã¤ã®BigQueryé–“ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’JOINã™ã‚‹</h3><p>2ã¤ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”¨æ„ã—ã€å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ç”¨æ„ã—ã¾ã™ã€‚</p><figure class="highlight bash"><figcaption><span>ProjectA</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+-----------------+</span><br><span class="line">| department_id | department_name |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">|             3 | HR              |</span><br><span class="line">|             1 | Engineer        |</span><br><span class="line">|             5 | Marketing       |</span><br><span class="line">|             4 | BackOffice      |</span><br><span class="line">|             2 | Sales           |</span><br><span class="line">+---------------+-----------------+</span><br></pre></td></tr></table></figure><figure class="highlight bash"><figcaption><span>ProjectA</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----------+-----------+-----+---------------+</span><br><span class="line">| worker_id |   name    | age | department_id |</span><br><span class="line">+-----------+-----------+-----+---------------+</span><br><span class="line">|         1 | Tanaka    |  23 |             1 |</span><br><span class="line">|         4 | Kobayashi |  28 |             2 |</span><br><span class="line">|         3 | Yamada    |  56 |             2 |</span><br><span class="line">|         5 | Suzuki    |  44 |             3 |</span><br><span class="line">|         2 | Sasaki    |  34 |             5 |</span><br><span class="line">+-----------+-----------+-----+---------------+</span><br></pre></td></tr></table></figure><p>ãã—ã¦ã€ãã‚Œãã‚Œã®BigQueryã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ¥ã®ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã§å®ˆã‚Šã¾ã™ã€‚</p><img src="/images/20230119a/34000be3-c373-0fe1-47b6-fdae7b41ec73.png" alt="" width="1078" height="374" loading="lazy"><p>ã§ã¯ã“ã®æ™‚ã€ã©ã®ã‚ˆã†ã«Ingree&#x2F;Egressã‚’è¨­å®šã™ã‚Œã°ã‚ˆã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ<br>æ­£è§£ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><img src="/images/20230119a/e43ce7a0-2d0e-6e65-a572-88d487eacd7b.png" alt="" width="928" height="489" loading="lazy"><p>ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã«ã¯å…ˆã»ã©ã¨åŒæ§˜ã®IDã¨IPã§æŒ‡å®šã—ãŸã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’åˆ©ç”¨ã—ã€ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã®Terraformã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight sh"><figcaption><span>perimeter_project_a.tf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">resource <span class="string">&quot;google_access_context_manager_service_perimeter&quot;</span> <span class="string">&quot;projecta_perimeter&quot;</span> &#123;</span><br><span class="line">  parent = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>&quot;</span></span><br><span class="line">  name   = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>/servicePerimeters/projecta&quot;</span></span><br><span class="line">  title  = <span class="string">&quot;ProjectA&quot;</span></span><br><span class="line">  status &#123;</span><br><span class="line">    restricted_services = [</span><br><span class="line">      <span class="string">&quot;bigquery.googleapis.com&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    resources = [</span><br><span class="line">      <span class="string">&quot;projects/111111111111&quot;</span>, <span class="comment"># ProjectA</span></span><br><span class="line">    ]</span><br><span class="line">    access_levels = [</span><br><span class="line">      google_access_context_manager_access_level.access_level_id_and_ip.name</span><br><span class="line">    ]</span><br><span class="line">    egress_policies &#123;</span><br><span class="line">      egress_from &#123;</span><br><span class="line">        identity_type = <span class="string">&quot;ANY_IDENTITY&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      egress_to &#123;</span><br><span class="line">        resources = [</span><br><span class="line">          <span class="string">&quot;projects/222222222222&quot;</span> <span class="comment"># ProjectB</span></span><br><span class="line">          ]</span><br><span class="line">        operations &#123;</span><br><span class="line">          service_name = <span class="string">&quot;bigquery.googleapis.com&quot;</span></span><br><span class="line">          method_selectors &#123;</span><br><span class="line">            method = <span class="string">&quot;*&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><figcaption><span>perimeter_project_b.tf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">resource <span class="string">&quot;google_access_context_manager_service_perimeter&quot;</span> <span class="string">&quot;projecta_perimeter&quot;</span> &#123;</span><br><span class="line">  parent = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>&quot;</span></span><br><span class="line">  name   = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>/servicePerimeters/projectb&quot;</span></span><br><span class="line">  title  = <span class="string">&quot;ProjectB&quot;</span></span><br><span class="line">  status &#123;</span><br><span class="line">    restricted_services = [</span><br><span class="line">      <span class="string">&quot;bigquery.googleapis.com&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    resources = [</span><br><span class="line">      <span class="string">&quot;projects/222222222222&quot;</span>, <span class="comment"># ProjectB</span></span><br><span class="line">    ]</span><br><span class="line">    access_levels = [</span><br><span class="line">      google_access_context_manager_access_level.access_level_id_and_ip.name</span><br><span class="line">    ]</span><br><span class="line">    egress_policies &#123;</span><br><span class="line">      egress_from &#123;</span><br><span class="line">        identity_type = <span class="string">&quot;ANY_IDENTITY&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      egress_to &#123;</span><br><span class="line">        resources = [</span><br><span class="line">          <span class="string">&quot;projects/111111111111&quot;</span> <span class="comment"># ProjectA</span></span><br><span class="line">          ]</span><br><span class="line">        operations &#123;</span><br><span class="line">          service_name = <span class="string">&quot;bigquery.googleapis.com&quot;</span></span><br><span class="line">          method_selectors &#123;</span><br><span class="line">            method = <span class="string">&quot;*&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bq query --use_legacy_sql=<span class="literal">false</span>  <span class="string">&#x27;select name, age, department_name from `project-a.dataset.table1` as table1 join `project-b.dataset.table2` as table2 on table1.department_id=table2.department_id&#x27;</span></span><br><span class="line">+-----------+-----+-----------------+</span><br><span class="line">|   name    | age | department_name |</span><br><span class="line">+-----------+-----+-----------------+</span><br><span class="line">| Suzuki    |  44 | HR              |</span><br><span class="line">| Tanaka    |  23 | Engineer        |</span><br><span class="line">| Sasaki    |  34 | Marketing       |</span><br><span class="line">| Kobayashi |  28 | Sales           |</span><br><span class="line">| Yamada    |  56 | Sales           |</span><br><span class="line">+-----------+-----+-----------------+</span><br></pre></td></tr></table></figure><p>ãŠäº’ã„ã«EGRESSã‚’è¨±å¯ã™ã‚‹ã“ã¨ã§JOINãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚<br>çµåˆå‡¦ç†ã‚’è¡Œã†ã‚¹ãƒ­ãƒƒãƒˆã«é€ã‚‰ã‚Œã‚‹éš›ã«ã€ProjectAå´ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ProjectBå´ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒ<strong>å¤–ã«æŒã¡å‡ºã•ã‚Œã‚‹</strong>ã“ã¨ã§EGRESSã®ç©´ã‚ã‘ãŒå¿…è¦ã«ãªã‚‹ã‚ˆã†ã§ã™ã€‚</p><h2 id="Shared-VPCã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã™ã‚‹"><a href="#Shared-VPCã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã™ã‚‹" class="headerlink" title="Shared VPCã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã™ã‚‹"></a>Shared VPCã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã™ã‚‹</h2><p>Shared VPCã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§VPC Service Controlsã‚’åˆ©ç”¨ã—ãŸã„å ´åˆã¯ã€åŒã˜å¢ƒç•Œå†…ã«VPCãƒ›ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚å«ã‚ãªã„ã¨ã€æœŸå¾…ã™ã‚‹å‹•ä½œã«ãªã‚‰ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã¿ãŸã„ã§ã™ã€‚<br><a href="https://cloud.google.com/vpc-service-controls/docs/troubleshooting?hl=ja#shared_vpc">Shared VPCã«ãŠã‘ã‚‹VPC Service Controls</a></p><p>ãã®ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«<code>resources</code>ã¸VPCãƒ›ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚å«ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚</p><figure class="highlight sh"><figcaption><span>perimeter_shared_pj.tf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">resource <span class="string">&quot;google_access_context_manager_service_perimeter&quot;</span> <span class="string">&quot;shared_pj_perimeter&quot;</span> &#123;</span><br><span class="line">  parent = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>&quot;</span></span><br><span class="line">  name   = <span class="string">&quot;accessPolicies/<span class="variable">$&#123;google_access_context_manager_access_policy.access_policy.name&#125;</span>/servicePerimeters/shared_pj_perimeter&quot;</span></span><br><span class="line">  title  = <span class="string">&quot;Shared PJ Perimeter&quot;</span></span><br><span class="line">  status &#123;</span><br><span class="line">    restricted_services = [</span><br><span class="line">      <span class="string">&quot;bigquery.googleapis.com&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    // å¢ƒç•Œã‚’ä½œã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ›ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚å«ã‚ã‚‹</span><br><span class="line">    resources = [</span><br><span class="line">      <span class="string">&quot;projects/333333333333&quot;</span>, <span class="comment"># shared-vpc-pj</span></span><br><span class="line">      <span class="string">&quot;projects/444444444444&quot;</span>, <span class="comment"># shared-vpc-host-pj</span></span><br><span class="line">    ]</span><br><span class="line">    access_levels = [</span><br><span class="line">      google_access_context_manager_access_level.access_level_id.name</span><br><span class="line">    ]</span><br><span class="line">    ingress_policies &#123;</span><br><span class="line">      ingress_from &#123;</span><br><span class="line">        identity_type = <span class="string">&quot;IDENTITY_TYPE_UNSPECIFIED&quot;</span></span><br><span class="line">        identities = [</span><br><span class="line">          <span class="string">&quot;user:xxx@yyy.com&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">      ingress_to &#123;</span><br><span class="line">        resources = [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">        operations &#123;</span><br><span class="line">          service_name = <span class="string">&quot;bigquery.googleapis.com&quot;</span></span><br><span class="line">          method_selectors &#123;</span><br><span class="line">            method = <span class="string">&quot;*&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h2><p>ä»Šå›ã¯BigQueryã«å¯¾ã—ã¦VPC Service Controlsã®æ©Ÿèƒ½ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚</p><p>VPC Service Controlsã§ã¯ãƒ‡ãƒ¼ã‚¿ã®ã‚„ã‚Šå–ã‚Šã‚’å†…å‘ããƒ»å¤–å‘ãã®ç´°ã‹ã„ãƒ¬ãƒ™ãƒ«ã§åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p><p>Google Cloudä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å®ˆã‚‹ãŸã‚ã«ã‚‚ã€ãœã²åˆ©ç”¨ã—ã¦ã¿ã¦ä¸‹ã•ã„ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot; title=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;/a&gt;ã¯ã˜ã‚ã«&lt;/h2&gt;&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€æœ¬è¨˜äº‹ã§ã¯Google Cloudã®VPC Service</summary>
        
      
    
    
    
    <category term="Security" scheme="https://future-architect.github.io/categories/Security/"/>
    
    
    <category term="Network" scheme="https://future-architect.github.io/tags/Network/"/>
    
    <category term="GCP" scheme="https://future-architect.github.io/tags/GCP/"/>
    
    <category term="VPC" scheme="https://future-architect.github.io/tags/VPC/"/>
    
  </entry>
  
  <entry>
    <title>GKEã§Identity-Aware Proxyã‚’åˆ©ç”¨ã—ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èªè¨¼</title>
    <link href="https://future-architect.github.io/articles/20230113a/"/>
    <id>https://future-architect.github.io/articles/20230113a/</id>
    <published>2023-01-12T15:00:00.000Z</published>
    <updated>2023-01-13T06:10:03.010Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆã‚ã«"><a href="#åˆã‚ã«" class="headerlink" title="åˆã‚ã«"></a>åˆã‚ã«</h1><p>æ˜ã‘ã¾ã—ã¦ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼Futureç­‹è‚‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ¸¡é‚‰ã§ã™ã€‚å¹´ã‚‚æ˜ã‘ãŸã“ã¨ãªã®ã§åˆ‡ã‚Šæ›¿ãˆã¦æ¸›é‡ã«å…¥ã‚Šã¾ã—ãŸã€‚ä¸‰æœˆæœ«ã¾ã§ã‚’ç›®å®‰ã«ä½“ã‚’çµã‚ã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</p><p>ç§ã¯ç¾åœ¨Google Cloudã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æ‰€å±ã—ã¦ãŠã‚Šã€Google Cloudã®ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã«ã„ãã—ã‚“ã§ã„ã¾ã™ã€‚ä»Šå›ã¯GKE (Google Kubernetes Engine)ã§Cloud IAP (Identity-Aware Proxy)ã‚’åˆ©ç”¨ã—ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼ã«ã¤ã„ã¦è¨˜äº‹ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚</p><h1 id="Identity-Aware-Proxyã¨ã¯"><a href="#Identity-Aware-Proxyã¨ã¯" class="headerlink" title="Identity-Aware Proxyã¨ã¯"></a>Identity-Aware Proxyã¨ã¯</h1><p>ä»¥ä¸‹ã€<a href="https://cloud.google.com/iap/docs/concepts-overview?hl=ja">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>å¼•ç”¨</p><blockquote><p>IAP ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€HTTPS ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸€å…ƒçš„ãªæ‰¿èªãƒ¬ã‚¤ãƒ¤ã‚’ç¢ºç«‹ã§ãã‚‹ãŸã‚ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ¬ãƒ™ãƒ«ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã«é ¼ã‚‰ãšã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ¬ãƒ™ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</p></blockquote><p>ç°¡å˜ã«è¨€ã†ã¨Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨Cloud IAMã®ä»•çµ„ã¿ã‚’ç”¨ã„ã¦Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èªè¨¼ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><h2 id="èªè¨¼ãƒ»æ‰¿èªãƒ•ãƒ­ãƒ¼"><a href="#èªè¨¼ãƒ»æ‰¿èªãƒ•ãƒ­ãƒ¼" class="headerlink" title="èªè¨¼ãƒ»æ‰¿èªãƒ•ãƒ­ãƒ¼"></a>èªè¨¼ãƒ»æ‰¿èªãƒ•ãƒ­ãƒ¼</h2><img src="/images/20230113a/authenticate-flow.drawio.png" alt="authenticate-flow.drawio.png" width="487" height="564" loading="lazy"><p><a href="https://cloud.google.com/iap/docs/concepts-overview?hl=ja">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã¯ã“ã¡ã‚‰</p><ul><li>Google Cloudãƒªã‚½ãƒ¼ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(Cloud Load Balancing)ã—ã¾ã™ã€‚</li><li>IAPãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã¯ã€IAPèªè¨¼ã‚µãƒ¼ãƒã¸æƒ…å ±ã‚’é€ä¿¡ã—ã¾ã™ã€‚ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç•ªå·ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆURLã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã€Cookieå†…ã®IAPèªè¨¼æƒ…å ±ãªã©ï¼‰</li><li>IAPèªè¨¼ã‚µãƒ¼ãƒãŒãƒ–ãƒ©ã‚¦ã‚¶ã®èªè¨¼æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</li><li>èªè¨¼æƒ…å ±ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€OAuth2.0ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã€èªè¨¼ç¢ºèªã‚’å®Ÿæ–½ã™ã‚‹ã€‚èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã¯ä»Šå¾Œã®ã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã‚ãƒ–ãƒ©ã‚¦ã‚¶ã®Cookieã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</li><li>èªè¨¼æƒ…å ±ãŒæœ‰åŠ¹ãªå ´åˆã€èªè¨¼ã‚µãƒ¼ãƒã¯èªè¨¼æƒ…å ±ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ã®IDï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶IDï¼‰ã‚’å–å¾—ã—ã¾ã™ã€‚</li><li>èªè¨¼ã‚µãƒ¼ãƒã¯ã“ã®IDã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ã®IAMãƒ­ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãƒ¦ãƒ¼ã‚¶ãŒãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹æ¨©é™(<strong>IAP ã§ä¿è­·ã•ã‚ŒãŸã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒª ãƒ¦ãƒ¼ã‚¶ãƒ¼</strong>)ã‚’æŒã£ã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™</li><li>æ¨©é™ã‚’æŒã£ã¦ã„ã‚Œã°ã€ã‚¢ã‚¯ã‚»ã‚¹OKã«ãªã‚Šã€ãªã‘ã‚Œã°NGã«ãªã‚Šã¾ã™ã€‚</li></ul><h1 id="å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³"><a href="#å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³" class="headerlink" title="å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³"></a>å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³</h1><p>ä»¥ä¸‹ãŒå…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã«ãªã‚Šã¾ã™ã€‚<br>GKE&#x2F;Networkãªã©ã®Google Cloudã®ãƒªã‚½ãƒ¼ã‚¹æ§‹ç¯‰ã«é–¢ã—ã¦ã¯æ…£ã‚Œè¦ªã—ã‚“ã§ã„ã‚‹Terraformã‚’åˆ©ç”¨ã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚OAuthåŒæ„ç”»é¢ã«é–¢ã—ã¦ã¯å¤–éƒ¨å…¬é–‹ã™ã‚‹å ´åˆã¯ã€APIã‹ã‚‰ä½œæˆã™ã‚‹ã“ã¨ã¯ã§ããªã„ (<a href="https://cloud.google.com/iap/docs/programmatic-oauth-clients?hl=ja%5D">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨˜è¼‰</a>)ã®ã§ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰è¨­å®šã—ã¾ã—ãŸã€‚</p><img src="/images/20230113a/architecture.drawio.png" alt="architecture.drawio.png" width="1151" height="429" loading="lazy"><h2 id="BastionåˆæœŸè¨­å®š"><a href="#BastionåˆæœŸè¨­å®š" class="headerlink" title="BastionåˆæœŸè¨­å®š"></a>BastionåˆæœŸè¨­å®š</h2><p>Public Subnetã«ä½œæˆã—ãŸGCEã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰GKEã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã«å¯¾ã—ã¦kubectlã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã„ã®ã§ã€<br>kubectlã‚³ãƒãƒ³ãƒ‰ã‚„ã€google-cloud-sdk-gke-gcloud-auth-pluginãªã©ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚<br>ä»¥ä¸‹ã€Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># Author: watanabe</span></span><br><span class="line"><span class="comment"># Initial Date: 2022/12/28</span></span><br><span class="line"><span class="comment"># History: Create</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Variable Definition</span></span><br><span class="line">project_name=<span class="string">&quot;xxxxxxxxxx&quot;</span></span><br><span class="line">gke_cluster_name=<span class="string">&quot;xxxxxxxxx&quot;</span></span><br><span class="line">region=<span class="string">&quot;asia-northeast1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Kubectl</span></span><br><span class="line">curl -LO <span class="string">&quot;https://storage.googleapis.com/kubernetes-release/release/<span class="subst">$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)</span>/bin/linux/amd64/kubectl&quot;</span></span><br><span class="line"><span class="built_in">chmod</span> +x ./kubectl</span><br><span class="line">sudo <span class="built_in">mv</span> ./kubectl /usr/local/bin/kubectl</span><br><span class="line">kubectl version</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install google-cloud-sdk-gke-gcloud-auth-plugin</span></span><br><span class="line">sudo apt-get install apt-transport-https ca-certificates gnupg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main&quot;</span> | sudo <span class="built_in">tee</span> -a /etc/apt/sources.list.d/google-cloud-sdk.list</span><br><span class="line">curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install google-cloud-cli</span><br><span class="line">sudo apt-get install google-cloud-sdk-gke-gcloud-auth-plugin</span><br><span class="line">gke-gcloud-auth-plugin --version</span><br><span class="line"><span class="built_in">export</span> USE_GKE_GCLOUD_AUTH_PLUGIN=True</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get Credentials</span></span><br><span class="line">gcloud container clusters get-credentials <span class="string">&quot;<span class="variable">$&#123;gke_cluster_name&#125;</span>&quot;</span> --region <span class="string">&quot;<span class="variable">$&#123;region&#125;</span>&quot;</span> --project <span class="string">&quot;<span class="variable">$&#123;project_name&#125;</span>&quot;</span></span><br><span class="line">kubectl config get-contexts</span><br><span class="line">kubectl get node</span><br></pre></td></tr></table></figure><h2 id="manifestãƒ•ã‚¡ã‚¤ãƒ«"><a href="#manifestãƒ•ã‚¡ã‚¤ãƒ«" class="headerlink" title="manifestãƒ•ã‚¡ã‚¤ãƒ«"></a>manifestãƒ•ã‚¡ã‚¤ãƒ«</h2><p>ã¾ãŸã€manifestãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã‚’ç”¨æ„ã—ã¦kubectlã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—k8sãƒªã‚½ãƒ¼ã‚¹ã‚’GKEã«å¯¾ã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚</p><p>ã“ã“ã¾ã§ã®è¨­å®šã§äº‹å‰æº–å‚™ã¯å®Œäº†ã§ã™ã€‚</p><h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><p>Nginxã®Podã‚’ç”¨æ„ã™ã‚‹ãŸã‚ã€Deploymentã®manifestã‚’ä½œæˆã—ã¾ã—ãŸã€‚</p><figure class="highlight yaml"><figcaption><span>deployment.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.22</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>Ingressã«ã¯NodePortãŒå¿…è¦ã«ãªã‚‹ã®ã§ã€Serviceã®manifestã‚’ä½œæˆã—ã¾ã—ãŸã€‚</p><figure class="highlight yaml"><figcaption><span>service.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure><h3 id="ManagedCertificate"><a href="#ManagedCertificate" class="headerlink" title="ManagedCertificate"></a>ManagedCertificate</h3><p>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨Ingressã§æ§‹ç¯‰ã™ã‚‹HTTP(S)ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µé–“ã‚’HTTPSã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚ˆã†ã«ã—ãŸã„ã®ã§ã€Googleãƒãƒãƒ¼ã‚¸ãƒ‰è¨¼æ˜æ›¸ã®manifestã‚’ä½œæˆã—ã¾ã—ãŸã€‚<br>domainsã«ã¯ã€terraformã§ç”¨æ„ã—ãŸHTTP(S)ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã«è¨­å®šã—ãŸã„å¤–éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒ•ãƒªãƒ¼ãªãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰DNSã‚µãƒ¼ãƒ“ã‚¹ã®<a href="https://nip.io/">nip.io</a>ã‚’åˆ©ç”¨ã—ãŸã‚‚ã®ã‚’è¨­å®šã—ã¾ã™ã€‚</p><figure class="highlight yaml"><figcaption><span>managed-certificate.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.gke.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ManagedCertificate</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">domains:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">34.</span><span class="string">xxx.xxx.xxx.nip.io</span></span><br></pre></td></tr></table></figure><h3 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h3><p>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã«Nginxã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã«Ingressã‚’æ§‹ç¯‰ã™ã‚‹manifestã‚’ä½œæˆã—ã¾ã—ãŸã€‚</p><figure class="highlight yaml"><figcaption><span>ingress.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="comment"># å¤–éƒ¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µã®ä½œæˆ</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">&quot;gce&quot;</span></span><br><span class="line">    <span class="comment"># ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨HTTP(S)ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µé–“ã®ã™ã¹ã¦ã®é€šä¿¡ã‚’HTTPSã«å¼·åˆ¶</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.allow-http:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">    <span class="comment"># äº‹å‰ã«ç”¨æ„ã—ã¦ã„ãŸé™çš„å¤–éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã™ã‚‹</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.global-static-ip-name:</span> <span class="string">&quot;loadbalancer-external-ip-address&quot;</span></span><br><span class="line">    <span class="comment"># Googleãƒãƒãƒ¼ã‚¸ãƒ‰è¨¼æ˜æ›¸ã‚’Ingressã«é©ç”¨ã™ã‚‹</span></span><br><span class="line">    <span class="attr">networking.gke.io/managed-certificates:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nginx-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h1 id="Cloud-IAPãªã—ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"><a href="#Cloud-IAPãªã—ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª" class="headerlink" title="Cloud IAPãªã—ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"></a>Cloud IAPãªã—ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª</h1><p>ã¾ãšã€Cloud IAPãªã—ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚<br>Load Balancerã«è¨­å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ã¨ã€ç‰¹ã«èªè¨¼ç”»é¢ã‚’çµŒç”±ã™ã‚‹ã“ã¨ã‚‚ãªãã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br><img src="/images/20230113a/1-IAPãªã—ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª.png" alt="1-IAPãªã—ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª.png" width="956" height="525" loading="lazy"></p><h1 id="Cloud-IAPã®è¨­å®šã‚’è¿½åŠ "><a href="#Cloud-IAPã®è¨­å®šã‚’è¿½åŠ " class="headerlink" title="Cloud IAPã®è¨­å®šã‚’è¿½åŠ "></a>Cloud IAPã®è¨­å®šã‚’è¿½åŠ </h1><p>ä¸Šè¨˜ã®çŠ¶æ…‹ã§ã¯ã ã‚Œã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ãªãŸã‚ã€ã‚»ã‚­ãƒ¥ã‚¢ãªçŠ¶æ…‹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã“ã“ã§Cloud IAPã®è¨­å®šã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><h2 id="OAuthåŒæ„ç”»é¢ã®ä½œæˆ"><a href="#OAuthåŒæ„ç”»é¢ã®ä½œæˆ" class="headerlink" title="OAuthåŒæ„ç”»é¢ã®ä½œæˆ"></a>OAuthåŒæ„ç”»é¢ã®ä½œæˆ</h2><p>OAuthåŒæ„ç”»é¢ã¯User Typeã‚’ã€Œå¤–éƒ¨ã€ã§ä½œæˆã—ã¾ã™ã€‚<br><img src="/images/20230113a/2-OAuthåŒæ„ç”»é¢â‘ .png" alt="2-OAuthåŒæ„ç”»é¢â‘ .png" width="1200" height="848" loading="lazy"></p><p>ã‚¢ãƒ—ãƒªæƒ…å ±ã¨ã—ã¦ã€å¿…é ˆé …ç›®ã®ä»¥ä¸‹ã‚’è¨­å®šã—ã¦ã€Œä¿å­˜ã—ã¦æ¬¡ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚<br>ã»ã‹ã®æƒ…å ±ã¯ä»»æ„ã®ãŸã‚è¨­å®šã—ã¾ã›ã‚“ã§ã—ãŸã€‚</p><ul><li>ã‚¢ãƒ—ãƒªåï¼šGKE Application</li><li>ãƒ¦ãƒ¼ã‚¶ã‚µãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«ï¼šè‡ªèº«ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</li><li>ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã®é€£çµ¡å…ˆæƒ…å ±ï¼šè‡ªèº«ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</li></ul><img src="/images/20230113a/2-OAuthåŒæ„ç”»é¢â‘¡.png" alt="2-OAuthåŒæ„ç”»é¢â‘¡.png" width="1200" height="838" loading="lazy"><img src="/images/20230113a/2-OAuthåŒæ„ç”»é¢â‘¢.png" alt="2-OAuthåŒæ„ç”»é¢â‘¢.png" width="1200" height="843" loading="lazy"><p>ã‚¹ã‚³ãƒ¼ãƒ—ã¨ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ã¯ä»»æ„æƒ…å ±ã®ãŸã‚è¨­å®šã—ã¾ã›ã‚“ã§ã—ãŸã€‚<br>ä»¥ä¸‹ãŒè¨­å®šå®Œäº†ã—ãŸOAuthåŒæ„ç”»é¢ã«ãªã‚Šã¾ã™ã€‚</p><img src="/images/20230113a/2-OAuthåŒæ„ç”»é¢â‘£.png" alt="2-OAuthåŒæ„ç”»é¢â‘£.png" width="1200" height="844" loading="lazy"><h2 id="OAuthèªè¨¼æƒ…å ±ã®ä½œæˆ"><a href="#OAuthèªè¨¼æƒ…å ±ã®ä½œæˆ" class="headerlink" title="OAuthèªè¨¼æƒ…å ±ã®ä½œæˆ"></a>OAuthèªè¨¼æƒ…å ±ã®ä½œæˆ</h2><p>APIã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¿ãƒ–ã®ã€Œèªè¨¼æƒ…å ±ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚<br>èªè¨¼æƒ…å ±ã®ä½œæˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã‹ã‚‰OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚</p><img src="/images/20230113a/3-OAuthèªè¨¼æƒ…å ±â‘ .png" alt="3-OAuthèªè¨¼æƒ…å ±â‘ .png" width="1200" height="843" loading="lazy"><ul><li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡ï¼šã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</li><li>OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®åå‰ï¼šGKE Application<br>ã‚’å…¥åŠ›ã—ã€ä½œæˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚</li></ul><img src="/images/20230113a/3-OAuthèªè¨¼æƒ…å ±â‘¡.png" alt="3-OAuthèªè¨¼æƒ…å ±â‘¡.png" width="1200" height="851" loading="lazy"><p>ä½œæˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ã€JSONã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p><img src="/images/20230113a/3-OAuthèªè¨¼æƒ…å ±â‘¢.png" alt="3-OAuthèªè¨¼æƒ…å ±â‘¢.png" width="512" height="448" loading="lazy"><p>ä½œæˆã—ãŸOAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å†åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã€æ‰¿èªæ¸ˆã¿ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸOAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID(CLIENT_ID)ã«ä¿®æ­£ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://iap.googleapis.com/v1/oauth/clientIds/CLIENT_ID:handleRedirect</span><br></pre></td></tr></table></figure><img src="/images/20230113a/3-OAuthèªè¨¼æƒ…å ±â‘£.png" alt="3-OAuthèªè¨¼æƒ…å ±â‘£.png" width="1200" height="795" loading="lazy"><h2 id="IAPã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®è¨­å®š"><a href="#IAPã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®è¨­å®š" class="headerlink" title="IAPã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®è¨­å®š"></a>IAPã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®è¨­å®š</h2><p>Google Cloud Consoleã®Identity-Aware Proxyã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚<br>ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä»˜ä¸ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®æ¨ªã«ã‚ã‚‹ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚ªãƒ³ã«ã—ã¾ã™ã€‚</p><img src="/images/20230113a/4-CloudIAPã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®šâ‘ .png" alt="4-CloudIAPã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®šâ‘ .png" width="1200" height="845" loading="lazy"><p>IAPã®æœ‰åŠ¹åŒ–ã§ã€Œæ§‹æˆè¦ä»¶ã€ã‚’å‚ç…§ã—ã€å•é¡Œãªã‘ã‚Œã°ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚<br><img src="/images/20230113a/4-CloudIAPã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®šâ‘¡.png" alt="4-CloudIAPã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®šâ‘¡.png" width="564" height="355" loading="lazy"></p><p>ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒã€Œã‚ªãƒ³ã€ã«ãªã‚Šã¾ã—ãŸ<br>å³å´ã®ãƒ‘ãƒãƒ«ã‹ã‚‰ã€ã€Œãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚<br><img src="/images/20230113a/4-CloudIAPã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®šâ‘¢.png" alt="4-CloudIAPã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®šâ‘¢.png" width="1200" height="849" loading="lazy"></p><p>IAPã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãŸã„Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã¾ãŸã¯ã€Googleã‚°ãƒ«ãƒ¼ãƒ—ãªã©ã‚’æŒ‡å®šã—ã¦ã€IAMãƒ­ãƒ¼ãƒ«ï¼ˆIAP-secured Web App Userï¼‰ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚</p><img src="/images/20230113a/4-CloudIAPã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®šâ‘£.png" alt="4-CloudIAPã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®šâ‘£.png" width="736" height="727" loading="lazy"><p>ã“ã“ã¾ã§ã§OAuthã®è¨­å®šã¯å®Œäº†ã§ã™ã€‚</p><h2 id="Kubernetes-Secretã®ä½œæˆ"><a href="#Kubernetes-Secretã®ä½œæˆ" class="headerlink" title="Kubernetes Secretã®ä½œæˆ"></a>Kubernetes Secretã®ä½œæˆ</h2><p>GKEã§Cloud IAPã‚’é©ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€Kubernetes Secretã‚’ä½œæˆã—ã¦BackendConfigã«é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>å…ˆã»ã©ä½œæˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸOAuthèªè¨¼æƒ…å ±ã®Client IDã¨Client Secretã‚’æŒ‡å®šã—ã¦Kubernetes Secretã‚’ä½œæˆã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic oauth-secret --from-literal=client_id=xxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com \</span><br><span class="line">    --from-literal=client_secret=xxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure><p>Kubernetes SecretãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxxxxx@tky-bastion:~$ kubectl describe secret oauth-secret</span><br><span class="line">Name:         oauth-secret</span><br><span class="line">Namespace:    default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Type:  Opaque</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">client_secret:  35 bytes</span><br><span class="line">client_id:      73 bytes</span><br></pre></td></tr></table></figure><h2 id="BackendConfigã®ä½œæˆ"><a href="#BackendConfigã®ä½œæˆ" class="headerlink" title="BackendConfigã®ä½œæˆ"></a>BackendConfigã®ä½œæˆ</h2><p>Kubernetes Secretã§ä½œæˆã—ãŸSecretã‚’BackendConfigã«è¨­å®šã™ã‚‹ã“ã¨ã§Cloud IAPã‚’é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>ä»¥ä¸‹ã®manifestãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚</p><figure class="highlight yaml"><figcaption><span>backendconfig.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">cloud.google.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">BackendConfig</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">iap-conifg</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">iap:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">oauthclientCredentials:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">oauth-secret</span></span><br></pre></td></tr></table></figure><p>kubectlã‚³ãƒãƒ³ãƒ‰ã§BackendConfigã‚’ä½œæˆã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f backendconfig.yaml</span><br></pre></td></tr></table></figure><p>BackendConfigãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxxxxx@tky-bastion:~/manifest$ kubectl get backendconfig</span><br><span class="line">NAME         AGE</span><br><span class="line">iap-conifg   3m42s</span><br></pre></td></tr></table></figure><p>ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒ¼ãƒˆã‚’ BackendConfig ã«é–¢é€£ä»˜ã‘ã¦ã€IAP ã®æœ‰åŠ¹åŒ–ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ—¢å­˜ã®Service ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã®ã™ã¹ã¦ã®ãƒãƒ¼ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ BackendConfig ã«ã—ã¾ã™ã€‚</p><figure class="highlight yaml"><figcaption><span>service.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-service</span></span><br><span class="line"><span class="comment"># è¿½è¨˜</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">beta.cloud.google.com/backend-config:</span> <span class="string">&#x27;&#123;&quot;default&quot;: &quot;config-default&quot;&#125;&#x27;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f service.yaml</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šã§ã€Cloud IAPã®è¨­å®šã¯å®Œäº†ã§ã™ã€‚</p><h1 id="Cloud-IAPã‚ã‚Šã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"><a href="#Cloud-IAPã‚ã‚Šã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª" class="headerlink" title="Cloud IAPã‚ã‚Šã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"></a>Cloud IAPã‚ã‚Šã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª</h1><p>Cloud IAPã®è¨­å®šãŒå®Œäº†ã—ãŸã®ã§ã€ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦Cloud IAPãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><h2 id="Cloud-IAPèªè¨¼å¯¾è±¡å¤–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"><a href="#Cloud-IAPèªè¨¼å¯¾è±¡å¤–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª" class="headerlink" title="Cloud IAPèªè¨¼å¯¾è±¡å¤–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"></a>Cloud IAPèªè¨¼å¯¾è±¡å¤–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª</h2><p>Load Balancerã«è¨­å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ã¨ã€Cloud IAPã«ã‚ˆã‚‹Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚</p><img src="/images/20230113a/5-IAPã‚¢ã‚¯ã‚»ã‚¹ãªã—â‘ .png" alt="5-IAPã‚¢ã‚¯ã‚»ã‚¹ãªã—â‘ .png" width="469" height="557" loading="lazy"><p>æœ¬Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯Cloud IAPã®ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹æ¨©é™(<strong>IAP ã§ä¿è­·ã•ã‚ŒãŸã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒª ãƒ¦ãƒ¼ã‚¶ãƒ¼</strong>)ã‚’æŒã£ã¦ã„ãªã„ãŸã‚ã€ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚<br><img src="/images/20230113a/5-IAPã‚¢ã‚¯ã‚»ã‚¹ãªã—â‘¡.png" alt="5-IAPã‚¢ã‚¯ã‚»ã‚¹ãªã—â‘¡.png" width="426" height="455" loading="lazy"></p><h2 id="Cloud-IAPèªè¨¼å¯¾è±¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"><a href="#Cloud-IAPèªè¨¼å¯¾è±¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª" class="headerlink" title="Cloud IAPèªè¨¼å¯¾è±¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"></a>Cloud IAPèªè¨¼å¯¾è±¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª</h2><p>Load Balancerã«è¨­å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ã¨ã€Cloud IAPã«ã‚ˆã‚‹Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚</p><img src="/images/20230113a/6-IAPã‚¢ã‚¯ã‚»ã‚¹ã‚ã‚Šâ‘ .png" alt="6-IAPã‚¢ã‚¯ã‚»ã‚¹ã‚ã‚Šâ‘ .png" width="529" height="565" loading="lazy"><p>æœ¬Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯Cloud IAPã®ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹æ¨©é™(<strong>IAP ã§ä¿è­·ã•ã‚ŒãŸã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒª ãƒ¦ãƒ¼ã‚¶ãƒ¼</strong>)ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚<br><img src="/images/20230113a/6-IAPã‚¢ã‚¯ã‚»ã‚¹ã‚ã‚Šâ‘¡.png" alt="6-IAPã‚¢ã‚¯ã‚»ã‚¹ã‚ã‚Šâ‘¡.png" width="908" height="299" loading="lazy"></p><h1 id="æœ€å¾Œã«"><a href="#æœ€å¾Œã«" class="headerlink" title="æœ€å¾Œã«"></a>æœ€å¾Œã«</h1><p>ä»Šå›ã¯GKE (Google Kubernetes Engine)ã§Cloud IAP (Identity-Aware Proxy)ã‚’åˆ©ç”¨ã—ãŸGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼ã«ã¤ã„ã¦è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚<br>Google Cloudã‚’åˆ©ç”¨ã—ã¦ã„ã¦ã€ç‰¹å®šã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãŸã„ã‚±ãƒ¼ã‚¹ã¯ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã®ã§ã€ãã®æ™‚ã«ã§ã‚‚å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;åˆã‚ã«&quot;&gt;&lt;a href=&quot;#åˆã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="Infrastructure" scheme="https://future-architect.github.io/categories/Infrastructure/"/>
    
    
    <category term="GCP" scheme="https://future-architect.github.io/tags/GCP/"/>
    
    <category term="GKE" scheme="https://future-architect.github.io/tags/GKE/"/>
    
    <category term="Identity-Aware Proxy" scheme="https://future-architect.github.io/tags/Identity-Aware-Proxy/"/>
    
  </entry>
  
  <entry>
    <title>Python Web APIã‚’AWS Lambdaã«ãƒ‡ãƒ—ãƒ­ã‚¤</title>
    <link href="https://future-architect.github.io/articles/20230105a/"/>
    <id>https://future-architect.github.io/articles/20230105a/</id>
    <published>2023-01-04T15:00:00.000Z</published>
    <updated>2023-01-19T02:59:42.309Z</updated>
    
    <content type="html"><![CDATA[<p>ã“ã®è¨˜äº‹ã¯<a href="https://qiita.com/advent-calendar/2022/future">ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ Advent Calendar 2022</a>ã®14æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p><h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ã€‚TIG DXãƒ¦ãƒ‹ãƒƒãƒˆã®æ‘ä¸Šã§ã™ã€‚</p><p>Pythonã®Web APIã‚’Lambdaã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚</p><p>Pythonã§Web APIã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã¯<a href="/articles/20221203a/">OpenAPI Generatorã§Python Web APIæ§‹ç¯‰</a>ã‚’ã”è¦§ãã ã•ã„ã€‚</p><p>æœ¬è¨˜äº‹ã§ã¯Python Web APIã®ã‚¢ãƒ—ãƒªå®Ÿè£…ã¯å®Œæˆã—ã¦ã„ã‚‹å‰æã§ã€ä¸‹å›³ã®æµã‚Œã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ã‚’è§£èª¬ã—ã¾ã™ã€‚</p><img src="/images/20230105a/image.png" alt="Pythonã‚¢ãƒ—ãƒªã‚’Dockerã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰â†’ECRâ†’Lambdaã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹" width="778" height="495" loading="lazy"><h1 id="Lambdaèµ·å‹•ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«"><a href="#Lambdaèµ·å‹•ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«" class="headerlink" title="Lambdaèµ·å‹•ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«"></a>Lambdaèµ·å‹•ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</h1><p>Lambdaã§ã¯èµ·ç‚¹ã¨ãªã‚‹é–¢æ•°ã¨API Responseã‚’è¿”ã™returnå‘½ä»¤ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚<br>ã“ã‚Œã‚‰ã‚’æº€ãŸã™ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p><figure class="highlight python"><figcaption><span>lambda.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> awsgi</span><br><span class="line"><span class="keyword">import</span> connexion</span><br><span class="line"><span class="keyword">from</span> openapi_server <span class="keyword">import</span> encoder</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lambda_handler</span>(<span class="params">event, context</span>):</span><br><span class="line">    app = connexion.App(__name__, specification_dir=<span class="string">&quot;./openapi/&quot;</span>)</span><br><span class="line">    app.app.json_encoder = encoder.JSONEncoder</span><br><span class="line">    app.add_api(</span><br><span class="line">        <span class="string">&quot;openapi.yaml&quot;</span>,</span><br><span class="line">        arguments=&#123;<span class="string">&quot;title&quot;</span>: <span class="string">&quot;Stock API&quot;</span>&#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> awsgi.response(app, event, context)</span><br></pre></td></tr></table></figure><p><code>lambda_handler</code>ã‚’Lambdaèµ·å‹•ç”¨é–¢æ•°ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€APIã‚’æ©Ÿèƒ½ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><h1 id="ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•"><a href="#ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•" class="headerlink" title="ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•"></a>ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•</h1><p>Lambdaã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã¯2ç¨®é¡ã‚ã‚Šã¾ã™ã€‚</p><ol><li>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãã®ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ZIPã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</li><li>ECRã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</li></ol><p>Pythonã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆã¯2ç•ªã®ECRã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚<br>ã¨ã„ã†ã®ã‚‚æœ€è¿‘ã®Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯å®¹é‡ãŒå¤§ããã€ä¾‹ãˆã°Pandasã ã‘ã§ã‚‚ç´„50MBã‚ã‚Šã¾ã™ã€‚<br>ZIPã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹å¼ã®å ´åˆã¯è§£å‡å‰50MBã€è§£å‡å¾Œ250MBã¾ã§ã¨ã„ã†åˆ¶é™ãŒã‚ã‚‹ãŸã‚ã€ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ•°ã¨ã‚µã‚¤ã‚ºã«ã‚ˆã£ã¦ã¯ã“ã®åˆ¶é™ã«å¼•ã£æ›ã‹ã‚Šã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã›ã‚“ã€‚<br>ä¸€æ–¹ã§ECRæ–¹å¼ã®å ´åˆã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºãŒ10GBã¾ã§OKãªã®ã§ã‹ãªã‚Šé•ã„ãŒã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><p>ãã®ä»–è©³ã—ã„åˆ¶é™ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã‚’ã”è¦§ãã ã•ã„ã€‚</p><p><a href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/gettingstarted-limits.html">https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/gettingstarted-limits.html</a></p><p>æœ¬è¨˜äº‹ã§ã¯ECRã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚</p><h1 id="ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨Dockerfileã®ä½œæˆ"><a href="#ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨Dockerfileã®ä½œæˆ" class="headerlink" title="ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨Dockerfileã®ä½œæˆ"></a>ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨Dockerfileã®ä½œæˆ</h1><p>ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã®Dockerfileã«ã¯ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨Lambdaèµ·å‹•ç”¨ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚<br>Pythonã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã«ã¯<a href="https://python-poetry.org/">Poetry</a>ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã‚’æƒ³å®šã—ã€Dockerfileã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚</p><figure class="highlight dockerfile"><figcaption><span>Dockerfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> FUNCTION_DIR=<span class="string">&quot;/usr/src/app&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span>.<span class="number">13</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> FUNCTION_DIR</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> -p <span class="variable">$&#123;FUNCTION_DIR&#125;</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$&#123;FUNCTION_DIR&#125;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install gcc g++ libc-dev</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install poetry</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> pyproject.toml poetry.lock ./</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> poetry <span class="built_in">export</span> -f requirements.txt &gt; requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip uninstall poetry --<span class="built_in">yes</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --target <span class="variable">$&#123;FUNCTION_DIR&#125;</span> awslambdaric</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./ <span class="variable">$&#123;FUNCTION_DIR&#125;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/usr/local/bin/python&quot;</span>, <span class="string">&quot;-m&quot;</span>, <span class="string">&quot;awslambdaric&quot;</span> ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;openapi_server/lambda.lambda_handler&quot;</span> ]</span></span><br></pre></td></tr></table></figure><p>poetryã¯ãã®æ€§è³ªä¸Šdockerå†…ã«ä»®æƒ³ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ãã‚Œã¯é¢å€’ãªã®ã§pipã§ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚<br>æ³¨æ„ç‚¹ã¨ã—ã¦ã€poetryã¨ãã‚Œä»¥å¤–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯pipã®ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚poetryã§å‡ºåŠ›ã•ã‚ŒãŸ<code>requirements.txt</code>ã«è¨˜è¿°ã•ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯poetryã«ã‚ˆã£ã¦ä¾å­˜é–¢ä¿‚ã®æ•´åˆæ€§ãŒä¿è¨¼ã•ã‚Œã¦ã„ã¾ã™ãŒã€ãã®ä¾å­˜é–¢ä¿‚ã«poetryè‡ªèº«ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚ã“ã®dockerå†…ã§ã¯pipã«ã‚ˆã£ã¦poetryã¨ãã‚Œã‚‰ä»¥å¤–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã¯ã˜ã‚ã¦ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã®å¯¾è±¡ã¨ãªã‚‹ãŸã‚ã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚ˆã£ã¦poetryã¯<code>requirements.txt</code>ã‚’å‡ºåŠ›ã—ãŸã‚‰é€Ÿã‚„ã‹ã«å‰Šé™¤ã—ã¾ã™ã€‚<br>ã¾ãŸã€Lambdaã§èµ·å‹•ã™ã‚‹ãŸã‚ã«ã¯<a href="https://github.com/aws/aws-lambda-python-runtime-interface-client">awslambdaric</a>ã¨ã„ã†ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒå¿…è¦ãªãŸã‚ã€åˆã‚ã›ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><h1 id="AWS-CLIã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹"><a href="#AWS-CLIã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹" class="headerlink" title="AWS CLIã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹"></a>AWS CLIã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹</h1><p>ä¸Šè¨˜ã®Dockerfileã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚<br>proxyç’°å¢ƒã®å ´åˆã¯ãã®ã¾ã¾ã§ã¯dockerå†…ã§å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒè¡Œãˆãªã„ãŸã‚ã€<code>--build-arg</code>ã«ãƒ—ãƒ­ã‚­ã‚·ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker build \</span><br><span class="line">    -f ./Dockerfile \</span><br><span class="line">-t <span class="string">&quot;&lt;AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆID&gt;.dkr.ecr.ap-northeast-1.amazonaws.com/&lt;ECRãƒªãƒã‚¸ãƒˆãƒªå&gt;:latest&quot;</span> \</span><br><span class="line">--build-arg https_proxy=<span class="variable">$&#123;https_proxy&#125;</span> \</span><br><span class="line">../.</span><br></pre></td></tr></table></figure><p>ãƒ“ãƒ«ãƒ‰ãŒã§ããŸã‚‰ECRã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker push &lt;AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆID&gt;.dkr.ecr.ap-northeast-1.amazonaws.com/&lt;ECRãƒªãƒã‚¸ãƒˆãƒªå&gt;:latest</span><br></pre></td></tr></table></figure><p>ãƒ—ãƒƒã‚·ãƒ¥ãŒå®Œäº†ã—ãŸã‚‰ECRã‹ã‚‰Lambdaã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ aws lambda update-function-code --function-name &lt;Lambdaå&gt; \</span><br><span class="line">--image-uri &lt;AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆID&gt;.dkr.ecr.ap-northeast-1.amazonaws.com/&lt;ECRãƒªãƒã‚¸ãƒˆãƒªå&gt;:latest</span><br></pre></td></tr></table></figure><h1 id="ãŠã‚ã‚Šã«"><a href="#ãŠã‚ã‚Šã«" class="headerlink" title="ãŠã‚ã‚Šã«"></a>ãŠã‚ã‚Šã«</h1><p>æœ€å¾Œã¾ã§ãŠèª­ã¿ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</p><p>Lambdaã«ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•ã¯åˆ¶é™ãŒç·©ãä½¿ã„ã‚„ã™ã„åé¢ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒå¿…è¦ã ã£ãŸã‚Šã€ECRã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ç”¨æ„ã—ãªã„ã¨ã„ã‘ãªã‹ã£ãŸã‚Šã¨ã€å°‘ã—æ‰‹é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚<br>æœ¬è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚</p><p>æ˜æ—¥ã¯tutuzã•ã‚“ã®<a href="https://qiita.com/tutuz/items/a2db0a78e5977b3d942b">æŠ€è¡“è¨˜äº‹åŸ·ç­†ã®ã‚¹ã‚¹ãƒ¡</a>ã§ã™ï¼</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;ã“ã®è¨˜äº‹ã¯&lt;a href=&quot;https://qiita.com/advent-calendar/2022/future&quot;&gt;ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ Advent Calendar 2022&lt;/a&gt;ã®14æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="AWS" scheme="https://future-architect.github.io/tags/AWS/"/>
    
    <category term="Docker" scheme="https://future-architect.github.io/tags/Docker/"/>
    
    <category term="WebAPI" scheme="https://future-architect.github.io/tags/WebAPI/"/>
    
  </entry>
  
  <entry>
    <title>Rustè£½SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’napi-rsã‚’åˆ©ç”¨ã—ã¦VSCodeæ‹¡å¼µæ©Ÿèƒ½åŒ–</title>
    <link href="https://future-architect.github.io/articles/20221228a/"/>
    <id>https://future-architect.github.io/articles/20221228a/</id>
    <published>2022-12-27T15:00:00.000Z</published>
    <updated>2022-12-28T00:57:42.773Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221228a/top.png" alt="" width="579" height="216"><h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ã€Futureã§ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚’ã—ã¦ã„ã‚‹å·æ¸•ã§ã™ã€‚</p><p>ã‚¢ãƒ«ãƒã‚¤ãƒˆã®å‰ã¯Futureã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚·ãƒƒãƒ—ã§Rustè£½SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã§ã‚ã‚‹uroborosql-fmtã®ä½œæˆã‚’è¡Œã£ã¦ã„ã¾ã—ãŸ(ãã®æ™‚ã®è¨˜äº‹ã¯<a href="/articles/20220916b/">ã“ã¡ã‚‰</a>)ã€‚</p><p>æœ¬è¨˜äº‹ã§ã¯ãã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’VSCodeã®æ‹¡å¼µæ©Ÿèƒ½åŒ–ã—ãŸæ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</p><h1 id="èª¬æ˜ã™ã‚‹ã“ã¨"><a href="#èª¬æ˜ã™ã‚‹ã“ã¨" class="headerlink" title="èª¬æ˜ã™ã‚‹ã“ã¨"></a>èª¬æ˜ã™ã‚‹ã“ã¨</h1><ul><li>napi-rsã‚’ä½¿ç”¨ã—ã¦TypeScript(JavaScript)ã‹ã‚‰Rustã®ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹æ–¹æ³•</li><li>napi-rsã«ãŠã‘ã‚‹ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰æ–¹æ³•</li><li>VSCodeæ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹æ–¹æ³•</li></ul><!--* x86_64-pc-windows-gnuã®ç’°å¢ƒã§napi-rsã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•--><h1 id="èª¬æ˜ã—ãªã„ã“ã¨"><a href="#èª¬æ˜ã—ãªã„ã“ã¨" class="headerlink" title="èª¬æ˜ã—ãªã„ã“ã¨"></a>èª¬æ˜ã—ãªã„ã“ã¨</h1><ul><li>æœ¬è¨˜äº‹ã§ã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®ä»•æ§˜ã€å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã›ã‚“ã€‚è©³ç´°ã‚’çŸ¥ã‚ŠãŸã„æ–¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚<ul><li><a href="/articles/20220916b/">Engineer Camp2022 Rustã§SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ä½œæˆï¼ˆå‰ç·¨ï¼‰ | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li><li><a href="/articles/20220916c/">Engineer Camp2022 Rustã§SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ä½œæˆï¼ˆå¾Œç·¨ï¼‰ | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li><li><a href="/articles/20221215a/">tree-sitteræ–‡æ³•å…¥é–€ | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li></ul></li><li>LSPã‚’ç”¨ã„ãŸæ‹¡å¼µæ©Ÿèƒ½ä½œæˆæ–¹æ³•ã®è©³ç´°ã«ã¤ã„ã¦ã‚‚æœ¬è¨˜äº‹ã§ã¯èª¬æ˜ã—ã¾ã›ã‚“ã€‚è©³ç´°ã‚’çŸ¥ã‚ŠãŸã„æ–¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚<ul><li><a href="/articles/20221124a/">Language Server Protocolã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º (å‰ç·¨) | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li><li><a href="/articles/20221125a/">Language Server Protocolã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º (å¾Œç·¨) | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li></ul></li><li>napi-rsã§ä½œæˆã—ãŸNode.jsã‚¢ãƒ‰ã‚ªãƒ³ã®å…¬é–‹æ–¹æ³•</li><li>ä½œæˆã—ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½ã®å…¬é–‹æ–¹æ³•</li></ul><h1 id="ç’°å¢ƒ"><a href="#ç’°å¢ƒ" class="headerlink" title="ç’°å¢ƒ"></a>ç’°å¢ƒ</h1><ul><li>OS: Windows 10 Pro</li><li>VSCode: 1.73.1</li><li>Node.js: v16.17.1</li><li>rustc: 1.64.0 (a55dd71d5 2022-09-19)</li><li>npm: 8.15.0</li><li>yarn: 1.22.19</li><li>napi-rs&#x2F;cli: 2.12.0</li><li>vsce: 2.14.0</li></ul><h1 id="ä½œæˆã™ã‚‹VSCodeæ‹¡å¼µæ©Ÿèƒ½ã®ä»•æ§˜"><a href="#ä½œæˆã™ã‚‹VSCodeæ‹¡å¼µæ©Ÿèƒ½ã®ä»•æ§˜" class="headerlink" title="ä½œæˆã™ã‚‹VSCodeæ‹¡å¼µæ©Ÿèƒ½ã®ä»•æ§˜"></a>ä½œæˆã™ã‚‹VSCodeæ‹¡å¼µæ©Ÿèƒ½ã®ä»•æ§˜</h1><p>ä½œæˆã™ã‚‹VSCodeæ‹¡å¼µæ©Ÿèƒ½ã®ä»•æ§˜ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p><ul><li><a href="https://microsoft.github.io/language-server-protocol/">Language Server Protocol</a>ã‚’åˆ©ç”¨ã™ã‚‹</li><li>ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã§å®Ÿè¡Œã§ãã‚‹</li><li>ç¯„å›²é¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®ç¯„å›²ã®SQLã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹</li><li>ç¯„å›²é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã€å…¨ä½“ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹</li></ul><img src="/images/20221228a/format_extension.gif" alt="format_extension.gif" width="1200" height="675" loading="lazy"><h1 id="å‡¦ç†ã®æµã‚Œ"><a href="#å‡¦ç†ã®æµã‚Œ" class="headerlink" title="å‡¦ç†ã®æµã‚Œ"></a>å‡¦ç†ã®æµã‚Œ</h1><p>ä½œæˆã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã®å‡¦ç†ã®æµã‚Œã‚’èª¬æ˜ã—ã¾ã™ã€‚</p><img src="/images/20221228a/df88766a-9fef-6408-5603-1c17bed7619c.png" alt="" width="1200" height="1190" loading="lazy"><p>å‡¦ç†ã®æµã‚Œã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚</p><ol><li>ã¾ãšãƒ¦ãƒ¼ã‚¶ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ãŸã„SQLã‚’ç¯„å›²é¸æŠã—ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</li><li>ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚’Language Serverã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæ¤œçŸ¥ã—ã€ã‚µãƒ¼ãƒã«é¸æŠç¯„å›²ã®æƒ…å ±ã‚’é€ä¿¡ã—ã¾ã™ã€‚</li><li>ã‚µãƒ¼ãƒã¯é¸æŠç¯„å›²ã®SQLã‚’å–å¾—ã—ã¾ã™ã€‚å–å¾—ã—ãŸSQLã‚’å¼•æ•°ã«ä¸ãˆã¦SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</li><li>SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã¯å¼•æ•°ã¨ã—ã¦å—ã‘å–ã£ãŸSQLã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿SQLã‚’è¿”ã—ã¾ã™ã€‚</li><li>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿SQLã‚’å—ã‘å–ã£ãŸã‚µãƒ¼ãƒã¯é¸æŠç¯„å›²ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿SQLã«ç½®ãæ›ãˆã‚‹ã‚ˆã†ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã—ã¾ã™ã€‚</li></ol><p>SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã¯Rustã€è‡ªä½œLanguage Serverã¯TypeScriptã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€ç›´æ¥SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚</p><p>ãã“ã§ã€napi-rsã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€TypeScriptã‹ã‚‰Rustã§æ›¸ã‹ã‚ŒãŸSQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚</p><h1 id="TypeScriptã‹ã‚‰Rustã®å‘¼ã³å‡ºã—"><a href="#TypeScriptã‹ã‚‰Rustã®å‘¼ã³å‡ºã—" class="headerlink" title="TypeScriptã‹ã‚‰Rustã®å‘¼ã³å‡ºã—"></a>TypeScriptã‹ã‚‰Rustã®å‘¼ã³å‡ºã—</h1><p>ã¾ãšTypeScriptã‹ã‚‰Rustã‚’å‘¼ã³å‡ºã™æ–¹æ³•ã¨ã—ã¦ä»¥ä¸‹ã®3ã¤ã®æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚</p><div class="scroll"><table><thead><tr><th>æ–¹æ³•</th><th>ä½¿ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«</th><th>ãƒ¡ãƒªãƒƒãƒˆ</th><th>ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ</th></tr></thead><tbody><tr><td>Rustã‚³ãƒ¼ãƒ‰ã®wasmåŒ–</td><td>rustc ã¾ãŸã¯ wasm-pack</td><td>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ä¾å­˜ã—ãªã„ãŸã‚ç§»æ¤æ€§ãŒé«˜ã„</td><td>C&#x2F;C++ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã®ãŒé›£ã—ã„</td></tr><tr><td>Rustã‚³ãƒ¼ãƒ‰ã®Node.jsã‚¢ãƒ‰ã‚ªãƒ³åŒ–</td><td>napi-rs</td><td>C&#x2F;C++ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã‚‚æ¯”è¼ƒçš„ç°¡å˜ã«ãƒ“ãƒ«ãƒ‰ã§ãã‚‹</td><td>ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦</td></tr><tr><td>Rustã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ã—ãŸã‚‚ã®ã‚’execã§å‘¼ã³å‡ºã™</td><td>rustc</td><td>ç‰¹åˆ¥ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã‚ãªãã¦ã‚‚å¯èƒ½</td><td>ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ <br>   ç¶ºéº—ãªæ–¹æ³•ã¨ã¯è¨€ãˆãªã„ãŸã‚æœ€å¾Œã®æ‰‹æ®µ</td></tr></tbody></table></div><p>wasmã¨Node.jsã‚¢ãƒ‰ã‚ªãƒ³ã®æ€§èƒ½å·®ã¯ç¾æ™‚ç‚¹ã§ã¯èª¿æŸ»ã—ã¾ã—ãŸãŒã‚ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚(ã‚‚ã—ã‚ã‹ã‚‹æ–¹ãŒã„ã‚Œã°æ•™ãˆã¦ãã ã•ã„)<br>ã—ã‹ã—ã€ç§»æ¤æ€§ã®è¦³ç‚¹ã‹ã‚‰ã§ãã‚‹é™ã‚Šwasmã®ã»ã†ãŒNode.jsã‚¢ãƒ‰ã‚ªãƒ³ã‚ˆã‚Šã‚‚è‰¯ã„ã¨ã„ã†æ„è¦‹ãŒå¤šãè¦‹å—ã‘ã‚‰ã‚Œã¾ã—ãŸã€‚</p><ul><li><a href="https://sprkl.dev/performance-rust-node-js/">Performance: Rust and its relationship with Node.js</a></li><li><a href="https://www.reddit.com/r/rust/comments/xhg78i/how_do_napi_works_compare_to_wasm_and_what_are/">How do NAPI works compare to WASM, and what are the use cases suiting each one? : rust</a></li></ul><p>ã—ã‹ã—ã€SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã¯å†…éƒ¨çš„ã«Cã§æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã“ã¨ãŒè¦å› ã§wasmåŒ–ãŒã†ã¾ãã„ã‹ãªã‹ã£ãŸãŸã‚ã€ä»Šå›ã¯napi-rsã‚’ç”¨ã„ã¦Node.jsã‚¢ãƒ‰ã‚ªãƒ³åŒ–ã™ã‚‹æ–¹æ³•ã‚’é¸æŠã—ã¾ã—ãŸã€‚</p><h2 id="Node-API"><a href="#Node-API" class="headerlink" title="Node-API"></a>Node-API</h2><p>napi-rsã«ã¤ã„ã¦ç´¹ä»‹ã™ã‚‹å‰ã«Node-APIã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚<br>Node-APIã¨ã¯Node 8.0.0ã§å°å…¥ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ã§ã€C&#x2F;C++ã‚³ãƒ¼ãƒ‰ã‚’Node.jsã®ã‚¢ãƒ‰ã‚ªãƒ³åŒ–ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>Node-APIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€C&#x2F;C++ã‚³ãƒ¼ãƒ‰ã‚’JavaScriptã§è¨˜è¿°ã•ã‚ŒãŸã‚‚ã®ã¨åŒæ§˜ã®æ–¹æ³•ã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><h2 id="napi-rsã¨ã¯"><a href="#napi-rsã¨ã¯" class="headerlink" title="napi-rsã¨ã¯"></a>napi-rsã¨ã¯</h2><p><a href="https://napi.rs/">napi-rs</a>ã¨ã¯Node-APIã‚’Rustã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã‚‚ã®ã§ã™ã€‚<br>ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªRustã‚³ãƒ¼ãƒ‰ã‚’napi-rsã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚</p><figure class="highlight rust"><figcaption><span>example.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![deny(clippy::all)]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> napi_derive;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[napi]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sum</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">  a + b + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã™ã‚‹ã¨ã€Node.jsã‚¢ãƒ‰ã‚ªãƒ³ãŒç”Ÿæˆã•ã‚Œã€JavaScriptã‹ã‚‰Rustã®é–¢æ•°ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight javascript"><figcaption><span>example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; sum &#125; = <span class="built_in">require</span>(<span class="string">&quot;./index.js&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line"><span class="comment">// 7</span></span><br></pre></td></tr></table></figure><div class="note info" style="background: #e5f8e2; padding:16px; margin:24px 12px; border-radius:8px;">  <span class="fa fa-fw fa-check-circle"></span>  <p>ã¡ãªã¿ã«ã€Node-APIã¯å…ƒã€…ã®åç§°ãŒN-APIã ã£ãŸã®ã§ã™ãŒã€ã—ã°ã—ã°ã€ŒNAPIã€ã¨ç™ºéŸ³ã•ã‚Œã€è”‘ç§°ã¨é–“é•ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã®æ‡¸å¿µã‹ã‚‰ç¾åœ¨ã®Node-APIã«åç§°ã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚ãã®ãŸã‚ã€napi-rsã«ãŠã„ã¦ã‚‚ã€"ã‚¨ãƒŒã‚¨ãƒ¼ãƒ”ãƒ¼ã‚¢ã‚¤"ã¨ç™ºéŸ³ã—ãŸã»ã†ãŒè‰¯ã•ãã†ã§ã™ã€‚</p><a href="https://codezine.jp/article/detail/14109">N-APIãŒã€ŒNode-APIã€ã¸åç§°å¤‰æ›´ã€æ—¢å­˜ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ã‚¢ãƒ‰ã‚ªãƒ³ã¸ã®å½±éŸ¿ã¯ãƒŠã‚·|CodeZineï¼ˆã‚³ãƒ¼ãƒ‰ã‚¸ãƒ³ï¼‰</a></div><h2 id="napi-rsã®ä½¿ã„æ–¹"><a href="#napi-rsã®ä½¿ã„æ–¹" class="headerlink" title="napi-rsã®ä½¿ã„æ–¹"></a>napi-rsã®ä½¿ã„æ–¹</h2><p>napi-rsã®ä½¿ã„æ–¹ã‚’èª¬æ˜ã—ã¾ã™ã€‚</p><div class="note warn" style="background:#fdf9e2; padding:16px; margin:24px 12px; border-radius:8px;">  <span class="fa fa-fw fa-check-circle"></span>  <p>napi-rsã§ã¯x86_64-pc-windows-gnuã®ç’°å¢ƒã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ã‚‚ã—windowsã§gnuç‰ˆrustã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ã¯msvcç‰ˆã®Rustã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚</p></div><h3 id="1-CLIãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#1-CLIãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="1. CLIãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>1. CLIãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3><p>yarnã§napi-rsã®CLIãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚<br>ã¾ãšyarnã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ä»¥é™ã‚‚yarnãŒå¿…è¦ã«ãªã‚‹ãŸã‚ã€å¿…ãšã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g yarn</span><br></pre></td></tr></table></figure><p>napi-rsã®CLIãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn global add @napi-rs/cli</span><br></pre></td></tr></table></figure><p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«æˆåŠŸã™ã‚‹ã¨<code>napi</code>ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><h3 id="2-æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ"><a href="#2-æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ" class="headerlink" title="2. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ"></a>2. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h3><p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸCLIãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚<br>æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">napi new</span><br></pre></td></tr></table></figure><p>ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®è³ªå•ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€é †ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»»æ„ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å</span></span><br><span class="line">? Package name: (The name filed in your package.json)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå</span></span><br><span class="line">? Dir name</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ã‚µãƒãƒ¼ãƒˆã—ãŸã„å®Ÿè¡Œç’°å¢ƒ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">publishæ™‚ã«ã“ã“ã§é¸ã‚“ã å®Ÿè¡Œç’°å¢ƒãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã™</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: x86_64-apple-darwin, x86_64-pc-windows-msvc, x86_64-unknown-linux-gnu</span></span><br><span class="line">? Choose targets you want to support</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GitHub Actionsã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹å¦ã‹</span></span><br><span class="line">? Enable github actions? (Y/n)</span><br></pre></td></tr></table></figure><!--:::note warnx86_64-pc-windows-gnuã®ç’°å¢ƒã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€msvcç‰ˆã®Rustã‚’å…¥ã‚Œã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚ã—ã‹ã—ã€gnuç‰ˆRustã®ç’°å¢ƒã§ã‚‚å¾Œè¿°ã®æ“ä½œã‚’ã™ã‚Œã°ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚‚ã—ãã®ã‚ˆã†ãªç’°å¢ƒã§è©¦ã—ãŸã„æ–¹ã¯ã€ã¨ã‚Šã‚ãˆãšã€Œã‚µãƒãƒ¼ãƒˆã—ãŸã„å®Ÿè¡Œç’°å¢ƒã€ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾é€²ã‚ã¦ãã ã•ã„ã€‚:::--><p>è³ªå•ã«å›ç­”ã™ã‚‹ã¨æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¾ã™ã€‚<br>ã“ã‚Œã§Node.js add-onã‚’ä½œã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå®Œæˆã—ã¾ã—ãŸã€‚</p><h3 id="3-ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ"><a href="#3-ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ" class="headerlink" title="3. ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ"></a>3. ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ</h3><p>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®<code>src/lib.rs</code>ã«æ—¢ã«ã‚µãƒ³ãƒ—ãƒ«ã®Rustã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚é–¢æ•°sumã¯2ã¤ã®å¼•æ•°ã®åˆè¨ˆã‚’è¿”ã™é–¢æ•°ã§ã™ã€‚</p><figure class="highlight rust"><figcaption><span>src/lib.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![deny(clippy::all)]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> napi_derive;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[napi]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sum</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">  a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã‚’Node.jsã‚¢ãƒ‰ã‚ªãƒ³ã¸ãƒ“ãƒ«ãƒ‰ã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚<br>ã¾ãšå…ˆã»ã©ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn build</span><br></pre></td></tr></table></figure><p>ãƒ“ãƒ«ãƒ‰ã«æˆåŠŸã™ã‚‹ã¨ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã«<code>index.d.ts</code>ã€<code>index.js</code>ã€<code>&lt;ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå&gt;.&lt;ç’°å¢ƒ&gt;.node</code>ãŒä½œæˆã•ã‚Œã¾ã™ã€‚</p><p><code>index.js</code>ã«ã¯ç’°å¢ƒã«åˆã£ãŸnodeãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã‚Œã‚‹å‡¦ç†ãŒæ›¸ã„ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€<code>index.js</code>ã‚’importã™ã‚‹ã“ã¨ã§è‡ªå‹•çš„ã«ç’°å¢ƒã«åˆã£ãŸnodeãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã€ãã“ã«å«ã¾ã‚Œã‚‹é–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><p>ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã«ä½œæˆã—ã¾ã™ã€‚</p><figure class="highlight javascript"><figcaption><span>test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; sum &#125; = <span class="built_in">require</span>(<span class="string">&quot;./index.js&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure><p>å®Ÿè¡Œã—ã¦â€7â€ã¨ã„ã†å‡ºåŠ›ãŒè¿”ã£ã¦ããŸã‚‰æˆåŠŸã§ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node test.js</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7</span></span><br></pre></td></tr></table></figure><h2 id="SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’JavaScriptã‹ã‚‰å®Ÿè¡Œ"><a href="#SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’JavaScriptã‹ã‚‰å®Ÿè¡Œ" class="headerlink" title="SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’JavaScriptã‹ã‚‰å®Ÿè¡Œ"></a>SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’JavaScriptã‹ã‚‰å®Ÿè¡Œ</h2><p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å¤‰æ›´ã—ã¦SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’JavaScriptã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ã€‚</p><h3 id="1-æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ"><a href="#1-æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ" class="headerlink" title="1. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ"></a>1. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h3><p>å…ˆè¿°ã—ãŸæ–¹æ³•ã§æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯uroborosql-fmt-napiã¨ã—ã¦ã„ã¾ã™ã€‚</p><h3 id="2-src-lib-rsã‚’å¤‰æ›´ã—ã€ãƒ“ãƒ«ãƒ‰"><a href="#2-src-lib-rsã‚’å¤‰æ›´ã—ã€ãƒ“ãƒ«ãƒ‰" class="headerlink" title="2. src/lib.rsã‚’å¤‰æ›´ã—ã€ãƒ“ãƒ«ãƒ‰"></a>2. <code>src/lib.rs</code>ã‚’å¤‰æ›´ã—ã€ãƒ“ãƒ«ãƒ‰</h3><p><code>src/lib.rs</code>ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚<br>SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®ã‚¯ãƒ¬ãƒ¼ãƒˆåã¯<code>uroborosql_fmt</code>ã§ã€<code>format_sql()</code>é–¢æ•°ã«SQLæ–‡ã‚’æ¸¡ã™ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸSQLãŒè¿”ã£ã¦ãã¾ã™ã€‚</p><figure class="highlight rust"><figcaption><span>src/lib.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![deny(clippy::all)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> uroborosql_fmt::format_sql;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> napi_derive;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[napi]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">runfmt</span>(input: <span class="type">String</span>) <span class="punctuation">-&gt;</span>  <span class="type">String</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">format_sql</span>(&amp;input)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn build</span><br></pre></td></tr></table></figure><p>ç§ã®ç’°å¢ƒã¯win32-x64-msvcã§ã‚ã‚‹ãŸã‚ã€<code>index.d.ts</code>ã€<code>index.ts</code>ã€<code>uroborosql-fmt-napi.win32-x64-msvc.node</code>ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚</p><h3 id="3-run-jsã®ä½œæˆã€å®Ÿè¡Œ"><a href="#3-run-jsã®ä½œæˆã€å®Ÿè¡Œ" class="headerlink" title="3. run.jsã®ä½œæˆã€å®Ÿè¡Œ"></a>3. run.jsã®ä½œæˆã€å®Ÿè¡Œ</h3><p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã«run.jsã‚’ä½œæˆã—ã¾ã™ã€‚å¤‰æ•°targetã«ã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ãŸã„SQLæ–‡ã‚’æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight javascript"><figcaption><span>run.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; runfmt &#125; = <span class="built_in">require</span>(<span class="string">&quot;./index.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> target = <span class="string">`</span></span><br><span class="line"><span class="string">SELECT</span></span><br><span class="line"><span class="string">      Identifier as id, --ID</span></span><br><span class="line"><span class="string">student_name          --              å­¦ç”Ÿå</span></span><br><span class="line"><span class="string">FROM</span></span><br><span class="line"><span class="string">  japanese_student_table</span></span><br><span class="line"><span class="string">AS JPN_STD --æ—¥æœ¬äººå­¦ç”Ÿ</span></span><br><span class="line"><span class="string">,       SUBJECT_TABLE AS SBJ  --ç§‘ç›®</span></span><br><span class="line"><span class="string">WHERE</span></span><br><span class="line"><span class="string">  JPN_STD.sportId = (SELECT</span></span><br><span class="line"><span class="string">         sportId   FROM</span></span><br><span class="line"><span class="string">    Sport</span></span><br><span class="line"><span class="string">                         WHERE</span></span><br><span class="line"><span class="string">             Sport.sportname</span></span><br><span class="line"><span class="string">    = &#x27;baseball&#x27;</span></span><br><span class="line"><span class="string">                    )   -- é‡çƒã‚’ã—ã¦ã„ã‚‹ç”Ÿå¾’</span></span><br><span class="line"><span class="string">    AND</span></span><br><span class="line"><span class="string">JPN_STD.ID  = SBJ.ID</span></span><br><span class="line"><span class="string">AND SBJ.grade   &gt;</span></span><br><span class="line"><span class="string">            /*grade*/50     --æˆç¸¾ãŒ50ç‚¹ä»¥ä¸Š</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">runfmt</span>(target));</span><br></pre></td></tr></table></figure><p>ä½œæˆã—ãŸ<code>run.js</code>ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node run.js</span><br></pre></td></tr></table></figure><p>å‡ºåŠ›çµæœã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ãã¡ã‚“ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚æˆåŠŸã§ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">IDENTIFIER<span class="keyword">AS</span>ID<span class="comment">-- ID</span></span><br><span class="line">,STUDENT_NAME<span class="keyword">AS</span>STUDENT_NAME<span class="comment">-- å­¦ç”Ÿå</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">JAPANESE_STUDENT_TABLEJPN_STD<span class="comment">-- æ—¥æœ¬äººå­¦ç”Ÿ</span></span><br><span class="line">,SUBJECT_TABLESBJ<span class="comment">-- ç§‘ç›®</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">JPN_STD.SPORTID<span class="operator">=</span>(</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">SPORTID</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">SPORT</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">SPORT.SPORTNAME<span class="operator">=</span><span class="string">&#x27;BASEBALL&#x27;</span></span><br><span class="line">)<span class="comment">-- é‡çƒã‚’ã—ã¦ã„ã‚‹ç”Ÿå¾’</span></span><br><span class="line"><span class="keyword">AND</span>JPN_STD.ID<span class="operator">=</span>SBJ.ID</span><br><span class="line"><span class="keyword">AND</span>SBJ.GRADE<span class="operator">&gt;</span><span class="comment">/*grade*/</span><span class="number">50</span><span class="comment">-- æˆç¸¾ãŒ50ç‚¹ä»¥ä¸Š</span></span><br></pre></td></tr></table></figure><h2 id="ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰"><a href="#ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰" class="headerlink" title="ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰"></a>ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰</h2><p>ç¾åœ¨ã¯ãƒ“ãƒ«ãƒ‰ã—ãŸç’°å¢ƒ(win32-x64-msvc)ã§ã—ã‹ä½œæˆã—ãŸNode.jsã‚¢ãƒ‰ã‚ªãƒ³ãŒå‹•ä½œã—ã¾ã›ã‚“ã€‚<br>ãã“ã§GitHub Actionsã‚’ä½¿ã£ã¦ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã„ã¾ã™ã€‚</p><h3 id="0-CI-ymlã®ä½œæˆ"><a href="#0-CI-ymlã®ä½œæˆ" class="headerlink" title="0. CI.ymlã®ä½œæˆ"></a>0. CI.ymlã®ä½œæˆ</h3><p>ã‚‚ã—napi-rsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ™‚ã«GitHub Actionsã‚’æœ‰åŠ¹ã«ã—ã¦ã„ãªã‹ã£ãŸå ´åˆã¯ã“ã¡ã‚‰ã®ä½œæ¥­ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p><ol><li>é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§<code>napi new</code></li><li>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¯é©å½“ã«å…¥åŠ›</li><li>ã‚µãƒãƒ¼ãƒˆã—ãŸã„å®Ÿè¡Œç’°å¢ƒã‚’é¸æŠ<br>  (ä»Šå›ä½œæˆã—ã¦ã„ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã§ã¯ã§ãã‚‹ã ã‘å¤šãã®ç’°å¢ƒã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã‹ã£ãŸãŸã‚ã€ã§å…¨ã¦ã®å®Ÿè¡Œç’°å¢ƒã‚’é¸æŠ)</li><li>GitHub Actionsã‚’æœ‰åŠ¹ã«ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ</li><li>å®Œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®<code>.github</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ç¾åœ¨ä½œæ¥­ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒšãƒ¼ã‚¹ãƒˆ</li></ol><h3 id="1-yarn-lockã®ä½œæˆ"><a href="#1-yarn-lockã®ä½œæˆ" class="headerlink" title="1. yarn.lockã®ä½œæˆ"></a>1. yarn.lockã®ä½œæˆ</h3><p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br></pre></td></tr></table></figure><p>yarn.lockãŒä½œæˆã€ã¾ãŸã¯æ›´æ–°ã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚</p><h3 id="2-CI-ymlã®ç·¨é›†ã€GitHub-Actionsã®å®Ÿè¡Œ"><a href="#2-CI-ymlã®ç·¨é›†ã€GitHub-Actionsã®å®Ÿè¡Œ" class="headerlink" title="2. CI.ymlã®ç·¨é›†ã€GitHub Actionsã®å®Ÿè¡Œ"></a>2. CI.ymlã®ç·¨é›†ã€GitHub Actionsã®å®Ÿè¡Œ</h3><p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯GitHubã«pushã™ã‚‹ã¨GitHub ActionsãŒè‡ªå‹•çš„ã«å‹•ã„ã¦ä»¥ä¸‹ã®å‡¦ç†ã‚’è¡Œã£ã¦ãã‚Œã¾ã™ã€‚</p><ol><li>å„ç’°å¢ƒã«å¯¾å¿œã—ãŸNode.jsã‚¢ãƒ‰ã‚ªãƒ³ã‚’ãƒ“ãƒ«ãƒ‰</li><li>npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®publish</li></ol><p>ä»Šå›ã¯npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®publishã¯è¡Œã‚ãªã„ãŸã‚ã€<code>.github/workflows/CI.yml</code>ã®publishä»¥ä¸‹ã‚’ã™ã¹ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚<br>publishæ–¹æ³•ã‚’çŸ¥ã‚ŠãŸã„æ–¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><ul><li><a href="https://shisama.hatenablog.com/entry/2021/12/03/054437#napi-rs%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9Fnpm-publish">Rust + Node-APIã§ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å‘ã‘npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹ - åˆ¥ã«ã—ã‚“ã©ããªã„ãƒ–ãƒ­ã‚°</a></li></ul><p>GitHub Actionsã§ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†ã¨ã€13å€‹ã®ç’°å¢ƒã®ã†ã¡11å€‹ã®ç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚Rustè£½SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãŒå†…éƒ¨çš„ã«C&#x2F;C++ã®ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã“ã¨ãŒåŸå› ã®1ã¤ã§ã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ãã®ãŸã‚ã€é€šå¸¸ã®Rustãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Œã°ã‚‚ã†å°‘ã—æˆåŠŸã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚<br>è©¦è¡ŒéŒ¯èª¤ã—ã¦<code>.github/workflows/CI.yml</code>ã‚’ç·¨é›†ã™ã‚‹ã¨ã€æœ€çµ‚çš„ã«13å€‹ä¸­7å€‹ã®ç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ç§ãŒå®Ÿæ–½ã—ãŸå¤‰æ›´ã‚’å‚è€ƒç¨‹åº¦ã«ç¤ºã—ã¾ã™ã€‚</p><h4 id="CI-ymlã®å¤‰æ›´1-é•·ã„ãƒ‘ã‚¹ã«å¯¾å¿œ"><a href="#CI-ymlã®å¤‰æ›´1-é•·ã„ãƒ‘ã‚¹ã«å¯¾å¿œ" class="headerlink" title="CI.ymlã®å¤‰æ›´1: é•·ã„ãƒ‘ã‚¹ã«å¯¾å¿œ"></a><code>CI.yml</code>ã®å¤‰æ›´1: é•·ã„ãƒ‘ã‚¹ã«å¯¾å¿œ</h4><p>hostãŒwindows-latestã§ã‚ã‚‹ç’°å¢ƒã®buildã«ä»¥ä¸‹ã®å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --system core.longpaths true</span><br></pre></td></tr></table></figure><h4 id="CI-ymlã®å¤‰æ›´2-yarn-testã®å‰Šé™¤"><a href="#CI-ymlã®å¤‰æ›´2-yarn-testã®å‰Šé™¤" class="headerlink" title="CI.ymlã®å¤‰æ›´2: yarn testã®å‰Šé™¤"></a><code>CI.yml</code>ã®å¤‰æ›´2: yarn testã®å‰Šé™¤</h4><p>targetãŒi686-pc-windows-msvcã®å ´åˆã®ã¿ãƒ“ãƒ«ãƒ‰æ™‚ã«<code>yarn test</code>ãŒèµ°ã£ã¦ã„ã¾ã™ã€‚æœ¬æ¥ã¯æ¶ˆã™ã¹ãã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä»Šå›ã¯ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãªã„ã®ã§ã¨ã‚Šã‚ãˆãšå‰Šé™¤ã—ã¾ã—ãŸã€‚</p><h4 id="CI-ymlã®å¤‰æ›´3-aarch64-apple-darwinã«ãŠã‘ã‚‹ä¸€éƒ¨å‡¦ç†ã®å‰Šé™¤"><a href="#CI-ymlã®å¤‰æ›´3-aarch64-apple-darwinã«ãŠã‘ã‚‹ä¸€éƒ¨å‡¦ç†ã®å‰Šé™¤" class="headerlink" title="CI.ymlã®å¤‰æ›´3: aarch64-apple-darwinã«ãŠã‘ã‚‹ä¸€éƒ¨å‡¦ç†ã®å‰Šé™¤"></a><code>CI.yml</code>ã®å¤‰æ›´3: aarch64-apple-darwinã«ãŠã‘ã‚‹ä¸€éƒ¨å‡¦ç†ã®å‰Šé™¤</h4><p>targetãŒaarch64-apple-darwinã®å ´åˆã®ãƒ“ãƒ«ãƒ‰å‡¦ç†ã®ä¸Š5è¡Œã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚æœ€çµ‚çš„ã«ãƒ“ãƒ«ãƒ‰å‡¦ç†ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn build --target aarch64-apple-darwin</span><br><span class="line">strip -x *.node</span><br></pre></td></tr></table></figure><h3 id="3-æˆæœç‰©ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"><a href="#3-æˆæœç‰©ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" class="headerlink" title="3. æˆæœç‰©ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"></a>3. æˆæœç‰©ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h3><p>GitHub Actionsã§ãƒ“ãƒ«ãƒ‰ã—ãŸå„ç’°å¢ƒã®Node.jsã‚¢ãƒ‰ã‚ªãƒ³ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚<br>GitHubã®ãƒªãƒã‚¸ãƒˆãƒª &gt; Actions &gt; æœ€æ–°ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ç§»å‹•ã—ã€ãƒšãƒ¼ã‚¸æœ€ä¸‹éƒ¨ã®Artifactsã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚<br><img src="/images/20221228a/image.png" alt="image.png" width="1200" height="392" loading="lazy"><br>å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã™ã‚‹ã¨ã€å„ç’°å¢ƒã«åˆã£ãŸNode.jsã‚¢ãƒ‰ã‚ªãƒ³ãŒå–å¾—ã§ãã¾ã™ã€‚</p><h2 id="nodeãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã¨ã‚ã¦åœ§ç¸®"><a href="#nodeãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã¨ã‚ã¦åœ§ç¸®" class="headerlink" title="nodeãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã¨ã‚ã¦åœ§ç¸®"></a>nodeãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã¨ã‚ã¦åœ§ç¸®</h2><ol><li>é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ</li><li>å¯¾å¿œã—ãŸã„ç’°å¢ƒã®nodeãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¨ã¦ç½®ã</li><li>napi-rsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®<code>index.d.ts</code>ã¨<code>index.js</code>ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒšãƒ¼ã‚¹ãƒˆ</li><li>package.jsonã‚’ä½œæˆ (nameã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å)<br>ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®åå‰ãŒuroborosql-fmtã§ã‚ã‚‹ãŸã‚ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯uroborosql-fmt-napiã¨ã—ã¾ã—ãŸã€‚ <figure class="highlight plaintext"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;uroborosql-fmt-napi&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;types&quot;: &quot;index.d.ts&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;MIT&quot;,</span><br><span class="line">  &quot;engines&quot;: &#123;</span><br><span class="line">    &quot;node&quot;: &quot;&gt;= 10&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦åœ§ç¸® <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm pack</span><br></pre></td></tr></table></figure></li><li><code>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå-ãƒãƒ¼ã‚¸ãƒ§ãƒ³.tgz</code>ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚Œã°æˆåŠŸ</li></ol><p>ä»Šå›ã®ä¾‹ã§ã¯<code>uroborosql-fmt-napi-0.0.0.tgz</code>ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚</p><h1 id="æ‹¡å¼µæ©Ÿèƒ½ã®ä½œæˆ"><a href="#æ‹¡å¼µæ©Ÿèƒ½ã®ä½œæˆ" class="headerlink" title="æ‹¡å¼µæ©Ÿèƒ½ã®ä½œæˆ"></a>æ‹¡å¼µæ©Ÿèƒ½ã®ä½œæˆ</h1><p>â€»å†æ²<br><img src="/images/20221228a/df88766a-9fef-6408-5603-1c17bed7619c_2.png" alt="" width="1200" height="1190" loading="lazy"></p><p>TypeScriptã‹ã‚‰SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€æ¬¡ã«æ‹¡å¼µæ©Ÿèƒ½éƒ¨åˆ†ã‚’ä½œæˆã—ã¾ã™ã€‚<br>æœ¬è¨˜äº‹ã§ã¯<a href="https://github.com/microsoft/vscode-extension-samples/tree/main/lsp-sample">microsoft&#x2F;vscode-extension-samples&#x2F;lsp-sample</a>ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã™ã€‚</p><p>LSPã‚’ç”¨ã„ãŸæ‹¡å¼µæ©Ÿèƒ½ä½œæˆæ–¹æ³•ã®è©³ç´°ã‚’çŸ¥ã‚ŠãŸã„æ–¹ã¯ä»¥ä¸‹ã‚’ã”è¦§ãã ã•ã„ã€‚æœ¬è¨˜äº‹ã§ã¯ç°¡å˜ã«è§£èª¬ã—ã¾ã™ã€‚</p><ul><li><a href="/articles/20221124a/">Language Server Protocolã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º (å‰ç·¨) | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li><li><a href="/articles/20221125a/">Language Server Protocolã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º (å¾Œç·¨) | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li></ul><h2 id="æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®š"><a href="#æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®š" class="headerlink" title="æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®š"></a>æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®š</h2><p><code>package.json</code>ã‚’å¤‰æ›´ã—ã¦æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚</p><p>ã¾ãšã€VSCodeãŒèµ·å‹•ã•ã‚Œã‚‹ã¨æ‹¡å¼µæ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p><figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;activationEvents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ã€Œformat sqlã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚</p><figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;contributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;commands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uroborosql-fmt.uroborosql-format&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;format sql&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"><a href="#ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ" class="headerlink" title="ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"></a>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</h2><p><code>client/src/extension.ts</code>ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</p><p><code>clientOptions</code>å†…ã®<code>documentSelector</code>ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã€å…¨ã¦ã®å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã€ä¿å­˜ã•ã‚Œã¦ã„ãªã„Untitledãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‹¡å¼µæ©Ÿèƒ½ã®å¯¾è±¡ã¨ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>client/src/extension.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">documentSelector</span>: [</span><br><span class="line">  &#123; <span class="attr">pattern</span>: <span class="string">&quot;**&quot;</span>, <span class="attr">scheme</span>: <span class="string">&quot;file&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">pattern</span>: <span class="string">&quot;**&quot;</span>, <span class="attr">scheme</span>: <span class="string">&quot;untitled&quot;</span> &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p><code>uroborosql-fmt.uroborosql-format</code>ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸã‚‰<code>uroborosql-fmt.executeFormat</code>ã®å®Ÿè¡Œæƒ…å ±ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®uriã€versionã€é¸æŠç¯„å›²ã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>client/src/extension.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">context.<span class="property">subscriptions</span>.<span class="title function_">push</span>(</span><br><span class="line">  commands.<span class="title function_">registerCommand</span>(<span class="string">&quot;uroborosql-fmt.uroborosql-format&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> uri = <span class="variable language_">window</span>.<span class="property">activeTextEditor</span>.<span class="property">document</span>.<span class="property">uri</span>;</span><br><span class="line">    <span class="keyword">const</span> version = <span class="variable language_">window</span>.<span class="property">activeTextEditor</span>.<span class="property">document</span>.<span class="property">version</span>;</span><br><span class="line">    <span class="keyword">const</span> selections = <span class="variable language_">window</span>.<span class="property">activeTextEditor</span>.<span class="property">selections</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> client.<span class="title function_">sendRequest</span>(<span class="title class_">ExecuteCommandRequest</span>.<span class="property">type</span>, &#123;</span><br><span class="line">      <span class="attr">command</span>: <span class="string">&quot;uroborosql-fmt.executeFormat&quot;</span>,</span><br><span class="line">      <span class="attr">arguments</span>: [uri, version, selections],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="ã‚µãƒ¼ãƒ"><a href="#ã‚µãƒ¼ãƒ" class="headerlink" title="ã‚µãƒ¼ãƒ"></a>ã‚µãƒ¼ãƒ</h2><p>ã¾ãšå…ˆç¨‹<code>npm pack</code>ã§å–å¾—ã—ãŸ<code>uroborosql-fmt-napi-0.0.0.tgz</code>ã‚’serverãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ç½®ãã¾ã™ã€‚<br>ãã—ã¦ã€<code>server/package.json</code>ã®dependenciesã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line"><span class="addition">+   &quot;uroborosql-fmt-napi&quot;: &quot;file:uroborosql-fmt-napi-0.0.0.tgz&quot;,</span></span><br><span class="line">    &quot;vscode-languageserver&quot;: &quot;^7.0.0&quot;,</span><br><span class="line">    &quot;vscode-languageserver-textdocument&quot;: &quot;^1.0.4&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§Rustè£½SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’importã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p><p><code>server/src/server.ts</code>ã«ã‚µãƒ¼ãƒã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚<br>ã¾ãšãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°ã‚’importã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>server/src/server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; runfmt &#125; <span class="keyword">from</span> <span class="string">&quot;uroborosql-fmt-napi&quot;</span>;</span><br></pre></td></tr></table></figure><p>ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«é¸æŠç¯„å›²ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«è¡Œã†å‡¦ç†</span></span><br><span class="line">connection.<span class="title function_">onExecuteCommand</span>(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    params.<span class="property">command</span> !== <span class="string">&quot;uroborosql-fmt.executeFormat&quot;</span> ||</span><br><span class="line">    params.<span class="property">arguments</span> == <span class="literal">null</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> uri = params.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">external</span>;</span><br><span class="line">  <span class="comment">// uriã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—</span></span><br><span class="line">  <span class="keyword">const</span> textDocument = documents.<span class="title function_">get</span>(uri);</span><br><span class="line">  <span class="keyword">if</span> (textDocument == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´ã®å ´åˆã¯ã‚¢ãƒ¼ãƒªãƒ¼ãƒªã‚¿ãƒ¼ãƒ³</span></span><br><span class="line">  <span class="keyword">const</span> version = params.<span class="property">arguments</span>[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> (textDocument.<span class="property">version</span> !== version) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> selections = params.<span class="property">arguments</span>[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">changes</span>: <span class="title class_">TextEdit</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…¨ã¦ã®é¸æŠç¯„å›²ã«å¯¾ã—ã¦å®Ÿè¡Œ</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> selection <span class="keyword">of</span> selections) &#123;</span><br><span class="line">    <span class="comment">// ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—</span></span><br><span class="line">    <span class="keyword">const</span> text = textDocument.<span class="title function_">getText</span>(selection);</span><br><span class="line">    <span class="keyword">if</span> (text.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</span></span><br><span class="line">    changes.<span class="title function_">push</span>(<span class="title class_">TextEdit</span>.<span class="title function_">replace</span>(selection, <span class="title function_">runfmt</span>(text)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆ</span></span><br><span class="line">  <span class="keyword">if</span> (changes.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’å–å¾—</span></span><br><span class="line">    <span class="keyword">const</span> text = textDocument.<span class="title function_">getText</span>();</span><br><span class="line">    <span class="comment">// ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</span></span><br><span class="line">    changes.<span class="title function_">push</span>(</span><br><span class="line">      <span class="title class_">TextEdit</span>.<span class="title function_">replace</span>(</span><br><span class="line">        <span class="title class_">Range</span>.<span class="title function_">create</span>(</span><br><span class="line">          <span class="title class_">Position</span>.<span class="title function_">create</span>(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">          textDocument.<span class="title function_">positionAt</span>(text.<span class="property">length</span>)</span><br><span class="line">        ),</span><br><span class="line">        <span class="title function_">runfmt</span>(text)</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤‰æ›´ã‚’é©ç”¨</span></span><br><span class="line">  connection.<span class="property">workspace</span>.<span class="title function_">applyEdit</span>(&#123;</span><br><span class="line">    <span class="attr">documentChanges</span>: [</span><br><span class="line">      <span class="title class_">TextDocumentEdit</span>.<span class="title function_">create</span>(</span><br><span class="line">        &#123; <span class="attr">uri</span>: textDocument.<span class="property">uri</span>, <span class="attr">version</span>: textDocument.<span class="property">version</span> &#125;,</span><br><span class="line">        changes</span><br><span class="line">      ),</span><br><span class="line">    ],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å‹•ä½œç¢ºèª"><a href="#å‹•ä½œç¢ºèª" class="headerlink" title="å‹•ä½œç¢ºèª"></a>å‹•ä½œç¢ºèª</h2><p>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚</p><img src="/images/20221228a/formattest.gif" alt="formattest.gif" width="1200" height="675" loading="lazy"><p>ã¡ã‚ƒã‚“ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸğŸ‰</p><h1 id="æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–"><a href="#æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–" class="headerlink" title="æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–"></a>æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–</h1><p>vsceã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã‚’è¡Œã„ã¾ã™ã€‚vsceã¨ã¯VSCodeæ‹¡å¼µæ©Ÿèƒ½ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã€å…¬é–‹ã€ç®¡ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹CLIãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p><div class="note warn" style="background:#fdf9e2; padding:16px; margin:24px 12px; border-radius:8px;">  <span class="fa fa-fw fa-check-circle"></span>  <p>æœ¬è¨˜äº‹ã§ã¯æ‹¡å¼µæ©Ÿèƒ½ã®å…¬é–‹ã«ã¤ã„ã¦ã¯èª¬æ˜ã—ã¾ã›ã‚“ã€‚</p></div><h2 id="vsceã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#vsceã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="vsceã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>vsceã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h2><p>ç§ã®ç’°å¢ƒ(Windows10)ã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«æ‰‹é †ãŒå¿…è¦ã ã£ãŸã®ã§é †ã«èª¬æ˜ã—ã¾ã™ã€‚</p><h3 id="1-Python3ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#1-Python3ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="1. Python3ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>1. Python3ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3><p>Python3ãŒå¿…è¦ãªãŸã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚æ—¢ã«Python3ãŒå…¥ã£ã¦ã„ã‚‹æ–¹ã¯æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚“ã§ãã ã•ã„ã€‚</p><p>ã¾ãš<a href="https://www.python.org/downloads/">ã“ã¡ã‚‰</a>ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p><img src="/images/20221228a/image_2.png" alt="image.png" width="1200" height="522" loading="lazy"><p>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€<strong>ä¸€ç•ªä¸‹ã®ã€ŒAdd Python 3.x to PATHã€ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚</strong><br>ã€ŒInstall Nowã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ã€ŒSetup was Succesfulã€ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã§ã™ã€‚</p><h3 id="2-node-gypã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š"><a href="#2-node-gypã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š" class="headerlink" title="2. node-gypã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š"></a>2. node-gypã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š</h3><p><a href="https://github.com/nodejs/node-gyp">node-gyp</a>ã¨ã¯ã€Node.js ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ‰ã‚ªãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚æ—¢ã«å…¥ã£ã¦ã„ã¦è¨­å®šæ¸ˆã¿ã®æ–¹ã¯æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚“ã§ãã ã•ã„ã€‚</p><h4 id="node-gypã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#node-gypã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="node-gypã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>node-gypã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h4><p>ã¾ãšnode-gypã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g node-gyp</span><br></pre></td></tr></table></figure><h3 id="3-VisualStudioã®ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#3-VisualStudioã®ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="3. VisualStudioã®ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>3. VisualStudioã®ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3><p>æ¬¡ã«<a href="https://visualstudio.microsoft.com/ja/thank-you-downloading-visual-studio/?sku=BuildTools">ã“ã¡ã‚‰</a>ã‹ã‚‰VisualStudioã®ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚<br>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’èµ·å‹•ã—ã¦ã€ŒC++ã«ã‚ˆã‚‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é–‹ç™ºã€ã‚’é¸æŠã—ã¦ã€<strong>å³å´ã®ã€Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®è©³ç´°ã€ã®ä¸­ã®ã€ŒWindows 10 SDKã€ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦</strong>å³ä¸‹ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚(Windows11ã®æ–¹ã¯ã€ŒWindows 11 SDKã€ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚)</p><img src="/images/20221228a/image_3.png" alt="image.png" width="1200" height="635" loading="lazy"><h3 id="4-npmã®è¨­å®š"><a href="#4-npmã®è¨­å®š" class="headerlink" title="4. npmã®è¨­å®š"></a>4. npmã®è¨­å®š</h3><p>ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚(2022ã®éƒ¨åˆ†ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã¦é©å®œå¤‰æ›´ã—ã¦ä¸‹ã•ã„)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set msvs_version 2022</span><br></pre></td></tr></table></figure><h3 id="5-vsceã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#5-vsceã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="5. vsceã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>5. vsceã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3><p>ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g vsce</span><br></pre></td></tr></table></figure><p>vsceã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Œã°æˆåŠŸã§ã™ã€‚</p><h2 id="ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–"><a href="#ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–" class="headerlink" title="ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–"></a>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–</h2><p>å…ˆç¨‹ä½œæˆã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vsce package</span><br></pre></td></tr></table></figure><p>ã™ã‚‹ã¨ã€<code>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå-ãƒãƒ¼ã‚¸ãƒ§ãƒ³.vsix</code>ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ä»Šå›ã®ä¾‹ã§ã¯<code>uroborosql-fmt-1.0.0.vsix</code>ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚</p><p>ãã—ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code --install-extension .\uroborosql-fmt-1.0.0.vsix</span><br></pre></td></tr></table></figure><p>ç„¡äº‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãŒå‹•ãã‚ˆã†ã«ãªã£ãŸã®ã§æˆåŠŸã§ã™ ğŸ‰</p><img src="/images/20221228a/image_4.png" alt="" width="1200" height="629" loading="lazy"><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>æœ¬è¨˜äº‹ã§ã¯Rustè£½SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’VSCodeæ‹¡å¼µæ©Ÿèƒ½åŒ–ã—ãŸæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ul><li><a href="https://nodejs.github.io/node-addon-examples/about/what/">What is Node-API? Â· The Node-API Resource</a></li><li><a href="https://shisama.hatenablog.com/entry/2021/12/03/054437">Rust + Node-APIã§ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å‘ã‘npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹ - åˆ¥ã«ã—ã‚“ã©ããªã„ãƒ–ãƒ­ã‚°</a></li><li><a href="https://qiita.com/irico/items/fa60a7e077f4414f0eb6">VSCodeã®æ‹¡å¼µã‚’ä½œã£ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹ - Qiita</a></li><li><a href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension">Publishing Extensions | Visual Studio Code Extension API</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221228a/top.png&quot; alt=&quot;&quot; width=&quot;579&quot; height=&quot;216&quot;&gt;

&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼" scheme="https://future-architect.github.io/tags/%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%82%BF%E3%83%BC/"/>
    
    <category term="ã‚³ã‚¢ãƒ†ã‚¯" scheme="https://future-architect.github.io/tags/%E3%82%B3%E3%82%A2%E3%83%86%E3%82%AF/"/>
    
    <category term="VSCode" scheme="https://future-architect.github.io/tags/VSCode/"/>
    
    <category term="Rust" scheme="https://future-architect.github.io/tags/Rust/"/>
    
    <category term="napi-rs" scheme="https://future-architect.github.io/tags/napi-rs/"/>
    
  </entry>
  
  <entry>
    <title>ä¼šç¤¾ã®ãƒ—ãƒ­ã‚­ã‚·ã®è£ã§Podman Desktopã‚’å®Ÿè¡Œã™ã‚‹</title>
    <link href="https://future-architect.github.io/articles/20221227a/"/>
    <id>https://future-architect.github.io/articles/20221227a/</id>
    <published>2022-12-26T15:00:00.000Z</published>
    <updated>2022-12-29T06:14:34.770Z</updated>
    
    <content type="html"><![CDATA[<p>ã¡ã‚‡ã£ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§PostgreSQLã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è©¦ã—ãŸã„ã‘ã©Docker Desktopã®ç¨Ÿè­°ãŒé–“ã«åˆã‚ãªã„ï¼ã¿ãŸã„ãªã¨ãã®ãŸã‚ã®ãƒ¡ãƒ¢ã§ã™ã€‚</p><p>Docker Desktopã®æœ‰å„ŸåŒ–ã¨å¥‘ç´„ã™ã¹ããƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«ã¤ã„ã¦ã¯ä»¥å‰æ›¸ãã¾ã—ãŸã€‚ãã®å¾Œã€å€¤æ®µãŒã¡ã‚‡ã£ã¨ä¸ŠãŒã£ãŸã®ã¨ã€100äººä»¥ä¸Šã®Teamãƒ—ãƒ©ãƒ³ã¯è¨±å¯ã•ã‚Œãšã«Buisinessãƒ—ãƒ©ãƒ³ãŒå¿…é ˆã«ãªã‚Šã€Businessãƒ—ãƒ©ãƒ³ã§ã¯SSOãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ãŒå¤‰æ›´ç‚¹ã§ã™ã€‚</p><ul><li><a href="/articles/20220124a/">Docker Desktopæœ‰å„ŸåŒ–ï¼ã©ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¥‘ç´„ã™ã‚‹ï¼Ÿ</a></li></ul><p><a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a>ã®ä»£æ›¿ã®ã‚‚ã®ãŒã„ãã¤ã‹ã§ã¦ã„ã¾ã™ã€‚<a href="https://rancherdesktop.io/">Rancher Desktop</a>ã¨ã€<a href="https://podman-desktop.io/">Podman Desktop</a>ãŒã‚ã‚Šã¾ã™ã€‚Rancher Desktopã¯ä¼šç¤¾ã®ãƒ—ãƒ­ã‚­ã‚·ã®è£ã§å‹•ã‹ã™ã®ãŒé›£ã—ãã€ã¡ã‚‡ã£ã¨è‹¦æˆ¦ã—ãŸä¸Šã«ã€WSLã®ã‚³ãƒ³ãƒ†ãƒŠãŒå†ä½œæˆã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ—ãƒ­ã‚­ã‚·è¨­å®šãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã¨ã„ã†ã“ã¨ã‚’èã„ã¦ã€Podman Desktopã‚’ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚Podmanã¯RedHatãŒé–‹ç™ºã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆä»¥ä¸‹ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¾ã™ï¼‰ã€CLIãƒ„ãƒ¼ãƒ«ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚ãã‚Œã«ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®UIã¨Podmanè‡ªèº«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’çµ„ã¿åˆã‚ã›ãŸã‚‚ã®ãŒPodman Desktopã§ã™ã€‚</p><img src="/images/20221227a/image.png" alt="" width="1200" height="978" loading="lazy"><h1 id="ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h1><p>ä¸Šè¨˜ã®Podman Desktopã®ã‚µã‚¤ãƒˆã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚0.9ç³»ã¾ã§ã¯å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ãŒãã®ã¾ã¾ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã®ã§ã™ãŒã€æœ€æ–°ã®0.10.0ã‹ã‚‰ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã«ãªã‚Šã¾ã—ãŸã€‚å…¥ã‚Œã‚‹ã®ã¯ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã ã‘ãªã®ã§é›£ã—ããªã„ã§ã—ã‚‡ã†ã€‚èµ·å‹•ã—ãŸã‚‰ã€Podmanã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãŒåˆå›ã¯èµ·å‹•ã™ã‚‹ã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚Podmanã¯WSL2ä¸Šã§å‹•ãã‚µãƒ¼ãƒãƒ¼ã§ã€dockerdã¨ã‹ã«ã‚ãŸã‚‹ã‚‚ã®ã§ã™ã€‚åŸ·ç­†æ™‚ç‚¹ã§ã¯4.3.1ãŒå…¥ã‚Šã¾ã—ãŸã€‚</p><h1 id="ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®š"><a href="#ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®š" class="headerlink" title="ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®š"></a>ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®š</h1><p>èµ·å‹•ã—ãŸã‚‰ã€å·¦ä¸‹ã®Settingsâ†’Proxyã¨é€²ã‚“ã§ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«è¨­å®šã—ã¾ã™ã€‚èªè¨¼ãŒå¿…è¦ãªå ´åˆã¯ã€<code>http://ãƒ¦ãƒ¼ã‚¶ãƒ¼:ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰@ãƒ›ã‚¹ãƒˆ:ãƒãƒ¼ãƒˆ</code>ã¨ã„ã†å½¢å¼ã§å…¥ã‚Œã¾ã™ã€‚</p><img src="/images/20221227a/image_2.png" alt="" width="1200" height="687" loading="lazy"><p>ã“ã‚Œã ã‘ã§æ¸ˆã‚ã°DockeråŒç­‰ãªã®ã§ã™ãŒã€æ®‹å¿µãªãŒã‚‰ã‚‚ã†ã²ã¨æ‰‹é–“å¿…è¦ã§ã™ã€‚</p><h2 id="Podmanã®WSL2ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è¨­å®šå¤‰æ›´"><a href="#Podmanã®WSL2ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è¨­å®šå¤‰æ›´" class="headerlink" title="Podmanã®WSL2ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è¨­å®šå¤‰æ›´"></a>Podmanã®WSL2ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è¨­å®šå¤‰æ›´</h2><p>ãã®ã¾ã¾ã ã¨å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ—ãƒ­ã‚­ã‚·ã®ãƒ›ã‚¹ãƒˆåãŒè§£æ±ºã§ããªã„ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚ãƒãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚’å…¥ã‚Œã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãšWSL2ã‚’èµ·å‹•ã—ã¾ã™ã€‚ã¾ãšã¯resolv.confãŒä¸Šæ›¸ãã•ã‚Œãªã„ã‚ˆã†ã«wsl.confã‚’ç·¨é›†ã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wsl -d podman-machine-default</span><br><span class="line"></span><br><span class="line">(wsl2èµ·å‹•)</span><br><span class="line"></span><br><span class="line">$ sudo vi /etc/wsl.conf</span><br></pre></td></tr></table></figure><figure class="highlight ini"><figcaption><span>/etc/wsl.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[user]</span></span><br><span class="line"><span class="attr">default</span>=user</span><br><span class="line"></span><br><span class="line"><span class="section">[network]</span></span><br><span class="line"><span class="attr">generateResolvConf</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>ãã®å¾Œã¯ä¸€åº¦WSL2ã‚’å†èµ·å‹•ã—ã¾ã™ï¼ˆãã†ã—ãªã„ã¨resolve.confãŒå†ç”Ÿã—ã¦ã—ã¾ã£ãŸï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wsl --shutdown</span><br></pre></td></tr></table></figure><p>æ¬¡ã¯&#x2F;etc&#x2F;resolv.confã‚’ç·¨é›†ã—ã¾ã™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wsl -d podman-machine-default</span><br><span class="line"></span><br><span class="line">(wsl2èµ·å‹•)</span><br><span class="line"></span><br><span class="line">$ sudo vi /etc/resolv.conf</span><br></pre></td></tr></table></figure><figure class="highlight text"><figcaption><span>/etc/resolv.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameserver ãƒ—ãƒ­ã‚­ã‚·ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹</span><br></pre></td></tr></table></figure><p>ä¸€åº¦WSL2ã‹ã‚‰å‡ºã¦å†åº¦å…¥ã‚ŠãªãŠã—ã¦ã‚‚ç·¨é›†ã—ãŸresolv.confãŒæ®‹ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚</p><p>æœ€å¾Œã«podmanã®ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ã‹ã‚‰ãƒ—ãƒ­ã‚­ã‚·è¶Šã—ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã¨ã£ã¦ãã¦å®Ÿè¡Œã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚<code>docker</code>ã‚’<code>podman</code>ã«èª­ã¿æ›¿ãˆã‚‹ã ã‘ã§ä½¿ãˆã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ podman machine stop</span><br><span class="line">$ podman machine start</span><br><span class="line">$ podman run --rm hello-world</span><br><span class="line">!... Hello Podman World ...!</span><br><span class="line"></span><br><span class="line">         .--&quot;--.</span><br><span class="line">       / -     - \</span><br><span class="line">      / (O)   (O) \</span><br><span class="line">   ~~~| -=(,Y,)=- |</span><br><span class="line">    .---. /`  \   |~~</span><br><span class="line"> ~/  o  o \~~~~.----. ~~</span><br><span class="line">  | =(X)= |~  / (O (O) \</span><br><span class="line">   ~~~~~~~  ~| =(Y_)=-  |</span><br><span class="line">  ~~~~    ~~~|   U      |~~</span><br><span class="line"></span><br><span class="line">Project:   https://github.com/containers/podman</span><br><span class="line">Website:   https://podman.io</span><br><span class="line">Documents: https://docs.podman.io</span><br><span class="line">Twitter:   @Podman_io</span><br></pre></td></tr></table></figure><h1 id="ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®è¨­å®š"><a href="#ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®è¨­å®š" class="headerlink" title="ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®è¨­å®š"></a>ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®è¨­å®š</h1><p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Podmanã¯ã€docker.ioä»¥å¤–ã®ã¨ã“ã‚ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã—ãŸã‚Šã€ã„ãã¤ã‹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸åã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒå¼µã‚‰ã‚Œã¦ã„ãŸã‚Šã—ã¾ã™ã€‚ã•ãã»ã©ã®hello-worldã€Dockerã®hello-worldã¨é•ã†ã“ã¨ã«æ°—ã¥ã„ãŸæ–¹ã‚‚ã„ã‚‹ã§ã—ã‚‡ã†ã€‚hello-worldã¯<code>quay.io/podman/hello</code>ã‚’ä»£ã‚ã‚Šã«ãƒ—ãƒ«ã—ã¦ãã¾ã™ã€‚</p><p>dockerã®ã‚‚ã®ã‚’ä½¿ã†ã«ã¯ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’å¤‰æ›´ã—ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wsl -d podman-machine-default</span><br><span class="line"></span><br><span class="line">(wsl2èµ·å‹•)</span><br><span class="line"></span><br><span class="line">$ sudo vi /etc/containers/registries.conf</span><br></pre></td></tr></table></figure><p>æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚ã“ã‚Œã§docker.ioã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã ã‘ã‚’å–å¾—ã—ã¾ã™ã€‚ã¾ãŸã€CONTAINERS_SHORT_NAME_ALIASING&#x3D;onã‚’è¨­å®šã—ã¦ãŠãã¨ã€<code>docker.io/hello-world</code>ã§ã¯ãªãã€<code>hello-world</code>ã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã¨ã¯ã„ãˆã€çŸ­ç¸®åã¯<a href="https://www.redhat.com/sysadmin/container-image-short-names">ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã‚ˆ</a>ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã•ã‚Œã¦ã„ãŸã‚Šã™ã‚‹ã®ã§ã€ç¢ºèªã®ä¸Šã”åˆ©ç”¨ãã ã•ã„ã€‚ä»Šå›ã¯ã‚ãã¾ã§ã‚‚Docker Desktopã‚’å…¥ã‚Œã‚‹ã¾ã§ã®ã¤ãªããªã®ã§ã€äº’æ›æ€§ãŒé«˜ã„æ–¹ãŒè‰¯ã„ãªã€ã¨ã„ã†ã“ã¨ã§ã‚„ã£ã¦ã„ã¾ã™ã€‚</p><figure class="highlight toml"><figcaption><span>/etc/containers/registries.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">unqualified-search-registries</span> = [<span class="string">&quot;docker.io&quot;</span>]</span><br><span class="line"><span class="section">[engine]</span></span><br><span class="line"><span class="attr">env</span>=[<span class="string">&quot;CONTAINERS_SHORT_NAME_ALIASING=on&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">short-name-mode</span>=<span class="string">&quot;enforcing&quot;</span></span><br></pre></td></tr></table></figure><p>ãã‚Œã§ã¯ã¾ãŸpodmanã‚’å†èµ·å‹•ã—ã¦ã‹ã‚‰ã€ä»Šåº¦ã¯Nginxã‚’èµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚<code>http://localhost:8888/</code>ã§èµ·å‹•ã—ãŸã‚‰å®Œäº†ã§ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ podman machine stop</span><br><span class="line">$ podman machine start</span><br><span class="line">$ podman run --rm -it -p 8888:80 nginx</span><br></pre></td></tr></table></figure><img src="/images/20221227a/image_3.png" alt="image.png" width="1200" height="548" loading="lazy"><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>Docker Desktopã¯ã„ã‚ã„ã‚ãªé–‹ç™ºè€…ã«ã†ã‚Œã—ã„æ©Ÿèƒ½ãŒãŸãã•ã‚“è¿½åŠ ã•ã‚Œã¦ã€ç©æ¥µçš„ã«é–‹ç™ºã•ã‚Œã¦ã„ã¦ã€ä¾¿åˆ©ã§ã™ã—ã€ä»Šå›ã‚„ã£ãŸã‚ˆã†ãªWSL2ã«å…¥ã£ã¦ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã«ã¤ãªãŒã‚‹ã‚ˆã†ãªè¨­å®šã‚’ã—ãªãã¦ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ããŸã‚Šã—ã¦ä¾¿åˆ©ãªã®ã§ã™ãŒã€ã¡ã‚‡ã³ã£ã¨æ¤œè¨¼ã™ã‚‹ç›®çš„ã§Podman Desktopã‚’ä»£ã‚ã‚Šã«å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚ãƒ—ãƒ­ã‚­ã‚·ã®è£ã§ã‚‚å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p><p>ã¾ã‚ã€ä¸–ã®ä¸­ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯Dockerã‚’ä½¿ã†ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ã„ãŸã‚Šã™ã‚‹ã®ã§ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆã¨ã‹ã‚’è€ƒãˆã‚‹ã¨é »ç¹ä½¿ã†äººã¯Docker Desktopã‚’ãã¡ã‚“ã¨å…¥ã‚ŒãŸæ–¹ãŒè‰¯ã„ã§ã™ã­ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;ã¡ã‚‡ã£ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§PostgreSQLã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è©¦ã—ãŸã„ã‘ã©Docker Desktopã®ç¨Ÿè­°ãŒé–“ã«åˆã‚ãªã„ï¼ã¿ãŸã„ãªã¨ãã®ãŸã‚ã®ãƒ¡ãƒ¢ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;Docker</summary>
        
      
    
    
    
    <category term="Infrastructure" scheme="https://future-architect.github.io/categories/Infrastructure/"/>
    
    
    <category term="Docker" scheme="https://future-architect.github.io/tags/Docker/"/>
    
    <category term="ãƒ—ãƒ­ã‚­ã‚·" scheme="https://future-architect.github.io/tags/%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7/"/>
    
    <category term="Podman" scheme="https://future-architect.github.io/tags/Podman/"/>
    
  </entry>
  
  <entry>
    <title>ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚º part1 è¶…å…¥é–€ç·¨</title>
    <link href="https://future-architect.github.io/articles/20221226a/"/>
    <id>https://future-architect.github.io/articles/20221226a/</id>
    <published>2022-12-25T15:00:00.000Z</published>
    <updated>2023-01-08T05:26:01.374Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>é‡‘èã‚µãƒ¼ãƒ“ã‚¹äº‹æ¥­éƒ¨ã®å±±å£ã§ã™ã€‚</p><p>ã“ã®è¨˜äº‹ã¯<a href="/articles/20220616a/">ã€Œæ¥­ç•Œãƒ‰ãƒ¡ã‚¤ãƒ³ã«è©³ã—ããªã‚ã†ã€ã‚·ãƒªãƒ¼ã‚ºé€£è¼‰</a>ã®ã€ŒéŠ€è¡Œæ¥­å‹™ã€è¶…å…¥é–€ç·¨ã§ã™ã€‚<br>éŠ€è¡Œæ¥­ç•Œã‚’ç›®æŒ‡ã™å­¦ç”Ÿã•ã‚“ã€éŠ€è¡Œæ¥­ç•Œã«ã‚¢ã‚µã‚¤ãƒ³ã•ã‚ŒãŸè‹¥æ‰‹SIerã€ä»–æ¥­ç¨®ã§æ´»èºã™ã‚‹ITã‚³ãƒ³ã‚µãƒ«ã®æ–¹å‘ã‘ã«ãªã‚Šã¾ã™ã€‚</p><p>ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã‚‰éŠ€è¡Œç³»ITã‚³ãƒ³ã‚µãƒ«ã«ã‚­ãƒ£ãƒªã‚¢ãƒã‚§ãƒ³ã‚¸ã—ãŸç§ãŒã€ãã®é“20å¹´ã®ã‚­ãƒ£ãƒªã‚¢ã‚’èª‡ã‚‹å®‰æœ¬å¤§å…ˆè¼©ã®åŠ›ã‚’å€Ÿã‚Šã¦ã€éŠ€è¡Œæ¥­å‹™ã«ã¤ã„ã¦è¨˜è¼‰ã—ã¦ã„ãã¾ã™ã€‚</p><h1 id="ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚º-éŠ€è¡Œæ¥­å‹™ã¨ã¯"><a href="#ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚º-éŠ€è¡Œæ¥­å‹™ã¨ã¯" class="headerlink" title="ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚ºã€€éŠ€è¡Œæ¥­å‹™ã¨ã¯"></a>ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚ºã€€éŠ€è¡Œæ¥­å‹™ã¨ã¯</h1><p>éŠ€è¡Œæ¥­å‹™ã‚’ãŠè©±ã™ã‚‹å‰ã«ã€ãªãœã€ŒéŠ€è¡Œã€ã¨å‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã¯ã”å­˜çŸ¥ã§ã—ã‚‡ã†ã‹ã€‚</p><p>æ˜æ²»ã®ä¸–ãŒå§‹ã¾ã£ã¦é–“ã‚‚ãªãã€ã€ŒBankã€ã¨ã„ã†è‹±å˜èªã‚’æ—¥æœ¬èªã«ä½•ã¨è¨³ã™ã‹ã¨ã„ã†è©±ã®ä¸­ã§ã€ã€ŒãŠé‡‘ï¼ˆé‡‘éŠ€ï¼‰ã‚’å–ã‚Šæ‰±ã†ã€ã¨ä¸­å›½èªã§ã€Œåº—ã€ã‚’æ„å‘³ã™ã‚‹ã€Œè¡Œã€ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã€Œé‡‘è¡Œã€ãƒ»ã€ŒéŠ€è¡Œã€ã¨ã„ã†æ¡ˆãŒå‡ºã¦ã€èªå‘‚ã®è‰¯ã•ã‹ã‚‰ã€ŒéŠ€è¡Œã€ã«æ±ºã¾ã£ãŸã¨è¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ï¼’ï¼ï¼’ï¼‘å¹´ã®å¤§æ²³ãƒ‰ãƒ©ãƒ<a href="https://www.nhk.jp/p/seiten/ts/61Z4879Q1K/">ã€Œæ™´å¤©ã‚’è¡ã‘ã€</a>ã®ä¸­ã§ã¯ã€æ—¥æœ¬åˆã®éŠ€è¡Œã®é ­å–ã«å°±ä»»ã—ãŸæ¸‹æ²¢æ „ä¸€ãŒã€ŒéŠ€è¡Œã€ğŸ¦ã¨åä»˜ã‘ãŸã¨ã„ã†ãŠè©±ã«ãªã£ã¦ã„ã¾ã—ãŸã—ã€å®Ÿéš›ã«ãã‚“ãªä¸€èª¬ãŒã‚ã‚‹ã¨ã„ã†è¨˜äº‹ã‚‚è¦‹ã‹ã‘ã¾ã™ãŒå®Ÿéš›ã®ã¨ã“ã‚ã¯ã©ã†ãªã®ã§ã—ã‚‡ã†ã­ã€‚<br>ã¨ã‚‚ã‚ã‚ŒéŠ€è¡Œã¨ã„ã†å˜èªã¯ä½œã‚‰ã‚Œã¦ã‹ã‚‰ã¾ã ï¼‘ï¼•ï¼å¹´ãã‚‰ã„ã®æ¯”è¼ƒçš„æµ…ã„å˜èªã®ã‚ˆã†ã§ã™ğŸ˜„</p><p>æœ¬é¡Œã®éŠ€è¡Œæ¥­å‹™ã«ãŠè©±ã‚’ç§»ã—ã¾ã—ã‚‡ã†ã€‚</p><p>éŠ€è¡Œã«ãŠã‘ã‚‹ä¼çµ±çš„ãªæ¥­å‹™ã¯ã€Œé é‡‘ã€ã€Œèè³‡ã€ã€Œç‚ºæ›¿ã€ã¨ãªã‚Šã¾ã™ã€‚(æ˜¨ä»Šã®éŠ€è¡Œã¯æ¥­å‹™ç¯„å›²ã‚’æ‹¡å¤§ã—ã¦ãã¦ã¾ã™ã€‚)</p><img src="/images/20221226a/ginko_gyomu.PNG" alt="ginko_gyomu.PNG" width="663" height="452" loading="lazy"><h2 id="éŠ€è¡Œã®åˆ©ç›Šæ§‹é€ "><a href="#éŠ€è¡Œã®åˆ©ç›Šæ§‹é€ " class="headerlink" title="éŠ€è¡Œã®åˆ©ç›Šæ§‹é€ "></a>éŠ€è¡Œã®åˆ©ç›Šæ§‹é€ </h2><p>éŠ€è¡Œã¯ã€é é‡‘è€…ã‹ã‚‰ãŠé‡‘ã‚’é ã‚Šã€ãã®ãŠé‡‘ã‚’å¿…è¦ã¨ã™ã‚‹ä¼æ¥­ãƒ»å€‹äººã¸è²¸ã—å‡ºã—ã¦ã„ã¾ã™ã€‚</p><p>è¨€ã‚ã°ãŠé‡‘ã¨ã„ã†å•†æã‚’é é‡‘ã«ã‚ˆã£ã¦ä»•å…¥ã‚Œã€ã¾ãŸãŠé‡‘ã‚’å¿…è¦ã¨ã—ã¦ã„ã‚‹äººã«è²¸å‡ºã¨ã„ã†å½¢ã§è²©å£²ã™ã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚</p><p>é¡§å®¢ã®æ—¥ã€…ã®ãŠé‡‘ã®ã‚„ã‚Šå–ã‚Šï¼ˆæ±ºæ¸ˆã‚„æŒ¯è¾¼ãªã©ï¼‰ã‚’å††æ»‘ãƒ»ç¢ºå®Ÿã«è¡Œã„æ—¥å¸¸çš„ãªçµŒæ¸ˆæ´»å‹•ã‚’æ”¯ãˆã¦ãŠã‚Šã€ç¤¾ä¼šçš„ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ‹…ã†å…¬å…±æ€§ã®é«˜ã„æ¥­ç¨®ã§ã™ã€‚ã¨ã¯ã„ãˆã€éŠ€è¡Œã¯æ ªå¼ä¼šç¤¾ã§ã‚ã‚Šæ°‘é–“ä¼æ¥­ã§ã‚ã‚Šã€ã—ã£ã‹ã‚Šåˆ©ç›Šã‚’å‡ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>éŠ€è¡Œã¯ã©ã†ã‚„ã£ã¦åç›Šã‚’å¾—ã¦ã„ã‚‹ã‹ã¨ã„ã†ã¨ã€é é‡‘è€…ã‹ã‚‰é›†ã‚ãŸãŠé‡‘ã‚’ã€èè³‡ã¨ã„ã†å½¢ã§ä¼æ¥­ã‚„å€‹äººã«è²¸ã—ä»˜ã‘ã‚’è¡Œã„ã€ã“ã®èè³‡ã«ã‚ˆã£ã¦ç™ºç”Ÿã—ãŸåˆ©å­ã§åˆ©ç›Šã‚’å¾—ã‚‹æ§‹é€ ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p><img src="/images/20221226a/image.png" alt="image.png" width="1140" height="592" loading="lazy"><h2 id="é é‡‘æ¥­å‹™"><a href="#é é‡‘æ¥­å‹™" class="headerlink" title="é é‡‘æ¥­å‹™"></a>é é‡‘æ¥­å‹™</h2><p>ãƒãƒ–ãƒ«å´©å£Šå¾Œã«ãŠã„ã¦ã¯è¶…ä½é‡‘åˆ©æ™‚ä»£ã¨ã‚‚è¨€ã‚ã‚Œã¦ãŠã‚Šã€éŠ€è¡ŒãŒèè³‡ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ç¨¼ã’ã‚‹åˆ©å­ã¯å¤§ããåœ§è¿«ã‚’å—ã‘ã¦ãŠã‚Šã€éŠ€è¡Œã®åç›Šãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦ã¯éå¸¸ã«å³ã—ã„çŠ¶æ³ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p><p>é‡‘èç·©å’Œæ”¿ç­–ã«ã‚ˆã£ã¦ä¸–ã®ä¸­ã«ãŠé‡‘ãŒä½™ã£ã¦ã„ã‚‹çŠ¶æ³ãŒé•·ãç¶šã„ã¦ãŠã‚Šã€ãŠé‡‘ã‚’é ã‘ãŸã„ï¼ˆé‹ç”¨ã—ãŸã„ï¼‰äººï¼ˆï¼ä¾›çµ¦ï¼‰ã¨ã€ãŠé‡‘ã‚’å¿…è¦ã¨ã—ã¦ã„ã‚‹äººï¼ˆï¼éœ€è¦ï¼‰ã®ãƒãƒ©ãƒ³ã‚¹ãŒä¾›çµ¦éå¤šã®çŠ¶æ³ã¨ãªã£ã¦ãŠã‚Šã€é‡‘åˆ©ãŒä½ãç¶­æŒã•ã‚ŒãŸçŠ¶æ…‹ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚ã“ã†ã—ãŸã“ã¨ãŒã€ç§é”ä¸€èˆ¬å¸‚æ°‘ã«ã‚‚å°‘ãªã‹ã‚‰ãšå½±éŸ¿ãŒå‡ºã¦ãã¦ã„ã¾ã™ã€‚</p><p>ä¾‹ãˆã°ã€éŠ€è¡Œå£åº§ã‚’é–‹è¨­ã™ã‚‹ã¨å½“ãŸã‚Šå‰ã®ã‚ˆã†ã«é€šå¸³ã‚’ã‚‚ã‚‰ã„ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã‚’ã‚‚ã‚‰ã„ã¾ã™ã€‚é€šå¸³ãŒå…¨ã¦å°å­—ã—çµ‚ã‚ã‚‹ã¨ã“ã‚Œã‚‚ã¾ãŸå½“ãŸã‚Šå‰ã®ã‚ˆã†ã«æ¬¡ã®é€šå¸³ãŒç™ºè¡Œã•ã‚Œã€ãã®é€šå¸³ç™ºè¡Œã«éš›ã—ã¦ãŠé‡‘ã‚’è«‹æ±‚ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã¨ã“ã‚ãŒã€éŠ€è¡Œã®åç›Šæ§‹é€ ãŒéå¸¸ã«å³ã—ããªã£ã¦ããŸã“ã¨ã‚„ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãªã©ã®ãƒ‡ã‚¸ã‚¿ãƒ«æ©Ÿå™¨ã®æ™®åŠã‚‚ç›¸ã¾ã£ã¦æœ‰æ–™åŒ–ã®å‹•ããŒå§‹ã¾ã£ã¦ã„ã¾ã™ã€‚ä¸‰è±UFJéŠ€è¡Œã«ãŠã„ã¦ã¯ã€2022å¹´4æœˆä»¥é™ç´™ã¨ã—ã¦ã®é€šå¸³ã‚’ç™ºè¡Œã™ã‚‹éƒ½åº¦æ•°ç™¾å††ã®è²»ç”¨ãŒã‹ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p><p>ã“ã†ã—ãŸå‹•ãã¯ç€å®Ÿã«åºƒãŒã£ã¦ãã¦ã„ã¾ã™ã€‚å„éŠ€è¡ŒãŒâ—‹â—‹éŠ€è¡Œã‚¢ãƒ—ãƒªã¨ã„ã£ãŸã‚‚ã®ã‚’æä¾›ã—ãã¡ã‚‰ã¸ç§»è¡Œã‚’ä¿ƒã™CMãªã©ã‚’å‡ºã—ã¦ã„ã‚‹ã®ã¯ä¸Šè¨˜ã®ã‚ˆã†ãªèƒŒæ™¯ãŒã‚ã‚‹ã¨ã„ãˆã¾ã™ã€‚</p><p>ä¸€æ–¹ã§ã€ä¸Šè¿°ã—ãŸä¸‰è±UFJéŠ€è¡Œã«ãŠã„ã¦ã€ãƒ‡ã‚¸ã‚¿ãƒ«æ©Ÿå™¨ã‚’æ‰±ã†ã®ãŒè‹¦æ‰‹ã‚ã‚‹ã„ã¯ã¾ã ä¸ãˆã‚‰ã‚Œã¦ã„ãªã„ã¨ã„ã†æœªæˆå¹´ã‚„é«˜é½¢è€…ã«ã¤ã„ã¦ã¯ç„¡å„Ÿã¨ã™ã‚‹ãªã©ã€å®Œå…¨æœ‰å„ŸåŒ–ã«å‘ã‘ã¦ã¯éæ¸¡æœŸã‚’çµŒãªãŒã‚‰ã¨ã„ã†ã“ã¨ã«ãªã£ã¦ã„ããã†ã§ã™ã€‚<br>ãªãŠã€æ™®é€šé é‡‘ã®å¹³å‡é‡‘åˆ©ã¯0.001%ï¼ˆ<a href="https://www.stat-search.boj.or.jp/ssi/mtshtml/ir02_m_1.html">æ—¥æœ¬éŠ€è¡Œ æ™‚ç³»åˆ—çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ æ¤œç´¢ã‚µã‚¤ãƒˆ</a>ã‚ˆã‚Š ï¼‰ã¨ãªã£ã¦ãŠã‚Šã€é é‡‘è€…ã®çš†ã•ã‚“ã«é‚„å…ƒã•ã‚Œã‚‹é‡‘åˆ©ã‚‚åŒæ§˜ã«ã”ãåƒ…ã‹ãªã‚‚ã®ã¨ãªã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ã®ã‚‚ã“ã†ã—ãŸåç›Šæ§‹é€ ã®å•é¡Œã‹ã‚‰ç™ºç”Ÿã—ã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚</p><h2 id="èè³‡æ¥­å‹™"><a href="#èè³‡æ¥­å‹™" class="headerlink" title="èè³‡æ¥­å‹™"></a>èè³‡æ¥­å‹™</h2><p>èè³‡ã«é–¢ã—ã¦ã‚‚åŒæ§˜ã§ã™ã€‚ä¾‹ãˆã°ä½å®…ãƒ­ãƒ¼ãƒ³ã§ã€ä¸€éƒ¨ã®ãƒãƒƒãƒˆéŠ€è¡Œã§ã—ã‹é‡‘åˆ©1%ã‚’å‰²ã‚‹ã‚ˆã†ãªãƒ­ãƒ¼ãƒ³ã¯ãªã‹ã£ãŸã®ã«ã€ä»Šã‚„å…¨å›½ã®åœ°æ–¹éŠ€è¡Œã§å›£ä¿¡ãƒ»ä¸‰å¤§ç–¾ç—…ç‰¹ç´„ã¾ã§ã¤ã„ã¦é‡‘åˆ©1%ã‚’å‰²ã‚‹ã‚ˆã†ãªå•†å“ãŒå½“ãŸã‚Šå‰ã®ã‚ˆã†ã«å‡ºã¦ãã¦ã„ã¾ã™ã€‚éŠ€è¡Œã¯ä»¥å‰ã«ã‚‚å¢—ã—ã¦éå¸¸ã«è–„ã„åˆ©ã–ã‚„ã§ç¢ºå®Ÿã«ç¨¼ãã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã™ã€‚</p><p>ãã‚Œãªã®ã«ã€è²¸ã—ä»˜ã‘ãŸã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ä¼æ¥­ãŒå€’ç”£ã™ã‚‹ãªã©ã—ã¦è²¸ã—ãŸãŠé‡‘ãŒè¿”æ¸ˆã•ã‚Œãªã„ã‚±ãƒ¼ã‚¹ãŒç™ºç”Ÿã—ã¦ã—ã¾ã†ã®ã§ã™ã€‚1000ä¸‡å††ã‚’å¹´åˆ©5%ã§10å…ˆã«è²¸ã™ã¨ã€éŠ€è¡Œã«ã¯ã–ã£ãã‚Š1å¹´é–“ã§500ä¸‡å††ã®åç›ŠãŒç”Ÿã¾ã‚Œã‚‹ã‚ã‘ã§ã™ãŒã€10å…ˆã®ã†ã¡1å…ˆã§ã‚‚è²¸ã—å€’ã‚ŒãŒç™ºç”Ÿã—ã¦ã—ã¾ãˆã°éŠ€è¡Œã®æå¤±ã¯ã‚ã£ã¨ã„ã†é–“ã«ï¼500ä¸‡å††ã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚è–„ã„åˆ©ã–ã‚„ã§ç¢ºå®Ÿã«ç¨¼ãŒãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ã«ã€ã“ã‚“ãªã“ã¨ãŒèµ·ã“ã£ã¦ã¯éŠ€è¡Œã«ã¨ã£ã¦æ³£ãã£é¢ã«èœ‚ğŸçŠ¶æ…‹ã§ã™â—</p><img src="/images/20221226a/image_2.png" alt="image.png" width="1082" height="575" loading="lazy"><p>ã“ã®ãŸã‚ã€éŠ€è¡ŒãŒèè³‡ã‚’è¡Œã†éš›ã«ã¯ã€èè³‡å…ˆã®æ¥­ç¸¾ã‚„ä¿¡ç”¨ãƒ»å°†æ¥æ€§ã‚’ã—ã£ã‹ã‚Šå¯©æŸ»ã—ãŸä¸Šã§èè³‡ã‚’è¡Œã†å¿…è¦æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ­ãƒ¼ãƒ³å¯©æŸ»ãªã©ã§æ–­ã‚‰ã‚Œã¦ã—ã¾ã„ã€ãŠé‡‘ã‚’å€Ÿã‚ŠãŸã„ã®ã«è²¸ã—ã¦ãã‚Œãªã„ï¼ãªã‚“ã¦æ„Ÿã˜ãŸã“ã¨ãŒã‚ã‚‹æ–¹ã‚‚ã„ã‚‰ã£ã—ã‚ƒã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€éŠ€è¡Œã¨ã—ã¦ã‚‚ç”Ÿãæ®‹ã‚Šã‚’ã‹ã‘ã¦å¿…æ­»ãªçŠ¶æ³ãªã‚“ã§ã™ã‚ˆã­ã€‚</p><h2 id="ç‚ºæ›¿æ¥­å‹™"><a href="#ç‚ºæ›¿æ¥­å‹™" class="headerlink" title="ç‚ºæ›¿æ¥­å‹™"></a>ç‚ºæ›¿æ¥­å‹™</h2><p>ç‚ºæ›¿ã«ã¤ã„ã¦ã¯ã€ãŠãã‚‰ãçš†ã•ã‚“ã‚‚ä¸€åº¦ã¯ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã€ä¼šç¤¾é–“ã‚ã‚‹ã„ã¯å€‹äººé–“ã§ã®è³‡é‡‘ç§»å‹•ã§ã‚ã£ãŸã‚Šã€å…‰ç†±è²»ãªã©ã®å„ç¨®è²»ç”¨ã®å¼•ãè½ã¨ã—ãªã©ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ãŠé‡‘ã®ã‚„ã‚Šå–ã‚Šã«ã¤ã„ã¦ã¯ã€æ—¥æœ¬å›½å†…ã«é™ã‚‰ãšã€å††ãƒ»ãƒ‰ãƒ«ãªã©ã®é€šè²¨ãŒç•°ãªã‚‹éŠ€è¡Œé–“ã§ã®å…¥å‡ºé‡‘ã«ã¤ã„ã¦ã‚‚éŠ€è¡Œã§ã¯å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</p><p>ä»Šã§ã“ãéŠ€è¡Œã®çª“å£ã¸è¡Œã‹ãšã¨ã‚‚ã€ãƒãƒ³ã‚­ãƒ³ã‚°ã‚¢ãƒ—ãƒªã‚„ã™ãè¿‘ãã«ã‚ã‚‹ã‚³ãƒ³ãƒ“ãƒ‹ATMãªã©ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§å½“ãŸã‚Šå‰ã®ã‚ˆã†ã«é é‡‘ã‚µãƒ¼ãƒ“ã‚¹ã‚„ç‚ºæ›¿ã‚µãƒ¼ãƒ“ã‚¹ã‚’å—ã‘ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚èè³‡ã®ç”³è¾¼ã¿ã‚‚ãƒãƒ³ã‚­ãƒ³ã‚°ã‚¢ãƒ—ãƒªã‹ã‚‰ç›´æ¥ç”³ã—è¾¼ã¿ãŒã§ãã‚‹ã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ã‚‚å¢—ãˆã¦ãã¾ã—ãŸã­ã€‚</p><p>å¾“æ¥ã®éŠ€è¡Œå£åº§ã‚’ä»‹ã—ãŸè³‡é‡‘ç§»å‹•ã¯æ‰‹æ•°æ–™ã®é«˜ã•ã‹ã‚‰æ•¬é ã•ã‚Œã€å€‹äººé–“ã®å°‘é¡é€é‡‘ã¯å„æ±ºæ¸ˆã‚¢ãƒ—ãƒªã«ã‚ˆã‚‹é€é‡‘ã‚µãƒ¼ãƒ“ã‚¹ã«ä»£æ›¿ã•ã‚Œå§‹ã‚ã¦ã„ã‚‹ã®ãŒç¾çŠ¶ã§ã™ã€‚çš†ã•ã‚“ã‚‚é£²ã¿ä¼šã®å‰²ã‚Šå‹˜ã‚’ã™ã‚‹ã®ã«æ±ºæ¸ˆã‚¢ãƒ—ãƒªã®é€é‡‘ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã†ã“ã¨ãŒå¢—ãˆã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿã¨ã¯è¨€ãˆã€çµ¦ä¸æŒ¯è¾¼ç­‰ã®ã—ã£ã‹ã‚Šã¨ã—ãŸä¿¡é ¼æ€§ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã‚‚ã®ã¯ã¾ã ã¾ã ã€éŠ€è¡ŒãŒæ´»ç”¨ã•ã‚Œã¦ã¾ã™ã­ã€‚</p><h2 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h2><p>éŠ€è¡Œã¨ã„ã†è¨€è‘‰ã®æ­´å²ã¯æµ…ã„ã§ã™ãŒã€æˆ‘ã€…ã«ã¯æ·±ã„å­˜åœ¨ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ãŒãŠåˆ¤ã‚Šã„ãŸã ã‘ãŸã§ã—ã‚‡ã†ã‹ã€‚</p><p>æ—¥æœ¬ã‚„åœ°åŸŸã®çµŒæ¸ˆã‚’å¾ªç’°ã•ã›ã‚‹ã‚ˆã†ãªè¡€æ¶²ã®ã‚ˆã†ãªå½¹å‰²ã‚’æ‹…ã£ã¦ã„ã‚‹ã®ãŒéŠ€è¡Œã§ã™ã€‚éŠ€è¡Œã¯ãŠé‡‘ã¨ã„ã†ä¼æ¥­ãƒ»å€‹äººã«ã¨ã£ã¦éå¸¸ã«é‡è¦ãªã‚‚ã®ã‚’å–ã‚Šæ‰±ã†ç¤¾ä¼šçš„è²¬ä»»ã®å¤§ãã•ã‚‚ã‚ã£ã¦ã€æ ªå¼ä¼šç¤¾ã¨ã—ã¦ä¸€èˆ¬ã«å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ä¼šç¤¾æ³•ãƒ»åŠ´åƒåŸºæº–æ³•ç­‰ã®æ³•è¦åˆ¶ã¯ã‚‚ã¡ã‚ã‚“ã€éŠ€è¡Œæ³•ã¨ã„ã£ãŸå½¢ã§å¤šãã®è¦åˆ¶ã‚’èª²ã•ã‚Œã¦ã„ã‚‹æ¥­ç¨®ã§ã™ã€‚</p><p>ã¾ãŸã€é•·å¼•ãä½é‡‘åˆ©ç’°å¢ƒä¸‹ã«ãŠã‘ã‚‹åˆ©ã–ã‚„ã®ç¸®å°ã€æ§˜ã€…ãªãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒæ±ºæ¸ˆé ˜åŸŸã«å‚åŠ ã™ã‚‹äº‹ã§ã®è³‡é‡‘ç§»å‹•æ‰‹æ®µã®å¤‰åŒ–ã€æ±ºæ¸ˆæ‰‹æ•°æ–™ã®æ¸›å°‘ã¨ã€ç¾åœ¨ã®éŠ€è¡Œã‚’å–ã‚Šå·»ãç’°å¢ƒã¯å¤§ããªè»¢æ›ç‚¹ã‚’è¿ãˆã¦ã„ã‚‹äº‹ã‚‚æ¥­ç•Œã®æ¦‚è¦ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ã¤ã‹ã‚€ä¸Šã§é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã ã¨æ€ã„ã¾ã™ã€‚</p><p>ä»Šå¾Œã¯ä»¥ä¸‹ã‚‚äºˆå®šã—ã¦ã¾ã™ã€‚</p><ul><li>ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚ºã€€åŠæ²¢ç›´æ¨¹ã§ã‚‚æœ‰åãªå–¶æ¥­æ´»å‹•</li><li>ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚ºã€€èè³‡ã®è¦ï¼èè³‡å¯©æŸ»â‘ ã€€ä½•ã‚’æ°—ã«ã™ã‚‹ï¼ŸéŠ€è¡Œå“¡ã€€ï½æ³•äººèè³‡ç·¨ï½</li><li>ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚ºã€€èè³‡ã®è¦ï¼èè³‡å¯©æŸ»â‘¡ã€€ä½•ã‚’æ°—ã«ã™ã‚‹ï¼ŸéŠ€è¡Œå“¡ã€€ï½å€‹äººèè³‡(ãƒ­ãƒ¼ãƒ³)ç·¨ï½</li><li>ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚ºã€€èè³‡ã®è¦ï¼èè³‡å¯©æŸ»â‘¢ã€€ä½•ã‚’æ°—ã«ã™ã‚‹ï¼ŸéŠ€è¡Œå“¡ã€€ï½æ‹…ä¿ã‚„ä¿è¨¼ç·¨ï½</li><li>ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚ºã€€è²¸ã—ãŸã‚‰çµ‚ã‚ã‚Šã§ã¯ãªã„ã€€å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯è‡ªå·±æŸ»å®š</li><li>ITã‚³ãƒ³ã‚µãƒ«ãŒæ•™ãˆã‚‹éŠ€è¡Œæ¥­å‹™ã‚·ãƒªãƒ¼ã‚ºã€€å¤‰åŒ–ã¨ä¸å¤‰ã€€å¤‰ã‚ã‚Šã‚†ãéŠ€è¡Œæ–‡åŒ–ã¨å¤‰ã‚ã‚‰ãªã„éŠ€è¡Œæ–‡åŒ–</li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot; title=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;/a&gt;ã¯ã˜ã‚ã«&lt;/h1&gt;&lt;p&gt;é‡‘èã‚µãƒ¼ãƒ“ã‚¹äº‹æ¥­éƒ¨ã®å±±å£ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;ã“ã®è¨˜äº‹ã¯&lt;a</summary>
        
      
    
    
    
    <category term="Business" scheme="https://future-architect.github.io/categories/Business/"/>
    
    
    <category term="ãƒ“ã‚¸ãƒã‚¹" scheme="https://future-architect.github.io/tags/%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9/"/>
    
    <category term="æ¥­ç•Œãƒ‰ãƒ¡ã‚¤ãƒ³" scheme="https://future-architect.github.io/tags/%E6%A5%AD%E7%95%8C%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3/"/>
    
    <category term="éŠ€è¡Œ" scheme="https://future-architect.github.io/tags/%E9%8A%80%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>ä¿ºã®ã‚·ã‚¹ãƒ†ãƒ ãŒã“ã‚“ãªã«è„†å¼±æ€§ã ã‚‰ã‘ã®ã‚ã‘ãŒãªã„(linkedpackageã®ç´¹ä»‹)</title>
    <link href="https://future-architect.github.io/articles/20221223a/"/>
    <id>https://future-architect.github.io/articles/20221223a/</id>
    <published>2022-12-22T15:00:00.000Z</published>
    <updated>2022-12-23T00:58:00.516Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221223a/top.jpg" alt="" width="842" height="523"><p>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«å¯¾ã—ã¦ã€ãã¡ã‚“ã¨ãŠé‡‘ã‚’ã‹ã‘ã¦å¯¾å¿œã™ã¹ãã§ã‚ã‚‹ã€ã¨ã„ã†ã®ãŒè¿‘å¹´ã®é¢¨æ½®ã§ã™ã€‚ãã‚“ãªä¸­ã€ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã§ã¯å¤šãã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ããŸãŸã‚ã€ä½¿ã£ã¦ã„ã‚‹éƒ¨å“ã®è„†å¼±æ€§ç®¡ç†ã€ã¨ã„ã†ã®ãŒã‹ãªã‚Šå¤§ããªå¸‚å ´ã«ãªã£ã¦ãã¾ã—ãŸã€‚</p><p>å½“ç¤¾ã«ã¯OSSã®<a href="https://vuls.io/">Vuls</a>ã¨ã€ãã‚Œã«è„†å¼±æ€§ç®¡ç†ã®æ‰‹é–“ã‚’æ¸›ã‚‰ã—ã¦ãã‚Œã‚‹<a href="https://vuls.biz/">FutureVuls</a>ã¨ã„ã†SaaSã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚­ãƒ£ãƒ³ã ã¨Aqua Securityã®<a href="https://trivy.dev/">Trivy</a>ãŒæœ‰åã§ã™ã­ã€‚</p><p>é–‹ç™ºä¸­ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã¨ã„ã†ã¨ã€Node.jsã®npmã‚³ãƒãƒ³ãƒ‰ãŒè„†å¼±ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ¤œçŸ¥æ©Ÿèƒ½ï¼ˆauditã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ï¼‰ã‚’å†…è”µã—ã¦ã„ã¾ã™ã—ã€Goã‚‚<a href="https://vuln.go.dev/">å…¬å¼è„†å¼±æ€§ç®¡ç†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</a>ã®ãƒšãƒ¼ã‚¸ã‚’ä½œã‚Šã€æ–°ã—ã„ä»•çµ„ã¿ã‚’æ§‹ç¯‰ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™(<a href="https://go.dev/security/vuln/">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã€<a href="https://pkg.go.dev/golang.org/x/vuln/cmd/govulncheck">æº–æ¨™æº–ã®ãƒã‚§ãƒƒã‚¯ã‚³ãƒãƒ³ãƒ‰</a>)ã€‚è¨€èªã‚’ã¾ãŸã„ã§ä½¿ãˆã‚‹ã‚‚ã®ã«ã¯<a href="https://snyk.io/">snyk</a>ã‚‚ã‚ã‚Šã¾ã™ã­ã€‚</p><h1 id="ãƒ•ã‚©ãƒ¼ãƒ«ã‚¹ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼ˆå½é™½æ€§ï¼‰ã‚’æ¸›ã‚‰ã™"><a href="#ãƒ•ã‚©ãƒ¼ãƒ«ã‚¹ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼ˆå½é™½æ€§ï¼‰ã‚’æ¸›ã‚‰ã™" class="headerlink" title="ãƒ•ã‚©ãƒ¼ãƒ«ã‚¹ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼ˆå½é™½æ€§ï¼‰ã‚’æ¸›ã‚‰ã™"></a>ãƒ•ã‚©ãƒ¼ãƒ«ã‚¹ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼ˆå½é™½æ€§ï¼‰ã‚’æ¸›ã‚‰ã™</h1><p>Node.jsã§ã®é–‹ç™ºã¯4æ¡ãã‚‰ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ä¾å­˜ã™ã‚‹ã“ã¨ãŒã‚ã‚Šãˆã¾ã™ã€‚npm auditã§å°‘ã—ã§ã‚‚å¤ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã¨å¤§é‡ã®è„†å¼±æ€§ãŒå ±å‘Šã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã§ã‚‚ã€ã‚ˆãã‚ˆãè¦‹ã¦ã¿ã‚‹ã¨å®Ÿã¯é–¢ä¿‚ãªã„ã®ã‹ãªï¼Ÿã¨ã‚‚æ€ãˆã‚‹ã‚ˆã†ãªè„†å¼±æ€§ã‚‚ãŸãã•ã‚“å‡ºã¦ãã¾ã™ãŒã€ãªã‹ãªã‹åˆ¤å®šã‚’1ã¤1ã¤è¡Œã†ã®ã¯å¤§å¤‰ã§ã™ã€‚</p><p>ã§ã™ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã§ã„ã†ã¨ã€ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã«ã¯è¿½åŠ ã—ã¦ã¿ãŸã®ã ã‘ã©ã€å®Ÿéš›ã«ã¯ä½¿ã£ã¦ã„ãªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ãªã©ãŒã‚ã£ãŸã‚Šã—ã¾ã™ã€‚Goã ã¨go mod tidyã§ãŠæƒé™¤ã—ã¦ãã‚Œã¾ã™ãŒã€‚ã‚ã¨ã¯é–‹ç™ºç”¨ã«è¿½åŠ ã—ãŸã‚‚ã®ã§ã€æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã«ã¯ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã‚‚ã‚ã‚Šã¾ã™ã€‚Node.jsãªã‚“ã‹ã¯ã€ã»ã¨ã‚“ã©ã¯ãã†ãªã‚“ã˜ã‚ƒãªã„ã§ã™ã‹ã­ã€‚</p><p>ã‚ã¨ã¯ã€è„†å¼±æ€§ãŒãƒ’ãƒƒãƒˆã—ãŸã¨ã—ã¦ã‚‚ã€ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸­ã®ä¸€éƒ¨ã®æ©Ÿèƒ½ã¯ä½¿ã£ã¦ã„ã‚‹ãŒè©²å½“ã™ã‚‹æ©Ÿèƒ½ã¯ä½¿ã£ã¦ã„ãªã„ã€ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€å®Ÿéš›ã«ãƒ“ãƒ«ãƒ‰ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å«ã¾ã‚Œã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ãŸã‚‰ã„ã„ã‚“ã˜ã‚ƒãªã„ã‹ã€ã¨æ€ã£ã¦å®Ÿè¨¼å®Ÿé¨“çš„ã«ä½œã£ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒæ¬¡ã®ã‚‚ã®ã§ã™ã€‚</p><p><a href="https://github.com/future-architect/linkedpackage">https://github.com/future-architect/linkedpackage</a></p><p>ç¥æˆ¸ã•ã‚“ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ã‚‰ã†ã¾ã§ã¯ã€ä½œã£ãŸã“ã¨ã‚’ã™ã£ã‹ã‚Šå¿˜ã‚Œã¦ã„ã¦ã€ã¨ã‚Šã‚ãˆãšå…¬é–‹ã ã‘ã—ãŸã®ãŒä¸Šã®ãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯ã²ã¨ã¾ãšVulsã«ã‚ã‚ã›ã¦GPLã«ã—ã¦ã„ã¾ã™ã€‚ã¨ã‚Šã‚ãˆãšå…¬é–‹ã ã‘ã—ãŸã®ã§READMEã‚‚ãªã„ã§ã™ãŒ</p><h1 id="å‡¦ç†ã®æ–¹æ³•"><a href="#å‡¦ç†ã®æ–¹æ³•" class="headerlink" title="å‡¦ç†ã®æ–¹æ³•"></a>å‡¦ç†ã®æ–¹æ³•</h1><p>ç¾æ™‚ç‚¹ã§ã¯JavaScriptã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é™å®šã—ãŸæ©Ÿèƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’ã–ã£ã¨ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã€å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã«å«ã¾ã‚Œã‚‹ã‚½ãƒ¼ã‚¹ç‰‡ã‚’æä¾›ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å–ã‚Šå‡ºã—ã¾ã™ã€‚ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦ã‚‚å‹•ã‹ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã€linkedpackage auditã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã¨ã€npm auditã®çµæœã‚’ã€åˆ©ç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«é™å®šã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦è¡¨ç¤ºã€ã¿ãŸã„ãªã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ä¸­ã®ãƒ‘ã‚¹è¡¨è¨˜ã¯ã€ãã®ä¸­ã§è­˜åˆ¥å­ãŒèªè­˜ä¸€è‡´ã—ã¦ã„ãŸã‚‰å•é¡Œã¯ãªã„ã¨æ€ã†ã®ã§ã™ãŒã€å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒªãƒ³ã‚¯ã•ã›ã‚‹ã«ã¯é€†å¤‰æ›ãŒå¿…è¦ã‹ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦å‡ºã¦ãã‚‹ãƒ‘ã‚¹è¡¨è¨˜ãŒã„ã‚ã„ã‚ã‚ã‚‹ã®ã§ã€ã“ã‚Œã‚’åœ°é“ã«æ‹¾ã£ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚’æ‹¾ã†ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚åœ°é“ã•ãŒå¿…è¦ã§ã™ã­ã€‚</p><ul><li><code>webpack:///./node_modules/@babel/runtime/helpers/wrapNativeSuper/_index.mjs</code></li><li><code>../webpack:/ncc-project/node_modules/trim/index.js</code></li><li><code>webpack://_N_E/ignored|/prj/node_modules/next/dist/shared/lib/router|./utils/resolve-rewrites</code></li></ul><h1 id="ä»Šå¾Œ"><a href="#ä»Šå¾Œ" class="headerlink" title="ä»Šå¾Œ"></a>ä»Šå¾Œ</h1><p>Goã‚‚<a href="https://pkg.go.dev/debug/buildinfo@go1.19.4#Read">debugãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</a>ä½¿ãˆã°å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€åˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§ãŒå–ã‚Œã‚‹ã®ã§è¡Œã‘ãã†ã§ã™ã­ã€‚ãã®ã†ã¡ä½œã‚ã†ã‹ãªã€‚</p><p>ãŸã ã€å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã«å…¥ã£ã¦ã„ã‚‹ã‹ã‚‰ã¨ã„ã£ã¦ã€ãã‚ŒãŒã¾ãŸå®Ÿè¡Œã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ã€ã¨ã„ã†ã®ã¯ã‚ã‚Šã¾ã™ã€‚JavaScriptã ã¨tree shakingã¨ã„ã†æœ€é©åŒ–ãŒã‚ã‚Šã¾ã™ãŒå®Œç’§ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Goã¯ãã“ã¾ã§ç©æ¥µçš„ãªCode Eliminationã¯ã—ã¦ãªã„å°è±¡ãŒã‚ã‚Šã¾ã™ã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’å«ã‚init()ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã‚“ã‹ã¯ä½¿ã£ã¦ãªãã¦ã‚‚ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚Goã¯1.20ã‹ã‚‰<a href="https://go.googlesource.com/proposal/+/master/design/55022-pgo.md">ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©æ©Ÿèƒ½ã¨ãƒªãƒ³ã‚¯ã—ãŸã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶</a>ãŒå…¥ã‚Šã¾ã™ã€‚ã“ã®æƒ…å ±ãŒå¤–éƒ¨ã®ãƒ„ãƒ¼ãƒ«ã‹ã‚‰ä½¿ãˆã‚‹ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚‰ãªã„ã§ã™ãŒã€å®Ÿéš›ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹è¡Œã ã‘å–ã‚Šå‡ºã›ã‚Œã°ã€ã¾ãŸç²¾åº¦ã®é«˜ã„ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒã§ãã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ãªã€ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221223a/top.jpg&quot; alt=&quot;&quot; width=&quot;842&quot;</summary>
        
      
    
    
    
    <category term="Security" scheme="https://future-architect.github.io/categories/Security/"/>
    
    
    <category term="JavaScript" scheme="https://future-architect.github.io/tags/JavaScript/"/>
    
    <category term="Node.js" scheme="https://future-architect.github.io/tags/Node-js/"/>
    
    <category term="è„†å¼±æ€§" scheme="https://future-architect.github.io/tags/%E8%84%86%E5%BC%B1%E6%80%A7/"/>
    
    <category term="npm" scheme="https://future-architect.github.io/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>MSAL.jsã§é–‹ç™ºæ™‚ã¯èªè¨¼ã‚¹ã‚­ãƒƒãƒ—ã—ãŸã„</title>
    <link href="https://future-architect.github.io/articles/20221220a/"/>
    <id>https://future-architect.github.io/articles/20221220a/</id>
    <published>2022-12-19T15:00:00.000Z</published>
    <updated>2022-12-26T04:01:56.051Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221220a/azuread.jpg" alt="" width="700" height="298"><p>MSAL.jsã¯ã¨ã¦ã‚‚ä¾¿åˆ©ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚å‰ã«æ›¸ã„ãŸã‚¨ãƒ³ãƒˆãƒªãƒ¼ã§èª¬æ˜ã—ã¾ã—ãŸãŒã€AzureADå´ã®è¨­å®šã¯å¿…è¦ã§ã™ãŒã€ã‚³ãƒ¼ãƒ‰ã¸ã®çµ„ã¿è¾¼ã¿ã‚‚ã™ãã§ã™ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å—ã‘ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã®ç”¨æ„ã‚‚ä¸è¦ã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã ã‘ã§èªè¨¼ãŒå®Œçµã—ã¾ã™ã€‚</p><ul><li><a href="https://future-architect.github.io/articles/20221118a/">https://future-architect.github.io/articles/20221118a/</a></li></ul><p>ã§ã™ãŒã€é–‹ç™ºæ™‚ã«AzureADãŒãªã„å ´åˆã‚‚ã‚ã‚Šã¾ã™ã—ã€é–‹ç™ºè€…å…¨å“¡ãŒé–‹ç™ºã§ä½¿ã†AzureADã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã•ã‚Œã¦ã„ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸã€æ¨©é™ã”ã¨ã«ã„ã‚ã‚“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç”¨æ„ã—ã¦ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨ã‹ã®ãƒ‹ãƒ¼ã‚ºã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€E2Eãƒ†ã‚¹ãƒˆã§æ¯å›èªè¨¼ã‚’ã™ã‚‹ã¨é…ã„ã¨ã‹ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å—ã‘ã‚‹ã‚³ãƒ¼ãƒ‰ãŒGitHub Actionsã§ã¯ã†ã¾ãå‹•ã‹ãšå®ŸAzureADèªè¨¼ã‚’çµ„ã¿è¾¼ã‚€ã®ãŒé›£ã—ã„ã¨ã‹ã€èªè¨¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ãŸã„ãƒ‹ãƒ¼ã‚ºã‚‚ã„ã‚ã„ã‚ã‚ã‚‹ãŸã‚ã€é–‹ç™ºæ™‚ã«ã¯MSAL.jsã‚’ã‚¹ã‚­ãƒƒãƒ—ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ã€‚</p><h1 id="è¨­å®šã®å¤–ã ã—"><a href="#è¨­å®šã®å¤–ã ã—" class="headerlink" title="è¨­å®šã®å¤–ã ã—"></a>è¨­å®šã®å¤–ã ã—</h1><p>å‰å›ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ã¾ã—ãŸãŒã€AzureADã®æ¥ç¶šæƒ…å ±ãªã©ã¯.envã§è¨­å®šã‚’æµã—è¾¼ã‚€ã¹ãã§ã™ã®ã§ã€åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—ã¾ã™ã€‚å„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã”ã¨ã«ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ç’°å¢ƒå¤‰æ•°ã‚’å…¬é–‹ã™ã‚‹ã«ã¯ã€ã‚­ãƒ¼ã®åå‰ã®ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚<a href="https://cli.vuejs.org/guide/mode-and-env.html">Vue.jsã§ã‚ã‚Œã°VUE_APP_</a>ã‚’å‰ã«ã¤ã‘ã¾ã™ã—ã€<a href="https://ja.vitejs.dev/guide/env-and-mode.html">Vite.jsã ã¨VITE_</a>ã‚’ã¤ã‘ã¾ã™ã—ã€<a href="https://nextjs.org/docs/basic-features/environment-variables">Next.jsã ã¨NEXT_PUBLIC_</a>ã§ã™ã­ã€‚ã“ã‚Œã‚‰ã®è¨­å®šã¯ã‚µãƒ¼ãƒãƒ¼ã§ã¯ãªãã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ãªã®ã§ã€ãã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ãŸåå‰ã«ã—ã¾ã™ã€‚Vue.jsã ã£ãŸã‚‰æ¬¡ã®é€šã‚Šã€‚</p><figure class="highlight bash"><figcaption><span>.env</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VUE_APP_AZURE_DUMMY_USER=dummy-user@example.com</span><br><span class="line">VUE_APP_AZURE_ISSUER=https://login.microsoftonline.com/<span class="variable">$&#123;ãƒ†ãƒŠãƒ³ãƒˆID&#125;</span>,</span><br><span class="line">VUE_APP_AZURE_APP_ID=<span class="variable">$&#123;ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID&#125;</span></span><br></pre></td></tr></table></figure><p>ã“ã‚Œã‚‰ã®è¨­å®šã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®URLã¯ç¾åœ¨å®Ÿè¡Œä¸­ã®ãƒ›ã‚¹ãƒˆã®<code>/callback</code>ã‚’å‘ãã‚ˆã†ã«å‹•çš„ã«ãƒ‘ã‚¹ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ‘ã‚¹ã‚’AzureADå´ã®è¨­å®šã«ã‚‚å…¥ã‚Œã‚‹æƒ³å®šã§ã™ã€‚</p><figure class="highlight ts"><figcaption><span>authConfig.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Configuration</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@azure/msal-browser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">config</span>: <span class="title class_">Configuration</span> = &#123;</span><br><span class="line">    <span class="attr">auth</span>: &#123;</span><br><span class="line">        <span class="attr">authority</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_AZURE_ISSUER</span>,</span><br><span class="line">        <span class="attr">clientId</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_AZURE_APP_ID</span>,</span><br><span class="line">        <span class="attr">redirectUri</span>: <span class="string">`<span class="subst">$&#123;location.protocol&#125;</span>//<span class="subst">$&#123;location.host&#125;</span>/callback`</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">cache</span>: &#123;</span><br><span class="line">        <span class="attr">cacheLocation</span>: <span class="string">&quot;localStorage&quot;</span>,</span><br><span class="line">        <span class="attr">storeAuthStateInCookie</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ"><a href="#ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ" class="headerlink" title="ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ"></a>ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ</h1><p>MSAL.jsã‚’ä½¿ã†ã¨ã€AzureADã§èªè¨¼ã—ã¦JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œã£ã¦è¿”ã—ã¦ãã‚Œã¾ã™ã€‚ãã‚Œã‚’ãã®ã¾ã¾ã‚µãƒ¼ãƒãƒ¼ã«ã‚‚æ¸¡ã—ã€ã‚µãƒ¼ãƒãƒ¼å´ã§IDã‚’å–ã‚Šå‡ºã—ã¦ä½¿ã„ã¾ã™ã€‚é–‹ç™ºç”¨ãƒ¢ãƒ¼ãƒ‰ã‚’ä½œã‚‹ã¨ã—ã¦å¤§å¹…ãªifåˆ†å²ãªã©ã¯ä½œã‚ŠãŸãã¯ãªã„ã§ã™ã‚ˆã­ï¼Ÿ</p><ul><li>ãƒ€ãƒŸãƒ¼ã®JWTã¯ä½œã‚Šã€IDãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«ã™ã‚‹</li><li>ãŸã ã—AzureADã®è¨¼æ˜æ›¸ã§ã®ç½²åã¯ã§ããªã„ã®ã§ã€ç½²åã®ç¢ºèªã¯ã‚µãƒ¼ãƒãƒ¼ã§ã¯ã‚ãã‚‰ã‚ã‚‹</li></ul><p>AzureADã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã†å ´åˆ</p><p>ä»Šå›ã¯é–‹ç™ºç”¨ã®ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p><figure class="highlight bash"><figcaption><span>.env.development</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VUE_APP_AZURE_DUMMY_USER=dummy-user@example.com</span><br></pre></td></tr></table></figure><p>ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ãƒ€ãƒŸãƒ¼ã®JWTã‚’ä½œã‚‹ãŸã‚ã«joseãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã„ã¾ã™ã€‚ã“ã‚Œã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§ä½¿ãˆã¾ã™ãŒã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã»ã¨ã‚“ã©ã¯Node.jsã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã„ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ä½¿ãˆãªã„ã‚‚ã®ãŒå¤šã‹ã£ãŸã§ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install jose</span><br></pre></td></tr></table></figure><p>å‰å›ã¨é•ã†ã¨ã“ã‚ã‚’ä¸»ã«ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦æç¤ºã—ã¦ã„ã¾ã™ã€‚</p><p>ãƒ­ã‚°ã‚¤ãƒ³ã§ã¯ãƒ€ãƒŸãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚ã‚‹ã‹ã©ã†ã‹ã§æ¡ä»¶åˆ¤æ–­ã‚’è¡Œã„ã€ãƒ€ãƒŸãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ãŸã‚‰JWTã‚’ä½œã£ã¦è¿”ã—ã¦ã„ã¾ã™ã€‚å†…å®¹ã¯ã ã„ãŸã„AzureADãŒä½œã£ã¦ã„ã‚‹ã‚‚ã®ã«ä¼¼ã›ã‚‹ã‚ˆã†ã«ã¯ã—ã¦ã„ã¾ã™ï¼ˆå®Œå…¨ã§ã¯ãªã„ï¼‰ã€‚</p><p>AzureADã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯subã§ã¯UUIDã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚ãŠãã‚‰ãã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®IDã‚’ã‚‚ã¨ã«æ¨©é™ç®¡ç†ã‚’ã—ãŸã‚Šã™ã‚‹ã®ã§ã‚ã‚Œã°ã€<code>preferred_username</code>ã«å…¥ã£ã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ã†ã“ã¨ã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚AzureADå´ã®è¨­å®šã§IDãƒˆãƒ¼ã‚¯ãƒ³ã«å…¥ã‚Œã‚‹ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’å¢—ã‚„ã—ã¦ã€<code>email</code>ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¶³ã—ãŸã‚Šã‚‚ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚</p><figure class="highlight ts"><figcaption><span>authPlugin</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿½åŠ </span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UnsecuredJWT</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;jose&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰å›ã¯accessTokenã ã£ãŸãŒidTokenã«å¤‰æ›´</span></span><br><span class="line"><span class="keyword">let</span> idToken = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰å›ã®loginãƒ¡ã‚½ãƒƒãƒ‰ã®ä¿®æ­£</span></span><br><span class="line"><span class="keyword">async</span> login () &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">VUE_APP_AZURE_DUMMY_USER</span>) &#123; <span class="comment">// ãƒ€ãƒŸãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰</span></span><br><span class="line">    <span class="keyword">const</span> jwt = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">UnsecuredJWT</span>(&#123;</span><br><span class="line">      <span class="attr">idp</span>: <span class="string">&#x27;https://sts.windows.net/....&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Dummy User(ãƒ€ãƒŸãƒ¼ ãƒ¦ãƒ¼ã‚¶ãƒ¼)&#x27;</span>,</span><br><span class="line">      <span class="attr">preferred_username</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_AZURE_DUMMY_USER</span>,</span><br><span class="line">      <span class="attr">sub</span>: <span class="title function_">btoa</span>(process.<span class="property">env</span>.<span class="property">VUE_APP_AZURE_DUMMY_USER</span>), <span class="comment">// ãƒŠãƒãƒ¥ãƒ©ãƒ«ã‚­ãƒ¼ã£ã½ãã™ã‚‹</span></span><br><span class="line">      <span class="attr">ver</span>: <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">      .<span class="title function_">setIssuer</span>(<span class="string">`<span class="subst">$&#123;process.env.VUE_APP_AZURE_ISSUER&#125;</span>/v2.0`</span>)</span><br><span class="line">      .<span class="title function_">setAudience</span>(process.<span class="property">env</span>.<span class="property">VUE_APP_AZURE_APP_ID</span>)</span><br><span class="line">      .<span class="title function_">setIssuedAt</span>()</span><br><span class="line">      .<span class="title function_">setExpirationTime</span>(<span class="string">&#x27;1h&#x27;</span>)</span><br><span class="line">      .<span class="title function_">setNotBefore</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>)</span><br><span class="line">      .<span class="title function_">encode</span>()</span><br><span class="line">    idToken = jwt</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰</span></span><br><span class="line">    <span class="keyword">if</span> (_auth.<span class="title function_">getAllAccounts</span>().<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      _auth.<span class="title function_">setActiveAccount</span>(_auth.<span class="title function_">getAllAccounts</span>()[<span class="number">0</span>])</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> _auth.<span class="title function_">acquireTokenSilent</span>(&#123;</span><br><span class="line">        <span class="attr">scopes</span>: [<span class="string">`<span class="subst">$&#123;process.env.VUE_APP_AZURE_APP_ID&#125;</span>/.default`</span>],</span><br><span class="line">        <span class="attr">redirectUri</span>: config.<span class="property">auth</span>.<span class="property">redirectUri</span></span><br><span class="line">      &#125;)</span><br><span class="line">      idToken = result.<span class="property">idToken</span></span><br><span class="line">      <span class="keyword">return</span> idToken</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> _auth.<span class="title function_">acquireTokenRedirect</span>(&#123;</span><br><span class="line">        <span class="attr">redirectStartPage</span>: location.<span class="property">href</span>,</span><br><span class="line">        <span class="attr">scopes</span>: [<span class="string">`<span class="subst">$&#123;process.env.VUE_APP_AZURE_APP_ID&#125;</span>/.default`</span>],</span><br><span class="line">        <span class="attr">redirectUri</span>: config.<span class="property">auth</span>.<span class="property">redirectUri</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!process.<span class="property">env</span>.<span class="property">AZURE_DUMMY_USER</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> _auth.<span class="title function_">logoutRedirect</span>(&#123;</span><br><span class="line">      <span class="attr">postLogoutRedirectUri</span>: <span class="string">`<span class="subst">$&#123;location.protocol&#125;</span>//<span class="subst">$&#123;location.host&#125;</span>/`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§ã€AzureADãŒã‚ã‚‹ãµã‚Šã‚’ã—ã¦ãã‚Œã£ã½ã„IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œã£ã¦è¿”ã™ã‚³ãƒ¼ãƒ‰ãŒã§ãã¾ã—ãŸã€‚</p><p>ã‚µãƒ¼ãƒãƒ¼å´ã§ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã‚‹ã¨ãã«ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å—ã‘ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã‚‚ç’°å¢ƒå¤‰æ•°ã§å°‘ã—å‹•ä½œã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã¦ã€ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã®æ™‚ã«ã¯ç½²åã®æ¤œè¨¼ã¯è¡Œã‚ãªã„å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€expiration time(exp)ã€not before(nbf)ã€audã€issã¨ã„ã£ãŸã‚¯ãƒ¬ãƒ¼ãƒ ã‚’ä½¿ã£ãŸæ¤œè¨¼ã¯å¯èƒ½ã§ã™ã€‚</p><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã§ã€é–‹ç™ºæ™‚ã«ãƒ­ã‚°ã‚¤ãƒ³å›ã‚Šã‚’ã©ã†å‡¦ç†ã™ã‚Œã°ã„ã„ã®ã‹ã€ã¨ã„ã†ã®ã¯ã„ã¤ã‚‚æ‚©ã‚€ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚ã„ã‚ã‚“ãªãƒ­ã‚°ã‚¤ãƒ³æ–¹å¼ãŒä½¿ãˆã‚‹ã‚µãƒ¼ãƒãƒ¼ã§ã‚ã‚Œã°ID&#x2F;ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹æ©Ÿæ§‹ã‚’åˆ¥ã«ä½œã£ãŸã‚Šã€æœ¬ç•ªåŒç­‰ã®èªè¨¼ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã¦ã€ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å…¥ã‚Œã‚‹ãªã©ã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚ã§ã™ãŒã€å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ä¾å­˜ãŒã‚ã‚‹ã¨çµåˆãƒ†ã‚¹ãƒˆã‚„CIãŒã‚„ã‚Šã«ãããªã£ãŸã‚Šã‚‚ã—ã¾ã™ã—ã€å‡¦ç†æ™‚é–“ã‚‚ä¼¸ã³ã¦ã—ã¾ã„ã¾ã™ã€‚ã‚ã¨ã€ã›ã£ã‹ãMSAL.jsã‚’ä½¿ãˆã°èªè¨¼ã®çµ„ã¿è¾¼ã¿ãŒç°¡å˜ãªã®ã«ã€èªè¨¼å›ã‚Šä»¥å¤–ã«ãŸãã•ã‚“ã®ifæ–‡ãŒå…¥ã‚‹ã®ã‚‚ã†ã‚Œã—ãã‚ã‚Šã¾ã›ã‚“ã€‚</p><p>ä»Šå›ã¯ãƒ†ã‚¹ãƒˆç”¨ã«AzureADã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ãƒ€ãƒŸãƒ¼ã®JWTã‚’ä½œã‚‹ã¨ã„ã†æ–¹å‘ã§å®Ÿè£…ã—ã¾ã—ãŸã€‚æ¯”è¼ƒçš„å½±éŸ¿ç¯„å›²ã‚’ãƒ­ã‚°ã‚¤ãƒ³å›ã‚Šã«é–‰ã˜è¾¼ã‚ã¤ã¤å®Ÿè£…ã§ããŸã‚“ã˜ã‚ƒãªã„ã‹ãªã€ã¨æ€ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221220a/azuread.jpg&quot; alt=&quot;&quot; width=&quot;700&quot;</summary>
        
      
    
    
    
    <category term="èªè¨¼èªå¯" scheme="https://future-architect.github.io/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/"/>
    
    
    <category term="Azure" scheme="https://future-architect.github.io/tags/Azure/"/>
    
    <category term="MSAL.js" scheme="https://future-architect.github.io/tags/MSAL-js/"/>
    
    <category term="AzureAD" scheme="https://future-architect.github.io/tags/AzureAD/"/>
    
  </entry>
  
  <entry>
    <title>tree-sitteræ–‡æ³•å…¥é–€</title>
    <link href="https://future-architect.github.io/articles/20221215a/"/>
    <id>https://future-architect.github.io/articles/20221215a/</id>
    <published>2022-12-14T15:00:00.000Z</published>
    <updated>2022-12-15T07:54:57.757Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221215a/tree-sitter-small.png" alt="" width="400" height="400"><p>ã“ã¡ã‚‰ã¯<a href="https://qiita.com/advent-calendar/2022/postgresql">PostgreSQL Advent Calendar 2022</a> ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼2æšç›®ãƒ»15æ—¥ç›®ã®æŠ•ç¨¿ã¨ãªã‚Šã¾ã™ã€‚<br>å‰å›ã¯ã€<a href="https://qiita.com/hmatsu47">@hmatsu47</a>ã•ã‚“ã®<a href="https://qiita.com/hmatsu47/items/8de48e81a660eabe4bf0">Supabase ã§ TCEï¼ˆé€éçš„åˆ—æš—å·åŒ–ï¼‰ã‚’è»½ãè©¦ã—ã¦ã¿ãŸ</a>ã§ã—ãŸã€‚</p><h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ã€ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã§ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚’ã—ã¦ã„ã‚‹é½‹è—¤ã§ã™ã€‚ä»¥å‰ã¯åŒç¤¾ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã§SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’ä½œæˆã—ã¦ã„ã¾ã—ãŸ(<a href="/articles/20220916b/">è¨˜äº‹</a>)ã€‚ç¾åœ¨ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ä¸­ã«ä½œæˆã—ã¦ã„ãŸSQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’PostgreSQLã®æ§‹æ–‡ã«å¯¾å¿œã•ã›ã‚‹ä½œæ¥­ã«å–ã‚Šçµ„ã‚“ã§ã„ã¾ã™ã€‚</p><p>ã“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã§ã¯SQLãƒ‘ãƒ¼ã‚µã«tree-sitter-sqlã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ãŒã€å¯¾å¿œã—ã¦ã„ãªã„æ§‹æ–‡ãŒã„ãã¤ã‹å­˜åœ¨ã—ã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€æœªå¯¾å¿œã®æ§‹æ–‡ã§ã‚ã‚‹BETWEENè¿°èªã‚’ä¾‹ã«ã€tree-sitterã®æ§‹æ–‡æ‹¡å¼µã®æ‰‹é †ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚é–‹ç™ºä¸­ã®SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã¯OSSå…¬é–‹äºˆå®šã§ã™ã®ã§ã€ãœã²ä»²é–“ã‚’å¢—ã‚„ã—ãŸã„ã¨ã„ã†æ€ã„ã‹ã‚‰è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚</p><p>ã¾ãŸã€ç¾åœ¨ä½œæˆä¸­ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®VSCodeæ‹¡å¼µæ©Ÿèƒ½åŒ–ã«ã‚‚å–ã‚Šçµ„ã‚“ã§ã„ã¾ã™ã€‚ãœã²ãã¡ã‚‰ã‚‚ä½µã›ã¦ã”è¦§ãã ã•ã„ï¼</p><p>VSCodeæ‹¡å¼µæ©Ÿèƒ½åŒ–ã«é–¢ã™ã‚‹è¨˜äº‹:</p><ol><li><a href="/articles/20221124a/">Language Server Protocolã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º (å‰ç·¨) | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li><li><a href="/articles/20221125a/">Language Server Protocolã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º (å¾Œç·¨) | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li></ol><h1 id="ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³"><a href="#ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³" class="headerlink" title="ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³"></a>ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³</h1><p>æœ¬è¨˜äº‹ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p><ol><li>tree-sitterã€tree-sitter-sqlã«ã¤ã„ã¦</li><li>tree-sitterã®æ§‹æ–‡æ‹¡å¼µç”¨ã®ç’°å¢ƒæ§‹ç¯‰</li><li>æ§‹æ–‡æœ¨ã‚’å‡ºåŠ›ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè£…</li><li>æ§‹æ–‡ã«ã¤ã„ã¦ã®èª¬æ˜</li><li>BETWEENè¿°èªã®è¦å‰‡ã‚’è¿½åŠ </li></ol><h1 id="tree-sitter"><a href="#tree-sitter" class="headerlink" title="tree-sitter"></a>tree-sitter</h1><p><a href="https://tree-sitter.github.io/tree-sitter/">tree-sitter</a>ã¯æ–‡æ³•ã‹ã‚‰ãƒ‘ãƒ¼ã‚µ(æ§‹æ–‡è§£æå™¨)ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ‘ãƒ¼ã‚µã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€ç”Ÿæˆã•ã‚ŒãŸãƒ‘ãƒ¼ã‚µã§æ§‹æ–‡è§£æã‚’è¡Œã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚‚ã‚ã‚Šã¾ã™ã€‚ç‰¹å¾´ã¨ã—ã¦ã€ä¸€èˆ¬çš„ãªãƒ‘ãƒ¼ã‚µãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯æŠ½è±¡æ§‹æ–‡æœ¨(AST)ã‚’æ§‹ç¯‰ã™ã‚‹ã®ã«å¯¾ã—ã€tree-sitterã§ç”Ÿæˆã•ã‚ŒãŸãƒ‘ãƒ¼ã‚µã¯å…·è±¡æ§‹æ–‡æœ¨(CST)ã‚’æ§‹ç¯‰ã™ã‚‹ã¨ã„ã†ç‚¹ãŒã‚ã’ã‚‰ã‚Œã¾ã™ã€‚CSTã«ã¤ã„ã¦ã¯<a href="/articles/20220916c/#:~:text=AST%E3%81%8C%E6%84%8F%E5%91%B3%E3%81%AE%E3%81%AA%E3%81%84%E6%83%85%E5%A0%B1(%E4%BE%8B:%20%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%84%E5%A4%9A%E9%87%8D%E6%8B%AC%E5%BC%A7%E3%81%AA%E3%81%A9)%E3%82%92%E4%BF%9D%E6%8C%81%E3%81%97%E3%81%AA%E3%81%84%E3%81%AE%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%80%81CST%E3%81%AF%E3%81%9D%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E6%83%85%E5%A0%B1%E3%82%82%E4%BF%9D%E6%8C%81%E3%81%97%E3%81%BE%E3%81%99%E3%80%82">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®è¨˜äº‹</a>ã§å–ã‚Šä¸Šã’ã¦ã„ã¾ã™ã€‚</p><p>æ§‹ç¯‰ã•ã‚Œã‚‹CSTã«ã¯ã‚³ãƒ¡ãƒ³ãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã‚‚å«ã¾ã‚Œã¦ã‚‹ãŸã‚ã€ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã«ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚<br>å‚è€ƒ:</p><ul><li><a href="https://www.soum.co.jp/misc/vim-advanced/6/">Vimã®ã™ã‚ã‚æ”¹ - Tree-sitter ã«ã¤ã„ã¦ | æ ªå¼ä¼šç¤¾å‰µå¤¢ â€” SOUM&#x2F;misc</a></li><li><a href="https://zenn.dev/hyakt/articles/6ff892c2edbabb">Emacsã§Tree-sitterã‚’åˆ©ç”¨ã—ã¦ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹</a></li></ul><h1 id="tree-sitter-sql"><a href="#tree-sitter-sql" class="headerlink" title="tree-sitter-sql"></a>tree-sitter-sql</h1><p><a href="https://github.com/m-novikov/tree-sitter-sql">tree-sitter-sql</a>ã¯tree-sitterç”¨ã«æ›¸ã‹ã‚ŒãŸSQLã®æ–‡æ³•ã¨ãã®æ–‡æ³•ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸãƒ‘ãƒ¼ã‚µãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚SQLã®ä¸­ã§ã‚‚ã€PostgreSQLã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦ã„ãŸã‚ˆã†ã§ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã§ä½œæˆã—ãŸãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã¯ã€ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚‹æ§‹æ–‡è§£æçµæœã‚’ã‚‚ã¡ã„ã¦SQLã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚</p><p>ã—ã‹ã—ã€BETWEENè¿°èªã‚„<code>UNION</code>ã€<code>INTERSECT</code>ãªã©ã®çµåˆæ¼”ç®—ãªã©ã€åŸºæœ¬çš„ãªæ§‹æ–‡ã§ã‚ã‚‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€å¯¾å¿œã—ã¦ã„ãªã„æ§‹æ–‡ãŒå­˜åœ¨ã—ã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€ãã®ä¸­ã§ã‚‚BETWEENè¿°èªã«å¯¾å¿œã•ã›ã‚‹ãŸã‚ã®æ§‹æ–‡æ‹¡å¼µã‚’è¡Œã„ã¾ã™ã€‚</p><h1 id="ç’°å¢ƒæ§‹ç¯‰"><a href="#ç’°å¢ƒæ§‹ç¯‰" class="headerlink" title="ç’°å¢ƒæ§‹ç¯‰"></a>ç’°å¢ƒæ§‹ç¯‰</h1><p>ã¾ãšã€tree-sitterã®æ§‹æ–‡æ‹¡å¼µã®ãŸã‚ã«è¡Œã£ãŸç’°å¢ƒæ§‹ç¯‰ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</p><h3 id="tree-sitter-cliã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#tree-sitter-cliã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="tree-sitter-cliã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>tree-sitter-cliã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3><p>tree-sitterã§ãƒ‘ãƒ¼ã‚µã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ã€tree-sitter-cliã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™(å‚è€ƒ<a href="https://tree-sitter.github.io/tree-sitter/creating-parsers#getting-started">Tree-sitter | Creating Parser</a>)ã€‚ã¾ãŸã€tree-sitterã«ã‚ˆã‚‹ãƒ‘ãƒ¼ã‚µã‚’é–‹ç™ºã™ã‚‹ãŸã‚ã«ã¯ã€Node.jsã¨Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå¿…è¦ã§ã™ã€‚ä»Šå›ä½¿ç”¨ã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p><div class="scroll"><table><thead><tr><th>tools</th><th>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</th></tr></thead><tbody><tr><td>node</td><td>16.17.1</td></tr><tr><td>gcc</td><td>12.2.0</td></tr><tr><td>tree-sitter</td><td>0.20.7</td></tr></tbody></table></div><h3 id="tree-sitter-sqlã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#tree-sitter-sqlã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="tree-sitter-sqlã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>tree-sitter-sqlã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3><p><a href="https://github.com/m-novikov/tree-sitter-sql">tree-sitter-sql</a>ã‚’cloneã—ã¾ã™ã€‚tree-sitterç”¨ã®SQLæ§‹æ–‡ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯æœ€ã‚‚ã‚¹ã‚¿ãƒ¼æ•°ãŒå¤šã„ã‚‚ã®ã‚’é¸æŠã—ã¾ã—ãŸã€‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/m-novikov/tree-sitter-sql.git</span></span><br></pre></td></tr></table></figure><p><code>git clone</code>ã‚’è¡Œã†ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: unable to create file [filepath]: Filename too long</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã¯ãƒ•ã‚¡ã‚¤ãƒ«åãŒé•·ã™ãã‚‹ã“ã¨ãŒå•é¡Œã§ã‚ã‚‹ã‚ˆã†ãªã®ã§ã€ä»¥ä¸‹ã®è¨­å®šã‚’è¡Œã†ã“ã¨ã§è§£æ±ºã—ã¾ã™ã€‚</p><figure class="highlight console"><figcaption><span>gitã®è¨­å®š</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git config --global core.longpaths <span class="literal">true</span></span></span><br></pre></td></tr></table></figure><p><code>git clone</code> ã—ãŸtree-sitter-sqlã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã€<code>tree-sitter test</code> ã‚³ãƒãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆãŒå‹•ä½œã—ãŸã‚‰ç’°å¢ƒæ§‹ç¯‰çµ‚äº†ã§ã™ã€‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ./tree-sitter-sql</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree-sitter <span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><h3 id="æ§‹æ–‡è§£æä¾‹"><a href="#æ§‹æ–‡è§£æä¾‹" class="headerlink" title="æ§‹æ–‡è§£æä¾‹"></a>æ§‹æ–‡è§£æä¾‹</h3><p>å®Ÿéš›ã«ãƒ‘ãƒ¼ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚</p><figure class="highlight sql"><figcaption><span>exapmles/simple.sql</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    STUDENT</span><br></pre></td></tr></table></figure><p><code>tree-sitter parse</code>ã‚³ãƒãƒ³ãƒ‰ã§ã€ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tree-sitter parse ./exapmles/simple.sql</span><br><span class="line">(<span class="name">source_file</span> [<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">3</span><span class="punctuation">,</span> <span class="number">11</span>]</span><br><span class="line">  (<span class="name">select_statement</span> [<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">3</span><span class="punctuation">,</span> <span class="number">11</span>]</span><br><span class="line">    (<span class="name">select_clause</span> [<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>]</span><br><span class="line">      (<span class="name">select_clause_body</span> [<span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>]</span><br><span class="line">        (<span class="name">identifier</span> [<span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>])))</span><br><span class="line">    (<span class="name">from_clause</span> [<span class="number">2</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">3</span><span class="punctuation">,</span> <span class="number">11</span>]</span><br><span class="line">      (<span class="name">identifier</span> [<span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">3</span><span class="punctuation">,</span> <span class="number">11</span>]))))</span><br></pre></td></tr></table></figure><h1 id="CSTã®å‡ºåŠ›ã«ã¤ã„ã¦"><a href="#CSTã®å‡ºåŠ›ã«ã¤ã„ã¦" class="headerlink" title="CSTã®å‡ºåŠ›ã«ã¤ã„ã¦"></a>CSTã®å‡ºåŠ›ã«ã¤ã„ã¦</h1><p>ä¸Šè¿°ã—ãŸ<code>tree-sitter parse</code>ã«ã‚ˆã‚Šå‡ºåŠ›ã•ã‚Œã‚‹çµæœã§ã¯ã€ãƒãƒ¼ãƒ‰ã®ãƒ©ãƒ™ãƒ«ã®ã¿è¡¨ç¤ºã•ã‚Œã¦ãŠã‚Šã€è­˜åˆ¥å­ã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãªã©ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ãã“ã§ã€ãƒ‘ãƒ¼ã‚¹çµæœã‹ã‚‰CSTã‚’å‡ºåŠ›ã™ã‚‹å‡¦ç†ã‚’è‡ªä½œã—ã¾ã—ãŸã€‚</p><p>è¨€èªã«ã¯Rustã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p><h3 id="æº–å‚™"><a href="#æº–å‚™" class="headerlink" title="æº–å‚™"></a>æº–å‚™</h3><p><code>tree-sitter-sql</code>ã®çµæœã‚’åˆ©ç”¨ã—ã¦CSTã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new print-cst</span><br></pre></td></tr></table></figure><p><code>Cargo.toml</code>ã«æ¬¡ã®ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight toml"><figcaption><span>print-cst/Cargo.toml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">tree-sitter</span> = <span class="string">&quot;~0.20.3&quot;</span></span><br><span class="line"><span class="attr">tree-sitter-sql</span> = &#123;path = <span class="string">&quot;&#123;tree-sitter-sqlã®ãƒ‘ã‚¹&#125;&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>ã¾ãŸã€Githubä¸Šã®tree-sitter-sqlãŒä½¿ç”¨ã—ã¦ã„ã‚‹tree-sitterã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„(2022å¹´11æœˆ22æ—¥ç¾åœ¨)ãŸã‚ã€tree-sitter-cliã¨tree-sitterã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸æ•´åˆãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸æ•´åˆãŒç”Ÿã˜ã‚‹ã¨ãã€å¾Œè¿°ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">thread &#x27;main&#x27; panicked at &#x27;called `Result::unwrap()` on an `Err` value: LanguageError &#123; version: 14 &#125;&#x27;, src\lib.rs:16:35</span><br><span class="line">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span><br></pre></td></tr></table></figure><p>ã“ã®å ´åˆã€tree-sitter-sqlã®<code>Cargo.toml</code>ã‚‚ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><figure class="highlight toml"><figcaption><span>tree-sitter-sql/Cargo.toml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">tree-sitter</span> = <span class="string">&quot;~0.20.3&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å®Ÿè£…"><a href="#å®Ÿè£…" class="headerlink" title="å®Ÿè£…"></a>å®Ÿè£…</h3><p><code>main.rs</code>ã«æ¬¡ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ãŸã€‚</p><figure class="highlight rust"><figcaption><span>main.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::read_to_string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> tree_sitter::TreeCursor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">language</span> = tree_sitter_sql::<span class="title function_ invoke__">language</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">parser</span> = tree_sitter::Parser::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    parser.<span class="title function_ invoke__">set_language</span>(language).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">src_file</span> = std::env::<span class="title function_ invoke__">args</span>().<span class="title function_ invoke__">nth</span>(<span class="number">1</span>).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;arguments error&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">src</span> = <span class="title function_ invoke__">read_to_string</span>(&amp;src_file).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tree</span> = parser.<span class="title function_ invoke__">parse</span>(&amp;src, <span class="literal">None</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">if</span> tree.<span class="title function_ invoke__">root_node</span>().<span class="title function_ invoke__">has_error</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">cursor</span> = tree.<span class="title function_ invoke__">walk</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">visit</span>(&amp;<span class="keyword">mut</span> cursor, <span class="number">0</span>, &amp;src);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UNIT: <span class="type">usize</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">visit</span>(cursor: &amp;<span class="keyword">mut</span> TreeCursor, depth: <span class="type">usize</span>, src: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">    <span class="comment">// ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ</span></span><br><span class="line">    (<span class="number">0</span>..(depth * UNIT)).<span class="title function_ invoke__">for_each</span>(|_| <span class="built_in">print!</span>(<span class="string">&quot; &quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, cursor.<span class="title function_ invoke__">node</span>().<span class="title function_ invoke__">kind</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­ä¾›ãŒã„ãªã„ã‹ã¤ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ãªã„å ´åˆã€å¯¾å¿œã™ã‚‹æ–‡å­—åˆ—ã‚’è¡¨ç¤º</span></span><br><span class="line">    <span class="keyword">if</span> cursor.<span class="title function_ invoke__">node</span>().<span class="title function_ invoke__">child_count</span>() == <span class="number">0</span> &amp;&amp; cursor.<span class="title function_ invoke__">node</span>().<span class="title function_ invoke__">kind</span>().<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">any</span>(|c| c.<span class="title function_ invoke__">is_lowercase</span>()) &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot; \&quot;&#123;&#125;\&quot;&quot;</span>, cursor.<span class="title function_ invoke__">node</span>().<span class="title function_ invoke__">utf8_text</span>(src.<span class="title function_ invoke__">as_bytes</span>()).<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot; [&#123;&#125;-&#123;&#125;]&quot;</span>,</span><br><span class="line">        cursor.<span class="title function_ invoke__">node</span>().<span class="title function_ invoke__">start_position</span>(),</span><br><span class="line">        cursor.<span class="title function_ invoke__">node</span>().<span class="title function_ invoke__">end_position</span>()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­ä¾›ã‚’èµ°æŸ»</span></span><br><span class="line">    <span class="keyword">if</span> cursor.<span class="title function_ invoke__">goto_first_child</span>() &#123;</span><br><span class="line">        <span class="title function_ invoke__">visit</span>(cursor, depth + <span class="number">1</span>, src);</span><br><span class="line">        <span class="keyword">while</span> cursor.<span class="title function_ invoke__">goto_next_sibling</span>() &#123;</span><br><span class="line">            <span class="title function_ invoke__">visit</span>(cursor, depth + <span class="number">1</span>, src);</span><br><span class="line">        &#125;</span><br><span class="line">        cursor.<span class="title function_ invoke__">goto_parent</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®Ÿè¡Œä¾‹"><a href="#å®Ÿè¡Œä¾‹" class="headerlink" title="å®Ÿè¡Œä¾‹"></a>å®Ÿè¡Œä¾‹</h3><p>ä½œæˆã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”¨ã„ã¦ã€å®Ÿéš›ã«CSTã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><figure class="highlight sql"><figcaption><span>exapmles/simple.sql</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    STUDENT</span><br></pre></td></tr></table></figure><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run ./examples/simple.sql</span><br><span class="line">source_file [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">1</span><span class="punctuation">,</span> <span class="number">12</span>)]</span><br><span class="line">  select_statement [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">0</span><span class="punctuation">,</span> <span class="number">9</span>)]</span><br><span class="line">    select_clause [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">0</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">      SELECT [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">0</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">      select_clause_body [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">7</span>)-(<span class="number">0</span><span class="punctuation">,</span> <span class="number">9</span>)]</span><br><span class="line">        identifier <span class="string">&quot;ID&quot;</span> [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">7</span>)-(<span class="number">0</span><span class="punctuation">,</span> <span class="number">9</span>)]</span><br><span class="line">    from_clause [(<span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span>)]</span><br><span class="line">      FROM [(<span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span>)]</span><br><span class="line">      identifier <span class="string">&quot;STUDENT&quot;</span> [(<span class="number">1</span><span class="punctuation">,</span> <span class="number">5</span>)-(<span class="number">1</span><span class="punctuation">,</span> <span class="number">12</span>)]</span><br></pre></td></tr></table></figure><p>ãƒãƒ¼ãƒ‰ã«å¯¾å¿œã™ã‚‹æ–‡å­—åˆ—ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚</p><h1 id="æ§‹æ–‡ä¾‹"><a href="#æ§‹æ–‡ä¾‹" class="headerlink" title="æ§‹æ–‡ä¾‹"></a>æ§‹æ–‡ä¾‹</h1><p>æ¬¡ã«ã€tree-sitterç”¨ã®æ§‹æ–‡ã«ã¤ã„ã¦ç°¡å˜ã«ç´¹ä»‹ã—ã¾ã™ã€‚</p><p>tree-sitter ã§ã¯æ–‡æ³•ã‚’ <code>grammar.js</code> ã«è¨˜è¿°ã—ã¾ã™ã€‚clone ã—ãŸ tree-sitter-sql ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ <code>grammar.js</code>ã‚’ç·¨é›†ã—ã¦ã„ãã¾ã™ã€‚ã“ã“ã§ã¯DSL(<a href="https://ja.wikipedia.org/wiki/%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E5%9B%BA%E6%9C%89%E8%A8%80%E8%AA%9E">ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰è¨€èª</a>)ã«ã¤ã„ã¦ç´°ã‹ãã¯èª¬æ˜ã—ãªã„ã®ã§ã€è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹ã¯<a href="https://tree-sitter.github.io/tree-sitter/creating-parsers#the-grammar-dsl">tree-sitterã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><h3 id="è¦å‰‡"><a href="#è¦å‰‡" class="headerlink" title="è¦å‰‡"></a>è¦å‰‡</h3><p>ä¾‹ãˆã°ã€tree-sitter-sql ã§ WHEREå¥ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™(<a href="https://github.com/m-novikov/tree-sitter-sql/blob/218b672499729ef71e4d66a949e4a1614488aeaa/grammar.js#L909">where_clauseã®å®šç¾©</a>)ã€‚</p><figure class="highlight js"><figcaption><span>WHEREå¥ã®è¦å‰‡</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">where_clause</span>: $ =&gt; <span class="title function_">seq</span>(<span class="title function_">kw</span>(<span class="string">&quot;WHERE&quot;</span>), $._expression)</span><br></pre></td></tr></table></figure><p><code>seq</code>ã¯tree-sitterã®æ–‡æ³•ã®DSLã®ä¸€ã¤ã§ã€è¤‡æ•°ã®è¦å‰‡ã‚’é€£çµã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸Šã®ä¾‹ã§ã¯ã€<code>kw(&quot;WHERE&quot;)</code>ã®ã‚ã¨ã«<code>$._expression</code>ãŒç¾ã‚Œã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚</p><p><code>kw</code>é–¢æ•°ã¯tree-sitter-sqlã®<code>grammar.js</code>ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ã§ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰(<code>k</code>ey<code>w</code>ord)ãŒå¤§æ–‡å­—ã‹å°æ–‡å­—ã§ã‚ã‚‹ã‹ã‚’è€ƒæ…®ã—ãªãã™ã‚‹ãªã©ã®å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚ãƒ‘ãƒ¼ã‚¹æ™‚ã«ã¯ã€<code>where</code>ã‚„<code>WHERE</code>ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ãƒãƒƒãƒã—ã¾ã™(<a href="https://github.com/m-novikov/tree-sitter-sql/blob/218b672499729ef71e4d66a949e4a1614488aeaa/grammar.js#L29">kwé–¢æ•°ã®å®šç¾©</a>)ã€‚</p><h3 id="ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‹ã‚‰å§‹ã¾ã‚‹è¦å‰‡"><a href="#ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‹ã‚‰å§‹ã¾ã‚‹è¦å‰‡" class="headerlink" title="ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‹ã‚‰å§‹ã¾ã‚‹è¦å‰‡"></a>ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‹ã‚‰å§‹ã¾ã‚‹è¦å‰‡</h3><p>è¦å‰‡åã®å…ˆé ­ã®æ–‡å­—ã‚’ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã§ã€ç”Ÿæˆã•ã‚Œã‚‹CSTã«ãƒãƒ¼ãƒ‰ã¨ã—ã¦å‡ºç¾ã•ã›ãªã„ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™(<a href="https://tree-sitter.github.io/tree-sitter/creating-parsers#hiding-rules">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>)ã€‚ä¾‹ãˆã°ã€ç®—è¡“æ¼”ç®—ã‚„è­˜åˆ¥å­ã€ãƒªãƒ†ãƒ©ãƒ«ãªã©ã®å¼ã¯<code>_expression</code>ã¨ã„ã†åå‰ã§ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><figure class="highlight js"><figcaption><span>å¼ã«å¯¾å¿œã™ã‚‹è¦å‰‡</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">_expression</span>: $ =&gt;</span><br><span class="line">     <span class="title function_">choice</span>(</span><br><span class="line">       $.string,</span><br><span class="line">       $.<span class="variable constant_">TRUE</span>,</span><br><span class="line">       $.<span class="variable constant_">FALSE</span>,</span><br><span class="line">       $.<span class="variable constant_">NULL</span>,</span><br><span class="line">       $._identifier,</span><br><span class="line">       $.number,</span><br><span class="line">       $.unary_expression,</span><br><span class="line">       <span class="comment">// ä¸€éƒ¨çœç•¥</span></span><br><span class="line">     ),</span><br></pre></td></tr></table></figure><p><code>choice</code>ã¯tree-sitterã®DSLã§ã€å¼•æ•°ã®ã†ã¡ã„ãšã‚Œã‹1ã¤ã¨ãƒãƒƒãƒã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã“ã®è¦å‰‡ã¯ã€æ–‡å­—åˆ—ã‚„<code>TRUE</code>ã€<code>FALSE</code>ãªã©å„å¼ã«å¯¾å¿œã—ãŸè¦å‰‡ã‚’å‘¼ã³å‡ºã—ã€ã„ãšã‚Œã‹ä¸€ã¤ã¨ãƒãƒƒãƒã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ä¸­ã«å¼ãŒç¾ã‚Œã‚‹ãŸã³ã«<code>_expression</code>ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚ŒãŒCSTä¸Šã«ç¾ã‚Œã‚‹ã¨ã€ä¾‹ãˆã°<code>1+2-3</code>ã¨ã„ã†å¼ã®ãƒ‘ãƒ¼ã‚¹çµæœãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">_expression</span></span><br><span class="line">  (<span class="name">binary_expression</span></span><br><span class="line">    (<span class="name">_expression</span></span><br><span class="line">      (<span class="name">binary_expression</span></span><br><span class="line">        (<span class="name">_expression</span></span><br><span class="line">          (<span class="name">number</span> <span class="string">&quot;1&quot;</span>))</span><br><span class="line">        (<span class="string">&quot;+&quot;</span>)</span><br><span class="line">        (<span class="name">_expression</span></span><br><span class="line">          (<span class="name">number</span> <span class="string">&quot;2&quot;</span>)))</span><br><span class="line">    (<span class="string">&quot;-&quot;</span>)</span><br><span class="line">    (<span class="name">_expression</span></span><br><span class="line">      (<span class="name">number</span> <span class="string">&quot;3&quot;</span>))))</span><br></pre></td></tr></table></figure><p>ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã§ã€CSTä¸Šã«ç¾ã‚Œãªã„ã‚ˆã†ã«è¨­å®šã§ãã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚·ãƒ³ãƒ—ãƒ«ãªæœ¨ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">binary_expression</span></span><br><span class="line">  (<span class="name">binary_expression</span></span><br><span class="line">    (<span class="name">number</span> <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    (<span class="string">&quot;+&quot;</span>)</span><br><span class="line">    (<span class="name">number</span> <span class="string">&quot;2&quot;</span>))</span><br><span class="line">  (<span class="string">&quot;-&quot;</span>)</span><br><span class="line">  (<span class="name">number</span> <span class="string">&quot;3))</span></span><br></pre></td></tr></table></figure><h3 id="å„ªå…ˆåº¦ã€çµåˆæ€§"><a href="#å„ªå…ˆåº¦ã€çµåˆæ€§" class="headerlink" title="å„ªå…ˆåº¦ã€çµåˆæ€§"></a>å„ªå…ˆåº¦ã€çµåˆæ€§</h3><p>ã“ã“ã§è©³ç´°ã¯è¿°ã¹ã¾ã›ã‚“ãŒã€tree-sitterã¯æ˜ç¤ºã—ãªã„å ´åˆã€æ›–æ˜§ãªæ–‡æ³•ã‚’æ‰±ã†ã“ã¨ãŒã§ãã¾ã›ã‚“(<a href="https://tree-sitter.github.io/tree-sitter/creating-parsers#the-grammar-dsl:~:text=conflicts%20%2D%20an%20array,dynamic%20precedence.">å‚è€ƒ</a>)ã€‚</p><p>ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè«–ç†å¼ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">NOT</span> X <span class="keyword">AND</span> Y <span class="keyword">OR</span> Z</span><br></pre></td></tr></table></figure><p>ã“ã®å¼ã¯ã©ã®ã‚ˆã†ã«è§£é‡ˆã•ã‚Œã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ<code>NOT (X AND (Y OR Z))</code>ã‚„<code>(NOT X) AND (Y OR Z)</code>ã€<code>((NOT X) AND Y) OR Z</code>ãªã©ã€è¤‡æ•°é€šã‚Šã«è§£é‡ˆã§ãã¦ã—ã¾ã†ã¨æ€ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ã«ã€è¤‡æ•°é€šã‚Šã®è§£é‡ˆãŒã§ãã¦ã—ã¾ã†ã‚ˆã†ãªæ–‡æ³•ã‚’æ›–æ˜§ãªæ–‡æ³•ã¨ã„ã„ã€ãã®ã¾ã¾ã§ã¯ãƒ‘ãƒ¼ã‚¹ã§ãã¾ã›ã‚“ã€‚</p><p>ã“ã‚Œã¯ã€å„ªå…ˆåº¦ãƒ»çµåˆæ€§ã‚’æ–‡æ³•ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã§å¯¾å‡¦ã§ãã¾ã™ã€‚tree-sitter-sqlã§ã¯å„ªå…ˆåº¦ã‚’Javascriptã®å®šæ•°ã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PREC</span> = &#123;</span><br><span class="line">  <span class="attr">primary</span>: <span class="number">8</span>,</span><br><span class="line">  <span class="attr">unary</span>: <span class="number">7</span>,             <span class="comment">// å˜é …æ¼”ç®—å­</span></span><br><span class="line">  <span class="attr">exp</span>: <span class="number">6</span>,               <span class="comment">// ç´¯ä¹—</span></span><br><span class="line">  <span class="attr">multiplicative</span>: <span class="number">5</span>,    <span class="comment">// ä¹—é™¤ç®—</span></span><br><span class="line">  <span class="attr">additive</span>: <span class="number">4</span>,          <span class="comment">// åŠ æ¸›ç®—</span></span><br><span class="line">  <span class="attr">comparative</span>: <span class="number">3</span>,       <span class="comment">// æ¯”è¼ƒæ¼”ç®—å­</span></span><br><span class="line">  <span class="attr">and</span>: <span class="number">2</span>,               <span class="comment">// AND</span></span><br><span class="line">  <span class="attr">or</span>: <span class="number">1</span>,                <span class="comment">// OR</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã‚’ç”¨ã„ã¦ã€è«–ç†å¼ã«å„ªå…ˆåº¦ãƒ»çµåˆæ€§ã‚’åŠ ãˆã¦è¨˜è¿°ã—ãŸè¦å‰‡ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">boolean_expression</span>: $ =&gt;</span><br><span class="line">  <span class="title function_">choice</span>(</span><br><span class="line">    prec.<span class="title function_">left</span>(<span class="variable constant_">PREC</span>.<span class="property">unary</span>, <span class="title function_">seq</span>(<span class="title function_">kw</span>(<span class="string">&quot;NOT&quot;</span>), $._expression)), <span class="comment">// å„ªå…ˆåº¦7</span></span><br><span class="line">    prec.<span class="title function_">left</span>(<span class="variable constant_">PREC</span>.<span class="property">and</span>, <span class="title function_">seq</span>($._expression, <span class="title function_">kw</span>(<span class="string">&quot;AND&quot;</span>), $._expression)),  <span class="comment">// å„ªå…ˆåº¦2</span></span><br><span class="line">    prec.<span class="title function_">left</span>(<span class="variable constant_">PREC</span>.<span class="property">or</span>, <span class="title function_">seq</span>($._expression, <span class="title function_">kw</span>(<span class="string">&quot;OR&quot;</span>), $._expression)), <span class="comment">// å„ªå…ˆåº¦1</span></span><br><span class="line">  ),</span><br></pre></td></tr></table></figure><p>å„ªå…ˆåº¦ã¯ã€<code>NOT &gt; AND &gt; OR</code>ã«ãªã£ã¦ã„ã¾ã™ã€‚å„ªå…ˆåº¦ãŒé«˜ã„ã‚‚ã®ã»ã©å„ªå…ˆã—ã¦çµåˆã•ã‚Œã‚‹ãŸã‚ã€ä¸Šè¿°ã®è«–ç†å¼ã‚’tree-sitter-sqlã§ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã¨ã€<code>((NOT X) AND Y) OR Z</code>ã¨è§£é‡ˆã•ã‚Œã¾ã™ã€‚ãªãŠã€<code>prec.left</code>ã¯å·¦çµåˆã§ã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚</p><h3 id="extras"><a href="#extras" class="headerlink" title="extras"></a>extras</h3><p>ãƒ•ã‚¡ã‚¤ãƒ«ã®ã©ã“ã«ç¾ã‚Œã¦ã‚‚ã‚ˆã„è¦å‰‡ã‚’extrasã§è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>ã“ã‚Œã‚’ä½¿ã£ã¦ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚„ç©ºç™½ã€æ”¹è¡Œã‚’ç°¡å˜ã«è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™(<a href="https://github.com/m-novikov/tree-sitter-sql/blob/218b672499729ef71e4d66a949e4a1614488aeaa/grammar.js#L75">ã‚³ãƒ¡ãƒ³ãƒˆã€ç©ºç™½ã®å®šç¾©</a>)ãŒã€CSTä¸Šã§ã¯ç›´æ„Ÿçš„ã§ãªã„å ´æ‰€ä½ç½®ã«ç¾ã‚Œã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™(<a href="https://future-architect.github.io/articles/20220916c/#:~:text=%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AE%E6%83%85%E5%A0%B1%E3%81%AFCST%E4%B8%8A%E3%81%AB%E4%BF%9D%E6%8C%81%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%81%8C%E3%80%81%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%A7%E3%81%AA%E3%81%84%E4%BD%8D%E7%BD%AE%E3%81%AB%E7%8F%BE%E3%82%8C%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E5%A0%B4%E5%90%88%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%80%82">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®è¨˜äº‹å¾Œç·¨</a>å‚ç…§)ã€‚</p><h1 id="BETWEENè¿°èªã¸ã®å¯¾å¿œ"><a href="#BETWEENè¿°èªã¸ã®å¯¾å¿œ" class="headerlink" title="BETWEENè¿°èªã¸ã®å¯¾å¿œ"></a>BETWEENè¿°èªã¸ã®å¯¾å¿œ</h1><p>ç¾çŠ¶ã®tree-sitter-sqlã‚’ä½¿ç”¨ã—ã¦ã€<code>BETWEEN</code>ã‚’å«ã‚€SQLã‚’ãƒ‘ãƒ¼ã‚¹ã§ãã‚‹ã‹ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚</p><figure class="highlight sql"><figcaption><span>examples/between.sql</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    STUDENT</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    GRADE   <span class="keyword">BETWEEN</span> <span class="number">80</span>  <span class="keyword">AND</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">AND</span> ID      <span class="keyword">BETWEEN</span> <span class="number">0</span>   <span class="keyword">AND</span> <span class="number">100</span></span><br></pre></td></tr></table></figure><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ tree-sitter parse .<span class="character">\e</span>xamples<span class="character">\b</span>etween.sql</span><br><span class="line">(<span class="name">source_file</span> [<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">7</span><span class="punctuation">,</span> <span class="number">0</span>]</span><br><span class="line">  (<span class="name">select_statement</span> [<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">6</span><span class="punctuation">,</span> <span class="number">31</span>]</span><br><span class="line">    (<span class="name">select_clause</span> [<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>]</span><br><span class="line">      (<span class="name">select_clause_body</span> [<span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>]</span><br><span class="line">        (<span class="name">identifier</span> [<span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>])))</span><br><span class="line">    (<span class="name">from_clause</span> [<span class="number">2</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">3</span><span class="punctuation">,</span> <span class="number">11</span>]</span><br><span class="line">      (<span class="name">identifier</span> [<span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">3</span><span class="punctuation">,</span> <span class="number">11</span>]))</span><br><span class="line">    (<span class="name">where_clause</span> [<span class="number">4</span><span class="punctuation">,</span> <span class="number">0</span>] - [<span class="number">6</span><span class="punctuation">,</span> <span class="number">31</span>]</span><br><span class="line">      (<span class="name">boolean_expression</span> [<span class="number">5</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">6</span><span class="punctuation">,</span> <span class="number">31</span>]</span><br><span class="line">        (<span class="name">boolean_expression</span> [<span class="number">5</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">6</span><span class="punctuation">,</span> <span class="number">6</span>]</span><br><span class="line">          (<span class="name">boolean_expression</span> [<span class="number">5</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">5</span><span class="punctuation">,</span> <span class="number">31</span>]</span><br><span class="line">            (<span class="name">identifier</span> [<span class="number">5</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">5</span><span class="punctuation">,</span> <span class="number">9</span>])</span><br><span class="line">            (<span class="name">ERROR</span> [<span class="number">5</span><span class="punctuation">,</span> <span class="number">12</span>] - [<span class="number">5</span><span class="punctuation">,</span> <span class="number">22</span>])</span><br><span class="line">            (<span class="name">number</span> [<span class="number">5</span><span class="punctuation">,</span> <span class="number">28</span>] - [<span class="number">5</span><span class="punctuation">,</span> <span class="number">31</span>]))</span><br><span class="line">          (<span class="name">identifier</span> [<span class="number">6</span><span class="punctuation">,</span> <span class="number">4</span>] - [<span class="number">6</span><span class="punctuation">,</span> <span class="number">6</span>]))</span><br><span class="line">        (<span class="name">ERROR</span> [<span class="number">6</span><span class="punctuation">,</span> <span class="number">12</span>] - [<span class="number">6</span><span class="punctuation">,</span> <span class="number">21</span>])</span><br><span class="line">        (<span class="name">number</span> [<span class="number">6</span><span class="punctuation">,</span> <span class="number">28</span>] - [<span class="number">6</span><span class="punctuation">,</span> <span class="number">31</span>])))))</span><br><span class="line">.<span class="character">\e</span>xamples<span class="character">\b</span>etween.sql  <span class="number">0</span> ms    (<span class="name">ERROR</span> [<span class="number">5</span><span class="punctuation">,</span> <span class="number">12</span>] - [<span class="number">5</span><span class="punctuation">,</span> <span class="number">22</span>])</span><br></pre></td></tr></table></figure><p>æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€WHEREå¥å†…ã®BETWEENè¿°èªã«ã¯å¯¾å¿œã—ã¦ã„ãªã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚<a href="https://github.com/m-novikov/tree-sitter-sql/blob/218b672499729ef71e4d66a949e4a1614488aeaa/grammar.js#L1071">grammar.jsã‚’è¦‹ã¦ã¿ã‚‹ã¨BETWEENã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯WINDOWé–¢æ•°ã®FRAMEå¥ã«ã—ã‹æƒ³å®šã—ã¦ã„ãªã„</a>ãŸã‚ã€BETWEENãŒERRORãƒãƒ¼ãƒ‰ã¨æ‰±ã‚ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚</p><h3 id="è¦å‰‡ã®è¿½åŠ "><a href="#è¦å‰‡ã®è¿½åŠ " class="headerlink" title="è¦å‰‡ã®è¿½åŠ "></a>è¦å‰‡ã®è¿½åŠ </h3><p>BETWEENè¿°èªã«å¯¾å¿œã™ã‚‹è¦å‰‡ãŒãã‚‚ãã‚‚å­˜åœ¨ã—ã¦ã„ãªã„ã“ã¨ãŒã‚ã‹ã£ãŸãŸã‚ã€æ–‡æ³•ã‚’æ‹¡å¼µã™ã‚‹ã“ã¨ã§å¯¾å¿œã—ã¦ã„ãã¾ã™ã€‚</p><p>BETWEENè¿°èªã¯æ¬¡ã®ã‚ˆã†ãªæ§‹æ–‡ã«ãªã£ã¦ã„ã¾ã™ã€‚<a href="https://www.postgresql.jp/document/14/html/functions-comparison.html">PostgreSQLã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã§ã¯æ§‹æ–‡ã«ã¤ã„ã¦è©³ã—ãæ›¸ã‹ã‚Œã¦ã„ãªã‹ã£ãŸã®ã§ã€<a href="https://docs.oracle.com/cd/E57425_01/121/SQLRF/conditions012.htm#sthref1111">Oracle SQLã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚</p><figure class="highlight sql"><figcaption><span>BETWEENè¿°èªã®æ§‹æ–‡</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(expression) (<span class="keyword">NOT</span>)? <span class="keyword">BETWEEN</span> (expression) <span class="keyword">AND</span> (expression)</span><br></pre></td></tr></table></figure><p>ãªãŠã€<code>(NOT)?</code> ã¯æ­£è¦è¡¨ç¾ã§ä½¿ã‚ã‚Œã‚‹ <code>?</code> ã¨åŒã˜æ„å‘³ã§ã€ <code>NOT</code> ãŒ0å›ã¾ãŸã¯1å›ç¾ã‚Œã‚‹ã“ã¨ã‚’è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚tree-sitterã®æ§‹æ–‡ã§ã¯ã€<code>optional</code>ã¨ã„ã†DSLã§è¡¨ç¾ã•ã‚Œã¾ã™ã€‚</p><p>ç‡ç›´ã«DSLã«ç›´ã™ã¨ã€æ¬¡ã®ã‚ˆã†ãªè¦å‰‡ãŒæ›¸ã‘ã¾ã™ã€‚</p><figure class="highlight js"><figcaption><span>ç‡ç›´ã«æ›¸ã„ãŸBETWEENã®è¦å‰‡</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">between_and_expression</span>: $ =&gt;</span><br><span class="line">  <span class="title function_">seq</span>($._expression, <span class="title function_">optional</span>(<span class="title function_">kw</span>(<span class="string">&quot;NOT&quot;</span>)), <span class="title function_">kw</span>(<span class="string">&quot;BETWEEN&quot;</span>),</span><br><span class="line">      $._expression, <span class="title function_">kw</span>(<span class="string">&quot;AND&quot;</span>), $._expression)</span><br></pre></td></tr></table></figure><p>ã“ã®è¦å‰‡ã‚’SQLã®å¼ã«å¯¾å¿œã™ã‚‹è¦å‰‡<code>_expression</code>ã«è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>_expressionã¸ã®è¿½åŠ </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    _expression: $ =&gt;</span><br><span class="line">      choice(</span><br><span class="line">        $.string,</span><br><span class="line">        $.TRUE,</span><br><span class="line">        $.FALSE,</span><br><span class="line">        // çœç•¥</span><br><span class="line"><span class="addition">+       $.between_and_expression,</span></span><br><span class="line">      ),</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§BETWEENè¿°èªã®è¦å‰‡ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚æ‹¡å¼µã—ãŸæ–‡æ³•ã‚’ã‚‚ã¨ã«ãƒ‘ãƒ¼ã‚µã‚’ç”Ÿæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ tree-sitter generate</span><br><span class="line">Unresolved conflict <span class="keyword">for</span> symbol sequence:</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;grant_statement_token4&#x27;</span>  _expression  <span class="string">&#x27;create_trigger_statement_token1&#x27;</span>  _expression  â€¢  <span class="string">&#x27;cte_token2&#x27;</span>  â€¦</span><br><span class="line"></span><br><span class="line">Possible interpretations:</span><br><span class="line"></span><br><span class="line">  1:  <span class="string">&#x27;grant_statement_token4&#x27;</span>  (boolean_expression  _expression  <span class="string">&#x27;create_trigger_statement_token1&#x27;</span>  _expression)  â€¢  <span class="string">&#x27;cte_token2&#x27;</span>  â€¦</span><br><span class="line">                                                            (precedence: 1, associativity: Left)</span><br><span class="line">  2:  <span class="string">&#x27;grant_statement_token4&#x27;</span>  _expression  <span class="string">&#x27;create_trigger_statement_token1&#x27;</span>  (between_and_expression  _expression  â€¢  <span class="string">&#x27;cte_token2&#x27;</span>  <span class="string">&#x27;frame_clause_token1&#x27;</span>  _expression  <span class="string">&#x27;frame_clause_token2&#x27;</span>  _expression)</span><br><span class="line">  3:  <span class="string">&#x27;grant_statement_token4&#x27;</span>  _expression  <span class="string">&#x27;create_trigger_statement_token1&#x27;</span>  (in_expression  _expression  â€¢  <span class="string">&#x27;cte_token2&#x27;</span>  <span class="string">&#x27;create_function_parameter_token1&#x27;</span>  tuple)                                        (precedence: 3, associativity: Left)</span><br><span class="line"></span><br><span class="line">Possible resolutions:</span><br><span class="line"></span><br><span class="line">  1:  Specify a higher precedence <span class="keyword">in</span> `in_expression` and `between_and_expression` than <span class="keyword">in</span> the other rules.</span><br><span class="line">  2:  Specify a higher precedence <span class="keyword">in</span> `boolean_expression` than <span class="keyword">in</span> the other rules.</span><br><span class="line">  3:  Add a conflict <span class="keyword">for</span> these rules: `in_expression`, `between_and_expression`, `boolean_expression`</span><br></pre></td></tr></table></figure><p>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã€ãƒ‘ãƒ¼ã‚µãŒç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã‚Œã¯ã€ä¸Šè¿°ã—ãŸè¦å‰‡ã§ã¯å„ªå…ˆåº¦ã‚’è¨˜è¿°ã—ã¦ã„ãªã„ãŸã‚ã€æ–‡æ³•ãŒæ›–æ˜§ã«ãªã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ã“ã¨ãŒåŸå› ã§ã™ã€‚ä¾‹ãˆã°ã€<code>X BETWEEN Y AND Z AND W</code>ã®<code>AND</code>ãŒBETWEENè¿°èªã®ã‚‚ã®ãªã®ã‹ã€è«–ç†å¼ã®ã‚‚ã®ãªã®ã‹ã‚’ãƒ‘ãƒ¼ã‚µãŒè‡ªå‹•ã§åˆ¤åˆ¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šã€<code>X BETWEEN (Y AND Z) AND W</code>ã‚„<code>(X BETWEEN Y AND Z) AND W</code>ãªã©ã€è¤‡æ•°ã®è§£é‡ˆãŒã§ãã¦ã—ã¾ã„ã¾ã™ã€‚</p><p>ãã“ã§ã€å„ªå…ˆåº¦ã¨çµåˆæ€§ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight javascript"><figcaption><span>å„ªå…ˆåº¦ã¨çµåˆæ€§ã‚’è¿½åŠ ã—ãŸBETWEENã®è¦å‰‡</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">between_and_expression</span>: $ =&gt;</span><br><span class="line">  prec.<span class="title function_">left</span>(</span><br><span class="line">    <span class="variable constant_">PREC</span>.<span class="property">comparative</span>,</span><br><span class="line">    <span class="title function_">seq</span>($._expression, <span class="title function_">optional</span>(<span class="title function_">kw</span>(<span class="string">&quot;NOT&quot;</span>)), <span class="title function_">kw</span>(<span class="string">&quot;BETWEEN&quot;</span>),</span><br><span class="line">        $._expression, <span class="title function_">kw</span>(<span class="string">&quot;AND&quot;</span>), $._expression)</span><br><span class="line">  ),</span><br></pre></td></tr></table></figure><p><code>prec.left</code>ã¯å·¦çµåˆã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã€<code>PREC.comparative</code>ã§æ¯”è¼ƒæ¼”ç®—å­ã¨åŒã˜å„ªå…ˆåº¦ã§ã‚ã‚‹ã“ã¨ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚æ¯”è¼ƒæ¼”ç®—å­ã¯<code>AND</code>ã‚ˆã‚Šã‚‚é«˜ã„å„ªå…ˆåº¦ã§ã‚ã‚‹ãŸã‚ã€<code>X BETWEEN Y AND Z AND W</code>ã¯<code>(X BETWEEN Y AND Z) AND W</code>ã¨è§£é‡ˆã•ã‚Œã¾ã™ã€‚</p><h3 id="å‹•ä½œç¢ºèª"><a href="#å‹•ä½œç¢ºèª" class="headerlink" title="å‹•ä½œç¢ºèª"></a>å‹•ä½œç¢ºèª</h3><p>æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><figure class="highlight sql"><figcaption><span>examples/between.sql</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    STUDENT</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    GRADE   <span class="keyword">BETWEEN</span> <span class="number">80</span>  <span class="keyword">AND</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">AND</span> ID      <span class="keyword">BETWEEN</span> <span class="number">0</span>   <span class="keyword">AND</span> <span class="number">100</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‘ãƒ¼ã‚µã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree-sitter generate</span></span><br></pre></td></tr></table></figure><p>å…ˆã»ã©ä½œæˆã—ãŸ <code>print-cst</code>ã‚’ç”¨ã„ã¦ã€ãƒ‘ãƒ¼ã‚¹çµæœã‚’å‡ºåŠ›ã—ã¾ã™ã€‚</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ cd [print-cstã®ãƒ‘ã‚¹]</span><br><span class="line">$ cargo run ./examples/between.sql</span><br><span class="line">source_file [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">6</span><span class="punctuation">,</span> <span class="number">31</span>)]</span><br><span class="line">  select_statement [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">    select_clause [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">0</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">      SELECT [(<span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">0</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">      select_clause_body [(<span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span>)-(<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">        identifier <span class="string">&quot;ID&quot;</span> [(<span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span>)-(<span class="number">1</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">    from_clause [(<span class="number">2</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">2</span><span class="punctuation">,</span> <span class="number">4</span>)]</span><br><span class="line">      FROM [(<span class="number">2</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">2</span><span class="punctuation">,</span> <span class="number">4</span>)]</span><br><span class="line">      identifier <span class="string">&quot;STUDENT&quot;</span> [(<span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span>)-(<span class="number">3</span><span class="punctuation">,</span> <span class="number">11</span>)]</span><br><span class="line">    where_clause [(<span class="number">4</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span>)]</span><br><span class="line">      WHERE [(<span class="number">4</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span>)]</span><br><span class="line">      boolean_expression [(<span class="number">5</span><span class="punctuation">,</span> <span class="number">4</span>)-(<span class="number">5</span><span class="punctuation">,</span> <span class="number">31</span>)]</span><br><span class="line">        between_and_expression [(<span class="number">5</span><span class="punctuation">,</span> <span class="number">4</span>)-(<span class="number">5</span><span class="punctuation">,</span> <span class="number">9</span>)]</span><br><span class="line">          identifier <span class="string">&quot;GRADE&quot;</span> [(<span class="number">5</span><span class="punctuation">,</span> <span class="number">4</span>)-(<span class="number">5</span><span class="punctuation">,</span> <span class="number">9</span>)]</span><br><span class="line">          BETWEEN [(<span class="number">5</span><span class="punctuation">,</span> <span class="number">12</span>)-(<span class="number">5</span><span class="punctuation">,</span> <span class="number">19</span>)]</span><br><span class="line">          number <span class="string">&quot;80&quot;</span> [(<span class="number">5</span><span class="punctuation">,</span> <span class="number">20</span>)-(<span class="number">5</span><span class="punctuation">,</span> <span class="number">22</span>)]</span><br><span class="line">          AND [(<span class="number">5</span><span class="punctuation">,</span> <span class="number">24</span>)-(<span class="number">5</span><span class="punctuation">,</span> <span class="number">27</span>)]</span><br><span class="line">          number <span class="string">&quot;100&quot;</span> [(<span class="number">5</span><span class="punctuation">,</span> <span class="number">28</span>)-(<span class="number">5</span><span class="punctuation">,</span> <span class="number">31</span>)]</span><br><span class="line">        AND [(<span class="number">6</span><span class="punctuation">,</span> <span class="number">0</span>)-(<span class="number">6</span><span class="punctuation">,</span> <span class="number">3</span>)]</span><br><span class="line">        between_and_expression [(<span class="number">6</span><span class="punctuation">,</span> <span class="number">4</span>)-(<span class="number">6</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">          identifier <span class="string">&quot;ID&quot;</span> [(<span class="number">6</span><span class="punctuation">,</span> <span class="number">4</span>)-(<span class="number">6</span><span class="punctuation">,</span> <span class="number">6</span>)]</span><br><span class="line">          BETWEEN [(<span class="number">6</span><span class="punctuation">,</span> <span class="number">12</span>)-(<span class="number">6</span><span class="punctuation">,</span> <span class="number">19</span>)]</span><br><span class="line">          number <span class="string">&quot;0&quot;</span> [(<span class="number">6</span><span class="punctuation">,</span> <span class="number">20</span>)-(<span class="number">6</span><span class="punctuation">,</span> <span class="number">21</span>)]</span><br><span class="line">          AND [(<span class="number">6</span><span class="punctuation">,</span> <span class="number">24</span>)-(<span class="number">6</span><span class="punctuation">,</span> <span class="number">27</span>)]</span><br><span class="line">          number <span class="string">&quot;100&quot;</span> [(<span class="number">6</span><span class="punctuation">,</span> <span class="number">28</span>)-(<span class="number">6</span><span class="punctuation">,</span> <span class="number">31</span>)]</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§<code>BETWEEN</code>ã‚’å«ã‚€SQLãŒãƒ‘ãƒ¼ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼</p><h3 id="ãƒ†ã‚¹ãƒˆã®è¿½åŠ "><a href="#ãƒ†ã‚¹ãƒˆã®è¿½åŠ " class="headerlink" title="ãƒ†ã‚¹ãƒˆã®è¿½åŠ "></a>ãƒ†ã‚¹ãƒˆã®è¿½åŠ </h3><p>æœ€å¾Œã«ã€ä»Šå›è¿½åŠ ã—ãŸBETWEENè¿°èªã®æ‹¡å¼µã‚’<code>tree-sitter test</code>(<a href="https://tree-sitter.github.io/tree-sitter/creating-parsers#command-test">Tree-sitterï½œCreating Parsers</a>)ã§ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚</p><p><code>test/corpus/between.txt</code>ã‚’ä½œæˆã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚</p><figure class="highlight sql"><figcaption><span>test/corpus/between.txt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="keyword">BETWEEN</span> predicates</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    STUDENT</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    GRADE   <span class="keyword">BETWEEN</span> <span class="number">80</span>  <span class="keyword">AND</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">AND</span> ID      <span class="keyword">BETWEEN</span> <span class="number">0</span>   <span class="keyword">AND</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---------------------------------------</span></span><br><span class="line"></span><br><span class="line">(source_file</span><br><span class="line">  (select_statement</span><br><span class="line">    (select_clause</span><br><span class="line">      (select_clause_body</span><br><span class="line">        (identifier)))</span><br><span class="line">    (from_clause</span><br><span class="line">      (identifier))</span><br><span class="line">    (where_clause</span><br><span class="line">      (boolean_expression</span><br><span class="line">        (between_and_expression</span><br><span class="line">          (identifier)</span><br><span class="line">          (number)</span><br><span class="line">          (number))</span><br><span class="line">        (between_and_expression</span><br><span class="line">          (identifier)</span><br><span class="line">          (number)</span><br><span class="line">          (number))))))</span><br></pre></td></tr></table></figure><ul><li><code>=</code>ã§å›²ã¾ã‚ŒãŸè¡Œã«ãƒ†ã‚¹ãƒˆåã‚’æ›¸ãã¾ã™</li><li>æ¬¡ã«ã€å…¥åŠ›ã¨ã—ã¦ä¸ãˆã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã€ä¸‹ã«<code>---</code>ã‚’è¨˜è¿°ã—ã¾ã™</li><li>æœ€å¾Œã«æœŸå¾…ã™ã‚‹çµæœã‚’Så¼ã§è¨˜è¿°ã—ã¾ã™</li></ul><p><code>tree-sitter test</code>ã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚<code>-f</code>ãƒ•ãƒ©ã‚°ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ tree-sitter <span class="built_in">test</span> -f <span class="string">&#x27;BETWEEN predicates&#x27;</span></span><br><span class="line">  between:</span><br><span class="line">    âœ“ BETWEEN predicates</span><br><span class="line">  create:</span><br><span class="line">  delete:</span><br><span class="line">  insert:</span><br><span class="line">  select:</span><br><span class="line">  statements:</span><br><span class="line">  update:</span><br><span class="line">syntax highlighting:</span><br><span class="line">  âœ“ builtin.sql (49 assertions)</span><br><span class="line">  âœ“ function.sql (16 assertions)</span><br><span class="line">  âœ“ insert.sql (6 assertions)</span><br><span class="line">  âœ“ keywords.sql (9 assertions)</span><br><span class="line">  âœ“ punctuation.sql (2 assertions)</span><br><span class="line">  âœ“ select.sql (43 assertions)</span><br><span class="line">  âœ“ statements.sql (25 assertions)</span><br><span class="line">  âœ“ table.sql (33 assertions)</span><br><span class="line">  âœ“ type.sql (5 assertions)</span><br><span class="line">  âœ“ update.sql (10 assertions)</span><br></pre></td></tr></table></figure><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>æœ¬è¨˜äº‹ã§ã¯ã€tree-sitter-sqlã§BETWEENè¿°èªã‚’æ‰±ãˆã‚‹ã‚ˆã†ã«æ§‹æ–‡æ‹¡å¼µã‚’è¡Œã„ã¾ã—ãŸã€‚tree-sitterç”¨ã®SQLæ§‹æ–‡ã¯ã¾ã ã¾ã æœªå®Œæˆãªã®ã§ã€çš†ã•ã‚“ã‚‚ä¸€ç·’ã«ã‚ˆã‚Šã‚ˆã„ãƒ‘ãƒ¼ã‚µã‚’ä½œã£ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221215a/tree-sitter-small.png&quot; alt=&quot;&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;

&lt;p&gt;ã“ã¡ã‚‰ã¯&lt;a</summary>
        
      
    
    
    
    <category term="Infrastructure" scheme="https://future-architect.github.io/categories/Infrastructure/"/>
    
    
    <category term="SQL" scheme="https://future-architect.github.io/tags/SQL/"/>
    
    <category term="ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼" scheme="https://future-architect.github.io/tags/%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%82%BF%E3%83%BC/"/>
    
    <category term="æ§‹æ–‡è§£æ" scheme="https://future-architect.github.io/tags/%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90/"/>
    
    <category term="tree-sitter" scheme="https://future-architect.github.io/tags/tree-sitter/"/>
    
  </entry>
  
  <entry>
    <title>Reactã§æ±ºã‚ã‚‰ã‚ŒãŸå€™è£œã‹ã‚‰é¸æŠã•ã›ã‚‹ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã¤ãï¼‰</title>
    <link href="https://future-architect.github.io/articles/20221213a/"/>
    <id>https://future-architect.github.io/articles/20221213a/</id>
    <published>2022-12-12T15:00:00.000Z</published>
    <updated>2022-12-13T02:51:57.294Z</updated>
    
    <content type="html"><![CDATA[<p>æŠ€è¡“ã‚³ãƒ³ã‚µãƒ«ã‚’è¡Œã£ã¦ã„ã‚‹ãŠå®¢æ§˜ã‹ã‚‰è³ªå•ãŒã‚ã£ãŸã®ã§ã™ãŒã€ãªã‹ãªã‹ãƒ‰ãƒ³ãƒ”ã‚·ãƒ£ãªæƒ…å ±ãŒãªãã€è©¦è¡ŒéŒ¯èª¤ã—ãŸã®ã§ãã®æ¤œè¨çµæœã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚</p><p>å®Ÿç¾ã—ãŸã„ã®ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã§ã™</p><ul><li>IDã®ãƒªã‚¹ãƒˆã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é¸æŠã•ã›ã‚‹</li><li>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§çµã‚Šè¾¼ã¿ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹</li><li>IDã®ãƒªã‚¹ãƒˆã¯å¤§é‡ã«ã‚ã‚Šã€å…¨ä»¶ã‚’ã‚ã‚‰ã‹ã˜ã‚ã‚µãƒ¼ãƒãƒ¼ã«å•ã„åˆã‚ã›ã¦å–å¾—ã™ã‚‹ã®ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè‰¯ããªã„</li></ul><p>ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã¨åŒç¾©èªçš„ã«ã‚‚ä½¿ã‚ã‚Œã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒœãƒƒã‚¯ã‚¹ã¨ã„ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã¡ã‚‰ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã®é¸æŠã®ã¿ã§ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®çµã‚Šè¾¼ã¿ãŒãªã„ã‚‚ã®ã§ã€ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã¯ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ãŒã‚ã‚‹ã€ã¨ã„ã†æƒ³å®šã§ã“ã“ã§è©±ã‚’ã™ã™ã‚ã¾ã™ã€‚</p><p>IDã®å€™è£œãŒæœ‰é™å€‹ã§ã‚ã‚Œã°ã€æ¨™æº–ã®HTMLã§ã‚‚ç°¡å˜ã«å®Ÿç¾ã§ãã¾ã™ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;ice-cream-choice&quot;</span>&gt;</span>Choose a flavor:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">list</span>=<span class="string">&quot;ice-cream-flavors&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ice-cream-choice&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ice-cream-choice&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">datalist</span> <span class="attr">id</span>=<span class="string">&quot;ice-cream-flavors&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Chocolate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Coconut&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Mint&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Strawberry&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Vanilla&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">datalist</span>&gt;</span></span><br></pre></td></tr></table></figure><img src="/images/20221213a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-12-02_17.01.46.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-12-02_17.01.46.png" width="571" height="461" loading="lazy"><p>ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã‚’å®Ÿç¾ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé›†ã‚‚ã‚ã‚Šã¾ã™ãŒã€å‹•çš„ã«ã‚µãƒ¼ãƒãƒ¼ã«å€™è£œã‚’å•ã„åˆã‚ã›ã‚‹ã®ã‚’ã‚„ã‚Šã‚„ã™ãã—ã¦ãã‚Œã‚‹æ©Ÿèƒ½ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„ã‚‚ã®ã‚‚å¤šã„ã§ã™ã€‚ä¸€éƒ¨ã€<a href="https://mui.com/material-ui/react-autocomplete/#asynchronous-requests">MaterialUI</a>ã§ã¯Autocompleteã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã£ã¦å®Ÿç¾ã¯ã§ããã†ã§ã™ã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¶Šã—ã«éåŒæœŸã«å€™è£œã‚’çµã‚‹ã®ã‚‚å¯¾å¿œã—ã¦ãã†ã§ã™ãŒã€ã“ã®1æ©Ÿèƒ½ã®ãŸã‚ã«UIéƒ¨å“ã‚’ä¹—ã‚Šæ›ãˆã‚‹ã‚ã‘ã«ã‚‚ã„ã‹ãªã„ã®ã§ã€ç´ ã®Reactã§å®Ÿç¾ã—ã¦ã¿ã¾ã™ã€‚</p><h1 id="å…¥åŠ›ã®çŠ¶æ…‹ã‚’æ¤œè¨ã™ã‚‹"><a href="#å…¥åŠ›ã®çŠ¶æ…‹ã‚’æ¤œè¨ã™ã‚‹" class="headerlink" title="å…¥åŠ›ã®çŠ¶æ…‹ã‚’æ¤œè¨ã™ã‚‹"></a>å…¥åŠ›ã®çŠ¶æ…‹ã‚’æ¤œè¨ã™ã‚‹</h1><p>Reactã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹å ´åˆã¯ã€ã©ã®ã‚ˆã†ãªçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‹ã€èª°ãŒãã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã‹ã‚’æ¤œè¨ã—ã¾ã™ã€‚æ¬¡ã®ã‚ˆã†ãªæ“ä½œãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚</p><ul><li>ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã—ãŸå€¤ãŒã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã«è¡¨ç¤ºã•ã‚Œã‚‹</li><li>ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã§çµã‚Šè¾¼ã¿ã‚’è¡Œã„ã€é¸æŠå€™è£œã‚’ãƒªã‚¹ãƒˆã«å‡ºã™</li><li>ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã§å€™è£œã¨æ­£ç¢ºã«ä¸€è‡´ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒå…¥åŠ›ã•ã‚ŒãŸã®ã§é¸æŠã™ã‚‹</li><li>ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã§å€™è£œãŒ1ã¤ã«ãªã‚‹ã¾ã§çµã‚Šè¾¼ã¿ã‚’è¡Œã£ãŸã®ã§ãã‚Œã‚’é¸æŠã™ã‚‹</li><li>çµã‚Šè¾¼ã¾ã‚ŒãŸå€™è£œã‹ã‚‰ãƒã‚¦ã‚¹ã§é¸æŠã™ã‚‹</li><li>å†é¸æŠã™ã‚‹ãŸã‚ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šé™¤ã—ã€å†åº¦çµã‚Šè¾¼ã¿ã‚’è¡Œã†</li></ul><p>ã„ã‚ã„ã‚è©¦è¡ŒéŒ¯èª¤ã—ãŸçµæœã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p><img src="/images/20221213a/combobox.png" alt="combobox.png" width="971" height="593" loading="lazy"><ul><li>ä»Šå›ã¯ã€validãªè¦ç´ ä»¥å¤–ã‚’é¸æŠè¦ç´ ã¨ã—ãªã„ãŸã‚ã€æœ€çµ‚çš„ãªé¸æŠå€¤ã‚’1ã¤çŠ¶æ…‹ã¨ã—ã¦æŒã¡ã¾ã™ã€‚ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã¯<code>useState()</code>ã§ä½œã£ã¦ã„ã¾ã™ãŒã€React Hook Formã¨ã‹ã§ã‚‚è‰¯ã„ã§ã™ã€‚</li><li>æœ€çµ‚çš„ãªå€¤ã ã‘ã®å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçµã‚Šè¾¼ã¿ã‚’è¡Œã†ãŸã‚ã®ä¸­é–“çŠ¶æ…‹ãŒè¡¨ç¾ã§ãã¾ã›ã‚“ã€‚uncontrolled formãªã‚‰ã°ä¸è¦ã§ã™ãŒã€UIéƒ¨å“ã«ã‚ˆã£ã¦ã¯é¸æŠå€™è£œãŒæ›´æ–°ã•ã‚Œã‚‹ã¨ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¦ã—ã¾ã£ã¦éƒ½åˆãŒè‰¯ããªã„ã“ã¨ãŒè€ƒãˆã‚‰ã‚Œã‚‹ãŸã‚ã€è¡¨ç¤ºç”¨ã®å€¤ã‚‚çŠ¶æ…‹ã¨ã—ã¦æŒã¡ã¾ã™</li><li>è¡¨ç¤ºç”¨ã®å…¥åŠ›å€¤ã‚’ãã®ã¾ã¾<code>useSWR()</code>ã®ã‚µãƒ¼ãƒãƒ¼å‘¼ã³å‡ºã—ã®æ›´æ–°ã‚­ãƒ¼ã¨ã—ã¦ä½¿ã£ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€ãƒã‚¦ã‚¹ã§å€™è£œã‹ã‚‰é¸æŠã—ãŸå ´åˆãªã©ã€ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã—ãªãã¦ã‚‚ã„ã„å ´åˆã«ã‚‚ã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒèµ°ã£ã¦ã—ã¾ã†ã¨å›°ã‚‹ã®ã§ã€ã‚µãƒ¼ãƒãƒ¼æ¤œç´¢ã‚’è¡Œã†ã‚­ãƒ¼ã‚’åˆ¥é€”ä¿æŒã—ã¾ã™ã€‚</li><li>æ¤œç´¢å€™è£œãŒ1ã¤ã«çµã‚ŒãŸã‚‰ã€ãã“ã§é¸æŠçµ‚äº†ã¨ã—ãŸã„ã®ã§ã™ãŒã€ãã†ã—ãŸå ´åˆã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®backspaceã§æœ€å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¶ˆã—ã¦å†çµã‚Šè¾¼ã¿ã—ã‚ˆã†ã¨ã—ã¦ã‚‚å†ã³å€™è£œãŒ1ã¤ã§å¼·åˆ¶çš„ã«é¸æŠã•ã‚Œã¦æœ«å°¾ã®ãƒ†ã‚­ã‚¹ãƒˆãŒæ¶ˆã›ãªã„ã€ã¨ã„ã†ã“ã¨ãŒã‚ã£ãŸã®ã§ã€é¸æŠçµ‚äº†æ¡ä»¶ã«ã€æœ€å¾Œã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ãŒbackspaceç­‰ã®ãƒ†ã‚­ã‚¹ãƒˆæ¶ˆå»ã§ã¯ãªã„ã€ã¨ã„ã†æ¡ä»¶ãŒå¿…è¦ã§ã—ãŸã€‚ãã®ãŸã‚ã€1ã¤å‰ã®è¡¨ç¤ºå€¤ã‚‚å–ã£ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ãŸã‚ã€<code>useRef</code>ã§ä¿æŒã—ã¾ã™ã€‚</li></ul><p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œã‚ã‚Œï¼Ÿã€ã¨æ€ã‚ã›ãªã„ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã‚’ä½œã‚‹ã«ã¯ã“ã‚Œã ã‘ã®çŠ¶æ…‹ãŒå¿…è¦ã‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒã‚¦ã‚¹ã¨ä¸¡æ–¹æ‰±ã†å¿…è¦ãŒã‚ã‚‹ã®ã§é¢å€’ã§ã™ãŒä»•æ–¹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p><h1 id="å®Ÿè£…ã—ã¦ã¿ã‚‹"><a href="#å®Ÿè£…ã—ã¦ã¿ã‚‹" class="headerlink" title="å®Ÿè£…ã—ã¦ã¿ã‚‹"></a>å®Ÿè£…ã—ã¦ã¿ã‚‹</h1><p>1000ä»¥ä¸‹ã®ç´ æ•°ã§å¥½ããªå€¤ã‚’é¸æŠã™ã‚‹ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚Vite.jsã§ä½œã£ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ã€‚</p><p>ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å€¤ã‚’å–ã£ã¦ãã¦å€™è£œã‚’å‡ºã—ã¾ã™ãŒã€ã“ã®ãŸã‚ã ã‘ã«ã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ã®ã¯é¢å€’ãªã®ã§<a href="https://mswjs.io/">Mock Service Worker</a>ã§APIã‚µãƒ¼ãƒãƒ¼ã®ä»£æ›¿ã‚’ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>mock.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; setupWorker, rest &#125; <span class="keyword">from</span> <span class="string">&#x27;msw&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getPrimes <span class="keyword">from</span> <span class="string">&#x27;get-primes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">msec: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="title function_">resolve</span>(<span class="number">0</span>); &#125;, msec);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> worker = <span class="title function_">setupWorker</span>(</span><br><span class="line">  rest.<span class="title function_">get</span>(<span class="string">&#x27;/primes&#x27;</span>, <span class="keyword">async</span> (req, res, ctx) =&gt; &#123;</span><br><span class="line">    <span class="comment">// prefix=ã§æ¸¡ã•ã‚ŒãŸæ–‡å­—ã§å§‹ã¾ã‚‹ç´ æ•°ã‚’ãƒªã‚¹ãƒˆã§è¿”ã™</span></span><br><span class="line">    <span class="keyword">const</span> prefix = req.<span class="property">url</span>.<span class="property">searchParams</span>.<span class="title function_">get</span>(<span class="string">&#x27;prefix&#x27;</span>) || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1000</span>); <span class="comment">// ã‚µãƒ¼ãƒãƒ¼ã®é…ã•ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ã‚¦ã‚§ã‚¤ãƒˆ</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">result</span>: <span class="built_in">number</span>[] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> v <span class="keyword">of</span> <span class="title function_">getPrimes</span>(<span class="number">1000</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">String</span>(v).<span class="title function_">startsWith</span>(prefix)) &#123;</span><br><span class="line">            result.<span class="title function_">push</span>(v);</span><br><span class="line">            <span class="keyword">if</span> (result.<span class="property">length</span> === <span class="number">10</span>) &#123; <span class="comment">// æœ€å¤§10å€™è£œã ã‘è¿”ã™</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">res</span>(ctx.<span class="title function_">json</span>(&#123;result&#125;)</span><br><span class="line">  &#125;),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã‚‹hookã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>use-completionlist.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSWR <span class="keyword">from</span> <span class="string">&#x27;swr&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetcher</span>(<span class="params">url: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">  <span class="keyword">const</span> &#123; result &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>() <span class="keyword">as</span> &#123;<span class="attr">result</span>: <span class="built_in">number</span>[]&#125;;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useCompletionList</span>(<span class="params">prefix: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, error &#125; = <span class="title function_">useSWR</span>(</span><br><span class="line">    <span class="string">`/primes?prefix=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(prefix)&#125;</span>`</span>,</span><br><span class="line">    fetcher</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">data</span>: data ? data : [], error, <span class="attr">loading</span>: !data &amp;&amp; !error &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å¾Œã«ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã¨å¿…è¦ãªstateç¾¤ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p><figure class="highlight tsx"><figcaption><span>App.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useCallback, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useCompletionList &#125; <span class="keyword">from</span> <span class="string">&#x27;use-completionlist&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [ userInput, setUserInput ] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);              <span class="comment">// è¡¨ç¤ºç”¨ã®å€¤</span></span><br><span class="line">  <span class="keyword">const</span> lastUserInput = <span class="title function_">useRef</span>(<span class="string">&#x27;&#x27;</span>);                              <span class="comment">// 1ã¤å‰ã®è¡¨ç¤ºç”¨ã®å€¤</span></span><br><span class="line">  <span class="keyword">const</span> [ searchKey, setSearchKey ] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);              <span class="comment">// æ¤œç´¢ã‚­ãƒ¼</span></span><br><span class="line">  <span class="keyword">const</span> [ confirmedValue, setConfirmedValue ] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);    <span class="comment">// é¸æŠã•ã‚ŒãŸå€¤</span></span><br><span class="line">  <span class="keyword">const</span> &#123; data, error, loading &#125; = <span class="title function_">useCompletionList</span>(searchKey); <span class="comment">// å€™è£œãƒªã‚¹ãƒˆ</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">length</span> === <span class="number">1</span> &amp;&amp; userInput.<span class="property">length</span> &gt; lastUserInput.<span class="property">current</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="comment">// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰é¸æŠç”¨: ã‚‚ã—ã€æ¤œç´¢å€™è£œãŒ1ä»¶ã—ã‹ãªã„å ´åˆã¯å…ˆé ­ä¸€è‡´ã§ãã®è¦ç´ ãŒé¸æŠã•ã‚ŒãŸã‚‚ã®ã¨ã™ã‚‹ã€‚è¡¨ç¤ºã‚‚æ›´æ–°ã™ã‚‹ã€‚</span></span><br><span class="line">      <span class="title function_">setUserInput</span>(<span class="title class_">String</span>(data[<span class="number">0</span>]));</span><br><span class="line">      lastUserInput.<span class="property">current</span> = <span class="title class_">String</span>(data[<span class="number">0</span>]);</span><br><span class="line">      <span class="title function_">setConfirmedValue</span>(<span class="title class_">String</span>(data[<span class="number">0</span>]));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰é¸æŠç”¨: æ­£ç¢ºã«ä¸€è‡´ã™ã‚‹ã‚‚ã®ãŒå€™è£œã«ã‚ã‚Œã°ãã®è¦ç´ ãŒé¸æŠã•ã‚ŒãŸã‚‚ã®ã¨ã™ã‚‹</span></span><br><span class="line">      <span class="keyword">const</span> found = data.<span class="title function_">find</span>(<span class="function"><span class="params">v</span> =&gt;</span> <span class="title class_">String</span>(v) === userInput);</span><br><span class="line">      <span class="keyword">if</span> (found !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">setConfirmedValue</span>(<span class="title class_">String</span>(found));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [userInput, data])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="title function_">useCallback</span>(<span class="keyword">function</span> <span class="title function_">onChange</span>(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) &#123;</span><br><span class="line">    lastUserInput.<span class="property">current</span> = userInput; <span class="comment">// æœ€å¾Œã®å…¥åŠ›ã‚’ã¨ã£ã¦ãŠã</span></span><br><span class="line">    <span class="title function_">setUserInput</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">    <span class="keyword">if</span> (data.<span class="title function_">some</span>(<span class="function"><span class="params">v</span> =&gt;</span> <span class="title class_">String</span>(v) === e.<span class="property">target</span>.<span class="property">value</span>)) &#123;</span><br><span class="line">      <span class="comment">// ãƒã‚¦ã‚¹é¸æŠç”¨: å€™è£œã®ãƒªã‚¹ãƒˆã‚’æ¤œç´¢ã—ã¦æ­£ç¢ºã«ãƒãƒƒãƒã™ã‚‹ã‚‚ã®ãŒã‚ã£ãŸã‚‰ç¢ºå®š(æ¤œç´¢ã¯ã—ãªã„)</span></span><br><span class="line">      <span class="title function_">setConfirmedValue</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰é¸æŠç”¨: æ­£ç¢ºã«ãƒãƒƒãƒã™ã‚‹ã‚‚ã®ãŒãªã‘ã‚Œã°ã‚µãƒ¼ãƒãƒ¼ã«å•ã„åˆã‚ã›ã¦å€™è£œãƒªã‚¹ãƒˆã‚’æœ€æ–°åŒ–</span></span><br><span class="line">      <span class="title function_">setSearchKey</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [data]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123; error ? <span class="tag">&lt;<span class="name">div</span>&gt;</span>ã‚¨ãƒ©ãƒ¼: &#123;String(error)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span> : undefined &#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>é¸æŠã•ã‚ŒãŸç´ æ•°: &#123;confirmedValue&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>ç´ æ•°é¸æŠ: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;example&quot;</span> <span class="attr">list</span>=<span class="string">&quot;exampleList&quot;</span> <span class="attr">value</span>=<span class="string">&#123;userInput&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;/</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123; loading ? &quot;ğŸŒ€&quot; : (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">datalist</span> <span class="attr">id</span>=<span class="string">&quot;exampleList&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123; data.map(value =&gt; (<span class="tag">&lt;<span class="name">option</span> <span class="attr">key</span>=<span class="string">&#123;value&#125;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> /&gt;</span>))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">datalist</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p>ã†ã¾ãå®Ÿè£…ã§ãã¾ã—ãŸã€‚</p><img src="/images/20221213a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-12-02_17.56.53.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-12-02_17.56.53.png" width="850" height="428" loading="lazy"><p>ä¸€ç®‡æ‰€ã«ã¾ã¨ã‚ã¦å®Ÿè£…ã—ã¾ã—ãŸãŒã€data, loading, onChange, confirmedValue, userInput, setUserInputã‚’è¿”ã™ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½œã£ã¦ãŠãã¨å†åˆ©ç”¨ãŒåŠ¹ããã†ã§ã™ã€‚</p><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>ã„ã‚ã‚“ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã®çµ„ã¿åˆã‚ã›ã‚’è€ƒãˆã‚‹ã¨ã€çŠ¶æ…‹ã®å¤‰æ›´ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’ãã¡ã‚“ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚ãã®ãŸã‚ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®çµã‚Šè¾¼ã¿æ©Ÿèƒ½ã¤ãã®ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã‚’æ‰‹ä½œã‚Šã—ã¦ã¿ã¾ã—ãŸã€‚Reactã§ã‚‚ãªã‚“ã§ã‚‚ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å«ã‚ã¦ã€çŠ¶æ…‹ç®¡ç†ãŒè¤‡é›‘ã«ãªã£ã¦ãã‚‹ã¨çµæ§‹ã‚„ã‚„ã“ã—ããªã£ã¦ã€ãƒã‚°ã£ã½ã„å‹•ãã«ãªã£ãŸã‚Šã—ãŒã¡ã§ã™ã€‚</p><p>ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¨ã—ã¦ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã‚’<a href="https://usehooks.com/useDebounce/">useDebounce</a>ã‚’ä½¿ã£ã¦çµã‚‹ã¨ã„ã†ã®ã¯ã‚„ã£ã¦ã‚‚ã„ã„ã‹ã¨æ€ã„ã¾ã™ã€‚ã‚ã¨ã¯å€™è£œãŒé¸æŠã•ã‚ŒãŸã¨ãã«å€™è£œæ¬„ã‚’éè¡¨ç¤ºã«ã™ã‚‹ã¨ã‹ã§ã™ã‹ã­ã€‚ç¢ºå®šã—ãŸå€¤ã¨è¡¨ç¤ºãŒä¸€è‡´ã—ã¦ã„ãŸã‚‰datalistã”ã¨å‰Šé™¤ã¨ã‹ã§ã„ã‘ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;æŠ€è¡“ã‚³ãƒ³ã‚µãƒ«ã‚’è¡Œã£ã¦ã„ã‚‹ãŠå®¢æ§˜ã‹ã‚‰è³ªå•ãŒã‚ã£ãŸã®ã§ã™ãŒã€ãªã‹ãªã‹ãƒ‰ãƒ³ãƒ”ã‚·ãƒ£ãªæƒ…å ±ãŒãªãã€è©¦è¡ŒéŒ¯èª¤ã—ãŸã®ã§ãã®æ¤œè¨çµæœã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚&lt;/p&gt;
&lt;p&gt;å®Ÿç¾ã—ãŸã„ã®ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã§ã™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IDã®ãƒªã‚¹ãƒˆã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é¸æŠã•ã›ã‚‹&lt;/li&gt;
&lt;l</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰" scheme="https://future-architect.github.io/tags/%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89/"/>
    
    <category term="React" scheme="https://future-architect.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>OpenAPI Generatorã§Python Web APIæ§‹ç¯‰</title>
    <link href="https://future-architect.github.io/articles/20221203a/"/>
    <id>https://future-architect.github.io/articles/20221203a/</id>
    <published>2022-12-02T15:00:00.000Z</published>
    <updated>2023-01-19T02:59:42.307Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221203a/top.png" alt="" width="941" height="481"><p>ã“ã®è¨˜äº‹ã¯<a href="https://qiita.com/advent-calendar/2022/python">Python Advent Calendar 2022</a> ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼2ã®3æ—¥ç›®ã§ã™ã€‚æ˜¨æ—¥ã¯tttakehã•ã‚“ã®<a href="https://zenn.dev/takeguchi/articles/672ff3b34753a7">ã˜ã‚ƒã‚“ã‘ã‚“ç”»åƒã‚’åˆ†é¡ã—ã¦ã¿ãŸ</a>ã§ã—ãŸã€‚</p><h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ã€‚TIG DXãƒ¦ãƒ‹ãƒƒãƒˆã®æ‘ä¸Šã§ã™ï¼</p><p>ã•ã¦ã€ç§ã®æ‰€å±ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã«ä¸»ã«Goè¨€èªã‚’ç”¨ã„ã¦ãŠã‚Šã€Goè¨€èªã«ã‚ˆã‚‹WebAPIã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚</p><p>ä¾‹ãˆã°<a href="/articles/20200927/">Lambdaã¨Goã‚’ä½¿ã£ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹WebAPIé–‹ç™ºå®Ÿè·µå…¥é–€</a>ãªã©ã€Future Tech Blogã«ã¯å¤šãã®ãƒã‚¦ãƒã‚¦ãŒæŠ•ç¨¿ã•ã‚Œã¦ã„ã¾ã™ã®ã§æ˜¯éã”è¦§ã«ãªã£ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚</p><p>ä»Šå›ã¯Goè¨€èªã§ã¯ãªãPythonã§WebAPIã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚ãã®éš›ã«OpenAPI GeneratorãŒä¾¿åˆ©ã ã£ãŸã®ã§ã”å…±æœ‰ã—ã¾ã™ã€‚</p><h1 id="OpenAPI-Generator"><a href="#OpenAPI-Generator" class="headerlink" title="OpenAPI Generator"></a>OpenAPI Generator</h1><p><a href="https://github.com/OpenAPITools/openapi-generator">OpenAPI Generator</a>ã¯APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å†…å®¹ã‚’å®šç¾©ã—ã€ãã‚Œã‚’å…ƒã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p><p>APIå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ã®ä¾‹ã¨ã€ãã“ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚</p><h2 id="APIå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«"><a href="#APIå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«" class="headerlink" title="APIå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«"></a>APIå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«</h2><p>ä»Šå›ã®ãƒ•ã‚¡ã‚¤ãƒ«åã¯<code>openapi.yaml</code>ã¨ã—ã¾ã™ã€‚<br>ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">openapi:</span> <span class="string">&quot;3.0.0&quot;</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Stock</span> <span class="string">API</span></span><br><span class="line"><span class="attr">servers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">http://localhost:3003</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">stockPrice</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">æ ªä¾¡å–å¾—</span></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/v1/sc/&#123;security_cd&#125;/stockPrice:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">æ ªä¾¡å–å¾—</span></span><br><span class="line">      <span class="attr">operationId:</span> <span class="string">stockPrice</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">ç¾åœ¨ã®æ ªä¾¡ã‚’å–å¾—ã™ã‚‹</span></span><br><span class="line">      <span class="attr">tags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">stockPrice</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">security_cd</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">è¨¼åˆ¸ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã™ã‚‹</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">example:</span> <span class="string">&quot;4722&quot;</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">&quot;200&quot;:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">success</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&quot;#/components/schemas/StockPrice&quot;</span></span><br><span class="line">        <span class="attr">&quot;400&quot;:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Bad</span> <span class="string">Request</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&quot;#/components/schemas/Error&quot;</span></span><br><span class="line">        <span class="attr">&quot;404&quot;:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Not</span> <span class="string">Found</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&quot;#/components/schemas/Error&quot;</span></span><br><span class="line">        <span class="attr">&quot;500&quot;:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Internal</span> <span class="string">Server</span> <span class="string">Error</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&quot;#/components/schemas/Error&quot;</span></span><br><span class="line">        <span class="attr">default:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">&quot;ãã®ä»–äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼&quot;</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&quot;#/components/schemas/Error&quot;</span></span><br><span class="line"><span class="attr">components:</span></span><br><span class="line">  <span class="attr">schemas:</span></span><br><span class="line">    <span class="attr">StockPrice:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">price:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">double</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">ç¾åœ¨ã®æ ªä¾¡</span></span><br><span class="line">          <span class="attr">example:</span> <span class="number">1741</span></span><br><span class="line">        <span class="attr">open:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">double</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">å§‹å€¤</span></span><br><span class="line">          <span class="attr">example:</span> <span class="number">1715</span></span><br><span class="line">        <span class="attr">high:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">é«˜å€¤</span></span><br><span class="line">          <span class="attr">example:</span> <span class="number">1762</span></span><br><span class="line">        <span class="attr">low:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">å®‰å€¤</span></span><br><span class="line">          <span class="attr">example:</span> <span class="number">1704</span></span><br><span class="line">        <span class="attr">volume:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">å‡ºæ¥é«˜</span></span><br><span class="line">          <span class="attr">example:</span> <span class="number">221400</span></span><br><span class="line">    <span class="attr">Error:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">message:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span></span><br><span class="line">        <span class="attr">field:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥</span></span><br><span class="line">    <span class="attr">OK:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">message:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure><p><code>operationId</code>ã§æŒ‡å®šã—ãŸéƒ¨åˆ†ãŒè‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã«é–¢æ•°åã¨ã—ã¦åæ˜ ã•ã‚Œã¾ã™ã€‚</p><h2 id="ã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆ"><a href="#ã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆ" class="headerlink" title="ã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆ"></a>ã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆ</h2><p>ç”Ÿæˆæ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯dockerã‚’ä½¿ã£ã¦è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚<br>ã‚µãƒ¼ãƒå´ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã©ã¡ã‚‰ã‚’ç”Ÿæˆã™ã‚‹ã‹ã¯generatorã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã«ã‚ˆã£ã¦æ±ºã¾ã‚Šã¾ã™ã€‚<br>ä¾‹ãˆã°ã‚µãƒ¼ãƒå´ã‚’Pythonã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚’Golangã§ç”Ÿæˆã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ã‚µãƒ¼ãƒå´</span><br><span class="line">$ docker run --<span class="built_in">rm</span> -v <span class="variable">$&#123;PWD&#125;</span>:/local openapitools/openapi-generator-cli generate -i /local/openapi.yaml -g python-flask -o /local</span><br><span class="line"></span><br><span class="line">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´</span><br><span class="line">$ docker run --<span class="built_in">rm</span> -v <span class="variable">$&#123;PWD&#125;</span>:/local openapitools/openapi-generator-cli generate -i /local/openapi.yaml -g go -o /local</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®<code>-g</code>ãŒgeneratorã®æŒ‡å®šã«ãªã‚Šã¾ã™ã€‚<br>generatorã«æŒ‡å®šã§ãã‚‹å¼•æ•°ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --<span class="built_in">rm</span> openapitools/openapi-generator-cli list</span><br></pre></td></tr></table></figure><p>ã¾ãŸã€ç”Ÿæˆã•ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§<code>openapi_server</code>ã¨ãªã‚Šã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --<span class="built_in">rm</span> -v <span class="variable">$&#123;PWD&#125;</span>:/local openapitools/openapi-generator-cli generate -i /local/openapi.yaml -g python-flask -o /local --package-name test_package</span><br></pre></td></tr></table></figure><p>pythonã®importãƒ‘ã‚¹ã«ã‚‚é–¢ã‚ã£ã¦ãã‚‹ãŸã‚ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æ²¿ã£ãŸåå‰ã«ã™ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚</p><h2 id="è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«"><a href="#è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«" class="headerlink" title="è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«"></a>è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«</h2><p>è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚µãƒ¼ãƒå´ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåŠã³ãã®å†…éƒ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚<br>ä¸Šè¨˜ã®<code>openapi.yaml</code>ã‹ã‚‰ã¯ä»¥ä¸‹ã®å†…å®¹ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ git_push.sh</span><br><span class="line">â”œâ”€â”€ openapi_server</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __main__.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ controllers</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ security_controller_.py</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ stock_price_controller.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ encoder.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ models</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ base_model_.py</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ error.py</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ok.py</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ stock_price.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ openapi</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ openapi.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ <span class="built_in">test</span></span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ test_stock_price_controller.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ typing_utils.py</span><br><span class="line">â”‚Â Â  â””â”€â”€ util.py</span><br><span class="line">â”œâ”€â”€ requirements.txt</span><br><span class="line">â”œâ”€â”€ setup.py</span><br><span class="line">â”œâ”€â”€ test-requirements.txt</span><br><span class="line">â””â”€â”€ tox.ini</span><br></pre></td></tr></table></figure><p>ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¾ã§è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã¾ã™ã€‚<br>ãã®ã¾ã¾ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã§ã™ã€‚</p><h3 id="openapi-server"><a href="#openapi-server" class="headerlink" title="openapi_server"></a>openapi_server</h3><p>APIã®æœ¬ä½“ã¯<code>openapi_server</code>ã«ãªã‚Šã¾ã™ã€‚ã“ã®ä¸­ã®<code>controllers</code>ã«APIã®ä¸­èº«ã‚’å®Ÿè£…ã—ã¦ã„ãã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p><p>å€‹äººçš„ã«ã¯controllersã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã‚¨ãƒ©ãƒ¼ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã‚„DBæ¥ç¶šãªã©ã®å‰å‡¦ç†ã ã‘ã‚’æ›¸ãã€å…·ä½“çš„ãªãƒ­ã‚¸ãƒƒã‚¯ã¯åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å®Ÿè£…ã™ã‚‹ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦APIãŒå¢—ãˆãŸæ™‚ã«controllersã®ä¸­èº«ãŒè¤‡é›‘ã«ãªã‚‹ã®ã‚’é¿ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«<code>core</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ã•ã‚‰ã«ãã®ä¸­ã«APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã”ã¨ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„ã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ controllers</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ security_controller_.py</span><br><span class="line">â”‚Â Â  â””â”€â”€ stock_price_controller.py</span><br><span class="line">â”œâ”€â”€ core</span><br><span class="line">â”‚Â Â  â””â”€â”€ stock_price</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ db.py</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ handler.py</span><br><span class="line">â”‚Â Â      â””â”€â”€ model.py</span><br></pre></td></tr></table></figure><p><code>handler.py</code>ã‚„<code>model.py</code>ã«å…·ä½“çš„ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã€<code>stock_price_controller.py</code>ã‹ã‚‰ãã‚Œã‚’å‚ç…§ã—ã¾ã™ã€‚</p><p><code>openapi</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯<code>openapi.yaml</code>ã¨ã„ã†ç”Ÿæˆå…ƒãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ä¸­èº«ã‚‚ä¸€è¦‹ã™ã‚‹ã¨ç”Ÿæˆå…ƒã¨å…¨ãåŒã˜ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€ã‚ˆãè¦‹ã‚‹ã¨<code>x-openapi-router-controller</code>ã¨ã„ã†é …ç›®ãŒå¢—ãˆã¦ã„ã¾ã™ã€‚</p><p>ã“ã‚Œã¯APIã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã§ã€ãã®APIãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸéš›ã«ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/v1/sc/&#123;security_cd&#125;/stockPrice:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">ç¾åœ¨ã®æ ªä¾¡ã‚’å–å¾—ã™ã‚‹</span></span><br><span class="line">      <span class="attr">operationId:</span> <span class="string">stock_price</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">description:</span> <span class="string">è¨¼åˆ¸ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã™ã‚‹</span></span><br><span class="line">        <span class="attr">example:</span> <span class="string">&quot;4722&quot;</span></span><br><span class="line">        <span class="attr">explode:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">security_cd</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">schema:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">style:</span> <span class="string">simple</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">&quot;200&quot;:</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/StockPrice&#x27;</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">success</span></span><br><span class="line">        <span class="attr">&quot;400&quot;:</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Error&#x27;</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Bad</span> <span class="string">Request</span></span><br><span class="line">        <span class="attr">&quot;404&quot;:</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Error&#x27;</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Not</span> <span class="string">Found</span></span><br><span class="line">        <span class="attr">&quot;500&quot;:</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Error&#x27;</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Internal</span> <span class="string">Server</span> <span class="string">Error</span></span><br><span class="line">        <span class="attr">default:</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Error&#x27;</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">ãã®ä»–äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">æ ªä¾¡å–å¾—</span></span><br><span class="line">      <span class="attr">tags:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">stockPrice</span></span><br><span class="line">      <span class="attr">x-openapi-router-controller:</span> <span class="string">openapi_server.controllers.stock_price_controller</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã®å ´åˆã€<code>/v1/sc/&#123;security_cd&#125;/stockPrice</code>ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸæ™‚ã€<code>openapi_server/controllers/stock_price_controller.py</code>ã®<code>stock_priceé–¢æ•°</code>ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p><h3 id="openapi-generator-ignore"><a href="#openapi-generator-ignore" class="headerlink" title=".openapi-generator-ignore"></a>.openapi-generator-ignore</h3><p>ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯è‡ªå‹•ç”Ÿæˆæ™‚ã«ä¸Šæ›¸ãã‚’ç¦æ­¢ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚</p><p>ä¾‹ãˆã°<code>controllers</code>ã‚„<code>test</code>ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯è‡ªå‹•ç”Ÿæˆã‚’è¡Œã†ãŸã³ã«ä¸­èº«ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ã“ã“ã«è¿½è¨˜ã—ã¾ã™ã€‚</p><p>ã¡ãªã¿ã«æ‰‹å‹•ã§æ–°è¦ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ãã®ã¾ã¾æ®‹ã‚‹ãŸã‚ã€ã“ã“ã«è¿½åŠ ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openapi_server/controllers/*</span><br><span class="line">openapi_server/test/*</span><br></pre></td></tr></table></figure><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>ã“ã®Dockerfileã‚’ä½¿ã†ã“ã¨ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ç°¡å˜ã«webã‚µãƒ¼ãƒã‚’ç«‹ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t openapi_server .</span><br><span class="line">$ docker run -p 8080:8080 openapi_server</span><br></pre></td></tr></table></figure><p>ç–é€šç¢ºèªã‚’ã™ã‚‹ã¨APIã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒã—ã£ã‹ã‚Šã¨è¡Œã‚ã‚Œã¦ãŠã‚Šã€è¿”ã‚Šå€¤ãŒè¿”å´ã•ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:8080/v1/sc/4722/stockPrice</span><br><span class="line"><span class="string">&quot;do some magic!&quot;</span></span><br></pre></td></tr></table></figure><h1 id="ãŠã‚ã‚Šã«"><a href="#ãŠã‚ã‚Šã«" class="headerlink" title="ãŠã‚ã‚Šã«"></a>ãŠã‚ã‚Šã«</h1><p>Pythonè‡ªä½“ãŒå‹•çš„å‹ä»˜ã‘è¨€èªãªã ã‘ã‚ã£ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ™‚ã«å‹ã‚’å¸¸ã«æ°—ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€çµæ§‹ç²¾ç¥ã‚’æ“¦ã‚Šæ¸›ã‚‰ã™ã¨æ€ã„ã¾ã™ã€‚</p><p>OpenAPI Generatorã¯å‹ãƒ’ãƒ³ãƒˆã‚‚ä»˜ä¸ã—ã¦ãã‚Œã‚‹ãŸã‚ã€ãªã‚‹ã¹ãã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã“ã¨ã§å‹ã«é–¢ã™ã‚‹é–‹ç™ºã‚³ã‚¹ãƒˆå‰Šæ¸›ã«ã‚‚ã¤ãªãŒã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><p>è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã‚’ä½¿ãˆã°çµæœçš„ã«APIã®å…·ä½“çš„ãªãƒ­ã‚¸ãƒƒã‚¯ã ã‘å®Ÿè£…ã™ã‚Œã°è‰¯ã„ãƒ¬ãƒ™ãƒ«ã«ãªã‚Šã¾ã™ã®ã§ã€æ¡ç”¨ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆã¯å¤§ãã„ã¨æ„Ÿã˜ã¾ã—ãŸã€‚</p><p>æ˜æ—¥ã¯ã€fujineã•ã‚“ã®<a href="https://qiita.com/fujine/items/58b4616d7f50c462d62f">2022å¹´ã«ãŠä¸–è©±ã«ãªã£ãŸã‚ªãƒ©ã‚¤ãƒªãƒ¼ã®Pythonæ›¸ç±5å†Š</a>ã§ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221203a/top.png&quot; alt=&quot;&quot; width=&quot;941&quot; height=&quot;481&quot;&gt;

&lt;p&gt;ã“ã®è¨˜äº‹ã¯&lt;a</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="Python" scheme="https://future-architect.github.io/tags/Python/"/>
    
    <category term="Swagger" scheme="https://future-architect.github.io/tags/Swagger/"/>
    
    <category term="WebAPI" scheme="https://future-architect.github.io/tags/WebAPI/"/>
    
  </entry>
  
  <entry>
    <title>Qiita Advent Calendar 2022 ã«å‚åŠ ã—ã¾ã™</title>
    <link href="https://future-architect.github.io/articles/20221130b/"/>
    <id>https://future-architect.github.io/articles/20221130b/</id>
    <published>2022-11-29T15:00:01.000Z</published>
    <updated>2022-11-30T04:48:14.790Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221130b/top.png" alt="" width="800" height="450"><p>Photo taken by <a href="https://twitter.com/kaedemalu">@kaedemalu</a></p><h2 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h2><p>æŠ€è¡“ãƒ–ãƒ­ã‚°é‹å–¶ã®ä¼Šè—¤ã§ã™ã€‚</p><p>ä»Šå¹´ã‚‚å¾Œã‚ãšã‹ã¨ãªã£ã¦ãŠã‚Šã€å¹´ã®ç€¬ã®å¿™ã—ã•ã‚„è‚Œå¯’ã•ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚<br>å¹´æœ«ã®é¢¨ç‰©è©©ã¨ãªã£ã¦ã„ã‚‹Qiita Advent Calendarã§ã™ãŒã€ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã¯ä»Šå¹´8å¹´ç›®ã®å‚åŠ ã¨ãªã‚Šã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€æ˜¨å¹´ã®æŒ¯ã‚Šè¿”ã‚Šã¨ä»Šå¹´ã®è¨˜äº‹ã®å†…å®¹ãªã©ã«è§¦ã‚Œã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚</p><ul><li><a href="https://qiita.com/advent-calendar/2022/future">ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ Advent Calendar 2022</a></li></ul><h2 id="ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã¯"><a href="#ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã¯" class="headerlink" title="ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã¯"></a>ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã¯</h2><p>ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ç•Œéšˆã§ã¯ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¯ã€ã€Œå‚åŠ è€…ã§è¨˜äº‹ã‚’ãƒªãƒ¬ãƒ¼ã—ã¦25æ—¥ã¾ã§æŠ•ç¨¿ã™ã‚‹ã€ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚‚ãªã£ã¦ã„ã¾ã™ãŒã€æœ¬æ¥ã¯ã‚¯ãƒªã‚¹ãƒã‚¹å½“æ—¥ã‚’å¾…ã¡æœ›ã¿ãªãŒã‚‰ã€ã²ã¨ã¤ãšã¤é–‹å°ã™ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚</p><p><a href="https://qiita.com/advent-calendar/2022">Qiita Advent Calendar</a>ã§ã¯ã“ã®ã€ã‚¯ãƒªã‚¹ãƒã‚¹ã®é¢¨ç‰©è©©ã®ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ãªãã‚‰ãˆã¦ã€12æœˆ1æ—¥ã‹ã‚‰25æ—¥ã¾ã§æ¯æ—¥ãƒªãƒ¬ãƒ¼æ–¹å¼ã§è¨˜äº‹ã‚’æŠ•ç¨¿ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’é–‹å‚¬ã—ã¦ã„ã¾ã™ã€‚</p><p>å½“ç¤¾ã®ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚ˆã†ã«Organizationã§å‚åŠ ã‚’å‹Ÿã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã—ã€Goè¨€èªã€ã‚¤ãƒ³ãƒ•ãƒ©ã€AWSãªã©ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚«ãƒƒãƒˆã§å‚åŠ ã‚’å‹Ÿã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚‚ã‚ã‚Šã¾ã™ã€‚<br>å‚åŠ ã™ã‚‹å ´åˆã¯ã€èˆˆå‘³ã®ã‚ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ç¨‹ã‚’åŸ‹ã‚ã‚‹ã ã‘ã§å‚åŠ ã§ãã‚‹ã®ã§ã€ã¨ã¦ã‚‚æ°—è»½ã«å‚åŠ ã§ãã¾ã™ã€‚</p><h2 id="2021å¹´ã®æŒ¯ã‚Šè¿”ã‚Š"><a href="#2021å¹´ã®æŒ¯ã‚Šè¿”ã‚Š" class="headerlink" title="2021å¹´ã®æŒ¯ã‚Šè¿”ã‚Š"></a>2021å¹´ã®æŒ¯ã‚Šè¿”ã‚Š</h2><img src="/images/20221130b/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-29_19.08.22.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-29_19.08.22.png" width="1059" height="692" loading="lazy"><p><a href="https://qiita.com/advent-calendar/2021/future">2021å¹´ã®ä¸€è¦§</a>ã‚’è¦‹ã‚‹ã¨ã€è¨€èªã«ç•™ã¾ã‚‰ãšã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®è¨˜äº‹ã‚„é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãªã©ã¨ã„ã£ãŸã•ã¾ã–ã¾ãªè¨˜äº‹ãŒæŠ•ç¨¿ã•ã‚Œã¦ã„ã¾ã™ã€‚<br>ç§ã¯å…¥ç¤¾ã—ã¦ä»¥æ¥ãšã£ã¨ä½¿ã£ã¦ã„ã‚‹Terraformã‚’ã©ã®ã‚ˆã†ã«ã—ã¦ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‹ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚</p><h2 id="2022å¹´ã®è¨˜äº‹ä¸€è¦§"><a href="#2022å¹´ã®è¨˜äº‹ä¸€è¦§" class="headerlink" title="2022å¹´ã®è¨˜äº‹ä¸€è¦§"></a>2022å¹´ã®è¨˜äº‹ä¸€è¦§</h2><p><a href="https://qiita.com/advent-calendar/2022/future">2022å¹´ã®ä¸€è¦§</a>ã¯ä»¥ä¸‹ã§ã™ã€‚<br><img src="/images/20221130b/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-29_19.14.45.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-29_19.14.45.png" width="1055" height="790" loading="lazy"></p><p>ã¾ã ä½•ã‚’æ›¸ãã‹æ±ºã¾ã£ã¦ã„ãªã„äººã‚‚ã„ã¾ã™ãŒã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã‚¤ãƒ³ãƒ•ãƒ©ã€ãƒ¢ãƒã‚¤ãƒ«ã€AIãªã©ä¾‹å¹´ã¨åŒæ§˜ã«å¹…åºƒã„è¨˜äº‹ãŒå…¬é–‹ã•ã‚Œã‚‹äºˆå®šã¨ãªã£ã¦ã„ã¾ã™ã€‚<br>ã¾ãŸã€ä»Šå¹´ã‚‚æ¯å¹´å‚åŠ ã®ãƒ™ãƒ†ãƒ©ãƒ³ç¤¾å“¡ã‚„ã€ä»Šå¹´åº¦å…¥ç¤¾ã®ãƒ«ãƒ¼ã‚­ãƒ¼ãªã©ã€åˆ†é‡ã ã‘ã§ãªãã€ç¤¾ä¼šäººæ­´ã‚‚åšã‚ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚</p><h3 id="ç™ºè¡¨ãƒ†ãƒ¼ãƒã«ã¤ã„ã¦"><a href="#ç™ºè¡¨ãƒ†ãƒ¼ãƒã«ã¤ã„ã¦" class="headerlink" title="ç™ºè¡¨ãƒ†ãƒ¼ãƒã«ã¤ã„ã¦"></a>ç™ºè¡¨ãƒ†ãƒ¼ãƒã«ã¤ã„ã¦</h3><p>ä¾‹å¹´ã®è¨˜äº‹ã§æ²è¼‰ã—ã¦ã„ã‚‹å†…å®¹ã‚’æ”¹ã‚ã¦å¼•ç”¨ã—ã¾ã™ã€‚</p><blockquote><p>ä¾‹å¹´ã¨åŒã˜ãã€ITæŠ€è¡“ã§ã‚ã‚‹ã“ã¨ä»¥å¤–ã¯ãƒ•ãƒªãƒ¼ãƒ†ãƒ¼ãƒã§ã™ã€‚</p></blockquote><blockquote><p>ãƒãƒªã‚·ãƒ¼ã¨ã—ã¦ã¯åŸºæœ¬çš„ã«ã¯Qiitaãã®ã‚‚ã®ã«æŠ•ç¨¿ã—ã¦ã„ãŸã ãã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ãŒï¼ˆé †ä½ã‚‚å°‘ã—æ°—ã«ã—ã¦ã„ã¾ã™ï¼‰ã€Qiitaã®æŠ•ç¨¿è¦ç´„ã«æ²¿ã‚ãªã„è¨˜äº‹ï¼ˆã‚¨ãƒƒã‚»ãƒ¼éãã‚‹ã‚‚ã®ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«é–¢ä¿‚ãªã„ã‚‚ã®ï¼‰ã¯æŠ€è¡“ãƒ–ãƒ­ã‚°å´ã«æŠ•ç¨¿ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚ãŸã‚Šã®æ±ºã‚ã¯å„äººã«ãŠé¡˜ã„ã—ã¦ã„ã¾ã™ã€‚<br>ãã®ä»–ã€å€‹äººãƒ–ãƒ­ã‚°ã¸ã®ãƒªãƒ³ã‚¯ã¯éæ¨å¥¨ã§åŸºæœ¬çš„ã«ã¯NGã¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ã¦ã„ã¾ã™ã€‚</p></blockquote><p>è¨˜äº‹æŠ•ç¨¿ã«ã¤ã„ã¦ã¯å€‹äººãŒæ°—ã«ãªã‚‹å ´åˆã¯å†…éƒ¨ã§ç¢ºèªã™ã‚‹ãªã©ã—ã¾ã™ãŒã€åŸºæœ¬ã¯ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚„å€«ç†çš„ã«åã—ãªã„å†…å®¹ã§æŠ•ç¨¿ã—ã¦ã„ãŸã ãã‚ˆã†ãŠé¡˜ã„ã—ã¦ãŠã‚Šã¾ã™ã€‚ã¾ãŸã€å€‹äººãƒ–ãƒ­ã‚°ã¸ã®ãƒªãƒ³ã‚¯ã¯åŸå‰‡ã¨ã—ã¦å½“ç¤¾ã®ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã¯NGã¨ã—ã¦ã„ã‚‹ã®ã§ã€å‚åŠ ã•ã‚Œã‚‹æ–¹ã¯æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</p><h2 id="æœ€å¾Œã«"><a href="#æœ€å¾Œã«" class="headerlink" title="æœ€å¾Œã«"></a>æœ€å¾Œã«</h2><p>ã“ã®ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’çµ‚ãˆã‚‹ã¨ã€å¤–éƒ¨ç™ºä¿¡ã®ç· ã‚ããã‚Šã‚’å€‹äººçš„ã«æ„Ÿã˜ã¾ã™ãŒã€</p><ul><li>æ¯å¹´ã®ç· ã‚ã«ä½¿ã£ã¦ã„ãŸã ãæ–¹</li><li>æŠ€è¡“ãƒ–ãƒ­ã‚°ã«ã¯å¯„ç¨¿ã§ããªã‹ã£ãŸã‘ã©ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãã‚‰ã„ã¯ãªã‚“ã¨ã‹æŠ•ç¨¿ã—ãŸã„æ–¹</li></ul><p>ã¨ã„ã†ã•ã¾ã–ã¾ãªãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã§å‚åŠ ã—ã¦ã„ãŸã ã„ã¦ã„ã¾ã™ã€‚<br>æ¯å¹´ã€ã•ã¾ã–ã¾ãªè¨˜äº‹ã‚’è¦‹ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ç§è‡ªèº«æ¥½ã—ã¿ã«ã—ã¦ã„ã‚‹ã®ã§ã€å‚åŠ ã•ã‚Œã‚‹æ–¹ã¨ä¸€ä¸¸ã«ãªã£ã¦å…¨è¨˜äº‹æŠ•ç¨¿ã¨ã‚ˆã‚Šèª­ã‚“ã§ã„ãŸã ã‘ã‚‹ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ãªã‚Œã°ã¨æ€ã„ã¾ã™ï¼</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221130b/top.png&quot; alt=&quot;&quot; width=&quot;800&quot; height=&quot;450&quot;&gt;

&lt;p&gt;Photo taken by &lt;a</summary>
        
      
    
    
    
    <category term="Culture" scheme="https://future-architect.github.io/categories/Culture/"/>
    
    
    <category term="Qiita" scheme="https://future-architect.github.io/tags/Qiita/"/>
    
    <category term="ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹" scheme="https://future-architect.github.io/tags/%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9/"/>
    
    <category term="ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼" scheme="https://future-architect.github.io/tags/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC/"/>
    
  </entry>
  
  <entry>
    <title>Auth0å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—ã‚³ãƒãƒ³ãƒ‰ã‚’PowerShellã®Invokeã‚³ãƒãƒ³ãƒ‰ã§è¡Œã†</title>
    <link href="https://future-architect.github.io/articles/20221130a/"/>
    <id>https://future-architect.github.io/articles/20221130a/</id>
    <published>2022-11-29T15:00:00.000Z</published>
    <updated>2022-11-30T03:40:29.826Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>Auth0ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹APIæ“ä½œã¯ã€curlã‚³ãƒãƒ³ãƒ‰ã§è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ä¸€æ–¹ã§ã€PowerShellæ¨™æº–ã® <code>Invoke-webRequest</code>ã‚„<code>Invoke-RestMethod</code> ã‚’ç”¨ã„ã¦æ“ä½œã™ã‚‹ã¨ã„ã£ãŸæ—¥æœ¬èªæƒ…å ±ãŒå°‘ãªã„ã¨æ€ã£ãŸãŸã‚ã€GETã¨POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚</p><p>ã¤ã„ã§ã«ã€Auth0ã«ã„ã‚‹å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã‚‚å…±æœ‰ã—ã¾ã™ã€‚</p><h2 id="Windowsã®curläº‹æƒ…"><a href="#Windowsã®curläº‹æƒ…" class="headerlink" title="Windowsã®curläº‹æƒ…"></a>Windowsã®curläº‹æƒ…</h2><p>CLIã‹ã‚‰é€šä¿¡ã‚’è¡Œãˆã‚‹ä¾¿åˆ©ã‚³ãƒãƒ³ãƒ‰ <code>curl</code> ã¯å…ƒã€…UNIXç³»ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ã‚‚ã¨ã‚‚ã¨Windowsã«ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚</p><p><a href="https://ascii.jp/elem/000/004/021/4021036/">ã“ã¡ã‚‰ã®è¨˜äº‹</a>ã«ã‚ˆã‚‹ã¨ã€2018å¹´ã®Windows 10 Ver.1803ã‹ã‚‰Curl.exeãŒWindowsã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸãã†ã§ã™ã€‚ãã“ã‹ã‚‰ã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã‚‰ã€<code>curl</code>ã€PowerShellã®å ´åˆ<code>curl.exe</code>ã¨æ‰“ã¦ã°curlãŒä½¿ãˆã¾ã™ã€‚</p><p>ã“ã“ã§å¤§äº‹ãªã“ã¨ã§ã™ãŒã€2018å¹´ã¾ã§curlãŒä½¿ãˆãªã‹ã£ãŸæ™‚ä»£ã®åæ®‹ãªã®ã‹ã€ <strong>PowerShellã®å ´åˆã€<code>curl</code> ã¨æ‰“ã¤ã¨windowsç”¨ã®<code>curl</code>ã§ã‚ã£ãŸ<code>Invoke-WebRequest</code>ãŒå®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã„ã¾ã™</strong>ã€‚ï¼ˆcurl.exeã ã¨curlãŒå‹•ããŒã€curlã«ã¯invokeã‚³ãƒãƒ³ãƒ‰ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒè²¼ã£ã¦ã‚ã‚‹ï¼‰ã€‚æ™®æ®µWindowsç’°å¢ƒã‚’è§¦ã‚‰ãªã„äººã«ã¨ã£ã¦ã€é«˜åº¦ãªç½ ã§ã™ã­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\xxxx&gt; curl</span><br><span class="line"></span><br><span class="line">ã‚³ãƒãƒ³ãƒ‰ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä½ç½® 1 ã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆ Invoke-WebRequest</span><br><span class="line">æ¬¡ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«å€¤ã‚’æŒ‡å®šã—ã¦ãã ã•ã„:</span><br><span class="line">Uri:</span><br></pre></td></tr></table></figure><p>ãã®ãŸã‚ã€ç­†è€…ã®ã‚ˆã†ã«PowerShellã§ã¯ ä¸€èˆ¬ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã™ã‚‹ <code>curl</code> ãŒãªã„ã‚‚ã®ã ã¨èªè­˜ã—ã€<code>Invoke-webRequest</code> ã‚„ <code>Invoke-RestMethod</code> ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚‹ã¨å‹˜é•ã„ã™ã‚‹äººã‚‚å°‘ãªããªã„ã¨æ€ã„ã¾ã™ã€‚ä»Šå›ã®è¨˜äº‹ã¯ä¸€é€£ã®Auth0ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã£ãŸcurlã‚³ãƒãƒ³ãƒ‰ã‚’Invoke-RestMethodã«ç½®æ›ã—ã¦å®Ÿè¡Œã™ã‚‹æµã‚Œã‚’ã€ä¸€æ™©ã‹ã‘ã¦å‹¢ã„ã§ã¾ã¨ã‚ãŸè¨˜äº‹ã§ã™ã€‚</p><p>ã™ã¹ã¦ã‚’æ›¸ãçµ‚ãˆãŸå¾Œã€å…ˆè¼©ç¤¾å“¡ã«<code>curl.exe</code>ã™ã‚Œã°curlå‡ºæ¥ã‚‹ã‚ˆã¨è¨€ã‚ã‚Œæ‚²ã—ããªã‚Šã¾ã—ãŸãŒã€2023å¹´10æœˆã€2027å¹´1æœˆã¾ã§ã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ã¦ã„ã‚‹Windows Server 2012ã€2016ã«ã¯curlãŒãªã„ã¨æ€ã‚ã‚Œã‚‹ã®ã§ã€ãã†ã„ã£ãŸç’°å¢ƒã‚’æ‰±ã†æ–¹ã«ã¯æœ‰ç”¨ã ã¨æ€ã„ã¾ã™ã€‚ã¡ãªã¿ã«ã€Windows Server 2019ã«ã¯ <code>curl.exe</code> ãŒã‚ã‚Šã¾ã—ãŸã®ã§ã€ç´ ç›´ã«ãã¡ã‚‰ã§æ“ä½œã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚</p><p>æ³¨æ„ã§ã™ãŒã€ã“ã®è¨˜äº‹ã«è¨˜è¼‰ã—ã¦ã„ã‚‹curlã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¸Šã§å‹•ã‹ã™å ´åˆã¯ã€<code>\</code>ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã¨ã€æ”¹è¡Œã‚’æ¶ˆã™å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆè¨˜äº‹ä¸Šã§ã¯èª­ã¿ã‚„ã™ã•ã®ãŸã‚ã«æ”¹è¡Œã‚’å…¥ã‚Œã¦ã„ã¾ã™ï¼‰ã€‚</p><h2 id="çµè«–ã‹ã‚‰è©±ã™ã¨"><a href="#çµè«–ã‹ã‚‰è©±ã™ã¨" class="headerlink" title="çµè«–ã‹ã‚‰è©±ã™ã¨"></a>çµè«–ã‹ã‚‰è©±ã™ã¨</h2><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å‹•ãã¾ã™ã€‚</p><ol><li>tokenå–å¾—ï¼ˆpostãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$client_id</span> =  <span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="variable">$client_secret</span> =  <span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="variable">$api</span> =  <span class="string">&quot;https://xxx/api/v2/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$body</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    client_id = <span class="string">&quot;<span class="variable">$client_id</span>&quot;</span></span><br><span class="line">    client_secret = <span class="string">&quot;<span class="variable">$client_secret</span>&quot;</span></span><br><span class="line">    audience = <span class="string">&quot;<span class="variable">$api</span>&quot;</span></span><br><span class="line">    grant_type = <span class="string">&quot;client_credentials&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Invoke-RestMethod</span> <span class="literal">-Method</span> Post <span class="literal">-Uri</span> <span class="string">&quot;https://xxx/oauth/token&quot;</span> <span class="literal">-ContentType</span> <span class="string">&#x27;application/json&#x27;</span> <span class="literal">-Body</span> (<span class="variable">$body</span>|<span class="built_in">ConvertTo-Json</span>) <span class="literal">-OutFile</span> output.txt</span><br><span class="line"><span class="built_in">cat</span> output.txt</span><br></pre></td></tr></table></figure></li><li>output.txtã‹ã‚‰tokenã‚’ã‚³ãƒ”ãƒ¼ã—ã¦2ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¤</li><li>å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—ã‚³ãƒãƒ³ãƒ‰(getãƒªã‚¯ã‚¨ã‚¹ãƒˆ)  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$token</span> = <span class="string">&quot;copyAndPasteHere&quot;</span></span><br><span class="line"><span class="built_in">Invoke-RestMethod</span> <span class="literal">-Method</span> Get <span class="literal">-Uri</span> <span class="string">&quot;https://xxx/api/v2/users?per_page=0&amp;include_totals=true&quot;</span> <span class="literal">-Headers</span> <span class="selector-tag">@</span>&#123;Authorization=<span class="string">&quot;Bearer <span class="variable">$token</span>&quot;</span>&#125;</span><br></pre></td></tr></table></figure></li><li>output.txt ãŒä¸è¦ã«ãªã‚Œã°å‰Šé™¤ã—ã¾ã™  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> .\output.txt</span><br></pre></td></tr></table></figure></li></ol><h2 id="æ“ä½œã®æµã‚Œ"><a href="#æ“ä½œã®æµã‚Œ" class="headerlink" title="æ“ä½œã®æµã‚Œ"></a>æ“ä½œã®æµã‚Œ</h2><p>Auth0ã«ã„ã‚‹ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’å–å¾—ã‚’ <code>Invoke-RestMethod</code> ã§è¨˜è¼‰ã™ã‚‹æ–¹æ³•ã‚’å…±æœ‰ã—ã¾ã™ã€‚</p><p>åŸºæœ¬çš„ã«ã¯ä»¥ä¸‹ã®2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã‚’<code>Invoke-RestMethod</code> ã§ä»£æ›¿ã—ã¾ã™ã€‚</p><ol><li>APIã‚’åˆ©ç”¨ã™ã‚‹tokenã‚’å–å¾—ã™ã‚‹ï¼ˆPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰</li><li>ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—APIã‚’æ‰“ã¤ï¼ˆGETãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰</li></ol><h3 id="1-APIã‚’åˆ©ç”¨ã™ã‚‹tokenã‚’å–å¾—ã™ã‚‹ï¼ˆPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰"><a href="#1-APIã‚’åˆ©ç”¨ã™ã‚‹tokenã‚’å–å¾—ã™ã‚‹ï¼ˆPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰" class="headerlink" title="1. APIã‚’åˆ©ç”¨ã™ã‚‹tokenã‚’å–å¾—ã™ã‚‹ï¼ˆPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰"></a>1. APIã‚’åˆ©ç”¨ã™ã‚‹tokenã‚’å–å¾—ã™ã‚‹ï¼ˆPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰</h3><p>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—ã«ä½¿ã† <strong>Auth0 User Management API</strong> ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®tokenã‚’ã¾ãšã¯å–å¾—ã—ã¾ã™ã€‚</p><p>User Management APIã®åˆ©ç”¨æ¨©é™ã®ã‚ã‚‹APIã®tokenå–å¾—ã‚³ãƒãƒ³ãƒ‰ãŒã€<strong>APIè¨­å®šã®Testã‚¿ãƒ–ã«</strong>ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«æ›¸ã„ã¦ã‚ã‚‹ã®ã§å‚ç…§ã—ã¾ã™ã€‚tokenã‚’å–å¾—ã™ã‚‹<code>cURLã‚³ãƒãƒ³ãƒ‰</code>ã¨ã€ã™ã”ãè¦ªåˆ‡ã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã‚ˆãç”¨ã„ã‚‹è¨€èªã§ã®å–å¾—æ–¹æ³•ã¾ã§è¨˜è¼‰ã—ã¦ã„ã‚‹ã®ã§å‚è€ƒã«ãªã‚Šã¾ã™ã€‚</p><img src="/images/20221130a/0.png" alt="" width="1200" height="706" loading="lazy"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl --request POST \</span><br><span class="line">  --url https://$domain/oauth/token \</span><br><span class="line">  --header &#x27;content-type: application/json&#x27; \</span><br><span class="line">  --data &#x27;&#123;&quot;client_id&quot;:&quot;alphanumericWithCapita1Letter&quot;,&quot;client_secret&quot;:&quot;alphanumericWithCapita1LetterChottoNaga1&quot;,&quot;audience&quot;:&quot;https://$domain/api/v2/&quot;,&quot;grant_type&quot;:&quot;client_credentials&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure><h4 id="è¦³å¯Ÿ"><a href="#è¦³å¯Ÿ" class="headerlink" title="è¦³å¯Ÿ"></a>è¦³å¯Ÿ</h4><p>ã¾ãšå…ƒã®CURLãŒä½•ã‚„ã£ã¦ã‚‹ã‹è¦‹ã¾ã™ã€‚</p><ul><li><strong>POST</strong>ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</li><li>content typeãŒ<strong>application&#x2F;json</strong>å½¢å¼</li><li>dataã«<strong>jsonæ–‡å­—åˆ—ã§clientèªè¨¼æƒ…å ±ã‚’æ¸¡ã—ã¦ã„ã‚‹</strong></li></ul><p><strong>data</strong>ã¨ã‚ã‚Šã¾ã™ãŒ <strong>HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯body</strong> ã¨ã‚‚å‘¼ã³ã¾ã™ã€‚ã“ã“ã¾ã§ã§ã€ <strong><code>Invoke-RestMethod</code>ã§ã‚„ã‚‹ã“ã¨ã¯ã€ŒJSONã‚’POSTã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œã‚Œã°è‰¯ã„</strong>ã€ã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚</p><h4 id="å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦‹ã‚‹"><a href="#å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦‹ã‚‹" class="headerlink" title="å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦‹ã‚‹"></a>å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦‹ã‚‹</h4><p>2022å¹´11æœˆæ™‚ç‚¹ã§ã¯powershell-7.3ãŒæœ€æ–°ã®ã‚ˆã†ã§ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯<a href="https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/invoke-restmethod?view=powershell-7.3">ã“ã‚Œ</a>ã§ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-RestMethod</span></span><br><span class="line">      [-<span class="type">Method</span> &lt;<span class="type">WebRequestMethod</span>&gt;]</span><br><span class="line">      [-<span class="type">FollowRelLink</span>]</span><br><span class="line">      [-<span class="type">MaximumFollowRelLink</span> &lt;<span class="built_in">Int</span><span class="type">32</span>&gt;]</span><br><span class="line">      [-<span class="type">ResponseHeadersVariable</span> &lt;<span class="built_in">String</span>&gt;]</span><br><span class="line">      [-<span class="type">StatusCodeVariable</span> &lt;<span class="built_in">String</span>&gt;]</span><br><span class="line">      [-<span class="type">UseBasicParsing</span>]</span><br><span class="line">      [-<span class="type">Uri</span>] &lt;Uri&gt;</span><br><span class="line">      [-<span class="type">HttpVersion</span> &lt;<span class="type">Version</span>&gt;]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸­ã€…é›£ã—ãã†ã§ã™ãŒã€ã‚³ãƒ¬ã‚’è¦‹ã‚‹ã¨ã€ <strong><code>Invoke-RestMethod</code>ã§å„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚Œã°è‰¯ã„</strong> ã“ã¨ãŒæ¨æ¸¬ã§ãã¾ã™ã€‚</p><p><strong>CURLã§æŒ‡å®šã—ãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒãƒƒãƒ”ãƒ³ã‚°å‡ºæ¥ãã†</strong>ã§ã™ã­ã€‚</p><ul><li>â€“requestã¯-Method<ul><li><code>-Method Post</code></li></ul></li><li>â€“urlã¯-Uri<ul><li><code>-Uri https://$domain/oauth/token</code></li></ul></li><li>â€“headerã¯Headersã¨ContentTypeãŒä¸¡æ–¹ã‚ã‚Šã¾ã™ã­ã€ContentTypeã ã‘æŒ‡å®šã™ã‚‹ã®ã§-ContentTypeã®ã¿ä½¿ã„ã¾ã™ã€‚ï¼ˆHeadersã«content-typeã¨å…¥ã‚ŒãŸã‚‰ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã¾ã—ãŸï¼‰<ul><li><code>-ContentType application/json</code></li></ul></li><li>â€“dataã¯-body<ul><li>å¾Œè¿°ã—ã¾ã™ãŒã„ã„æ„Ÿã˜ã«æ›¸ã‹ãªã„ã¨NGã§ã—ãŸ</li></ul></li></ul><p>ã“ã‚Œã§ã€<strong>bodyã«å½“ãŸã‚‹éƒ¨åˆ†ä»¥å¤–ã¯è‰¯ã„æ„Ÿã˜ã«ãƒãƒƒãƒ”ãƒ³ã‚°å‡ºæ¥ã¾ã—ãŸã€‚</strong></p><p>ç¶šã„ã¦ã¯bodyã®è¨˜è¼‰æ–¹æ³•ã‚’è¦‹ã¾ã™ã€‚</p><img src="/images/20221130a/image.png" alt="" width="700" height="1083" loading="lazy"><p>ã±ã£ã¨è¦‹ã¯ç†è§£ã™ã‚‹ã“ã¨ãŒé›£ã—ã„ã§ã™ã‚ˆã­ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ¸¡ã›ã°è‰¯ã„ã®ã‹ãªï¼Ÿã¨ã‚ã‹ã‚Šã¾ã™ã€‚</p><p><a href="https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/invoke-restmethod?view=powershell-7.3#2-post">å…¬å¼ã«POSTã®ä¾‹ãŒ</a>ã‚ã‚‹ã®ã§å‚è€ƒã«ã§ãã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Cred</span> = <span class="built_in">Get-Credential</span></span><br><span class="line"><span class="variable">$Url</span> = <span class="string">&quot;https://server.contoso.com:8089/services/search/jobs/export&quot;</span></span><br><span class="line"><span class="variable">$Body</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    search = <span class="string">&quot;search index=_internal | reverse | table index,host,source,sourcetype,_raw&quot;</span></span><br><span class="line">    output_mode = <span class="string">&quot;csv&quot;</span></span><br><span class="line">    earliest_time = <span class="string">&quot;-2d@d&quot;</span></span><br><span class="line">    latest_time = <span class="string">&quot;-1d@d&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Invoke-RestMethod</span> <span class="literal">-Method</span> <span class="string">&#x27;Post&#x27;</span> <span class="literal">-Uri</span> <span class="variable">$url</span> <span class="literal">-Credential</span> <span class="variable">$Cred</span> <span class="literal">-Body</span> <span class="variable">$body</span> <span class="literal">-OutFile</span> output.csv</span><br></pre></td></tr></table></figure><p>ã©ã†ã‚„ã‚‰ã‚·ã‚§ãƒ«å†…ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Œã°è‰¯ã•ãã†ã ã¨ã‚ã‹ã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã‚’å‚è€ƒã«ä»¥ä¸‹ã®ã‚ˆã†ã«å‹•ã‹ã™ã¨ <strong>ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™</strong>ã€‚</p><figure class="highlight powershell"><figcaption><span>ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸå®Ÿè¡Œçµæœ</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$body</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    client_id = <span class="string">&quot;alphanumericWithCapita1Letter&quot;</span></span><br><span class="line">client_secret = <span class="string">&quot;alphanumericWithCapita1LetterChottoNaga1&quot;</span></span><br><span class="line">audience = <span class="string">&quot;https://<span class="variable">$domain</span>/api/v2/&quot;</span></span><br><span class="line">grant_type = <span class="string">&quot;client_credentials&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Invoke-RestMethod</span> <span class="literal">-Method</span> Post <span class="literal">-Uri</span> <span class="string">&quot;https://<span class="variable">$domain</span>/oauth/token&quot;</span> <span class="literal">-ContentType</span> <span class="string">&#x27;application/json&#x27;</span> <span class="literal">-Body</span> <span class="variable">$body</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><figcaption><span>å®Ÿè¡Œçµæœ</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-RestMethod</span> : invalid json</span><br></pre></td></tr></table></figure><p>ç†ç”±ã§ã™ãŒã€bodyã«jsonæ¸¡ã™æ¸¡ã™è©æ¬ºï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã§JSONæ¸¡ã™ã¨å®£è¨€ã—ã¦ã‚‹ãŒJSONã‚’æ¸¡ã—ã¦ã„ãªã„çŠ¶æ…‹ï¼‰ã‚’ã—ã¦ã‚‹ã‚ˆã†ã§ã™ã€‚ã‚ˆã—ãªã«ã‚„ã£ã¦ãã‚Œã‚‹ã¨å°‘ã—æœŸå¾…ã—ã¾ã—ãŸãŒã€ãƒ€ãƒ¡ãªã‚ˆã†ã§ã™ã€‚<br>ï¼ˆâ€»ã‚‚ã—ã€ä½•ã‹ã—ã‚‰ã®æ‰‹æ³•ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ï¼‰</p><h4 id="å¯¾å¿œæ–¹æ³•"><a href="#å¯¾å¿œæ–¹æ³•" class="headerlink" title="å¯¾å¿œæ–¹æ³•"></a>å¯¾å¿œæ–¹æ³•</h4><p><code>auth0 invoke rest method post body json powershell</code> ã¨ã„ã£ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¢ã™ã¨ã€<a href="https://www.thecodebuzz.com/invoke-restmethod-get-post-example-with-parameters/">ã“ã¡ã‚‰ã®è¨˜äº‹</a>ã«è¨˜è¼‰ã—ã¦ã„ã‚‹é€šã‚Šã€ <code>ConvertTo-Json</code><strong><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/convertto-json?view=powershell-7.3">ã‚³ãƒãƒ³ãƒ‰</a>ã‚’ç”¨ã„bodyã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’JSONã«å¤‰æ›</strong>ã™ã‚Œã°è‰¯ã„ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ï¼ˆ<code>-Body $body</code> â”ã€€<code>-Body ($body|ConvertTo-Json)</code>ï¼‰ã€‚</p><p>â€»å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é–¢é€£è¨˜äº‹ã®ç®‡æ‰€ã«ã‚‚ <code>ConvertTo-Json</code> ã®è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ãŒã€æœ¬æ–‡ã«ã‚‚è¨˜è¼‰ãŒã‚ã‚‹ã¨åŠ©ã‹ã‚‹äººã‚‚ã„ã‚‹ã‹ãªã¨æ€ã„ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯å‡ºã—ã¦ãŠãã¾ã—ãŸã€‚ã“ã‚ŒãŒæ¡ç”¨ã•ã‚Œã‚‹ã¨å¬‰ã—ã„ãªã¨æ€ã„ã¾ã™ã€‚</p><p>çµæœã¨ã—ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å‹•ãã¾ã™ã€‚</p><figure class="highlight powershell"><figcaption><span>æˆåŠŸä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$body</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    client_id = <span class="string">&quot;alphanumericWithCapita1Letter&quot;</span></span><br><span class="line">client_secret = <span class="string">&quot;alphanumericWithCapita1LetterChottoNaga1&quot;</span></span><br><span class="line">audience = <span class="string">&quot;https://<span class="variable">$domain</span>/api/v2/&quot;</span></span><br><span class="line">grant_type = <span class="string">&quot;client_credentials&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Invoke-RestMethod</span> <span class="literal">-Method</span> Post <span class="literal">-Uri</span> <span class="string">&quot;https://<span class="variable">$domain</span>/oauth/token&quot;</span> <span class="literal">-ContentType</span> <span class="string">&#x27;application/json&#x27;</span> <span class="literal">-Body</span> (<span class="variable">$body</span>|<span class="built_in">ConvertTo-Json</span>)</span><br></pre></td></tr></table></figure><p>ã—ã‹ã—ã€å°‘ã—æ–œã‚ä¸Šãªçµæœã«ãªã‚Šã¾ã™ã€‚</p><img src="/images/20221130a/1.png" alt="1.png" width="1200" height="181" loading="lazy"><h4 id="å‡ºåŠ›çµæœæœ€å¾Œã¾ã§å‡ºãªã„å•é¡Œ"><a href="#å‡ºåŠ›çµæœæœ€å¾Œã¾ã§å‡ºãªã„å•é¡Œ" class="headerlink" title="å‡ºåŠ›çµæœæœ€å¾Œã¾ã§å‡ºãªã„å•é¡Œ"></a>å‡ºåŠ›çµæœæœ€å¾Œã¾ã§å‡ºãªã„å•é¡Œ</h4><p>PowerShellã®ä»•æ§˜ã‹ã€Invoke-RestMethodã®ä»•æ§˜ãªã®ã‹ã€<strong>å‡ºåŠ›ãŒæœ€å¾Œã¾ã§å‡ºã¦ãã‚Œãšãƒˆãƒ¼ã‚¯ãƒ³ãŒåˆ†ã‹ã‚‰ãªã„å•é¡Œ</strong> ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p><p>è§£æ±ºç­–ã¨ã—ã¦ã€å…¬å¼ã®ä¾‹ã‚’çœŸä¼¼ã¦<strong>ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã—ã¦è¡¨ç¤º</strong>ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ï¼ˆæ„šç›´ã«<code>output.txt</code>ã«å‡ºã—ã¦<code>cat output.txt</code>ã—ã¾ã™ï¼‰ã€‚ã‚·ã‚§ãƒ«ã«è©³ã—ã„äººã ã£ãŸã‚‰è‰¯ã„æ„Ÿã˜ã«CLIã®å‡ºåŠ›å‡ºæ¥ãŸã‹ã‚‚ã—ã‚Œãªã„ã§ã™ãŒã€è©³ã—ã„æ–¹ã¯æ•™ãˆã¦ãã ã•ã„ã€‚</p><p>ãã®ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä»˜ã‘ã¾ã™ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">... <span class="literal">-OutFile</span> output.txt</span><br><span class="line"><span class="built_in">cat</span> output.txt</span><br></pre></td></tr></table></figure><h3 id="ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—APIã‚’æ‰“ã¤"><a href="#ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—APIã‚’æ‰“ã¤" class="headerlink" title="ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—APIã‚’æ‰“ã¤"></a>ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—APIã‚’æ‰“ã¤</h3><p>æœ€åˆã«ã€Auth0å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã®å–å¾—ã‚³ãƒãƒ³ãƒ‰ã‚’æ¢ã™ãŸã‚ã€å…¬å¼ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹<a href="https://auth0.com/docs/api/management/v2#!/Users/get_users">Auth0 User Management APIã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’è¦‹ã¾ã™ã€‚</p><p>ãã†ã™ã‚‹ã¨ã€<code>Users</code>ã€€â”ã€€<code>List or Search Users</code>ã®ç®‡æ‰€ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’çœºã‚ã¦ã‚‹ã¨ <strong>å°ã•ãå–å¾—ã§ãã‚‹æ—¨ãŒæ›¸ã„ã¦</strong> ã‚ã‚Šã¾ã™ã€‚APIã®æ¦‚è¦ã«ã¯ãƒšãƒ¼ã‚¸ãƒ³ã‚°ç•ªå·ã‚’æŒ‡å®šã—ãªãŒã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ã—ã‹ã§ããªã„ã‹ã®ã‚ˆã†ã«æ›¸ã„ã¦ã‚ã‚‹ãŒã€ã‚ˆãã‚ˆããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹ã¨å–å¾—ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</p><p><strong>APIæ¦‚è¦</strong>:1ãƒšãƒ¼ã‚¸ã«å–å¾—ã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’æŒ‡å®šã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’å–å¾—ã§ãã‚‹ã‚“ã‚„ã§ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Retrieve details of users. It is possible to:</span><br><span class="line"></span><br><span class="line">- Specify a search criteria for users</span><br><span class="line">- Sort the users to be returned</span><br><span class="line">- Select the fields to be returned</span><br><span class="line">- Specify the number of users to retrieve per page and the page index</span><br></pre></td></tr></table></figure><p><strong>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</strong>:include_totalsã‚’ã‚ªãƒ³ã«ã™ã‚‹ã¨<strong>APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ãƒˆãƒ¼ã‚¿ãƒ«ã‚’å«ã‚ã‚‰ã‚Œã‚‹</strong>ã¨æ›¸ã„ã¦ã„ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include_totals</span><br><span class="line">Return results inside an object that contains the total result count (true) or as a direct array of results (false, default).</span><br></pre></td></tr></table></figure><p>ã—ã‹ã—ã€ã“ã®èª¬æ˜æ–‡ã ã¨ã€è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã®åˆè¨ˆãªã®ã‹ã€å…¨ä½“ãªã®ã‹æ›–æ˜§ã§ã™ã‚ˆã­ã€‚</p><img src="/images/20221130a/image_2.png" alt="image.png" width="612" height="200" loading="lazy"><p>ã¾ãŸã€æ¦‚è¦ã«ã‚ã‚‹é€šã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆãŒå–å¾—ã§ãã¦ã—ã¾ã†ãŒã€åˆè¨ˆäººæ•°ã ã‘çŸ¥ã‚ŠãŸã„ã®ã§<strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ãªãã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¢ã—ã¾ã™</strong>ã€‚â€»å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ä»»æ„</p><div class="scroll"><table><thead><tr><th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th><th>èª¬æ˜</th></tr></thead><tbody><tr><td>page</td><td>è¿”å´ã™ã‚‹ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆ0ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰</td></tr><tr><td>per_page</td><td>1ãƒšãƒ¼ã‚¸ã«å«ã‚€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã€ç©ºã®å ´åˆå…¨ä»¶è¿”å´</td></tr><tr><td>include_totals</td><td>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«åˆè¨ˆäººæ•°ã‚’å…¥ã‚Œã‚‹</td></tr><tr><td>sort</td><td>ã‚½ãƒ¼ãƒˆé …ç›®ãƒ»é †ã‚’æ±ºã‚ã‚‹</td></tr><tr><td>connection</td><td>ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆã‚ˆãåˆ†ã‹ã‚‰ãšï¼‰</td></tr><tr><td>fields</td><td>è¡¨ç¤º&#x2F;éè¡¨ç¤ºã™ã‚‹é …ç›®ã‚’æ±ºã‚ã‚‹ã€‚ç©ºã®å ´åˆå…¨é …ç›®è¿”å´</td></tr><tr><td>include_fields</td><td>fieldsã§æŒ‡å®šã—ãŸé …ç›®ã‚’è¡¨ç¤ºã•ã›ã‚‹ã‹éè¡¨ç¤ºã«ã™ã‚‹ã‹æ±ºã‚ã‚‹</td></tr><tr><td>q</td><td>æ¤œç´¢ã‚¯ã‚¨ãƒªã€å½¢å¼ã¯Lucene query string syntaxã‚‰ã—ã„</td></tr><tr><td>search_engine</td><td>ã‚µãƒ¼ãƒã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ±ºã‚ã‚‹ã€è©³ç´°ã¯ãªã‹ã£ãŸãŸã‚è¬</td></tr></tbody></table></div><p><code>per_page</code>ã«ç€ç›®ã™ã‚‹ã¨<code>include_totals</code>ã ã‘æŒ‡å®šã—ã¦<code>per_page</code>ã‚’<strong>ç©ºã«ã—ãŸå ´åˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¦ã—ã¾ã†</strong>ã‚ˆã†ã§ã™ã€‚ãã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ•ãƒ©ã‚°ã®ã‚ˆã†ãªã‚‚ã®ã¯ãªãã€ <strong><code>per_page</code>ã‚’ã„ã˜ã‚‹ã—ã‹ãªã•ãã†</strong> ãªã®ã§ã€ä¸€æ—¦ã“ã‚Œã‚’0ã«ã—ã¦APIã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚</p><p>tokenå–å¾—æ™‚ã¨åŒæ§˜ã«ã€ã¾ãšæˆåŠŸã™ã‚‹curlã‚³ãƒãƒ³ãƒ‰ã‚’å…±æœ‰ã—ã¾ã™ã€‚401èªè¨¼å¤±æ•—ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã‚ˆã†ã«tokenã‚’ã¤ã‘ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl --request GET \</span><br><span class="line">  --url <span class="string">&quot;https://<span class="variable">$domain</span>/api/v2/users?per_page=0&amp;include_totals=true&quot;</span> \</span><br><span class="line">  --header <span class="string">&#x27;authorization: Bearer $token&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="è¦³å¯Ÿãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°"><a href="#è¦³å¯Ÿãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°" class="headerlink" title="è¦³å¯Ÿãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°"></a>è¦³å¯Ÿãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°</h3><p>ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯GETãªã®ã§ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ã€‚tokenæ¸¡ã—ãŸGETãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã ã‘ã§ã™ã€‚<a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-restmethod?view=powershell-7.3">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒªãƒ³ã‚¯ã¯ã“ã¡ã‚‰</a>ã§ã™ã€‚</p><ul><li>GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã—ã¦ã„ã‚‹<ul><li><code>--request GET</code>ãŒ<code>--Method Get</code>ã«ãªã‚‹</li></ul></li><li>URLã«POSTã¨é•ã„ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹<ul><li><code>--url</code>ãŒ<code>-Uri</code>ã«ãªã‚‹</li><li><code>-Uri https://$domain/api/v2/users?per_page=0&amp;include_totals=true</code></li><li>URLã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹ã“ã¨ã‚’ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨è¨€ã†</li></ul></li><li>tokenèªè¨¼æƒ…å ±ã‚’æ¸¡ã—ã¦ã„ã‚‹<ul><li><code>--header</code>ãŒ<code>-Headers</code>ã«ãªã‚‹</li><li><code>-Headers @&#123;Authorization=&quot;Bearer $token&quot;&#125;</code></li><li>cURLã¨é•ã„<code>Invoke-RestMethod</code>ç‰¹æœ‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ã®ã§@{xxx}ã®å½¢å¼ã¨ãªã‚‹</li><li>Authenticationã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã©ã§ã‚‚æŒ‡å®šå¯èƒ½ã ã£ãŸã‹ã‚‚ã—ã‚Œãªã„ï¼ˆæœªæ¤œè¨¼ï¼‰</li></ul></li></ul><p>ä»¥ä¸Šã‹ã‚‰Invokeã‚³ãƒãƒ³ãƒ‰ã«æ›¸ãæ›ãˆã¾ã™ã€‚</p><figure class="highlight powershell"><figcaption><span>å®Ÿè¡Œä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-RestMethod</span> <span class="literal">-Method</span> Get <span class="literal">-Uri</span> <span class="string">&quot;https://<span class="variable">$domain</span>/api/v2/users?per_page=0&amp;include_totals=true&quot;</span> <span class="literal">-Headers</span> <span class="selector-tag">@</span>&#123;Authorization=<span class="string">&quot;Bearer <span class="variable">$token</span>&quot;</span>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><figcaption><span>å®Ÿè¡Œçµæœ</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span>  : <span class="number">0</span></span><br><span class="line">limit  : <span class="number">0</span></span><br><span class="line">length : <span class="number">0</span></span><br><span class="line">users  : &#123;&#125;</span><br><span class="line">total  : xxx</span><br></pre></td></tr></table></figure><p>ç„¡äº‹totalã®æ•°å­—ãŒå–å¾—ã§ãã¾ã—ãŸï¼</p><h2 id="æœ€å¾Œã«"><a href="#æœ€å¾Œã«" class="headerlink" title="æœ€å¾Œã«"></a>æœ€å¾Œã«</h2><p>curlã‚³ãƒãƒ³ãƒ‰ã®ä»£æ›¿ã¨ã—ã¦ã€PowerShellæ¨™æº–ã® <code>Invoke-webRequest</code>ã ã£ãŸã‚Š<code>Invoke-RestMethod</code> ã‚’ç”¨ã„ã¦Auth0ã®APIã‚’æ“ä½œã™ã‚‹ä¾‹ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚</p><p>ITåˆå¿ƒè€…ãŒITèª²é¡Œã‚’ã©ã†è§£æ±ºã—ã¦ã„ã‘ã°è‰¯ã„ã®ã‹ä½•ã¨ãªãåˆ†ã‹ã‚‹ã‚ˆã†ãªæ–‡ç« ã‚’æ›¸ã‘ãŸã‚‰è‰¯ã„ãªã¨æœ€è¿‘è€ƒãˆã¦ã„ã‚‹ãŸã‚ã€ãƒãƒã£ãŸéƒ¨åˆ†ã‚„èª¿æŸ»ã®æµã‚Œã‚‚ãªã‚‹ã¹ãæ®‹ã™ã‚ˆã†ã«è¨˜è¼‰ã—ã¾ã—ãŸã€‚ã‚°ã‚°ã£ã¦ã‚‚æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã«ãã‹ã£ãŸã“ã¨ã‚’è¨˜äº‹ã«ã—ã¦èª°ã‹ã‚’åŠ©ã‘ã‚‹å‚™å¿˜éŒ²ã«ã‚‚ãªã£ã¦ãŸã‚‰è‰¯ã„ãªã¨æ€ã„ã¾ã™ã€‚</p><p>ã“ã®è¨˜äº‹ãŒè‰¯ã„ãªã¨æ€ã£ãŸã‚‰æ„Ÿæƒ³ä¸‹ã•ã‚‹ã¨åŠ±ã¿ã«ãªã‚Šã¾ã™ã€‚Twitterãªã©ã§ã‚³ãƒ¡ãƒ³ãƒˆã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="èªè¨¼èªå¯" scheme="https://future-architect.github.io/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/"/>
    
    
    <category term="Auth0" scheme="https://future-architect.github.io/tags/Auth0/"/>
    
    <category term="curl" scheme="https://future-architect.github.io/tags/curl/"/>
    
    <category term="PowerShell" scheme="https://future-architect.github.io/tags/PowerShell/"/>
    
    <category term="Invoke-Request" scheme="https://future-architect.github.io/tags/Invoke-Request/"/>
    
  </entry>
  
  <entry>
    <title>go-projã‚’ç”¨ã„ã¦æ—¥æœ¬æ¸¬åœ°ç³»/ä¸–ç•Œæ¸¬åœ°ç³»ã®å¤‰æ›</title>
    <link href="https://future-architect.github.io/articles/20221129a/"/>
    <id>https://future-architect.github.io/articles/20221129a/</id>
    <published>2022-11-28T15:00:00.000Z</published>
    <updated>2022-11-29T01:44:11.121Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221129a/logo.png" alt="" width="250" height="76"><h2 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h2><p>TIG DXãƒ¦ãƒ‹ãƒƒãƒˆã®çœŸé‡ã§ã™ã€‚</p><p>ã‚ã‚‹ç·¯åº¦çµŒåº¦ã®åº§æ¨™ã‚’æ—¥æœ¬æ¸¬åœ°ç³»ã‹ã‚‰ä¸–ç•Œæ¸¬åœ°ç³»ã¸å¤‰æ›ã™ã‚‹éš›ã«ã€<a href="https://github.com/everystreet/go-proj">everystreet&#x2F;go-proj</a>ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç”¨ã„ã¾ã—ãŸã€‚ç§ã«ã¨ã£ã¦åˆã‚ã¦ã®cgoã‚’ç”¨ã„ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆ©ç”¨ã§ã‚ã‚Šã€ç’°å¢ƒæ§‹ç¯‰ã«å°‘ã—æ‚©ã‚“ã ã®ã§æ‰‹é †ã‚’ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚</p><p>ãªãŠã€é¡ä¼¼ã«<a href="https://github.com/go-spatial/proj">go-spatial&#x2F;proj</a>ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãã¡ã‚‰ã¯æ—¥æœ¬æ¸¬åœ°ç³»ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã‚ˆã†ã§ã—ãŸã€‚æ¸¬åœ°ç³»å¤‰æ›ã®çŸ¥è­˜ãŒç„¡ã„ã®ã§ãƒãƒ¼ã‚¿ãƒƒãƒã§ã™ãŒPure Goå®Ÿè£…ã«ã§ãã‚‹ã¨å¬‰ã—ã„ã§ã™ã­ã€‚</p><h2 id="æ—¥æœ¬æ¸¬åœ°ç³»-x2F-ä¸–ç•Œæ¸¬åœ°ç³»-ã¨ã¯"><a href="#æ—¥æœ¬æ¸¬åœ°ç³»-x2F-ä¸–ç•Œæ¸¬åœ°ç³»-ã¨ã¯" class="headerlink" title="æ—¥æœ¬æ¸¬åœ°ç³» &#x2F; ä¸–ç•Œæ¸¬åœ°ç³» ã¨ã¯"></a>æ—¥æœ¬æ¸¬åœ°ç³» &#x2F; ä¸–ç•Œæ¸¬åœ°ç³» ã¨ã¯</h2><p>ä»Šæ³‰ã•ã‚“ã® <a href="/articles/20220719b/">éƒµä¾¿ç•ªå·ãƒ»ä½æ‰€ãƒ»ç·¯åº¦çµŒåº¦ã®ä½“ç³»ã«ã¤ã„ã¦</a> ã«è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã®ã§å‚è€ƒãã ã•ã„ã€‚æ±äº¬ä»˜è¿‘ã§ã¯æ—¥æœ¬æ¸¬åœ°ç³»ã¨ä¸–ç•Œæ¸¬åœ°ç³»ã¨ã®èª¤å·®ãŒ450mç¨‹åº¦ã‚ã‚‹ã‚‰ã—ãã€å¤§æŠµã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã¯ã‚³ãƒ¼ãƒ‰ã‚’çµ±ä¸€ã—ãŸæ–¹ãŒè‰¯ã•ãã†ã§ã™ã€‚</p><p>ä»–ã«ã‚‚ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚</p><ul><li><a href="https://www.gsi.go.jp/LAW/G2000-g2000-h3.htm">ï¼“ã€€æ—¥æœ¬æ¸¬åœ°ç³»ã¨ä¸–ç•Œæ¸¬åœ°ç³»  | å›½åœŸåœ°ç†é™¢</a></li><li><a href="https://www.pasco.co.jp/recommend/word/word075/">æ¸¬åœ°ç³»ã¨ã¯ï¼Ÿï¼ˆæ—¥æœ¬æ¸¬åœ°ç³»ã¨ä¸–ç•Œæ¸¬åœ°ç³»ï¼‰ | ç”¨èªé›†ã¨GISã®ä½¿ã„æ–¹ | æ ªå¼ä¼šç¤¾ãƒ‘ã‚¹ã‚³</a></li></ul><h2 id="æ—¥æœ¬æ¸¬åœ°ç³»-x2F-ä¸–ç•Œæ¸¬åœ°ç³»-ã®å¤‰æ›ã«ã¤ã„ã¦"><a href="#æ—¥æœ¬æ¸¬åœ°ç³»-x2F-ä¸–ç•Œæ¸¬åœ°ç³»-ã®å¤‰æ›ã«ã¤ã„ã¦" class="headerlink" title="æ—¥æœ¬æ¸¬åœ°ç³» &#x2F; ä¸–ç•Œæ¸¬åœ°ç³» ã®å¤‰æ›ã«ã¤ã„ã¦"></a>æ—¥æœ¬æ¸¬åœ°ç³» &#x2F; ä¸–ç•Œæ¸¬åœ°ç³» ã®å¤‰æ›ã«ã¤ã„ã¦</h2><p><a href="http://kamoland.com/wiki/wiki.cgi?%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%C2%AC%EF%BF%BD%CF%B7%CF%A4%D8%A4%EF%BF%BD%EF%BF%BD%D0%B1%EF%BF%BD">æ—¥æœ¬æ¸¬åœ°ç³»ã¸ã®å¯¾å¿œ - ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼â€™sãƒšã‚¤ã‚¸</a> ã•ã‚“ã«ã‚ˆã‚‹ã¨ã€æ¦‚ã­3ã¤ã®å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚</p><ol><li>1æ¬¡å¼ã«ã‚ˆã‚‹è¿‘ä¼¼<ul><li>ã‚°ã‚°ã‚‹ã¨ã™ãå‡ºã¦ãã‚‹â†“ã®å¼<ul><li><code>lonJ = lonW + latW * 0.000046047 + lonW * 0.000083049 â€“ 0.010041</code></li><li><code>latJ = latW + latW * 0.00010696 â€“ lonW * 0.000017467 â€“ 0.0046020</code></li></ul></li><li>ã‚·ãƒ³ãƒ—ãƒ«ã§ç´ æ™´ã‚‰ã—ã„ã€‚ç´„2.5~2.8ãƒ¡ãƒ¼ãƒˆãƒ«ã‚ºãƒ¬ã‚‹</li></ul></li><li>ä¸‰æ¬¡å…ƒç›´äº¤åº§æ¨™ç³»ã«å¤‰æ›ã—ã¦å¹³è¡Œç§»å‹•<ul><li><strong>PROJ ãŒåˆ©ç”¨ã—ã¦ã„ã‚‹æ–¹å¼</strong></li><li>3ã«æ¯”ã¹ã¦ã€ç´„0.2~0.4ãƒ¡ãƒ¼ãƒˆãƒ«ã‚ºãƒ¬ã‚‹</li></ul></li><li>åœ°åŸŸã”ã¨ã®å¤‰æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å¤‰æ›ã™ã‚‹<ul><li>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨ã„ãŸæœ€ã‚‚ç²¾åº¦ãŒé«˜ã„æ–¹å¼</li><li><a href="https://vldb.gsi.go.jp/sokuchi/surveycalc/tky2jgd/main.html">Webç‰ˆ TKY2JGD</a> ã¨ã„ã£ãŸãƒ„ãƒ¼ãƒ«ãŒã‚ã‚‹</li></ul></li></ol><p>ä»Šå›ã¯1ã¯è¨±å®¹ã§ããªã„ã‘ã©ã€2ã®ãƒ¬ãƒ™ãƒ«ã§ã‚ã‚Œã°å•é¡Œãªã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã ã£ãŸã®ã§ã€PROJã‚’ç”¨ã„ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</p><p>â€»ã‚ºãƒ¬ã®è¨ˆç®—ã¯ã€3ã®Webç‰ˆTKY2JGDã§ æ—¥æœ¬æ¸¬åœ°ç³»â†’ä¸–ç•Œæ¸¬åœ°ç³»ã«å¤‰æ›ã—ãŸã‚‚ã®ã‚’æ­£ã¨ã—ã€1,2ã®å¤‰æ›å¾Œã®ç·¯åº¦çµŒåº¦ã‚’ã€<a href="https://vldb.gsi.go.jp/sokuchi/surveycalc/surveycalc/bl2stf.html">æ¸¬é‡è¨ˆç®—(è·é›¢ã¨æ–¹ä½è§’ã®è¨ˆç®—)</a> ã®Webãƒ„ãƒ¼ãƒ«ã§è¨ˆæ¸¬ã—ãŸã€‚å ´æ‰€ã¯äº”åç”°é§…ãªã©é–¢æ±ã®è¤‡æ•°åœ°ç‚¹ã§è©¦ã—ã¾ã—ãŸ</p><h2 id="ã“ã®å¤‰æ›ã‚’è¦šãˆã‚‹ã¨å¬‰ã—ã„ã®ï¼Ÿ"><a href="#ã“ã®å¤‰æ›ã‚’è¦šãˆã‚‹ã¨å¬‰ã—ã„ã®ï¼Ÿ" class="headerlink" title="ã“ã®å¤‰æ›ã‚’è¦šãˆã‚‹ã¨å¬‰ã—ã„ã®ï¼Ÿ"></a>ã“ã®å¤‰æ›ã‚’è¦šãˆã‚‹ã¨å¬‰ã—ã„ã®ï¼Ÿ</h2><p>æ—¥æœ¬æ¸¬åœ°ç³»ã¯ã€æ—§æ—¥æœ¬æ¸¬åœ°ç³»ï¼ˆTokyo Datumï¼‰ã¨å‘¼ã°ã‚Œã‚‹ã ã‘ã‚ã‚Šã€<a href="https://www.gsi.go.jp/LAW/G2000-g2000-h3.htm#:~:text=%E6%98%8E%E6%B2%BB%E6%99%82%E4%BB%A3%E3%81%AB%E6%8E%A1%E7%94%A8%E3%81%97%E3%81%9F%E3%83%99%E3%83%83%E3%82%BB%E3%83%AB%E6%A5%95%E5%86%86%E4%BD%93%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%97%E3%81%9F">æ˜æ²»æ™‚ä»£ã«ä½œã‚‰ã‚Œ</a>ã€2002å¹´4æœˆ1æ—¥ã¾ã§åˆ©ç”¨ã•ã‚Œã¦ã„ãŸè¦æ ¼ã§ã™ã€‚ãã‚Œä»¥é™ã¯æ—¥æœ¬æ¸¬åœ°ç³»2000ï¼ˆJGD2000ï¼‰ã‚ã‚‹ã„ã¯ã€æ—¥æœ¬æ¸¬åœ°ç³»2011ï¼ˆJGD2011ï¼‰ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚JGD2000ã¨JGD2011ã®ã©ã¡ã‚‰ã‚‚ä¸–ç•Œæ¸¬åœ°ç³»ã¨è¨€ãˆã‚‹çµŒåº¦ãƒ»ç·¯åº¦ã®ä½“ç³»ã§ã™ã€‚GD2011ã¸ç§»è¡Œã—ãŸãã£ã‹ã‘ã¯ã€æ±æ—¥æœ¬å¤§éœ‡ç½ã«ã‚ˆã‚‹å¤§è¦æ¨¡ãªåœ°æ®»å¤‰å‹•ã®ç™ºç”Ÿã¸ã®å¯¾å¿œã ãã†ã§ã€åŸºæœ¬çš„ã«JGD2000ã¨ã€JGD2011ã¯Tokyo Datumã«æ¯”ã¹ã‚‹ã¨ã€ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã®ãƒãƒƒãƒ—ã«ãƒ”ãƒ³ã‚’ç«‹ã¦ã¦ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã§ã¯åŒä¸€ã¨è¦‹ãªã—ã¦è‰¯ã„ãƒ¬ãƒ™ãƒ«ã§ã™ã€‚å…·ä½“çš„ã«ã¯<a href="https://club.informatix.co.jp/?p=998#:~:text=%E3%82%82%E7%95%B0%E3%81%AA%E3%82%8A%E3%80%81-,%E6%97%A5%E6%9C%AC%E8%BF%91%E8%BE%BA%E3%81%A7%E3%81%9D%E3%81%AE%E5%B7%AE%E3%81%AF5cm%E7%A8%8B%E5%BA%A6%E3%81%A7%E3%81%99,-%E3%80%82%E3%81%93%E3%81%AE%E5%B7%AE%E3%82%92">æ—¥æœ¬è¿‘è¾ºã§5cmç¨‹åº¦ã®å·®ãŒã‚ã‚‹</a>ã¨ã®ã“ã¨ã§ã™ã€‚</p><p>ä½•ãŒè¨€ã„ãŸã„ã‹ã¨ã„ã†ã¨ã€2002å¹´ä»¥é™ã«å…¬é–‹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯å¤§æ¦‚ã€ä¸–ç•Œæ¸¬åœ°ç³»ã§ã‚ã‚‹JGD2000ã¾ãŸã¯JGD2011ã§ã™ã€‚ãã®ãŸã‚ã€æ—¥æœ¬æ¸¬åœ°ç³»â†’ä¸–ç•Œæ¸¬åœ°ç³»ã«ã—ãŸã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã£ã¦ãã‚“ãªã«å¤šããªã„ã¨æ€ã„ã¾ã™ï¼ˆå¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œã—ãŸã„ã¨ã‹ã€ãã®å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«Google Mapãªã©ã«è¡¨ç¤ºã•ã›ãŸã„ãªã©ï¼Ÿï¼‰ã€‚ã“ã®è¨˜äº‹ã«æ›¸ã‹ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ã€å¤ã„è³‡ç”£ã‚’æ´»ç”¨ã—ãŸã„å ´åˆãªã©ã€é™å®šã•ã‚ŒãŸå ´é¢ã§å‚è€ƒã«ãªã‚‹ã‚“ã ã¨èªè­˜ã—ã¦ã‚‚ã‚‰ãˆã‚Œã°ã§ã™ã€‚</p><p>ä¾‹ãˆã°ã€å›½åœŸäº¤é€šçœã®<a href="https://nlftp.mlit.go.jp/isj/">è¡—åŒºãƒ¬ãƒ™ãƒ«ä½ç½®å‚ç…§æƒ…å ±</a>ã¯JGD2000å½¢å¼ã§ã™ã€‚åŒã˜ãå›½åœŸäº¤é€šçœã®<a href="https://nlftp.mlit.go.jp/ksj/gml/datalist/KsjTmplt-A45.html#prefecture01">å›½æœ‰æ—é‡ãƒ‡ãƒ¼ã‚¿</a>ã¯JGD2011ã§ã—ãŸã€‚å°‘ãªãã¦ã‚‚å…¬å…±æ©Ÿé–¢ã‹ã‚‰å–å¾—ã§ãã‚‹ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã¯ä¸–ç•Œæ¸¬åœ°ç³»ã«ãªã£ã¦ã„ã‚‹ã®ã‹ãªã¨æ€ã„ã¾ã™ã€‚</p><h2 id="PROJã¨ã¯"><a href="#PROJã¨ã¯" class="headerlink" title="PROJã¨ã¯"></a>PROJã¨ã¯</h2><p><a href="https://proj.org/">PROJ</a> ã¯ã“ã®ç•Œéšˆã§ã¯æœ‰åãªã€åœ°å›³æŠ•å½±ã‚„æ¸¬åœ°å¤‰æ›ãŒè¡Œãˆã‚‹ãƒ„ãƒ¼ãƒ«ã§ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã—ã¨ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚ˆã†ã«ã‚‚ä½¿ãˆã‚‹APIã‚‚æä¾›ã—ã¦ã„ã¾ã™ã€‚</p><p>ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰æ—¥æœ¬æ¸¬åœ°ç³»ã‹ã‚‰ä¸–ç•Œæ¸¬åœ°ç³»ã«å¤‰æ›ã™ã‚‹ä¾‹ã§ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¥æœ¬æ¸¬åœ°ç³»ï¼ˆEPSG 4301ï¼‰ã‹ã‚‰ä¸–ç•Œæ¸¬åœ°ç³»ï¼ˆEPSG 4612ï¼‰ã«å¤‰æ›</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;139.477799479 35.4891015625&quot;</span> | cs2cs +init=epsg:4301 +to +init=epsg:4612 -f <span class="string">&quot;%.10f&quot;</span></span><br><span class="line">139.4745977186  35.4923543046 0.0000000000</span><br></pre></td></tr></table></figure><p>å‚è€ƒ: <a href="http://pen.envr.tsukuba.ac.jp/~torarimon/?%C2%AC%EF%BF%BD%CF%B7%EF%BF%BD:+datum">http://pen.envr.tsukuba.ac.jp/~torarimon/?%C2%AC%C3%CF%B7%CF%3A+datum</a></p><h2 id="å„è¨€èªã‹ã‚‰PROJã‚’ç”¨ã„ã‚‹"><a href="#å„è¨€èªã‹ã‚‰PROJã‚’ç”¨ã„ã‚‹" class="headerlink" title="å„è¨€èªã‹ã‚‰PROJã‚’ç”¨ã„ã‚‹"></a>å„è¨€èªã‹ã‚‰PROJã‚’ç”¨ã„ã‚‹</h2><p>Javaï¼ˆ<a href="https://github.com/locationtech/proj4j">proj4j</a>ï¼‰, JavaScriptï¼ˆ<a href="https://github.com/proj4js/proj4js">proj4js</a>ï¼‰, Pythonï¼ˆ<a href="https://pyproj4.github.io/pyproj/stable/">pyproj</a>ï¼‰ãªã©æ§˜ã€…ãªè¨€èªã«ã‚ˆã‚‹ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><p>Goã®å ´åˆã¯å†’é ­ã§ã‚‚ç´¹ä»‹ã—ãŸ<a href="https://github.com/everystreet/go-proj">everystreet&#x2F;go-proj</a>ãŒãã‚Œã«ã‚ãŸã‚Šã¾ã™ã€‚</p><p>PROJã¯C++ã§å®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€cgoçµŒç”±ã§æ‰±ã†ãŸã‚ã€PROJç’°å¢ƒã‚’æ§‹ç¯‰ã—ãŸå¾Œã«ã€go-projã‹ã‚‰å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><h2 id="go-projã®åˆ©ç”¨é–‹å§‹"><a href="#go-projã®åˆ©ç”¨é–‹å§‹" class="headerlink" title="go-projã®åˆ©ç”¨é–‹å§‹"></a>go-projã®åˆ©ç”¨é–‹å§‹</h2><p>Windowsã¨WSL2ã§ã®æ§‹ç¯‰æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã™ã€‚Macã¯æ‰‹å…ƒã«ç„¡ã‹ã£ãŸã®ã§å‰²æ„›ã—ã¾ã™ã€‚</p><p>å…¨ä½“ã®æ³¨æ„ã§ã™ãŒã€2022.11.20æ™‚ç‚¹ã§PROJã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ <code>9.1.0</code> ã§ã™ãŒã€go-projã¯ <code>8.1.0</code> ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚8.1ç³»ã ã¨æœ€æ–°ãŒ <code>8.1.1</code> ãŒå­˜åœ¨ã™ã‚‹ã®ã§ã€ã“ã®è¨˜äº‹ã§ã¯ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚</p><p>PROJã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯<a href="https://proj.org/install.html#">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a> ã«ç´°ã‹ãæ‰‹é †ãŒè¼‰ã£ã¦ã„ã¾ã™ãŒã€<code>conda</code> çµŒç”±ã§è¡Œã„ã¾ã™ï¼ˆWSL2ã¯apt-getã‚‚è¿½è¨˜ã—ã¦ãŠãã¾ã™ï¼‰ã€‚</p><p>å„ç’°å¢ƒã‹ã‚‰ã¯æ¬¡ã®ã‚ˆã†ãªgo-projã‚’ç”¨ã„ãŸã‚³ãƒ¼ãƒ‰ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºã‹ã‚ã¾ã™ã€‚</p><figure class="highlight go"><figcaption><span>main.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/everystreet/go-proj/v8/proj&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/golang/geo/s1&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">wgsLng, wgsLat := Tky2Wgs(<span class="number">128542740</span>/<span class="type">float64</span>(<span class="number">60</span>*<span class="number">60</span>*<span class="number">256</span>), <span class="number">32706756</span>/<span class="type">float64</span>(<span class="number">60</span>*<span class="number">60</span>*<span class="number">256</span>))</span><br><span class="line">fmt.Printf(<span class="string">&quot;%f %f\n&quot;</span>, wgsLng, wgsLat) <span class="comment">// 139.474598 35.492354</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Tky2Wgs</span><span class="params">(lng, lat <span class="type">float64</span>)</span></span> (<span class="type">float64</span>, <span class="type">float64</span>) &#123;</span><br><span class="line">coord := proj.LP&#123;</span><br><span class="line">Lng: s1.Angle(lng),</span><br><span class="line">Lat: s1.Angle(lat),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err := proj.CRSToCRS(</span><br><span class="line"><span class="string">&quot;EPSG:4301&quot;</span>, <span class="comment">// æ—¥æœ¬æ¸¬åœ°ç³»(TOKYO) ç·¯åº¦çµŒåº¦</span></span><br><span class="line"><span class="string">&quot;EPSG:4326&quot;</span>, <span class="comment">// ä¸–ç•Œæ¸¬åœ°ç³»(WGS84) ç·¯åº¦çµŒåº¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(pj proj.Projection)</span></span> &#123;</span><br><span class="line">proj.TransformForward(pj, &amp;coord)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err) <span class="comment">// ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãªã®ã§panicã«ã—ã¦ã„ã¾ã™ãŒã€errorã‚’æˆ»ã‚Šå€¤ã«ã—ãŸæ–¹ãŒè‰¯ã„ã§ã™</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="type">float64</span>(coord.Lng), <span class="type">float64</span>(coord.Lat)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Windowsç’°å¢ƒæ§‹ç¯‰æ‰‹é †"><a href="#Windowsç’°å¢ƒæ§‹ç¯‰æ‰‹é †" class="headerlink" title="Windowsç’°å¢ƒæ§‹ç¯‰æ‰‹é †"></a>Windowsç’°å¢ƒæ§‹ç¯‰æ‰‹é †</h3><p><code>conda</code> ã¯ <code>miniconda</code> ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ç’°å¢ƒãŒãªã„æ–¹ã¯ä»¥ä¸‹ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãã ã•ã„ã€‚</p><ul><li><a href="https://docs.conda.io/en/latest/miniconda.html">https://docs.conda.io/en/latest/miniconda.html</a></li></ul><p>ã‚‚ã—ã€ãƒ—ãƒ­ã‚­ã‚·ç’°å¢ƒã§æ§‹ç¯‰ã™ã‚‹å ´åˆã¯ <code>%USERPROFILE%</code> ç›´ä¸‹ã« <code>.condarc</code> ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãƒ—ãƒ­ã‚­ã‚·æƒ…å ±ã‚’è¿½è¨˜ãã ã•ã„ã€‚</p><figure class="highlight yml"><figcaption><span>.condarc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">proxy_servers:</span></span><br><span class="line">    <span class="attr">http:</span> <span class="string">http://&#123;user&#125;:&#123;password&#125;@proxy.example.co.jp:8000</span></span><br><span class="line">    <span class="attr">https:</span> <span class="string">http://&#123;user&#125;:&#123;password&#125;@proxy.example.co.jp:8000</span></span><br></pre></td></tr></table></figure><p>â€» {password} ã«è¨˜å·ãŒå…¥ã£ã¦ã„ã‚‹äººã§ã€ä¸Šè¨˜ã§èªè¨¼ãŒé€šã‚‰ãªã„æ–¹ã¯ã€URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦è¨­å®šã—ã¦ã¿ã¦ãã ã•ã„</p><p>condaç’°å¢ƒãŒã§ããŸã‚‰ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; conda install -c conda-forge proj=8.2.1 proj-data=1.11.0</span><br></pre></td></tr></table></figure><p>æˆåŠŸã™ã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæˆåŠŸã—ã¦ã„ã‚‹ã‘ã©<code>proj</code>ã‚³ãƒãƒ³ãƒ‰ãŒå‹•ã‹ãªã„äººã¯ã€ <code>%USERPROFILE%\Miniconda3\Library\bin</code> ã‚’PATHã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;proj</span><br><span class="line">Rel. 8.2.1, January 1st, 2022</span><br><span class="line">usage: proj [-bdeEfiIlmorsStTvVwW [args]] [+opt[=arg] ...] [file ...]</span><br></pre></td></tr></table></figure><p>æ¬¡ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã€go get ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç’°å¢ƒå¤‰æ•°</span></span><br><span class="line">&gt; <span class="built_in">set</span> CGO_CFLAGS=-I%USERPROFILE%\Miniconda3\Library\include</span><br><span class="line">&gt; <span class="built_in">set</span> CGO_LDFLAGS=-L%USERPROFILE%\Miniconda3\Library\lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># go-projã®å–å¾—</span></span><br><span class="line">&gt; go get -u github.com/everystreet/go-proj/v8</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§å‹•ãã¨æ€ã„ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;go run main.go</span><br><span class="line">139.474598 35.492354</span><br></pre></td></tr></table></figure><p>ã‚‚ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã®ã§ã‚ã‚Œã°ã€Cã®ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã£ã¦ã„ãªã„ã¨ã„ã†ã“ã¨ã§ã™ã®ã§ã€ <code>CGO_CFLAGS</code> ã§æŒ‡å®šã—ã¦ã„ã‚‹ã€includeãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹ã‚’ç¢ºèªã—å†è¨­å®šãã ã•ã„ã€‚</p><figure class="highlight sh"><figcaption><span>å¤±æ•—ä¾‹1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># github.com/everystreet/go-proj/v8/cproj</span></span><br><span class="line">~\go\pkg\mod\github.com\everystreet\go-proj\v8@v8.0.0\cproj\cgo_helpers.go:8:10: fatal error: proj.h: No such file or directory</span><br><span class="line"> <span class="comment">#include &quot;proj.h&quot;</span></span><br><span class="line">          ^~~~~~~~</span><br><span class="line">compilation terminated.</span><br></pre></td></tr></table></figure><p>ã‚ã‚‹ã„ã¯ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ã€ <code>CGO_LDFLAGS</code> ã§è¨­å®šã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‘ã‚¹ã‚’ç¢ºèªã—å†è¨­å®šãã ã•ã„ã€‚</p><figure class="highlight sh"><figcaption><span>å¤±æ•—ä¾‹2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~\go\go1.19.1\pkg\tool\windows_amd64\link.exe: running gcc failed: <span class="built_in">exit</span> status 1</span><br><span class="line">C:/Program Files/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/8.1.0/../../../../x86_64-w64-mingw32/bin/ld.exe: cannot find -lproj</span><br><span class="line">...</span><br><span class="line">collect2.exe: error: ld returned 1 <span class="built_in">exit</span> status</span><br></pre></td></tr></table></figure><h2 id="WSL2ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †"><a href="#WSL2ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †" class="headerlink" title="WSL2ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †"></a>WSL2ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †</h2><h3 id="condaã‚’ä½¿ã†å ´åˆ"><a href="#condaã‚’ä½¿ã†å ´åˆ" class="headerlink" title="condaã‚’ä½¿ã†å ´åˆ"></a>condaã‚’ä½¿ã†å ´åˆ</h3><p>ã»ã¼Windowså´ã¨åŒã˜ã§ã™ã€‚miniconda3 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€PROJã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼†ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãŠã—ã¾ã„ã§ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># minicondaã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ—ãƒ­ã‚­ã‚·è¨­å®šã¯å‰²æ„›ï¼‰</span></span><br><span class="line">$ wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">$ bash Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># PATHã‚’é€šã™ï¼ˆã“ã®ä¾‹ã§ã¯ .bashrcã« export PATH=$PATH:~/miniconda3/bin ã‚’è¿½è¨˜ï¼‰</span></span><br><span class="line">$  ~/.bashrc</span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># PROJã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</span></span><br><span class="line">$ conda install -c conda-forge proj=8.2.1 proj-data=1.11.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># CGOã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š</span></span><br><span class="line">$ <span class="built_in">export</span> CGO_CFLAGS=-I<span class="variable">$&#123;HOME&#125;</span>/miniconda3/include</span><br><span class="line">$ <span class="built_in">export</span> CGO_LDFLAGS=-L<span class="variable">$&#123;HOME&#125;</span>/miniconda3/lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># go-projã®å–å¾—</span></span><br><span class="line">&gt; go get -u github.com/everystreet/go-proj/v8</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§go-projãŒå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go</span><br><span class="line">139.474598 35.492354</span><br></pre></td></tr></table></figure><h3 id="apt-ã‚’ä½¿ã†å ´åˆ"><a href="#apt-ã‚’ä½¿ã†å ´åˆ" class="headerlink" title="apt ã‚’ä½¿ã†å ´åˆ"></a>apt ã‚’ä½¿ã†å ´åˆ</h3><p><code>conda</code> ã‚’ä½¿ã„ãŸããªã„æ–¹å‘ã‘ã«æ‰‹é †ã‚’æ®‹ã—ã¦ãŠãã¾ã™ã€‚ã¾ãšã€å…¬å¼ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªãƒã‚¸ãƒˆãƒªã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹projãŒ6ç³»ã¨å¤ã„ãŸã‚ã€3rdãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã‹ã‚‰åˆ©ç”¨ã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠã—ã€é‹ç”¨ã—ã¦ã„ãŸã ã„ã¦ã„ã‚‹ã“ã¨ã«æ„Ÿè¬ã—ã¾ã™ã€‚</p><ul><li><a href="https://packages.ubuntu.com/jammy/amd64/libproj-dev/download">https://packages.ubuntu.com/jammy/amd64/libproj-dev/download</a></li></ul><p>ç§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ <code>proj.list</code> ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦è¿½åŠ ã—ã¾ã—ãŸã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/apt/sources.list.d/proj.list</span><br><span class="line">deb http://kr.archive.ubuntu.com/ubuntu jammy main universe</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§PROJã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ</span></span><br><span class="line">$ sudo apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># PROJ 8.2.1-1 ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™</span></span><br><span class="line"><span class="comment"># $ sudo apt-cache show libproj-dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</span></span><br><span class="line">$ sudo apt install proj-bin=8.2.1-1 libproj-dev=8.2.1-1</span><br></pre></td></tr></table></figure><p>ã“ã‚Œã§go-projãŒå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go</span><br><span class="line">139.474598 35.492354</span><br></pre></td></tr></table></figure><p>aptçµŒç”±ã®å ´åˆã¯ã€<code>libproj-dev</code> ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ <code>/usr/include</code> ã«ãƒ˜ãƒƒãƒ€ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ãŸã‚ã€CGOç³»ã®ãƒ•ãƒ©ã‚°ã¯è¨­å®šã—ãªãã¦ã‚‚å‹•ãã¨æ€ã„ã¾ã™ã€‚</p><h2 id="é«˜é€ŸåŒ–ã—ãŸã„å ´åˆ"><a href="#é«˜é€ŸåŒ–ã—ãŸã„å ´åˆ" class="headerlink" title="é«˜é€ŸåŒ–ã—ãŸã„å ´åˆ"></a>é«˜é€ŸåŒ–ã—ãŸã„å ´åˆ</h2><p><code>proj.CRSToCRS()</code> ã§ã™ãŒã€å‡¦ç†ä»¶æ•°ãŒå¤šã„å‡¦ç†ã«åˆ©ç”¨ã™ã‚‹ã¨ç‰©è¶³ã‚Šãªã„æ€§èƒ½ã§ã—ãŸï¼ˆ1å¤‰æ›ã«10msã»ã©ã‹ã‹ã‚Šã¾ã—ãŸï¼‰ã€‚ç†ç”±ã¯ã€C++å´ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«æ¸¬åœ°ç³»ã®ãƒ­ãƒ¼ãƒ‰ã‚’éƒ½åº¦è¡Œã†ãŸã‚ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚ãã®ãŸã‚ã€<code>proj.CRSToCRS()</code> ã‚’ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã®ã§ãªãã€ãã®å…§éƒ¨ã§åˆ©ç”¨ã—ã¦ã„ã‚‹ <code>cproj</code> ã‚’ç›´æ¥åˆ©ç”¨ã™ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p><p>ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã§ã™ï¼ˆâ€»ã¡ã‚ƒã‚“ã¨ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã—ãªã„ã‹ç¢ºã‹ã‚ã¦ã„ãªã„ã§ã™ï¼‰ã€‚ã“ã‚Œã§1000å€ãã‚‰ã„æ—©ããªã‚Šã¾ã—ãŸã€‚</p><figure class="highlight go"><figcaption><span>æ”¹è‰¯ç‰ˆ</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/everystreet/go-proj/v8/cproj&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/everystreet/go-proj/v8/proj&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/golang/geo/s1&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pj := NewProjection(<span class="string">&quot;EPSG:4301&quot;</span>, <span class="string">&quot;EPSG:4326&quot;</span>)</span><br><span class="line"><span class="keyword">defer</span> pj.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>*<span class="number">1000</span>; i++ &#123;</span><br><span class="line">wgsLng, wgsLat := pj.CRSToCRS(<span class="number">128542740</span>/<span class="type">float64</span>(<span class="number">60</span>*<span class="number">60</span>*<span class="number">256</span>), <span class="number">32706756</span>/<span class="type">float64</span>(<span class="number">60</span>*<span class="number">60</span>*<span class="number">256</span>))</span><br><span class="line">fmt.Printf(<span class="string">&quot;%f %f\n&quot;</span>, wgsLng, wgsLat)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Projection <span class="keyword">struct</span> &#123;</span><br><span class="line">ctx        *cproj.PJ_CONTEXT</span><br><span class="line">src        *cproj.PJ</span><br><span class="line">dst        *cproj.PJ</span><br><span class="line">pj         *cproj.PJ</span><br><span class="line">normalized *cproj.PJ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewProjection</span><span class="params">(source, target <span class="type">string</span>)</span></span> Projection &#123;</span><br><span class="line">ctx := cproj.Context_create()</span><br><span class="line">src := cproj.Create(ctx, source)</span><br><span class="line">dst := cproj.Create(ctx, target)</span><br><span class="line">pj := cproj.Create_crs_to_crs_from_pj(ctx, src, dst, <span class="literal">nil</span>, <span class="literal">nil</span>)</span><br><span class="line">normalized := cproj.Normalize_for_visualization(ctx, pj)</span><br><span class="line"><span class="keyword">return</span> Projection&#123;</span><br><span class="line">ctx:        ctx,</span><br><span class="line">src:        src,</span><br><span class="line">dst:        dst,</span><br><span class="line">pj:         pj,</span><br><span class="line">normalized: normalized,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Projection)</span></span> CRSToCRS(lng, lat <span class="type">float64</span>) (<span class="type">float64</span>, <span class="type">float64</span>) &#123;</span><br><span class="line">coord := proj.LP&#123;</span><br><span class="line">Lng: s1.Angle(lng),</span><br><span class="line">Lat: s1.Angle(lat),</span><br><span class="line">&#125;</span><br><span class="line">proj.TransformForward(p.normalized, &amp;coord)</span><br><span class="line"><span class="keyword">return</span> <span class="type">float64</span>(coord.Lng), <span class="type">float64</span>(coord.Lat)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Projection)</span></span> Close() &#123;</span><br><span class="line">cproj.Context_destroy(p.ctx)</span><br><span class="line">cproj.Destroy(p.src)</span><br><span class="line">cproj.Destroy(p.dst)</span><br><span class="line">cproj.Destroy(p.pj)</span><br><span class="line">cproj.Destroy(p.normalized)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Close()</code> å†…ã§ã˜ã‚ƒã‹ã˜ã‚ƒã‹ <code>Destroy()</code> ã—ã¦ã„ã‚‹ã®ã¯Cå´ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯Goå´ã§GCã•ã‚Œãªã„ãŸã‚ã§ã€è‡ªåˆ†ã§ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹æ”¾ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚</p><h2 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h2><p>Goã‹ã‚‰PROJã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ æ§‹ç¯‰ã¯ cgo ã‚’ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹æ–¹ã§ã‚ã‚Œã°ãƒãƒã‚‹ã“ã¨ã¯å°‘ãªã„ã¨æ€ã„ã¾ã™ãŒã€condaçµŒç”±ã ã¨CGOã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p><p>æ¸¬åœ°ç³»ã®å¤‰æ›ã‚’è¡Œã†ã‚±ãƒ¼ã‚¹ã¯ä¸€èˆ¬çš„ã«ã¯ã‚ã¾ã‚Šå¤šããªã„ã¨æ€ã„ã¾ã™ãŒã€ä½•ã‹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221129a/logo.png&quot; alt=&quot;&quot; width=&quot;250&quot; height=&quot;76&quot;&gt;

&lt;h2 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="Go" scheme="https://future-architect.github.io/tags/Go/"/>
    
    <category term="åœ°å›³" scheme="https://future-architect.github.io/tags/%E5%9C%B0%E5%9B%B3/"/>
    
    <category term="ç·¯åº¦çµŒåº¦" scheme="https://future-architect.github.io/tags/%E7%B7%AF%E5%BA%A6%E7%B5%8C%E5%BA%A6/"/>
    
    <category term="æ—¥æœ¬æ¸¬åœ°ç³»" scheme="https://future-architect.github.io/tags/%E6%97%A5%E6%9C%AC%E6%B8%AC%E5%9C%B0%E7%B3%BB/"/>
    
    <category term="ä¸–ç•Œæ¸¬åœ°ç³»" scheme="https://future-architect.github.io/tags/%E4%B8%96%E7%95%8C%E6%B8%AC%E5%9C%B0%E7%B3%BB/"/>
    
    <category term="Proj" scheme="https://future-architect.github.io/tags/Proj/"/>
    
  </entry>
  
  <entry>
    <title>æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã§sqlcã‚’å°å…¥ã—ã¦è‰¯ã‹ã£ãŸç‚¹ã¨ãƒãƒã£ãŸç‚¹</title>
    <link href="https://future-architect.github.io/articles/20221128a/"/>
    <id>https://future-architect.github.io/articles/20221128a/</id>
    <published>2022-11-27T15:00:00.000Z</published>
    <updated>2022-11-28T04:21:05.437Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221128a/logo.png" alt="" width="500" height="254"><h2 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h2><p>Technogoly Innovation Group è¾»ã§ã™ã€‚Go ã«ã¯ <a href="https://github.com/go-gorm/gorm">Gorm</a> ã‚„ <a href="https://github.com/volatiletech/sqlboiler">SQLBoiler</a> ã‚’ã¯ã˜ã‚ã¨ã—ã¦æ§˜ã€…ãª ORM ãŒã‚ã‚Šã¾ã™ã€‚2021 å¹´ã«ã¯å½“ç¤¾ã®ãƒ–ãƒ­ã‚°ã§ <a href="/articles/20210726a/">OR ãƒãƒƒãƒ‘ãƒ¼ã®é€£è¼‰</a>ã‚’è¡Œã£ãŸã“ã¨ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚çµ¶å¯¾çš„ãª ORM ãŒã‚ã‚‹ã‚ã‘ã§ã¯ãªãã€æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹æ€§ã‚„ãƒãƒ¼ãƒ æ§‹æˆãªã©ã«åˆã‚ã›ã¦ ORM ã‚’é¸æŠã™ã‚‹ã“ã¨ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚</p><p>ä»Šå›ã€ç§ãŸã¡ã®ãƒãƒ¼ãƒ ã§ã¯ã€ãƒãƒƒãƒå‡¦ç†ãŒä¸­å¿ƒçš„ãªæ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã«ãŠã„ã¦ Go ã® ORM ã« <a href="https://github.com/kyleconroy/sqlc">sqlc</a> ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚ç´ ã® SQL ã‚’æ›¸ã„ã¦ã„ããƒãƒ¼ãƒ ã®é–‹ç™ºæ–¹é‡<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>ã¨ãƒãƒƒãƒã—ã€é–‹ç™ºä½“é¨“ã¯éå¸¸ã«è‰¯ã‹ã£ãŸã§ã™ã€‚ä¸€æ–¹ã€æ¯ã‚Œãã£ã¦ã¯ã„ãªã„ ORM ã§ã¯ã‚ã‚Šã¾ã™ã€‚ã„ãã¤ã‹æƒ³å®šå¤–ã®æŒ™å‹•ãŒç™ºç”Ÿã— GitHub ã® Issue ã‚’è¦‹ãªãŒã‚‰å•é¡Œã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚</p><p>ã“ã‚Œã‹ã‚‰ sqlc ã‚’å°å…¥ã—ã¦ã¿ã‚ˆã†ã‹ãªã€ã¨è€ƒãˆã¦ã„ã‚‹æ–¹ã€…ã®å‚è€ƒã«ãªã‚Œã°ã¨æ€ã„ã€sqlc ã‚’æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã«å°å…¥ã—ã¦ã¿ã¦è‰¯ã‹ã£ãŸç‚¹ã¨ãƒãƒã£ãŸç‚¹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚</p><p>ãªãŠæœ¬è¨˜äº‹ã§ã¯ sqlc ã®æ¦‚è¦ã¯æ‰±ã„ã¾ã›ã‚“ã€‚ãã‚‚ãã‚‚ sqlc ã£ã¦ä½•ï¼Ÿã£ã¦æ–¹ã¯ sqlc ã®ä½œè€…ãŒæ›¸ã„ãŸ<a href="https://conroy.org/introducing-sqlc">è¨˜äº‹</a>ã‚„ OR ãƒãƒƒãƒ‘ãƒ¼é€£è¼‰ã§ç´¹ä»‹ã—ãŸ<a href="https://future-architect.github.io/articles/20210804a/">ã“ã¡ã‚‰</a>ã®è¨˜äº‹ã‚’è¦‹ã¦ã¿ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚</p><p>ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ä»¥ä¸‹ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ PostgreSQL ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</p><ul><li>PostgreSQL 13.7</li><li>Go 1.19</li><li>sqlc 1.15.0</li></ul><h2 id="è‰¯ã‹ã£ãŸç‚¹"><a href="#è‰¯ã‹ã£ãŸç‚¹" class="headerlink" title="è‰¯ã‹ã£ãŸç‚¹"></a>è‰¯ã‹ã£ãŸç‚¹</h2><h3 id="1-SQL-ã®é–‹ç™ºã«é›†ä¸­ã§ãã‚‹"><a href="#1-SQL-ã®é–‹ç™ºã«é›†ä¸­ã§ãã‚‹" class="headerlink" title="1. SQL ã®é–‹ç™ºã«é›†ä¸­ã§ãã‚‹"></a>1. SQL ã®é–‹ç™ºã«é›†ä¸­ã§ãã‚‹</h3><p>sqlc ã‚’ä½¿ã†ä¸€ç•ªã®ãƒ¡ãƒªãƒƒãƒˆã¯ SQL ã®é–‹ç™ºã«é›†ä¸­ã§ãã‚‹ã“ã¨ã§ã™ã€‚SQL ã®å®Ÿè£…ä»¥å¤–ã®é¢å€’ãªã“ã¨ã¯ sqlc ãŒã‚„ã£ã¦ãã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®æµã‚Œã§é–‹ç™ºã§ãã¾ã™ã€‚</p><ul><li>SQL ã‚’æ›¸ã</li><li><code>sqlc generate</code> ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã™ã‚‹</li><li>ç”Ÿæˆã•ã‚ŒãŸ API ã‚’ Go ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å‘¼ã³å‡ºã™</li></ul><p>sqlc ã‚’ä½¿ã†ã¨ã€SQL ã‹ã‚‰ã€SQL ã®çµæœã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã‚‹æ§‹é€ ä½“ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ API ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚ç”Ÿæˆã•ã‚Œã‚‹æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹ã¯ SQL ã®çµæœã«å¿œã˜ã¦ã€é©åˆ‡ã«é¸æŠã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ãƒã‚¤ãƒ³ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ SQL ã«å€¤ã‚’æ¸¡ã™å ´åˆã‚‚ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãŸã‚ã®æ§‹é€ ä½“ã¨ãã®æ§‹é€ ä½“ã‚’ API ã«æ¸¡ã›ã‚‹ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ§‹é€ ä½“ã«å€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã ã‘ã§ã‚ˆãã€æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒã‚§ãƒƒã‚¯ã§ãã¾ã™ã€‚</p><p>ã‚¯ã‚¨ãƒªã®çµæœã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ Go ã®æ§‹é€ ä½“ã‚’ä½œæˆã—ãŸã‚Šã€ãƒã‚¤ãƒ³ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é †ç•ªã‚„ãƒ‡ãƒ¼ã‚¿å‹ã‚’æ³¨æ„æ·±ãç¢ºèªã—ãŸã‚Šã€ã‚¯ã‚¨ãƒªã‚’ç™ºè¡Œã™ã‚‹ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ãŸã‚Šã™ã‚‹ã“ã¨ã¯å¿…è¦ã¯ãªããªã‚Šã¾ã™ã€‚</p><h3 id="2-ãƒ•ã‚¡ã‚¤ãƒ«ç”ŸæˆãŒé«˜é€Ÿã§ã‚ã‚‹"><a href="#2-ãƒ•ã‚¡ã‚¤ãƒ«ç”ŸæˆãŒé«˜é€Ÿã§ã‚ã‚‹" class="headerlink" title="2. ãƒ•ã‚¡ã‚¤ãƒ«ç”ŸæˆãŒé«˜é€Ÿã§ã‚ã‚‹"></a>2. ãƒ•ã‚¡ã‚¤ãƒ«ç”ŸæˆãŒé«˜é€Ÿã§ã‚ã‚‹</h3><p>sqlc ã¯ãƒ•ã‚¡ã‚¤ãƒ«ç”ŸæˆãŒé«˜é€Ÿã§ã™ã€‚æ•°åã® SQL ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã®ã« 1 ç§’ã‚‚ã‹ã‹ã‚Šã¾ã›ã‚“<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>ã€‚é«˜é€Ÿãªç†ç”±ã® 1 ã¤ã¯ sqlc ã§ã¯ã‚³ãƒ¼ãƒ‰ç”Ÿæˆæ™‚ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¿…è¦ã¨ã—ãªã„ãŸã‚ã§ã™<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>ã€‚SQL ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¯ã‚¨ãƒªã®çµæœã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã‚‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ sqlc ã®ä»–ã« <a href="https://github.com/xo/xo">xo&#x2F;xo</a> ãªã©ãŒã‚ã‚Šã¾ã™<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>ã€‚ãŸã ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã¨ãã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã«ãªã‚Šã€ç”Ÿæˆã«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒã‹ã‹ã‚Šã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã¯ä½•åº¦ã‚‚å®Ÿè¡Œã™ã‚‹ãŸã‚ã€ãã®æ“ä½œãŒé«˜é€Ÿã§ã‚ã‚‹ã“ã¨ã¯åœ°å‘³ãªãŒã‚‰éå¸¸ã«å¬‰ã—ã„ãƒã‚¤ãƒ³ãƒˆã§ã—ãŸã€‚</p><h3 id="3-è‡ªç„¶ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã§ãã‚‹"><a href="#3-è‡ªç„¶ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã§ãã‚‹" class="headerlink" title="3. è‡ªç„¶ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã§ãã‚‹"></a>3. è‡ªç„¶ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã§ãã‚‹</h3><p>è‡ªç„¶ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã§ãã€sqlc ãŒç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’é•å’Œæ„Ÿãªãåˆ©ç”¨ã§ãã¾ã—ãŸã€‚ç‰¹ã«ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«é–¢ã—ã¦ <code>$1</code>, <code>$2</code> ãªã©ã¨ã—ãŸã¨ãã«ã€ç”Ÿæˆã•ã‚Œã‚‹ Go ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ åã«å¿œã˜ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¨ãªã‚Šã¾ã™ã€‚ãŸã¨ãˆã°ä»¥ä¸‹ã® <code>users</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ INSERT ã™ã‚‹ SQL ã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯ <code>NewUser()</code> ã¨ <code>NewUserParams</code> ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- name: NewUser :exec</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (</span><br><span class="line">    id,</span><br><span class="line">    first_name,</span><br><span class="line">    last_name,</span><br><span class="line">    age,</span><br><span class="line">) <span class="keyword">VALUES</span> ($<span class="number">1</span>, $<span class="number">2</span>, $<span class="number">3</span>, $<span class="number">4</span>);</span><br></pre></td></tr></table></figure><p><code>ID</code> ã‚„ <code>FirstName</code> ã¨ã„ã£ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’æŒã¤æ§‹é€ ä½“ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NewUserParams <span class="keyword">struct</span> &#123;</span><br><span class="line">ID        <span class="type">int32</span></span><br><span class="line">FirstName <span class="type">string</span></span><br><span class="line">LastName  sql.NullString</span><br><span class="line">Age       <span class="type">int32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queries)</span></span> NewUser(ctx context.Context, arg NewUserParams) <span class="type">error</span> &#123;</span><br><span class="line">_, err := q.db.ExecContext(ctx, newUser,</span><br><span class="line">arg.ID,</span><br><span class="line">arg.FirstName,</span><br><span class="line">arg.LastName,</span><br><span class="line">arg.Age,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã¾ãŸã€å¿…è¦ã«å¿œã˜ã¦ SQL ä¸Šã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ sqlc å›ºæœ‰ã®ç‰¹æ®Šãªæ§‹æ–‡ã‚’ä½¿ã„ã€ <code>@my_first_name</code> ãªã©ã¨è¨˜è¿°ã—ã¦ã€ç”Ÿæˆã•ã‚Œã‚‹ Go ã®ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’æ›¸ãæ›ãˆã‚‰ã‚Œã¾ã™<sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup>ã€‚<code>$1</code> ãªã©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç”Ÿæˆã§ãã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«é•å’Œæ„ŸãŒã‚ã‚‹å ´åˆã¯ <code>@xxxx</code> ã‚’ä½¿ã£ã¦ä»»æ„ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«æ›¸ãæ›ãˆã‚‰ã‚Œã‚‹æŸ”è»Ÿã•ã‚‚è‰¯ã‹ã£ãŸã§ã™ã€‚</p><ul><li>è£œè¶³äº‹é …</li></ul><p>ãªãŠã€ãƒãƒ¼ãƒ é–‹ç™ºã§å°å…¥ã™ã‚‹å ´åˆã¯ã‚ã‚‰ã‹ã˜ã‚å‘½åè¦ç´„ã‚’æ±ºã‚ã¦ãŠã„ãŸã»ã†ãŒè‰¯ã„ã§ã™ã€‚</p><p>API åã¯ SQL ã®ã‚³ãƒ¡ãƒ³ãƒˆã§è¨˜è¼‰ã—ãŸå‘½åãŒä½¿ã‚ã‚Œã¾ã™ã€‚ä¸Šã®ä¾‹ã§ã¯ <code>-- name: NewUser</code> ã¨ã—ã¦ã„ã‚‹ <code>NewUser</code> ãŒ API åã‚„æ§‹é€ ä½“åã«ä½¿ã‚ã‚Œã¾ã™ã€‚<code>NewUser</code>, <code>CreateUser</code> ã‚ã‚‹ã„ã¯ <code>InsertUser</code> ãªã©ã¨é¸æŠã™ã‚‹ä½™åœ°ãŒã‚ã‚Šã€é–‹ç™ºè€…é–“ã§æºã‚Œã‚‹ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚</p><h3 id="4-ç”Ÿæˆã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã®ç¨®é¡ãŒè±Šå¯Œã§ã‚ã‚‹"><a href="#4-ç”Ÿæˆã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã®ç¨®é¡ãŒè±Šå¯Œã§ã‚ã‚‹" class="headerlink" title="4. ç”Ÿæˆã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã®ç¨®é¡ãŒè±Šå¯Œã§ã‚ã‚‹"></a>4. ç”Ÿæˆã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã®ç¨®é¡ãŒè±Šå¯Œã§ã‚ã‚‹</h3><p><code>database/sql</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® <code>ExecContext()</code> ã‚„ <code>QueryContext()</code>ã€<code>QueryRowContext()</code> ã‚’ä½¿ã£ã¦ SQL ã‚’å®Ÿè¡Œã§ãã‚‹ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã§ãã¾ã™ã€‚ã¾ãŸ PostgreSQL å°‚ç”¨ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§ã‚ã‚‹ <code>pgx</code> ã®æ©Ÿèƒ½ã‚’ä½¿ã£ãŸãƒãƒƒãƒå‡¦ç†å¯èƒ½ãªã‚³ãƒ¼ãƒ‰ã‚‚ç”Ÿæˆã§ãã¾ã™ã€‚ã•ã‚‰ã« <code>Copy</code> ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ã£ãŸé«˜é€Ÿãªãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼ãŒã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã‚‚ç”Ÿæˆã§ãã¾ã™ã€‚æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã§ã¯ 10 ä¸‡ï½100 ä¸‡ã¨ã„ã£ãŸã‚ªãƒ¼ãƒ€ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã“ã¨ã‚‚ã‚ã£ãŸãŸã‚ã€ãƒãƒƒãƒå‡¦ç†ã‚„ <code>Copy</code> ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã“ã¨ã¯éå¸¸ã«å¬‰ã—ã„ã§ã™ã€‚</p><p>ç”Ÿæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ <code>sqlc</code> ã®ã‚¯ã‚¨ãƒªã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã§ãã¾ã™ã€‚è©³ã—ãã¯ <a href="https://docs.sqlc.dev/en/stable/reference/query-annotations.html">Query annotations</a> ãªã©ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><h3 id="5-ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŸ”è»Ÿã«å¤‰æ›´ã§ãã‚‹"><a href="#5-ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŸ”è»Ÿã«å¤‰æ›´ã§ãã‚‹" class="headerlink" title="5. ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŸ”è»Ÿã«å¤‰æ›´ã§ãã‚‹"></a>5. ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŸ”è»Ÿã«å¤‰æ›´ã§ãã‚‹</h3><p>ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŸ”è»Ÿã«è¨­å®šã§ãã‚‹ç‚¹ã‚‚ä¾¿åˆ©ã§ã™ã€‚</p><p>ãŸã¨ãˆã°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã« <code>pgx</code> ã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ã PostgreSQL ã® <code>numeric</code> å‹ã®ã‚«ãƒ©ãƒ ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ <code>pgtype.Numeric</code> å‹ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—èª¤å·®ã‚’è¨±å®¹ã—ã¦ <code>float64</code> å‹ã§æ‰±ã„ãŸã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã—ãŸ<sup id="fnref:6"><a href="#fn:6" rel="footnote">6</a></sup>ã€‚</p><p>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã® <code>overrides</code> æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ã§ç”Ÿæˆã•ã‚Œã‚‹å‹ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚ä¸Šè¨˜ã®ã‚±ãƒ¼ã‚¹ã§ã‚ã‚Œã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜è¿°ã‚’ YAML ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã—ã¾ã™ã€‚</p><figure class="highlight yaml"><figcaption><span>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® numeric å‹ã‚’ Go ã® sql.NullFloat64 å‹ã§ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‚ˆã†ã«æ›´æ–°ã™ã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">overrides:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">db_type:</span> <span class="string">&quot;pg_catalog.numeric&quot;</span></span><br><span class="line">    <span class="attr">go_type:</span> <span class="string">&quot;database/sql.NullFloat64&quot;</span></span><br><span class="line">    <span class="attr">nullable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">db_type:</span> <span class="string">&quot;pg_catalog.numeric&quot;</span></span><br><span class="line">    <span class="attr">go_type:</span> <span class="string">&quot;float64&quot;</span></span><br></pre></td></tr></table></figure><h3 id="6-è¤‡æ•°ã®é–‹ç™ºè¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹"><a href="#6-è¤‡æ•°ã®é–‹ç™ºè¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹" class="headerlink" title="6. è¤‡æ•°ã®é–‹ç™ºè¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹"></a>6. è¤‡æ•°ã®é–‹ç™ºè¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹</h3><p>2022&#x2F;11 ç¾æ™‚ç‚¹ã§ã¯ã¾ã ãƒ™ãƒ¼ã‚¿ç‰ˆã§ã™ãŒã€å®Ÿã¯ sqlc ã¯ Go ä»¥å¤–ã«ã‚‚ Python ã‚„ Kotlin ã¨ã„ã£ãŸè¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™<sup id="fnref:7"><a href="#fn:7" rel="footnote">7</a></sup>ã€‚ã€ŒSQL ã‚’æ›¸ã„ã¦ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã—ã€ãã®ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã™ã€ã¨ã„ã†é–‹ç™ºä½“é¨“ã¯è¨€èªã‚’å•ã‚ãšã€åŒã˜ã§ã™ã€‚ç§ãŸã¡ã®ãƒãƒ¼ãƒ ã§ã¯ä¸»ã« Go ã§ã®é–‹ç™ºãŒãƒ¡ã‚¤ãƒ³ã§ã—ãŸã€‚ãŸã ã€ã„ãã¤ã‹å°ã•ãªãƒãƒƒãƒæ©Ÿèƒ½ã‚’ Python ã§å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ sqlc ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã‚¹ãƒ ãƒ¼ã‚ºã«é–‹ç™ºã§ãã¾ã—ãŸã€‚</p><p>sqlc ã®ä½œè€…ã¯ <code>protoc</code> ã®ã‚ˆã†ãªå¤šè¨€èªã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚’ç›®çš„ã® 1 ã¤ã¨ã—ã¦ã„ã‚‹ã€ã¨è¨€ã£ã¦ã„ã¾ã™ã€‚TypeScript ã‚„ Rust ãªã©ã®è¨€èªã‚‚å°†æ¥çš„ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ˆ<a href="https://github.com/kyleconroy/sqlc/issues/296">#296</a>ï¼‰ã€‚</p><h3 id="7-1SQL-ãƒ•ã‚¡ã‚¤ãƒ«ã«è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’æ›¸ã„ã¦ã‚‚è‰¯ã„"><a href="#7-1SQL-ãƒ•ã‚¡ã‚¤ãƒ«ã«è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’æ›¸ã„ã¦ã‚‚è‰¯ã„" class="headerlink" title="7. 1SQL ãƒ•ã‚¡ã‚¤ãƒ«ã«è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’æ›¸ã„ã¦ã‚‚è‰¯ã„"></a>7. 1SQL ãƒ•ã‚¡ã‚¤ãƒ«ã«è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’æ›¸ã„ã¦ã‚‚è‰¯ã„</h3><p>1SQL ãƒ•ã‚¡ã‚¤ãƒ«ã« 1 ã‚¯ã‚¨ãƒªã€ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒç‰¹ã«åˆ¶ç´„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚1SQL ãƒ•ã‚¡ã‚¤ãƒ«ã«è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’æ›¸ã„ã¦ã‚‚è‰¯ã„ã§ã™ã€‚ãŸã¨ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ã« CRUD ã‚’ 1SQL ãƒ•ã‚¡ã‚¤ãƒ«ã«é›†ç´„ã—ã¦ã‚‚ã€å„ SQL ã«ç´ã¥ã API ãŒç”Ÿæˆã§ãã¾ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- name: GetAll :many</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: NewUser :exec</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (</span><br><span class="line">    id,</span><br><span class="line">    first_name,</span><br><span class="line">    last_name,</span><br><span class="line">    age,</span><br><span class="line">    shoe_size,</span><br><span class="line">    shirt_size</span><br><span class="line">) <span class="keyword">VALUES</span></span><br><span class="line">($<span class="number">1</span>, $<span class="number">2</span>, $<span class="number">3</span>, $<span class="number">4</span>, $<span class="number">5</span>, $<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: UpdateSizes :exec</span></span><br><span class="line"><span class="keyword">UPDATE</span> users</span><br><span class="line"><span class="keyword">SET</span> shoe_size <span class="operator">=</span> $<span class="number">2</span>, shirt_size <span class="operator">=</span> $<span class="number">3</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> $<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: DeleteBySize :exec</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">WHERE</span> shoe_size <span class="operator">=</span> $<span class="number">1</span> <span class="keyword">AND</span> shirt_size <span class="operator">=</span> $<span class="number">2</span>;</span><br></pre></td></tr></table></figure><h2 id="ãƒãƒã£ãŸç‚¹"><a href="#ãƒãƒã£ãŸç‚¹" class="headerlink" title="ãƒãƒã£ãŸç‚¹"></a>ãƒãƒã£ãŸç‚¹</h2><p>sqlc ã¯ç´ æ™´ã‚‰ã—ã„ ORM ã§ã™ãŒã€é–‹ç™ºä¸­ã«ã„ãã¤ã‹ãƒãƒã‚Šã©ã“ã‚ãŒã‚ã‚Šã¾ã—ãŸã€‚ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãŒå¤§ãã‹ã£ãŸé †ã«è¨˜è¼‰ã—ã¾ã™ã€‚</p><h3 id="1-æœ‰åŠ¹ãª-SQL-ã«ã‚‚ã‹ã‹ã‚ã‚‰ãš-sqlc-ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ããªã„ã“ã¨ãŒã‚ã‚‹"><a href="#1-æœ‰åŠ¹ãª-SQL-ã«ã‚‚ã‹ã‹ã‚ã‚‰ãš-sqlc-ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ããªã„ã“ã¨ãŒã‚ã‚‹" class="headerlink" title="1. æœ‰åŠ¹ãª SQL ã«ã‚‚ã‹ã‹ã‚ã‚‰ãš sqlc ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ããªã„ã“ã¨ãŒã‚ã‚‹"></a>1. æœ‰åŠ¹ãª SQL ã«ã‚‚ã‹ã‹ã‚ã‚‰ãš sqlc ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ããªã„ã“ã¨ãŒã‚ã‚‹</h3><p>åŸºæœ¬çš„ã«ã¯ PostgreSQL ã§å®Ÿè¡Œã§ãã‚‹ SQL ã¯ã™ã¹ã¦ sqlc ã§æ‰±ãˆã¾ã™ã€‚ã—ã‹ã—ã€ã„ãã¤ã‹ã® SQL ã¯ PostgreSQL ä¸Šã¯æœ‰åŠ¹ã«ã‚‚é–¢ã‚ã‚‰ãšã€sqlc ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ããªã„å ´åˆã¯ãã® SQL ã‚’ sqlc ã§ã¯ä½¿ã‚ãªã„ã‚ˆã†ã«æ›¸ãæ›ãˆã™ã‚‹ã€ã‚ã‚‹ã„ã¯ sqlc ã‚’çµŒç”±ã›ãš <code>database/sql</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® API ã‹ã‚‰ç›´æ¥ SQL ã‚’å‘¼ã³å‡ºã™ãªã©ã®å›é¿ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>å‚è€ƒã¾ã§ã« sqlc ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ããªã„ SQL ã®ä¾‹ã‚’ã‚ã’ã¾ã™ã€‚</p><ul><li>ä¾‹ï¼‘ï¼šUPDATE å¥ã§ JOIN ã‚’ä½¿ã†å ´åˆï¼ˆ<a href="https://github.com/kyleconroy/sqlc/issues/1100">#1100</a>ï¼‰</li></ul><p>ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä¸€ç•ªå½±éŸ¿ãŒã‚ã‚Šã¾ã—ãŸã€‚<code>JOIN</code> ã¨ <code>UPDATE</code> ãŒåŒæ™‚ã«ã§ããªã„ãŸã‚ã€<code>JOIN</code> ã—ã¦æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã‚’ <code>SELECT</code> ã™ã‚‹ã‚¯ã‚¨ãƒªã¨ <code>UPDATE</code> ã™ã‚‹ã‚¯ã‚¨ãƒªã® 2 ã¤ã«åˆ†å‰²ã—ã¦å¯¾å‡¦ã—ã¾ã—ãŸã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span></span><br><span class="line">group_calc_totals gct</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">npn <span class="operator">=</span> nem.npn</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">producer_group_attribute ga</span><br><span class="line"><span class="keyword">JOIN</span></span><br><span class="line">npn_external_map nem</span><br><span class="line"><span class="keyword">ON</span>ga.npn_external_map_id <span class="operator">=</span> nem.id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">gct.group_id <span class="operator">=</span> ga.group_id;</span><br></pre></td></tr></table></figure><ul><li>ä¾‹ï¼’ï¼šã‚µãƒ–ã‚¯ã‚¨ãƒªã¨ <code>AS</code>, <code>GROUP</code> å¥ã‚’ä½¿ã†å ´åˆï¼ˆ<a href="https://github.com/kyleconroy/sqlc/issues/1886">#1886</a>ï¼‰</li></ul><p>ä»¥ä¸‹ã®ã‚ˆã†ãª SQL ã‚‚ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">s.id <span class="keyword">AS</span> &quot;s_id&quot;</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">spam.id</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">spam</span><br><span class="line">  ) <span class="keyword">AS</span> &quot;s&quot;</span><br><span class="line"><span class="comment">-- ä»¥ä¸‹ã‚’ s.id ã«å¤‰æ›´ã™ã‚Œã°æ©Ÿèƒ½ã™ã‚‹</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s_id;</span><br></pre></td></tr></table></figure><h3 id="2-ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹æ§‹é€ ä½“ã®å‹ãŒ-NULL-ã«ãªã‚Šã†ã‚‹å ´åˆã§ã‚‚-NULL-ã‚’è¨±å®¹ã—ãªã„å‹ã§ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹"><a href="#2-ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹æ§‹é€ ä½“ã®å‹ãŒ-NULL-ã«ãªã‚Šã†ã‚‹å ´åˆã§ã‚‚-NULL-ã‚’è¨±å®¹ã—ãªã„å‹ã§ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹" class="headerlink" title="2. ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹æ§‹é€ ä½“ã®å‹ãŒ NULL ã«ãªã‚Šã†ã‚‹å ´åˆã§ã‚‚ NULL ã‚’è¨±å®¹ã—ãªã„å‹ã§ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹"></a>2. ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹æ§‹é€ ä½“ã®å‹ãŒ NULL ã«ãªã‚Šã†ã‚‹å ´åˆã§ã‚‚ NULL ã‚’è¨±å®¹ã—ãªã„å‹ã§ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹</h3><p>ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ è‡ªä½“ã¯ NOT NULL åˆ¶ç´„ãŒã‚ã‚‹ãŒã€SQL ã®æ¡ä»¶ã«ã‚ˆã£ã¦ NULL ã«ãªã‚Šã†ã‚‹ã‚±ãƒ¼ã‚¹ã§ã™ï¼ˆ<a href="https://github.com/kyleconroy/sqlc/issues/1208">#1208</a>ï¼‰ã€‚ã“ã®ã‚±ãƒ¼ã‚¹ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãšã€å®Ÿè¡Œæ™‚ã«ã‚«ãƒ©ãƒ ã®å€¤ãŒ NULL ã«ãªã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p><p>ãŸã¨ãˆã°ä»¥ä¸‹ã® <code>one</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã® <code>name</code> ã‚«ãƒ©ãƒ ã¯ NOT NULL åˆ¶ç´„ãŒä»˜ä¸ã•ã‚Œã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã‚µãƒ–ã‚¯ã‚¨ãƒªã® WHERE å¥ã®æ¡ä»¶ã«è©²å½“ã—ãªã„å ´åˆã¯ SELECT ã§ãã‚‹çµæœãŒ NULL ã«ãªã‚Šãˆã¾ã™ã€‚ã“ã®ã‚ˆã†ãªæ¡ä»¶ä¸‹ã§ã‚‚ sqlc ã¯ NOT NULL ãªã‚«ãƒ©ãƒ ã¨ã—ã¦æ§‹é€ ä½“ã‚’ç”Ÿæˆã—ã¾ã™ã€‚æœŸå¾…ã¨ã—ã¦ã¯ <code>sql.NullInt32</code> å‹ã¨ã—ã¦ NULL ã‚’è¨±å®¹ã•ã‚Œã‚‹å‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æƒ³å®šã—ã¾ã™ãŒã€å®Ÿéš›ã«ã¯ <code>int32</code> ã¨ NULL ãªå€¤ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã§ããªã„å‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">one</span> (</span><br><span class="line">id <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">otherfield TEXT,</span><br><span class="line">name <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">otherfield,</span><br><span class="line">(<span class="keyword">SELECT</span> o.id <span class="keyword">FROM</span> <span class="keyword">one</span> o <span class="keyword">WHERE</span> one.name <span class="operator">=</span> <span class="string">&#x27;foo&#x27;</span> LIMIT <span class="number">1</span>) <span class="keyword">AS</span> &quot;id&quot;</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">one</span>;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TestRow <span class="keyword">struct</span> &#123;</span><br><span class="line">Otherfield sql.NullString</span><br><span class="line">ID         <span class="type">int32</span>    <span class="comment">// æœ¬å½“ã¯ sql.NullInt32 ã«ãªã£ã¦ã»ã—ã„!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-IN-å¥ã«è¤‡æ•°ã®å€¤ã‚’æ¸¡ã›ãªã„"><a href="#3-IN-å¥ã«è¤‡æ•°ã®å€¤ã‚’æ¸¡ã›ãªã„" class="headerlink" title="3. IN å¥ã«è¤‡æ•°ã®å€¤ã‚’æ¸¡ã›ãªã„"></a>3. IN å¥ã«è¤‡æ•°ã®å€¤ã‚’æ¸¡ã›ãªã„</h3><p><code>IN</code> å¥ã§è¤‡æ•°ã®å€¤ã‚’æ¸¡ã—ã¦ã€è¤‡æ•°ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã™ã‚‹ã‚¯ã‚¨ãƒªã¯ä¸€èˆ¬çš„ã§ã™ãŒ sqlc ã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã™ã‚‹å ´åˆã¯æŠ€å·§ãŒå¿…è¦ã«ãªã‚Šã¾ã™ï¼ˆ<a href="https://github.com/kyleconroy/sqlc/issues/77">#77</a>, <a href="https://github.com/kyleconroy/sqlc/issues/167">#167</a>ï¼‰ã€‚ãŸã¨ãˆã° <code>authors</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã„ãã¤ã‹ã® <code>id</code> ã«ãƒãƒƒãƒã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã™ã‚‹ã‚¯ã‚¨ãƒªã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- name: ListAuthorsByIDs :many</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> authors</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">IN</span> ($<span class="number">1</span>)</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>ã“ã®ã‚ˆã†ãªã‚¯ã‚¨ãƒªã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹ Go ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ <code>string</code> ã®å˜ä¸€ã®å€¤ã¯æ¸¡ã›ã¾ã™ãŒè¤‡æ•°ã® ID ã‚’å«ã‚“ã  <code>[]string</code> ã®å€¤ã¯æ¸¡ã›ã¾ã›ã‚“ã€‚ç”Ÿæˆã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚·ã‚°ãƒãƒãƒ£ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ListAuthorsByIDs(ctx context.Context, id <span class="type">string</span>) ([]Author, <span class="type">error</span>)</span><br></pre></td></tr></table></figure><p>å¯¾å‡¦æ–¹æ³•ã¨ã—ã¦ã€ã‚¯ã‚¨ãƒªã‚’ä»¥ä¸‹ã®ã‚ˆã†ã« <code>ANY</code> å¥<sup id="fnref:8"><a href="#fn:8" rel="footnote">8</a></sup>ã‚’ä½¿ã†ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> authors</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="keyword">ANY</span>(<span class="variable">@ids</span>::<span class="type">VARCHAR</span>[]);</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>ä¸Šè¨˜ã®ã‚ˆã†ãª SQL ã‹ã‚‰ã¯ä»¥ä¸‹ã®ã‚·ã‚°ãƒãƒãƒ£ã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã§ãã€ã¾ãŸè¤‡æ•°ã®å€¤ã«ãƒãƒƒãƒã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã§ãã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ListAuthorsByIDs(ctx context.Context, ids []<span class="type">string</span>) ([]Author, <span class="type">error</span>)</span><br></pre></td></tr></table></figure><h3 id="4-é›†è¨ˆé–¢æ•°ã®çµæœã‚„-CASE-å¥ã®å€¤ãŒ-interface-å‹ã«ãªã‚‹"><a href="#4-é›†è¨ˆé–¢æ•°ã®çµæœã‚„-CASE-å¥ã®å€¤ãŒ-interface-å‹ã«ãªã‚‹" class="headerlink" title="4. é›†è¨ˆé–¢æ•°ã®çµæœã‚„ CASE å¥ã®å€¤ãŒ interface{} å‹ã«ãªã‚‹"></a>4. é›†è¨ˆé–¢æ•°ã®çµæœã‚„ CASE å¥ã®å€¤ãŒ interface{} å‹ã«ãªã‚‹</h3><p><code>MIN()</code> ã‚„ <code>MAX()</code>, <code>SUM()</code> ã¨ã„ã£ãŸé›†è¨ˆé–¢æ•°ã®çµæœã¯ã€å¼•æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã§ã¯ãªã <code>interface&#123;&#125;</code> å‹ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã¾ã™ã€‚</p><p>ãŸã¨ãˆã°ä»¥ä¸‹ã® <code>MIN</code> ã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹ã§ã¯ <code>int32</code> å‹ã§ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€<code>interface&#123;&#125;</code> å‹ã«ãªã‚Šã¾ã™ï¼ˆ<a href="https://github.com/kyleconroy/sqlc/issues/1574">#1574</a>ï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sales (</span><br><span class="line">id SERIAL <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">vat <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="built_in">MIN</span>(vat) <span class="keyword">AS</span> vatpence</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">sales;</span><br></pre></td></tr></table></figure><p>ã“ã†ã—ãŸã‚±ãƒ¼ã‚¹ã§ã¯æ˜ç¤ºçš„ã« SQL ã§å‹ã‚­ãƒ£ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ã§å›é¿ã§ãã¾ã™ã€‚ä¸Šè¨˜ã®ã‚±ãƒ¼ã‚¹ã§ã‚ã‚Œã° <code>::INTEGER</code> ã‚ã‚‹ã„ã¯ <code>CAST(MIN(vat) AS INTEGER)</code> ã¨æ˜ç¤ºã™ã‚‹ã“ã¨ã§ Go ã§ã¯ <code>int32</code> å‹ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã¾ã™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="built_in">MIN</span>(vat)::<span class="type">INTEGER</span> <span class="keyword">AS</span> vatpence</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">sales;</span><br></pre></td></tr></table></figure><p>CASE å¥ã‚’æ‰±ã†å ´åˆã‚‚åŒæ§˜ã« <code>interface&#123;&#125;</code> å‹ã¨ãªã‚‹ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦å‹ã‚­ãƒ£ã‚¹ãƒˆã‚’ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚</p><h3 id="5-DDL-ãŒæ‰±ãˆãªã„"><a href="#5-DDL-ãŒæ‰±ãˆãªã„" class="headerlink" title="5. DDL ãŒæ‰±ãˆãªã„"></a>5. DDL ãŒæ‰±ãˆãªã„</h3><p>sqlc ã¯ 1.15.0 ã§ã¯ DDL ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ï¼ˆ<a href="https://github.com/kyleconroy/sqlc/issues/1661">#1661</a>ï¼‰ã€‚è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ SQL ã§å®Ÿè£…ã—ã¦ã„ã‚‹ã¨ãã«ã€å‡¦ç†ã®ä¸­é–“çµæœã‚’ä¸€æ™‚è¡¨ã«ä¿æŒã—ãŸã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã« <code>CREATE TEMPORARY TABLE ...</code> ã¨ã—ã¦ä¸€æ™‚è¡¨ã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒ sqlc ã§ã¯ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã‚Œã¯ <code>pgx</code> ã® <code>Exec()</code> ã‹ã‚‰ç›´æ¥ã‚¯ã‚¨ãƒªã‚’ç™ºè¡Œã—ã¦å¯¾å‡¦ã—ã¾ã—ãŸã€‚</p><h2 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h2><p>æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã« sqlc ã‚’å°å…¥ã—ã¦è‰¯ã‹ã£ãŸç‚¹ã¨ãƒãƒã£ãŸç‚¹ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚ç´ ã® SQL ã‚’æ›¸ããŸã„ã‚±ãƒ¼ã‚¹ã§ã¯éå¸¸ã«è‰¯ã„ ORM ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚Go ã® ORM ã®é¸æŠã«è¿·ã£ã¦ã„ã‚‹æ–¹ã®å‚è€ƒã«ãªã‚Œã°å¬‰ã—ã„ã§ã™ã€‚</p><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="vertical-align: top; padding-right: 10px;">1.</span><span style="vertical-align: top;">æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã§ã¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’ SQL ã«å¯„ã›ã‚‹ã“ã¨ã‚‚å¤šãã€è¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ JOIN ã—ãŸã‚Šã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã‚’ä½¿ã£ã¦å‡¦ç†ã‚’ã—ãŸã‚Šãªã©ã€SQL ãŒè¤‡é›‘ã«ãªã‚ŠãŒã¡ã§ã™ã€‚è¤‡é›‘ãª SQL ã¯ ORM ã®ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼API ã‚’ä½¿ã£ã¦ã‚¯ã‚¨ãƒªã‚’çµ„ã¿ç«‹ã¦ã‚‹ã®ã§ã¯ãªãã€æ‰‹æ›¸ãã§å®Ÿè£…ã—ãŸã„ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã§ã™ã€‚ãŸã¨ãˆã° ORM ã« Gorm ã‚’ä½¿ã£ã¦ã„ãŸã¨ã—ã¦ã‚‚ <a href="https://pkg.go.dev/github.com/jinzhu/gorm#DB.Raw">Raw()</a> ã‚’ä½¿ã‚ã–ã‚‹ã‚’å¾—ãªã„ã€ã‚ã‚‹ã„ã¯ä½¿ã„ãŸã„ã‚±ãƒ¼ã‚¹ãŒå¤šãã‚ã‚Šã¾ã—ãŸã€‚</span><a href="#fnref:1" rev="footnote"> â†©</a></li><li id="fn:2"><span style="vertical-align: top; padding-right: 10px;">2.</span><span style="vertical-align: top;">ç”Ÿæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰é‡ã¯ 1 ãƒ•ã‚¡ã‚¤ãƒ«ã«å«ã¾ã‚Œã‚‹ SQL ã®æ•°ã«ã‚‚ã‚ˆã‚‹ãŸã‚ã€ã‚ãã¾ã§ç›®å®‰ã§ã™ã€‚</span><a href="#fnref:2" rev="footnote"> â†©</a></li><li id="fn:3"><span style="vertical-align: top; padding-right: 10px;">3.</span><span style="vertical-align: top;">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã—ãªã„ã«ã‚‚é–¢ã‚ã‚‰ãšå‹å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã§ãã‚‹ã®ã¯ç†ç”±ã¯ã€sqlc ãŒ C è¨€èªã§æ›¸ã‹ã‚ŒãŸæœ¬ç‰©ã® PostgreSQL ã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ¼ã‚µã‚’ Go ã‹ã‚‰å‘¼ã³å‡ºã—ã€ãƒ‘ãƒ¼ã‚¹ã•ã‚ŒãŸãƒ„ãƒªãƒ¼ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚</span><a href="#fnref:3" rev="footnote"> â†©</a></li><li id="fn:4"><span style="vertical-align: top; padding-right: 10px;">4.</span><span style="vertical-align: top;"><code>xo</code> ã¯ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã«æ™‚é–“ãŒã‹ã‹ã‚‹ã ã‘ã§ãªãã€ç”Ÿæˆã§ãã‚‹ã‚³ãƒ¼ãƒ‰ãŒç§ãŸã¡ã®æ±‚ã‚ã‚‹æ©Ÿèƒ½/éæ©Ÿèƒ½è¦ä»¶ã¨åˆã‚ãªã‹ã£ãŸãŸã‚ã€æ¡ç”¨ã‚’è¦‹é€ã‚Šã¾ã—ãŸã€‚</span><a href="#fnref:4" rev="footnote"> â†©</a></li><li id="fn:5"><span style="vertical-align: top; padding-right: 10px;">5.</span><span style="vertical-align: top;"><a href="https://docs.sqlc.dev/en/stable/howto/named_parameters.html?highlight=Named%20parameter#naming-parameters">https://docs.sqlc.dev/en/stable/howto/named_parameters.html?highlight=Named parameter#naming-parameters</a></span><a href="#fnref:5" rev="footnote"> â†©</a></li><li id="fn:6"><span style="vertical-align: top; padding-right: 10px;">6.</span><span style="vertical-align: top;"><code>pgtype.Numeric</code> å‹ã¯ <code>big.Int</code> å‹ã®å€¤ã‚’ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å«ã‚“ã§ãŠã‚Šã€æµ®å‹•å°æ•°ç‚¹æ¼”ç®—ã®èª¤å·®ãŒè¨±ã•ã‚Œãªã„å ´åˆã§ã¯ã€ã“ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ä½¿ã†ã“ã¨ã¯å¦¥å½“ã§ã™ã€‚ä¸€æ–¹ã€æ•°å€¤è¨ˆç®—ãŒ <code>float64</code> ã®ã‚ˆã†ãª <code>+</code>, <code>-</code>, <code>/</code>, <code>*</code> ã§ã§ãã¾ã›ã‚“ã€‚API ã‚’ä½¿ã£ã¦æ¼”ç®—ã—ã¾ã™ãŒã€ã‚³ãƒ¼ãƒ‰ãŒèª­ã¿ã¥ã‚‰ãã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒé›£ã—ããªã‚‹ç‚¹ãŒãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦ã‚ã‚Šã¾ã™ã€‚</span><a href="#fnref:6" rev="footnote"> â†©</a></li><li id="fn:7"><span style="vertical-align: top; padding-right: 10px;">7.</span><span style="vertical-align: top;"><a href="https://docs.sqlc.dev/en/stable/reference/language-support.html?highlight=beta#database-and-language-support">https://docs.sqlc.dev/en/stable/reference/language-support.html?highlight=beta#database-and-language-support</a></span><a href="#fnref:7" rev="footnote"> â†©</a></li><li id="fn:8"><span style="vertical-align: top; padding-right: 10px;">8.</span><span style="vertical-align: top;"><code>ANY</code> å¥ã¯ <code>SOME</code> å¥ã§ã‚‚ã‚ˆã„ã§ã™ã€‚<a href="https://www.postgresql.jp/document/13/html/functions-comparisons.html">https://www.postgresql.jp/document/13/html/functions-comparisons.html</a></span><a href="#fnref:8" rev="footnote"> â†©</a></li></ol></div></div>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221128a/logo.png&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;254&quot;&gt;

&lt;h2 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="DB" scheme="https://future-architect.github.io/categories/DB/"/>
    
    
    <category term="SQL" scheme="https://future-architect.github.io/tags/SQL/"/>
    
    <category term="Go" scheme="https://future-architect.github.io/tags/Go/"/>
    
    <category term="ORM" scheme="https://future-architect.github.io/tags/ORM/"/>
    
    <category term="sqlc" scheme="https://future-architect.github.io/tags/sqlc/"/>
    
  </entry>
  
  <entry>
    <title>Language Server Protocolã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º (å¾Œç·¨)</title>
    <link href="https://future-architect.github.io/articles/20221125a/"/>
    <id>https://future-architect.github.io/articles/20221125a/</id>
    <published>2022-11-24T15:00:00.000Z</published>
    <updated>2022-11-25T02:40:45.671Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ã€Futureã§ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚’ã—ã¦ã„ã‚‹å·æ¸•ã§ã™ã€‚</p><p><a href="/articles/20221124a/">å‰ç·¨</a>ã§ã¯LSPã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¨ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã‚’è¡Œã„ã¾ã—ãŸã€‚</p><p>å¾Œç·¨ã§ã¯å‰ç·¨ã§è§£èª¬ã—ãŸ<a href="https://github.com/microsoft/vscode-extension-samples/tree/main/lsp-sample">lsp-sample</a>ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</p><h1 id="èª¬æ˜ã™ã‚‹ã“ã¨"><a href="#èª¬æ˜ã™ã‚‹ã“ã¨" class="headerlink" title="èª¬æ˜ã™ã‚‹ã“ã¨"></a>èª¬æ˜ã™ã‚‹ã“ã¨</h1><ul><li>ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã®è¿½åŠ æ–¹æ³•</li><li>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ™‚ã«å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã®è¿½åŠ æ–¹æ³•</li><li>ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã®è¿½åŠ æ–¹æ³•</li></ul><h1 id="èª¬æ˜ã—ãªã„ã“ã¨"><a href="#èª¬æ˜ã—ãªã„ã“ã¨" class="headerlink" title="èª¬æ˜ã—ãªã„ã“ã¨"></a>èª¬æ˜ã—ãªã„ã“ã¨</h1><ul><li>ä¸Šè¨˜ä»¥å¤–ã®æ©Ÿèƒ½ã®è¿½åŠ æ–¹æ³•</li></ul><h1 id="ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ "><a href="#ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ " class="headerlink" title="ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ "></a>ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ </h1><p>lsp-sampleã§ã¯å…¨ã¦å¤§æ–‡å­—ã€ã‹ã¤2æ–‡å­—ä»¥ä¸Šã®å˜èªã«å¯¾ã—ã¦è­¦å‘Šã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã—ãŸã€‚ãã®å˜èªã‚’å°æ–‡å­—ã«è‡ªå‹•ä¿®æ­£ã™ã‚‹ã‚¯ã‚¤ãƒƒã‚¯ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚</p><h2 id="å®Ÿè£…-server-ts"><a href="#å®Ÿè£…-server-ts" class="headerlink" title="å®Ÿè£… (server.ts)"></a>å®Ÿè£… (server.ts)</h2><p>server.tsã«ä»¥ä¸‹ã®importã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  /* ç•¥ */</span><br><span class="line"><span class="addition">+ CodeAction,</span></span><br><span class="line"><span class="addition">+ TextEdit,</span></span><br><span class="line"><span class="addition">+ TextDocumentEdit,</span></span><br><span class="line"><span class="addition">+ CodeActionKind,</span></span><br><span class="line">&#125; from &quot;vscode-languageserver/node&quot;;</span><br></pre></td></tr></table></figure><p><code>connection.onInitialize</code>ã®<code>result</code>ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  const result: InitializeResult = &#123;</span><br><span class="line">    capabilities: &#123;</span><br><span class="line">      textDocumentSync: TextDocumentSyncKind.Incremental,</span><br><span class="line">      // Tell the client that this server supports code completion.</span><br><span class="line">      completionProvider: &#123;</span><br><span class="line">        resolveProvider: true,</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="addition">+     // ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</span></span><br><span class="line"><span class="addition">+     codeActionProvider: true,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹<code>onCodeAction()</code>ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">connection.<span class="title function_">onCodeAction</span>(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">only</span>: <span class="built_in">string</span> | <span class="literal">undefined</span> =</span><br><span class="line">    params.<span class="property">context</span>.<span class="property">only</span> != <span class="literal">null</span> &amp;&amp; params.<span class="property">context</span>.<span class="property">only</span>.<span class="property">length</span> &gt; <span class="number">0</span></span><br><span class="line">      ? params.<span class="property">context</span>.<span class="property">only</span>[<span class="number">0</span>]</span><br><span class="line">      : <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç¨®é¡ãŒã‚¯ã‚¤ãƒƒã‚¯ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§ãªã„å ´åˆã¯ã‚¢ãƒ¼ãƒªãƒ¼ãƒªã‚¿ãƒ¼ãƒ³</span></span><br><span class="line">  <span class="keyword">if</span> (only !== <span class="title class_">CodeActionKind</span>.<span class="property">QuickFix</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ã“ã®æ‹¡å¼µæ©Ÿèƒ½ãŒç”Ÿæˆã—ãŸè­¦å‘Šã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹</span></span><br><span class="line">  <span class="comment">// lsp-sampleã§ç”Ÿæˆã—ãŸè­¦å‘Šã®ç™ºè¡Œå…ƒã¯&quot;ex&quot;ã§ã‚ã‚‹ã®ã§ã“ã‚Œã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</span></span><br><span class="line">  <span class="keyword">const</span> diagnostics = params.<span class="property">context</span>.<span class="property">diagnostics</span>.<span class="title function_">filter</span>(</span><br><span class="line">    <span class="function">(<span class="params">diag</span>) =&gt;</span> diag.<span class="property">source</span> === <span class="string">&quot;ex&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// uriã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—</span></span><br><span class="line">  <span class="keyword">const</span> textDocument = documents.<span class="title function_">get</span>(params.<span class="property">textDocument</span>.<span class="property">uri</span>);</span><br><span class="line">  <span class="keyword">if</span> (textDocument == <span class="literal">null</span> || diagnostics.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">codeActions</span>: <span class="title class_">CodeAction</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å„è­¦å‘Šã«å¯¾ã—ã¦å‡¦ç†</span></span><br><span class="line">  diagnostics.<span class="title function_">forEach</span>(<span class="function">(<span class="params">diag</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> title = <span class="string">&quot;Fix to lower case&quot;</span>;</span><br><span class="line">    <span class="comment">// è­¦å‘Šç¯„å›²ã®ãƒ†ã‚­ã‚¹ãƒˆã€ã¤ã¾ã‚Šå¤§æ–‡å­—ã®ã¿ã§æ§‹æˆã•ã‚ŒãŸå˜èªã‚’å–å¾—</span></span><br><span class="line">    <span class="keyword">const</span> originalText = textDocument.<span class="title function_">getText</span>(diag.<span class="property">range</span>);</span><br><span class="line">    <span class="comment">// è­¦å‘Šç¯„å›²ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å°æ–‡å­—ã«å¤‰æ›ã—ãŸã‚‚ã®ã«ç½®æ›ã™ã‚‹å‡¦ç†ã®ç”Ÿæˆ</span></span><br><span class="line">    <span class="keyword">const</span> edits = [<span class="title class_">TextEdit</span>.<span class="title function_">replace</span>(diag.<span class="property">range</span>, originalText.<span class="title function_">toLowerCase</span>())];</span><br><span class="line">    <span class="keyword">const</span> editPattern = &#123;</span><br><span class="line">      <span class="attr">documentChanges</span>: [</span><br><span class="line">        <span class="title class_">TextDocumentEdit</span>.<span class="title function_">create</span>(</span><br><span class="line">          &#123; <span class="attr">uri</span>: textDocument.<span class="property">uri</span>, <span class="attr">version</span>: textDocument.<span class="property">version</span> &#125;,</span><br><span class="line">          edits</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ</span></span><br><span class="line">    <span class="keyword">const</span> fixAction = <span class="title class_">CodeAction</span>.<span class="title function_">create</span>(</span><br><span class="line">      title,</span><br><span class="line">      editPattern,</span><br><span class="line">      <span class="title class_">CodeActionKind</span>.<span class="property">QuickFix</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨è­¦å‘Šã‚’é–¢é€£ä»˜ã‘ã‚‹</span></span><br><span class="line">    fixAction.<span class="property">diagnostics</span> = [diag];</span><br><span class="line">    codeActions.<span class="title function_">push</span>(fixAction);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> codeActions;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å‹•ä½œç¢ºèª"><a href="#å‹•ä½œç¢ºèª" class="headerlink" title="å‹•ä½œç¢ºèª"></a>å‹•ä½œç¢ºèª</h2><p>è¨ºæ–­ã«ã€Œåˆ©ç”¨ã§ãã‚‹ã‚¯ã‚¤ãƒƒã‚¯ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã€ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚</p><img src="/images/20221125a/codeAction.drawio.png" alt="codeAction.drawio.png" width="1200" height="230" loading="lazy"><p>ã‚¯ã‚¤ãƒƒã‚¯ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãã®å˜èªãŒå°æ–‡å­—ã«è‡ªå‹•ã§ä¿®æ­£ã•ã‚Œã¾ã™ã€‚</p><img src="/images/20221125a/toLower.gif" alt="toLower.gif" width="1200" height="675" loading="lazy"><h1 id="ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ™‚ã«å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ "><a href="#ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ™‚ã«å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ " class="headerlink" title="ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ™‚ã«å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ "></a>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ™‚ã«å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ </h1><p>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨<code>Formatting has been executed. (linecount: $&#123;è¡Œæ•°&#125;)</code>ã¨ã„ã†æ–‡å­—åˆ—ãŒãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«æŒ¿å…¥ã•ã‚Œã‚‹æ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã™ã€‚</p><h2 id="å®Ÿè£…-server-ts-1"><a href="#å®Ÿè£…-server-ts-1" class="headerlink" title="å®Ÿè£… (server.ts)"></a>å®Ÿè£… (server.ts)</h2><p>server.tsã«ä»¥ä¸‹ã®importã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  /* ç•¥ */</span><br><span class="line"><span class="addition">+ Position</span></span><br><span class="line">&#125; from &quot;vscode-languageserver/node&quot;;</span><br></pre></td></tr></table></figure><p><code>connection.onInitialize</code>ã®<code>result</code>ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  const result: InitializeResult = &#123;</span><br><span class="line">    capabilities: &#123;</span><br><span class="line">      textDocumentSync: TextDocumentSyncKind.Incremental,</span><br><span class="line">      // Tell the client that this server supports code completion.</span><br><span class="line">      completionProvider: &#123;</span><br><span class="line">        resolveProvider: true,</span><br><span class="line">      &#125;,</span><br><span class="line">      // ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</span><br><span class="line">      codeActionProvider: true,</span><br><span class="line"><span class="addition">+     // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</span></span><br><span class="line"><span class="addition">+     documentFormattingProvider: true,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹<code>onDocumentFormatting()</code>ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">connection.<span class="title function_">onDocumentFormatting</span>(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// uriã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—</span></span><br><span class="line">  <span class="keyword">const</span> textDocument = documents.<span class="title function_">get</span>(params.<span class="property">textDocument</span>.<span class="property">uri</span>);</span><br><span class="line">  <span class="keyword">if</span> (textDocument == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¡Œæ•°ã‚’å–å¾—</span></span><br><span class="line">  <span class="keyword">const</span> lineCount = textDocument.<span class="property">lineCount</span>;</span><br><span class="line">  <span class="comment">// æŒ¿å…¥ã™ã‚‹æ–‡å­—åˆ—</span></span><br><span class="line">  <span class="keyword">const</span> insertText = <span class="string">`save successful!(lineCount: <span class="subst">$&#123;lineCount&#125;</span>)\n`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [<span class="title class_">TextEdit</span>.<span class="title function_">insert</span>(<span class="title class_">Position</span>.<span class="title function_">create</span>(<span class="number">0</span>, <span class="number">0</span>), insertText)];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å‹•ä½œç¢ºèª-1"><a href="#å‹•ä½œç¢ºèª-1" class="headerlink" title="å‹•ä½œç¢ºèª"></a>å‹•ä½œç¢ºèª</h2><p>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨Formatting has been executed. (linecount: ${è¡Œæ•°})ã¨ã„ã†æ–‡å­—åˆ—ãŒãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«æŒ¿å…¥ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚<br><img src="/images/20221125a/format.gif" alt="format.gif" width="1200" height="675" loading="lazy"></p><h1 id="ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ "><a href="#ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ " class="headerlink" title="ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ "></a>ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ </h1><p>ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨é¸æŠç¯„å›²ãŒåè»¢ã™ã‚‹æ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã™ã€‚é¸æŠç¯„å›²ãŒãªã„å ´åˆã¯ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’åè»¢ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã—ã¾ã™ã€‚</p><h2 id="å¤§ã¾ã‹ãªå‡¦ç†ã®æµã‚Œ"><a href="#å¤§ã¾ã‹ãªå‡¦ç†ã®æµã‚Œ" class="headerlink" title="å¤§ã¾ã‹ãªå‡¦ç†ã®æµã‚Œ"></a>å¤§ã¾ã‹ãªå‡¦ç†ã®æµã‚Œ</h2><p>ä»Šå›å®Ÿè£…ã™ã‚‹å‡¦ç†ã«ã¯ã€ç·¨é›†ä¸­ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æƒ…å ±ã€ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ã®é¸æŠç¯„å›²ã®æƒ…å ±ãŒå¿…è¦ã§ã™ãŒã€ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæƒ…å ±ã«ã¯ãã®ã‚ˆã†ãªæƒ…å ±ãŒãªãã€ã‚µãƒ¼ãƒå´ã§å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã›ã‚“ã€‚<br>ãã®ãŸã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘ã€å¿…è¦ãªè¿½åŠ æƒ…å ±ã‚’ã‚µãƒ¼ãƒã«é€ã‚‹ã“ã¨ã§å®Ÿè£…ã—ã¾ã™ã€‚<br>(ã€Œã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã€ã¨ã„ã†æƒ…å ±ã®ã¿ãŒå¿…è¦ãªå ´åˆã¯è¿½åŠ æƒ…å ±ã‚’é€ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚)</p><img src="/images/20221125a/shori_(1).png" alt="" width="1200" height="223" loading="lazy"><p>GitHubã«ä¸ŠãŒã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ãŸã¨ã“ã‚ã€2é€šã‚Šã®å®Ÿè£…æ–¹æ³•ã‚’è¦‹ã¤ã‘ãŸã®ã§ä¸¡æ–¹ç´¹ä»‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚</p><p>å‚è€ƒã«ã—ãŸãƒªãƒã‚¸ãƒˆãƒª:</p><ul><li>å®Ÿè£…1: <a href="https://github.com/microsoft/vscode-eslint">vscode-eslint</a> (<a href="https://github.com/microsoft/vscode-eslint/blob/4b92c12af15d41f76417bde9571cb56f08ec3d0f/client/src/client.ts#L330-L347">è©²å½“ç®‡æ‰€</a>)</li><li>å®Ÿè£…2: <a href="https://github.com/microsoft/vscode-extension-samples/tree/main/lsp-user-input-sample">lsp-user-input-sample</a> (<a href="https://github.com/microsoft/vscode-extension-samples/blob/ddae6c0c9ff203b4ed6f6b43bfacdd0834215f83/lsp-user-input-sample/client/src/extension.ts#L23-L33">è©²å½“ç®‡æ‰€</a>)</li></ul><p>ä¸¡æ–¹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ãŠã„ã¦è©²å½“ç®‡æ‰€ã‚’<a href="https://github.com/dbaeumer">dbaeumerã•ã‚“</a>(VSCodeã®LSPã®ä¸­ã®äºº)ã¨ã„ã†æ–¹ãŒæ›¸ã„ã¦ã„ã‚‹ã®ã§ã€ã©ã¡ã‚‰ã®å®Ÿè£…æ–¹æ³•ã‚‚æ­£ã—ã„ã¨æ€ã„ã¾ã™ã€‚(é©åˆ‡ãªä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦ã¯èª¿æŸ»ã—ã¾ã—ãŸãŒã‚ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã—ã‚ã‹ã‚‹æ–¹ãŒã„ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ã€‚)</p><h2 id="package-jsonã®å¤‰æ›´"><a href="#package-jsonã®å¤‰æ›´" class="headerlink" title="package.jsonã®å¤‰æ›´"></a>package.jsonã®å¤‰æ›´</h2><p>lsp-sample.reveseã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã®å¤‰æ›´ã¯2ã¤ã®å®Ÿè£…ã§å…±é€šã§ã™ã€‚</p><p>ã¾ãšã€package.jsonã®activationEventsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã€lsp-sample.reverseã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸå ´åˆã‚‚æ‹¡å¼µæ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  &quot;activationEvents&quot;: [</span><br><span class="line">    &quot;onLanguage:plaintext&quot;,</span><br><span class="line"><span class="addition">+   &quot;onCommand:lsp-sample.reverse&quot;</span></span><br><span class="line">  ],</span><br></pre></td></tr></table></figure><p>æ¬¡ã«ã€contributesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã€ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰lsp-sample.reverseã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚<br>VSCodeä¸Šã§ã¯titleã«å…¥åŠ›ã—ãŸæ–‡å­—åˆ—ãŒã‚³ãƒãƒ³ãƒ‰åã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  &quot;contributes&quot;: &#123;</span><br><span class="line"><span class="addition">+   &quot;commands&quot;: [</span></span><br><span class="line"><span class="addition">+     &#123;</span></span><br><span class="line"><span class="addition">+       &quot;command&quot;: &quot;lsp-sample.reverse&quot;,</span></span><br><span class="line"><span class="addition">+       &quot;title&quot;: &quot;reverse text&quot;</span></span><br><span class="line"><span class="addition">+     &#125;</span></span><br><span class="line"><span class="addition">+   ],</span></span><br></pre></td></tr></table></figure><h2 id="å®Ÿè£…1-ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚³ãƒãƒ³ãƒ‰ã‚’é€ã‚Šç›´ã™å®Ÿè£…"><a href="#å®Ÿè£…1-ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚³ãƒãƒ³ãƒ‰ã‚’é€ã‚Šç›´ã™å®Ÿè£…" class="headerlink" title="å®Ÿè£…1: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚³ãƒãƒ³ãƒ‰ã‚’é€ã‚Šç›´ã™å®Ÿè£…"></a>å®Ÿè£…1: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚³ãƒãƒ³ãƒ‰ã‚’é€ã‚Šç›´ã™å®Ÿè£…</h2><h3 id="å‡¦ç†ã®æµã‚Œ"><a href="#å‡¦ç†ã®æµã‚Œ" class="headerlink" title="å‡¦ç†ã®æµã‚Œ"></a>å‡¦ç†ã®æµã‚Œ</h3><p>å®Ÿè£…1ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚µãƒ¼ãƒã¸ã‚³ãƒãƒ³ãƒ‰ã‚’é€ã‚Šç›´ã™ã“ã¨ã§å®Ÿè£…ã—ã¾ã™ã€‚</p><ol><li>ãƒ¦ãƒ¼ã‚¶ãŒã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã§lsp-sample.reverseã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹</li><li>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å®Ÿè¡Œã‚’æ¤œçŸ¥ã—ã€ã‚µãƒ¼ãƒã«lsp-sample.executeReverseã‚³ãƒãƒ³ãƒ‰ã¨ä»¥ä¸‹ã®æƒ…å ±ã‚’é€ä¿¡ã™ã‚‹<ul><li>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ‡ã‚£ã‚¿ãŒç·¨é›†ä¸­ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®URI(è­˜åˆ¥å­)</li><li>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ‡ã‚£ã‚¿ãŒç·¨é›†ä¸­ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³</li><li>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ã®é¸æŠç¯„å›²</li></ul></li><li>lsp-sample.executeCommandã‚’æ¤œçŸ¥ã—ãŸã‚µãƒ¼ãƒã¯ã€å—ã‘å–ã£ãŸæƒ…å ±ã‚’åŸºã«é¸æŠç¯„å›²ã‚’åè»¢ã™ã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹</li></ol><h3 id="å®Ÿè£…-extension-ts"><a href="#å®Ÿè£…-extension-ts" class="headerlink" title="å®Ÿè£… (extension.ts)"></a>å®Ÿè£… (extension.ts)</h3><p>lsp-sample.reverseã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘å–ã£ãŸéš›ã«lsp-sample.executeReverseã‚³ãƒãƒ³ãƒ‰ã¨é¸æŠç¯„å›²ãªã©ã®æƒ…å ±ã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p><p>ã¾ãšä»¥ä¸‹ã®importã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>extension.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  workspace,</span><br><span class="line">  ExtensionContext,</span><br><span class="line"><span class="addition">+ window,</span></span><br><span class="line"><span class="addition">+ commands</span></span><br><span class="line">&#125; from &quot;vscode&quot;;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">  LanguageClient,</span><br><span class="line">  LanguageClientOptions,</span><br><span class="line">  ServerOptions,</span><br><span class="line">  TransportKind,</span><br><span class="line"><span class="addition">+ ExecuteCommandRequest,</span></span><br><span class="line">&#125; from &quot;vscode-languageclient/node&quot;;</span><br></pre></td></tr></table></figure><p>æ‹¡å¼µæ©Ÿèƒ½ã®èµ·å‹•æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°<code>activate()</code>ã®<code>client.start()</code>ã®ç›´å‰ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>extension.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reverseå®Ÿè¡Œæ™‚ã«serverã«executeReverseã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã™ã‚‹</span></span><br><span class="line">context.<span class="property">subscriptions</span>.<span class="title function_">push</span>(</span><br><span class="line">  commands.<span class="title function_">registerCommand</span>(<span class="string">&quot;lsp-sample.reverse&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> uri = <span class="variable language_">window</span>.<span class="property">activeTextEditor</span>.<span class="property">document</span>.<span class="property">uri</span>;</span><br><span class="line">    <span class="keyword">const</span> version = <span class="variable language_">window</span>.<span class="property">activeTextEditor</span>.<span class="property">document</span>.<span class="property">version</span>;</span><br><span class="line">    <span class="keyword">const</span> selections = <span class="variable language_">window</span>.<span class="property">activeTextEditor</span>.<span class="property">selections</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> client.<span class="title function_">sendRequest</span>(<span class="title class_">ExecuteCommandRequest</span>.<span class="property">type</span>, &#123;</span><br><span class="line">      <span class="attr">command</span>: <span class="string">&quot;lsp-sample.executeReverse&quot;</span>,</span><br><span class="line">      <span class="attr">arguments</span>: [uri, version, selections],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ã“ã®å®Ÿè£…ã«ã‚ˆã£ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§lsp-sample.reverseãŒå®Ÿè¡Œã•ã‚ŒãŸéš›ã«ã‚µãƒ¼ãƒã«lsp-sample.executeReverseã‚³ãƒãƒ³ãƒ‰ã¨ã€uriã€é¸æŠç¯„å›²ã‚’é€ä¿¡ã™ã‚‹å‡¦ç†ãŒå®Ÿç¾ã§ãã¾ã—ãŸã€‚</p><h3 id="å®Ÿè£…-server-ts-2"><a href="#å®Ÿè£…-server-ts-2" class="headerlink" title="å®Ÿè£… (server.ts)"></a>å®Ÿè£… (server.ts)</h3><p>lsp-sample.executeReverseã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘å–ã£ãŸéš›ã«å¼•æ•°æƒ…å ±ã‚’åŸºã«é¸æŠç¯„å›²ã‚’åè»¢ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p><p>ã¾ãšä»¥ä¸‹ã®importã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  /* ç•¥ */</span><br><span class="line"><span class="addition">+ Range</span></span><br><span class="line">&#125; from &quot;vscode-languageserver/node&quot;;</span><br></pre></td></tr></table></figure><p>ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹<code>onExecuteCommand()</code>ã‚’è¿½åŠ ã—ã¾ã™ã€‚<br>ã“ã“ã§é€ä¿¡ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å–å¾—ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸€è‡´ã™ã‚‹ã‹ã©ã†ã‹ç¢ºèªã™ã‚‹ã“ã¨ã§ã€éåŒæœŸå‡¦ç†ä¸­ã®å¤‰æ›´ã«ã‚ˆã‚‹å‡¦ç†ã®ã‚ºãƒ¬ã‚’é˜²ã„ã§ã„ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«è¡Œã†å‡¦ç†</span></span><br><span class="line">connection.<span class="title function_">onExecuteCommand</span>(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// lsp-sample.executeReverseã‚³ãƒãƒ³ãƒ‰ã§ãªã„å ´åˆã¯ã‚¢ãƒ¼ãƒªãƒ¼ãƒªã‚¿ãƒ¼ãƒ³</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    params.<span class="property">command</span> !== <span class="string">&quot;lsp-sample.executeReverse&quot;</span> ||</span><br><span class="line">    params.<span class="property">arguments</span> == <span class="literal">null</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> uri = params.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">external</span>;</span><br><span class="line">  <span class="comment">// uriã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—</span></span><br><span class="line">  <span class="keyword">const</span> textDocument = documents.<span class="title function_">get</span>(uri);</span><br><span class="line">  <span class="keyword">if</span> (textDocument == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´ã®å ´åˆã¯ã‚¢ãƒ¼ãƒªãƒ¼ãƒªã‚¿ãƒ¼ãƒ³</span></span><br><span class="line">  <span class="keyword">const</span> version = params.<span class="property">arguments</span>[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> (textDocument.<span class="property">version</span> !== version) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¸æŠç¯„å›²</span></span><br><span class="line">  <span class="keyword">const</span> selections = params.<span class="property">arguments</span>[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">changes</span>: <span class="title class_">TextEdit</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…¨ã¦ã®é¸æŠç¯„å›²ã«å¯¾ã—ã¦å®Ÿè¡Œ</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> selection <span class="keyword">of</span> selections) &#123;</span><br><span class="line">    <span class="comment">// é¸æŠç¯„å›²ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—</span></span><br><span class="line">    <span class="keyword">const</span> text = textDocument.<span class="title function_">getText</span>(selection);</span><br><span class="line">    <span class="keyword">if</span> (text.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åè»¢</span></span><br><span class="line">    <span class="keyword">const</span> reversed = text.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    changes.<span class="title function_">push</span>(<span class="title class_">TextEdit</span>.<span class="title function_">replace</span>(selection, reversed));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¸æŠç¯„å›²ãŒãªã„å ´åˆã¯ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’åè»¢</span></span><br><span class="line">  <span class="keyword">if</span> (changes.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’å–å¾—</span></span><br><span class="line">    <span class="keyword">const</span> text = textDocument.<span class="title function_">getText</span>();</span><br><span class="line">    <span class="comment">// åè»¢</span></span><br><span class="line">    <span class="keyword">const</span> reversed = text.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    changes.<span class="title function_">push</span>(</span><br><span class="line">      <span class="title class_">TextEdit</span>.<span class="title function_">replace</span>(</span><br><span class="line">        <span class="title class_">Range</span>.<span class="title function_">create</span>(</span><br><span class="line">          <span class="title class_">Position</span>.<span class="title function_">create</span>(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">          textDocument.<span class="title function_">positionAt</span>(text.<span class="property">length</span>)</span><br><span class="line">        ),</span><br><span class="line">        reversed</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤‰æ›´ã‚’é©ç”¨</span></span><br><span class="line">  connection.<span class="property">workspace</span>.<span class="title function_">applyEdit</span>(&#123;</span><br><span class="line">    <span class="attr">documentChanges</span>: [</span><br><span class="line">      <span class="title class_">TextDocumentEdit</span>.<span class="title function_">create</span>(</span><br><span class="line">        &#123; <span class="attr">uri</span>: textDocument.<span class="property">uri</span>, <span class="attr">version</span>: textDocument.<span class="property">version</span> &#125;,</span><br><span class="line">        changes</span><br><span class="line">      ),</span><br><span class="line">    ],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å®Ÿè£…2-middlewareã‚’ç”¨ã„ãŸå®Ÿè£…"><a href="#å®Ÿè£…2-middlewareã‚’ç”¨ã„ãŸå®Ÿè£…" class="headerlink" title="å®Ÿè£…2: middlewareã‚’ç”¨ã„ãŸå®Ÿè£…"></a>å®Ÿè£…2: middlewareã‚’ç”¨ã„ãŸå®Ÿè£…</h2><h3 id="å‡¦ç†ã®æµã‚Œ-1"><a href="#å‡¦ç†ã®æµã‚Œ-1" class="headerlink" title="å‡¦ç†ã®æµã‚Œ"></a>å‡¦ç†ã®æµã‚Œ</h3><p>å®Ÿè£…2ã§ã¯middlewareã¨ã„ã†æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæƒ…å ±ã«æƒ…å ±ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å®Ÿè£…ã—ã¾ã™ã€‚</p><ol><li>ãƒ¦ãƒ¼ã‚¶ãŒã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã§lsp-sample.reverseã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹</li><li>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ä»¥ä¸‹ã®æƒ…å ±ã‚’è¿½åŠ ã™ã‚‹<ul><li>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ‡ã‚£ã‚¿ãŒç·¨é›†ä¸­ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®URI(è­˜åˆ¥å­)</li><li>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ‡ã‚£ã‚¿ãŒç·¨é›†ä¸­ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³</li><li>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ã®é¸æŠç¯„å›²</li></ul></li><li>lsp-sample.reverseã‚³ãƒãƒ³ãƒ‰ã‚’æ¤œçŸ¥ã—ãŸã‚µãƒ¼ãƒã¯å—ã‘å–ã£ãŸæƒ…å ±ã‚’åŸºã«é¸æŠç¯„å›²ã‚’åè»¢ã™ã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹</li></ol><h3 id="å®Ÿè£…-extension-ts-1"><a href="#å®Ÿè£…-extension-ts-1" class="headerlink" title="å®Ÿè£… (extension.ts)"></a>å®Ÿè£… (extension.ts)</h3><p>ã¾ãšä»¥ä¸‹ã®importã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>extension.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  workspace,</span><br><span class="line">  ExtensionContext,</span><br><span class="line"><span class="addition">+ window,</span></span><br><span class="line">&#125; from &quot;vscode&quot;;</span><br></pre></td></tr></table></figure><p>æ‹¡å¼µæ©Ÿèƒ½ã®èµ·å‹•æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°<code>activate()</code>ã®<code>clientOptions</code>ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>extension.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  const clientOptions: LanguageClientOptions = &#123;</span><br><span class="line">    // Register the server for plain text documents</span><br><span class="line">    documentSelector: [&#123; scheme: &quot;file&quot;, language: &quot;plaintext&quot; &#125;],</span><br><span class="line">    synchronize: &#123;</span><br><span class="line">      // Notify the server about file changes to &#x27;.clientrc files contained in the workspace</span><br><span class="line">      fileEvents: workspace.createFileSystemWatcher(&quot;**/.clientrc&quot;),</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="addition">+  middleware: &#123;</span></span><br><span class="line"><span class="addition">+     executeCommand: async (command, args, next) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+       const uri = window.activeTextEditor.document.uri;</span></span><br><span class="line"><span class="addition">+       const version = window.activeTextEditor.document.version;</span></span><br><span class="line"><span class="addition">+       const selections = window.activeTextEditor.selections;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+       return next(command, [...args, uri, version, selections]);</span></span><br><span class="line"><span class="addition">+     &#125;,</span></span><br><span class="line"><span class="addition">+   &#125;,</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><h3 id="å®Ÿè£…-server-ts-3"><a href="#å®Ÿè£…-server-ts-3" class="headerlink" title="å®Ÿè£… (server.ts)"></a>å®Ÿè£… (server.ts)</h3><p>lsp-sample.executeReverseã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘å–ã£ãŸéš›ã«å¼•æ•°æƒ…å ±ã‚’åŸºã«é¸æŠç¯„å›²ã‚’åè»¢ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p><p>ã¾ãšä»¥ä¸‹ã®importã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  /* ç•¥ */</span><br><span class="line"><span class="addition">+ Range</span></span><br><span class="line">&#125; from &quot;vscode-languageserver/node&quot;;</span><br></pre></td></tr></table></figure><p>connection.onInitializeã®resultã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã€ã‚µãƒ¼ãƒãŒlsp-sample.reverseã®å®Ÿè¡Œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ä¼ãˆã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  const result: InitializeResult = &#123;</span><br><span class="line">    capabilities: &#123;</span><br><span class="line">      textDocumentSync: TextDocumentSyncKind.Incremental,</span><br><span class="line">      // Tell the client that this server supports code completion.</span><br><span class="line">      completionProvider: &#123;</span><br><span class="line">        resolveProvider: true,</span><br><span class="line">      &#125;,</span><br><span class="line">      // ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</span><br><span class="line">      codeActionProvider: true,</span><br><span class="line">      // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</span><br><span class="line">      documentFormattingProvider: true,</span><br><span class="line"><span class="addition">+     // ã‚³ãƒãƒ³ãƒ‰</span></span><br><span class="line"><span class="addition">+     executeCommandProvider: &#123;</span></span><br><span class="line"><span class="addition">+       commands: [&quot;lsp-sample.reverse&quot;],</span></span><br><span class="line"><span class="addition">+     &#125;,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹<code>onExecuteCommand()</code>ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«è¡Œã†å‡¦ç†</span></span><br><span class="line">connection.<span class="title function_">onExecuteCommand</span>(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// lsp-sample.reverseã‚³ãƒãƒ³ãƒ‰ã§ãªã„å ´åˆã¯ã‚¢ãƒ¼ãƒªãƒ¼ãƒªã‚¿ãƒ¼ãƒ³</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    params.<span class="property">command</span> !== <span class="string">&quot;lsp-sample.reverse&quot;</span> ||</span><br><span class="line">    params.<span class="property">arguments</span> == <span class="literal">null</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> uri = params.<span class="property">arguments</span>[<span class="number">0</span>].<span class="property">external</span>;</span><br><span class="line">  <span class="comment">// uriã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—</span></span><br><span class="line">  <span class="keyword">const</span> textDocument = documents.<span class="title function_">get</span>(uri);</span><br><span class="line">  <span class="keyword">if</span> (textDocument == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´ã®å ´åˆã¯ã‚¢ãƒ¼ãƒªãƒ¼ãƒªã‚¿ãƒ¼ãƒ³</span></span><br><span class="line">  <span class="keyword">const</span> version = params.<span class="property">arguments</span>[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> (textDocument.<span class="property">version</span> !== version) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¸æŠç¯„å›²</span></span><br><span class="line">  <span class="keyword">const</span> selections = params.<span class="property">arguments</span>[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">changes</span>: <span class="title class_">TextEdit</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…¨ã¦ã®é¸æŠç¯„å›²ã«å¯¾ã—ã¦å®Ÿè¡Œ</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> selection <span class="keyword">of</span> selections) &#123;</span><br><span class="line">    <span class="comment">// é¸æŠç¯„å›²ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—</span></span><br><span class="line">    <span class="keyword">const</span> text = textDocument.<span class="title function_">getText</span>(selection);</span><br><span class="line">    <span class="keyword">if</span> (text.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åè»¢</span></span><br><span class="line">    <span class="keyword">const</span> reversed = text.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    changes.<span class="title function_">push</span>(<span class="title class_">TextEdit</span>.<span class="title function_">replace</span>(selection, reversed));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¸æŠç¯„å›²ãŒãªã„å ´åˆã¯ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’åè»¢</span></span><br><span class="line">  <span class="keyword">if</span> (changes.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’å–å¾—</span></span><br><span class="line">    <span class="keyword">const</span> text = textDocument.<span class="title function_">getText</span>();</span><br><span class="line">    <span class="comment">// åè»¢</span></span><br><span class="line">    <span class="keyword">const</span> reversed = text.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    changes.<span class="title function_">push</span>(</span><br><span class="line">      <span class="title class_">TextEdit</span>.<span class="title function_">replace</span>(</span><br><span class="line">        <span class="title class_">Range</span>.<span class="title function_">create</span>(</span><br><span class="line">          <span class="title class_">Position</span>.<span class="title function_">create</span>(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">          textDocument.<span class="title function_">positionAt</span>(text.<span class="property">length</span>)</span><br><span class="line">        ),</span><br><span class="line">        reversed</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤‰æ›´ã‚’é©ç”¨</span></span><br><span class="line">  connection.<span class="property">workspace</span>.<span class="title function_">applyEdit</span>(&#123;</span><br><span class="line">    <span class="attr">documentChanges</span>: [</span><br><span class="line">      <span class="title class_">TextDocumentEdit</span>.<span class="title function_">create</span>(</span><br><span class="line">        &#123; <span class="attr">uri</span>: textDocument.<span class="property">uri</span>, <span class="attr">version</span>: textDocument.<span class="property">version</span> &#125;,</span><br><span class="line">        changes</span><br><span class="line">      ),</span><br><span class="line">    ],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å‹•ä½œç¢ºèª-2"><a href="#å‹•ä½œç¢ºèª-2" class="headerlink" title="å‹•ä½œç¢ºèª"></a>å‹•ä½œç¢ºèª</h2><p>ä»»æ„ã®ç¯„å›²ã‚’é¸æŠè‚¢ã€ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã§reverse textã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€é¸æŠç¯„å›²ãŒåè»¢ã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ç¯„å›²ã‚’é¸æŠã—ã¦ã„ãªã„å ´åˆã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ãŒåè»¢ã•ã‚Œã¾ã™ã€‚<br><img src="/images/20221125a/reverse.gif" alt="" width="1200" height="675" loading="lazy"></p><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>LSPã‚’ç”¨ã„ãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã—ãŸã€‚</p><p>LSPã‚’ç”¨ã„ãŸVSCodeã®æ‹¡å¼µæ©Ÿèƒ½ã®é–‹ç™ºã«é–¢ã™ã‚‹æ—¥æœ¬èªè¨˜äº‹ã¯ã¾ã ã¾ã å°‘ãªã„ã®ã§ã€ã“ã®è¨˜äº‹ãŒå°‘ã—ã§ã‚‚é–‹ç™ºã®åŠ©ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ul><li><a href="https://qiita.com/Ikuyadeu/items/98458f9ab760d09660ff">Language Server Protocolé–‹ç™ºãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« - Qiita</a></li><li><a href="https://code.visualstudio.com/api/language-extensions/language-server-extension-guide">Language Server Extension Guide | Visual Studio Code Extension API</a></li><li><a href="https://qiita.com/atsushieno/items/ce31df9bd88e98eec5c4">language server protocolã«ã¤ã„ã¦ (å‰ç·¨) - Qiita</a></li><li><a href="https://future-architect.github.io/articles/20220303a/">Pyright ã‚’ LSP ã‚µãƒ¼ãƒã¨ã—ãŸè‡ªä½œ LSP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆå®Ÿè£…ç·¨ï¼‰ | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li><li><a href="https://future-architect.github.io/articles/20220302a/">Pyright ã‚’ LSP ã‚µãƒ¼ãƒã¨ã—ãŸè‡ªä½œ LSP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆèª¿æŸ»ç·¨ï¼‰ | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot; title=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;/a&gt;ã¯ã˜ã‚ã«&lt;/h1&gt;&lt;p&gt;ã“ã‚“ã«ã¡ã¯ã€Futureã§ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚’ã—ã¦ã„ã‚‹å·æ¸•ã§ã™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="SQL" scheme="https://future-architect.github.io/tags/SQL/"/>
    
    <category term="ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼" scheme="https://future-architect.github.io/tags/%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%82%BF%E3%83%BC/"/>
    
    <category term="TypeScript" scheme="https://future-architect.github.io/tags/TypeScript/"/>
    
    <category term="VSCode" scheme="https://future-architect.github.io/tags/VSCode/"/>
    
    <category term="LSP" scheme="https://future-architect.github.io/tags/LSP/"/>
    
  </entry>
  
  <entry>
    <title>Language Server Protocolã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º (å‰ç·¨)</title>
    <link href="https://future-architect.github.io/articles/20221124a/"/>
    <id>https://future-architect.github.io/articles/20221124a/</id>
    <published>2022-11-23T15:00:00.000Z</published>
    <updated>2022-11-25T02:36:25.606Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ã€Futureã§ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚’ã—ã¦ã„ã‚‹å·æ¸•ã§ã™ã€‚ã‚¢ãƒ«ãƒã‚¤ãƒˆã®å‰ã¯Futureã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚·ãƒƒãƒ—ã§Rustè£½SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®ä½œæˆã‚’è¡Œã£ã¦ã„ã¾ã—ãŸ(ãã®æ™‚ã®è¨˜äº‹ã¯<a href="/articles/20220916b/">ã“ã¡ã‚‰</a>)ã€‚ç¾åœ¨ã¯ãã®SQLãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’VSCodeã®æ‹¡å¼µæ©Ÿèƒ½ã«ã™ã‚‹ä½œæ¥­ã‚’è¡Œã£ã¦ãŠã‚Šã€ãã®ãŸã‚ã®æ–¹æ³•ã‚’å­¦ã‚“ã§ã„ã¾ã™ã€‚</p><p>æœ¬è¨˜äº‹ã§ã¯Language Server Protocol(ä»¥ä¸‹LSP)ã‚’ç”¨ã„ãŸVSCodeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</p><p>å‰ç·¨ã§ã¯LSPã‚’ç”¨ã„ãŸVSCodeã®æ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¨ã€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«ä½¿ç”¨ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã‚’è¡Œã„ã¾ã™ã€‚</p><p><a href="/articles/20221125a/">å¾Œç·¨</a>ã§ã¯ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚</p><h1 id="Language-Serverã¨ã¯"><a href="#Language-Serverã¨ã¯" class="headerlink" title="Language Serverã¨ã¯"></a>Language Serverã¨ã¯</h1><p>Language Serverã¨ã¯ã€è‡ªå‹•è£œå®Œã€ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã€å‹ãƒã‚§ãƒƒã‚¯ãªã©ã®æ§˜ã€…ãªè¨€èªæ©Ÿèƒ½ã‚’IDEã«æä¾›ã™ã‚‹ã‚‚ã®ã§ã™ã€‚</p><h1 id="Language-Server-Protocol-LSP-ã¨ã¯"><a href="#Language-Server-Protocol-LSP-ã¨ã¯" class="headerlink" title="Language Server Protocol (LSP)ã¨ã¯"></a>Language Server Protocol (LSP)ã¨ã¯</h1><p><a href="https://microsoft.github.io/language-server-protocol/">LSP</a>ã¨ã¯2016å¹´6æœˆã«MicrosoftãŒç™ºè¡¨ã—ãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã€IDEã¨Language Serveré–“ã®é€šä¿¡ã‚’æ¨™æº–åŒ–ã™ã‚‹ã‚‚ã®ã§ã™ã€‚</p><p>LSPãŒãªã„å ´åˆã¯å„IDEã«å¯¾å¿œã—ãŸè¨€èªã€ä»•æ§˜ã§è¨€èªã‚µãƒ¼ãƒã‚’å®Ÿè£…ã—ãªã‘ã‚Œã°ãªã‚‰ãšã€éå¸¸ã«åŠ´åŠ›ãŒã‹ã‹ã£ã¦ã—ã¾ã„ã¾ã™ã€‚ã—ã‹ã—ã€LSPã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§1ã¤ã®è¨€èªã‚µãƒ¼ãƒã‚’è¤‡æ•°ã®IDEã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€å®Ÿè£…è¨€èªã®åˆ¶ç´„ã‚‚ç„¡ããªã‚Šã¾ã™ã€‚</p><p>ã¤ã¾ã‚Šã€LSPã‚’ç”¨ã„ã¦é–‹ç™ºã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã¯VSCodeã ã‘ã§ãªãã€Vimã‚„Emacsãªã©ã§ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚</p><img src="/images/20221124a/lsp-languages-editors.png" alt="lsp-languages-editors.png" width="1162" height="538" loading="lazy"><h1 id="æœ¬è¨˜äº‹ã§èª¬æ˜ã™ã‚‹ã“ã¨"><a href="#æœ¬è¨˜äº‹ã§èª¬æ˜ã™ã‚‹ã“ã¨" class="headerlink" title="æœ¬è¨˜äº‹ã§èª¬æ˜ã™ã‚‹ã“ã¨"></a>æœ¬è¨˜äº‹ã§èª¬æ˜ã™ã‚‹ã“ã¨</h1><ul><li>LSPã‚’ç”¨ã„ãŸVSCodeã®æ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</li><li>ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬</li></ul><h1 id="æœ¬è¨˜äº‹ã§èª¬æ˜ã—ãªã„ã“ã¨"><a href="#æœ¬è¨˜äº‹ã§èª¬æ˜ã—ãªã„ã“ã¨" class="headerlink" title="æœ¬è¨˜äº‹ã§èª¬æ˜ã—ãªã„ã“ã¨"></a>æœ¬è¨˜äº‹ã§èª¬æ˜ã—ãªã„ã“ã¨</h1><ul><li>VSCodeä»¥å¤–ã§ä½¿ç”¨ã™ã‚‹æ–¹æ³•</li><li>æ‹¡å¼µæ©Ÿèƒ½ã®å…¬é–‹æ–¹æ³•</li></ul><h1 id="LSPãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"><a href="#LSPãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«" class="headerlink" title="LSPãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"></a>LSPãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</h1><p>ã¾ãšVSCodeã®å…¬å¼ã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹<a href="https://github.com/microsoft/vscode-extension-samples/tree/main/lsp-sample">LSPã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰</a>ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚</p><h3 id="1-ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"><a href="#1-ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" class="headerlink" title="1. ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"></a>1. ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h3><p>ã¾ãšé©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦VSCodeæ‹¡å¼µæ©Ÿèƒ½ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/microsoft/vscode-extension-samples.git</span><br></pre></td></tr></table></figure><h3 id="2-å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"><a href="#2-å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" class="headerlink" title="2. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"></a>2. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3><p>æ¬¡ã«npmã‚’ç”¨ã„ã¦å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><ol><li>ã¾ãšå…ˆç¨‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒªãƒã‚¸ãƒˆãƒªå†…ã®lsp-sampleãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’vscodeã§é–‹ã</li><li>Ctrl+@(macOSã®å ´åˆã¯^+@)ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã™ã‚‹<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨å®Ÿè¡Œ"><a href="#3-ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨å®Ÿè¡Œ" class="headerlink" title="3. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨å®Ÿè¡Œ"></a>3. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨å®Ÿè¡Œ</h3><ol><li>Ctrl+Shift+Bã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«</li><li>Ctrl+Shift+Dã§ã€Œå®Ÿè¡Œã¨ãƒ‡ãƒãƒƒã‚°ã€ã‚’é–‹ãã€Launch Clientã‚’é¸æŠã™ã‚‹<img src="/images/20221124a/image.png" alt="" width="1200" height="650" loading="lazy"></li><li><font color="MediumSeaGreen">â–·</font>ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹</li><li>æ–°ãŸã«VSCodeã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ãã®ã§ãã®VSCodeä¸Šã§é©å½“ãªãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ</li><li>ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ä»¥ä¸‹ã®æ©Ÿèƒ½ãŒç¢ºèªã§ãã‚Œã°å®Œäº†<ul><li>jã¨å…¥åŠ›ã™ã‚‹ã¨è£œå®Œã®å€™è£œã¨ã—ã¦JavaScriptãŒè¡¨ç¤ºã•ã‚Œã‚‹ <img src="/images/20221124a/image_2.png" alt="" width="682" height="84" loading="lazy"></li><li>tã¨å…¥åŠ›ã™ã‚‹ã¨è£œå®Œã®å€™è£œã¨ã—ã¦TypeScriptãŒè¡¨ç¤ºã•ã‚Œã‚‹ <img src="/images/20221124a/image_3.png" alt="" width="676" height="74" loading="lazy"></li><li>å…¨ã¦å¤§æ–‡å­—ã€ã‹ã¤é•·ã•ãŒ2ä»¥ä¸Šã®å˜èªã«ã¯è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹<br> <img src="/images/20221124a/image_4.png" alt="" width="491" height="202" loading="lazy"></li></ul></li></ol><h3 id="4-ã‚µãƒ¼ãƒã®ãƒ‡ãƒãƒƒã‚°"><a href="#4-ã‚µãƒ¼ãƒã®ãƒ‡ãƒãƒƒã‚°" class="headerlink" title="4. ã‚µãƒ¼ãƒã®ãƒ‡ãƒãƒƒã‚°"></a>4. ã‚µãƒ¼ãƒã®ãƒ‡ãƒãƒƒã‚°</h3><ol><li>Launch Clientã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã€Œå®Ÿè¡Œã¨ãƒ‡ãƒãƒƒã‚°ã€ã®Attach to Serverã‚’é¸æŠ</li><li><font color="MediumSeaGreen">â–·</font>ã‚’ã‚¯ãƒªãƒƒã‚¯<img src="/images/20221124a/image_5.png" alt="" width="1200" height="650" loading="lazy"></li><li>ã‚µãƒ¼ãƒã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆãŒåŠ¹ãã‚ˆã†ã«ãªã‚‹<img src="/images/20221124a/image_6.png" alt="" width="1200" height="650" loading="lazy"></li></ol><h1 id="ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬"><a href="#ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬" class="headerlink" title="ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬"></a>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬</h1><p>å…ˆç¨‹å®Ÿè¡Œã—ãŸlsp-sampleã®å®Ÿè£…ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚</p><h2 id="ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ"><a href="#ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ" class="headerlink" title="ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ"></a>ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ</h2><p>ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚<br>extension.tsã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®å‡¦ç†ã€server.tsã«ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ client  <span class="comment"># ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰</span></span><br><span class="line">â”‚   â”œâ”€â”€ src</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ <span class="built_in">test</span> <span class="comment"># ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰</span></span><br><span class="line">â”‚   â”‚   â””â”€â”€ extension.ts <span class="comment"># ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®å®Ÿè£…</span></span><br><span class="line">â”œâ”€â”€ package.json <span class="comment"># ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æƒ…å ±</span></span><br><span class="line">â””â”€â”€ server <span class="comment"># ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰</span></span><br><span class="line">    â””â”€â”€ src</span><br><span class="line">        â””â”€â”€ server.ts <span class="comment"># ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã®å®Ÿè£…</span></span><br></pre></td></tr></table></figure><h2 id="pakcage-json"><a href="#pakcage-json" class="headerlink" title="pakcage.json"></a>pakcage.json</h2><p>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ©Ÿèƒ½ã«ã¤ã„ã¦è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚è©³ã—ã„æƒ…å ±ã¯ä»¥ä¸‹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><ul><li><a href="https://code.visualstudio.com/api/references/extension-manifest">Extension Manifest | Visual Studio Code Extension API</a></li></ul><p>ã“ã®ä¸­ã‹ã‚‰ä¸€éƒ¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èª¬æ˜ã—ã¾ã™ã€‚</p><h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>æ‹¡å¼µæ©Ÿèƒ½ã®åå‰ã§ã€ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯lsp-sampleã¨ãªã£ã¦ã„ã¾ã™ã€‚<br>ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ãƒ¼ã‚¹ã§ã®è¡¨ç¤ºåã¯displayNameã§åˆ¥ã«è¨­å®šã§ãã¾ã™ã€‚</p><h3 id="publisher"><a href="#publisher" class="headerlink" title="publisher"></a>publisher</h3><p>æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¬é–‹ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™ã€‚<br><a href="https://github.com/microsoft/vscode-vsce">vsce</a>ã¨ã„ã†VSCodeæ‹¡å¼µæ©Ÿèƒ½ç”¨ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ä½œæˆã—ãŸpublisherIDã‚’ã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å…¥åŠ›ã—ã¾ã™ã€‚</p><p>æ‹¡å¼µæ©Ÿèƒ½ã®å…¬é–‹æ–¹æ³•ã¯ä»¥ä¸‹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><ul><li><a href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension">Publishing Extensions | Visual Studio Code Extension API</a></li></ul><h3 id="categories"><a href="#categories" class="headerlink" title="categories"></a>categories</h3><p>æ‹¡å¼µæ©Ÿèƒ½ã®ã‚«ãƒ†ã‚´ãƒªã‚’å…¥åŠ›ã—ã¾ã™ã€‚</p><details><summary>è¨±å®¹ã™ã‚‹ã‚«ãƒ†ã‚´ãƒªä¸€è¦§</summary><ul><li>Programming Languages</li><li>Snippets</li><li>Linters</li><li>Themes</li><li>Debuggers</li><li>Formatters</li><li>Keymaps</li><li>SCM Providers</li><li>Other</li><li>Extension Packs</li><li>Language Packs</li><li>Data Science</li><li>Machine Learning</li><li>Visualization</li><li>Notebooks</li><li>Education</li><li>Testing</details></li></ul><h3 id="activateEvents"><a href="#activateEvents" class="headerlink" title="activateEvents"></a>activateEvents</h3><p>activateEventsã«è¨˜è¿°ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã™ã‚‹ã¨ã€æ‹¡å¼µæ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚<br>lsp-sampleã§ã®activateEventsã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚</p><p><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/package.json#L19-L21">GitHub</a></p><figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;activationEvents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;onLanguage:plaintext&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>ã“ã‚Œã¯ã€ã€Œãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ(.txtãªã©)ã‚’é–‹ãã€ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã™ã‚‹ã¨æ‹¡å¼µæ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚<br>ä»–ã«ã‚‚ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚¤ãƒ™ãƒ³ãƒˆã‚„ãƒ‡ãƒãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆãªã©ã‚’ç™»éŒ²ã§ãã¾ã™ã€‚è©³ã—ã„æƒ…å ±ã¯ä»¥ä¸‹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><ul><li><a href="https://code.visualstudio.com/api/references/activation-events">Activation Events | Visual Studio Code Extension API</a></li></ul><h3 id="contributes"><a href="#contributes" class="headerlink" title="contributes"></a>contributes</h3><p>æ‹¡å¼µæ©Ÿèƒ½ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ã®æƒ…å ±ã‚’è¨˜è¿°ã—ã¾ã™ã€‚<br>è©³ã—ã„æƒ…å ±ã¯ä»¥ä¸‹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><ul><li><a href="https://code.visualstudio.com/api/references/contribution-points">Contribution Points | Visual Studio Code Extension API</a></li></ul><h2 id="extension-ts"><a href="#extension-ts" class="headerlink" title="extension.ts"></a>extension.ts</h2><p>extension.tsã«ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</p><h3 id="æ‹¡å¼µæ©Ÿèƒ½ã®èµ·å‹•æ™‚ã®å‡¦ç†"><a href="#æ‹¡å¼µæ©Ÿèƒ½ã®èµ·å‹•æ™‚ã®å‡¦ç†" class="headerlink" title="æ‹¡å¼µæ©Ÿèƒ½ã®èµ·å‹•æ™‚ã®å‡¦ç†"></a>æ‹¡å¼µæ©Ÿèƒ½ã®èµ·å‹•æ™‚ã®å‡¦ç†</h3><p>æ‹¡å¼µæ©Ÿèƒ½ã®èµ·å‹•æ™‚ã«é–¢æ•°<code>activate()</code>ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p><p><code>activate()</code>å†…ã§ã¯æ¥ç¶šå…ˆã®ã‚µãƒ¼ãƒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èµ·å‹•å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚</p><p><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/client/src/extension.ts#L18-L58">GitHub</a></p><figure class="highlight ts"><figcaption><span>extension.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">activate</span>(<span class="params">context: ExtensionContext</span>) &#123;</span><br><span class="line"><span class="comment">// ã‚µãƒ¼ãƒã¯nodeã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> serverModule = context.<span class="title function_">asAbsolutePath</span>(</span><br><span class="line">path.<span class="title function_">join</span>(<span class="string">&#x27;server&#x27;</span>, <span class="string">&#x27;out&#x27;</span>, <span class="string">&#x27;server.js&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">// ã‚µãƒ¼ãƒã®ãƒ‡ãƒãƒƒã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³</span></span><br><span class="line"><span class="comment">// --inspect=6009: VSCodeãŒã‚µãƒ¼ãƒã«ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ã‚ˆã†ã«ã‚µãƒ¼ãƒã‚’Nodeã®ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ</span></span><br><span class="line"><span class="keyword">const</span> debugOptions = &#123; <span class="attr">execArgv</span>: [<span class="string">&#x27;--nolazy&#x27;</span>, <span class="string">&#x27;--inspect=6009&#x27;</span>] &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§æ‹¡å¼µæ©Ÿèƒ½ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒ‡ãƒãƒƒã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒä½¿ç”¨ã•ã‚Œã‚‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverOptions</span>: <span class="title class_">ServerOptions</span> = &#123;</span><br><span class="line"><span class="attr">run</span>: &#123; <span class="attr">module</span>: serverModule, <span class="attr">transport</span>: <span class="title class_">TransportKind</span>.<span class="property">ipc</span> &#125;,</span><br><span class="line"><span class="attr">debug</span>: &#123;</span><br><span class="line"><span class="attr">module</span>: serverModule,</span><br><span class="line"><span class="attr">transport</span>: <span class="title class_">TransportKind</span>.<span class="property">ipc</span>,</span><br><span class="line"><span class="attr">options</span>: debugOptions</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">clientOptions</span>: <span class="title class_">LanguageClientOptions</span> = &#123;</span><br><span class="line">        <span class="comment">// ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã«æ©Ÿèƒ½ã‚’æä¾›</span></span><br><span class="line"><span class="attr">documentSelector</span>: [&#123; <span class="attr">scheme</span>: <span class="string">&#x27;file&#x27;</span>, <span class="attr">language</span>: <span class="string">&#x27;plaintext&#x27;</span> &#125;],</span><br><span class="line">        <span class="comment">// ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ä¸Šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã«ã‚µãƒ¼ãƒã«é€šçŸ¥</span></span><br><span class="line"><span class="attr">synchronize</span>: &#123;</span><br><span class="line"><span class="attr">fileEvents</span>: workspace.<span class="title function_">createFileSystemWatcher</span>(<span class="string">&#x27;**/.clientrc&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ</span></span><br><span class="line">client = <span class="keyword">new</span> <span class="title class_">LanguageClient</span>(</span><br><span class="line"><span class="string">&#x27;languageServerExample&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Language Server Example&#x27;</span>,</span><br><span class="line">serverOptions,</span><br><span class="line">clientOptions</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èµ·å‹• (åŒæ™‚ã«ã‚µãƒ¼ãƒã‚‚èµ·å‹•ã™ã‚‹)</span></span><br><span class="line">client.<span class="title function_">start</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã¡ãªã¿ã«ã€lsp-sampleã§ã¯Untitledãªãƒ•ã‚¡ã‚¤ãƒ«(æ–°è¦ä½œæˆã—ãŸä¿å­˜ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«)ã«ã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ãŒã€<code>clientOptions</code>ã®<code>documentSelector</code>ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§å¯¾å¿œã§ãã¾ã™ã€‚</p><figure class="highlight diff"><figcaption><span>extension.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³</span><br><span class="line">const clientOptions: LanguageClientOptions = &#123;</span><br><span class="line">        // ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã«æ©Ÿèƒ½ã‚’æä¾›</span><br><span class="line">        documentSelector: [</span><br><span class="line">          &#123; scheme: &quot;file&quot;, language: &quot;plaintext&quot; &#125;,</span><br><span class="line"><span class="addition">+         &#123; scheme: &quot;untitled&quot;, language: &quot;plaintext&quot; &#125;,</span></span><br><span class="line">        ],</span><br><span class="line">        // ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ä¸Šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã«ã‚µãƒ¼ãƒã«é€šçŸ¥</span><br><span class="line">synchronize: &#123;</span><br><span class="line">fileEvents: workspace.createFileSystemWatcher(&#x27;**/.clientrc&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><img src="/images/20221124a/untitled.drawio.png" alt="untitled.drawio.png" width="1200" height="215" loading="lazy"><h3 id="æ‹¡å¼µæ©Ÿèƒ½ã®çµ‚äº†æ™‚ã®å‡¦ç†"><a href="#æ‹¡å¼µæ©Ÿèƒ½ã®çµ‚äº†æ™‚ã®å‡¦ç†" class="headerlink" title="æ‹¡å¼µæ©Ÿèƒ½ã®çµ‚äº†æ™‚ã®å‡¦ç†"></a>æ‹¡å¼µæ©Ÿèƒ½ã®çµ‚äº†æ™‚ã®å‡¦ç†</h3><p>æ‹¡å¼µæ©Ÿèƒ½ã®çµ‚äº†æ™‚ã«é–¢æ•°<code>deactive()</code>ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p><p>lsp-sampleã§ã¯é–¢æ•°<code>deactive()</code>ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’çµ‚äº†ã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚<br><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/client/src/extension.ts#L60-L65">GitHub</a></p><figure class="highlight ts"><figcaption><span>extension.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deactivate</span>(<span class="params"></span>): <span class="title class_">Thenable</span>&lt;<span class="built_in">void</span>&gt; | <span class="literal">undefined</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!client) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> client.<span class="title function_">stop</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="server-ts"><a href="#server-ts" class="headerlink" title="server.ts"></a>server.ts</h2><p>server.tsã«ã¯ã‚µãƒ¼ãƒå´ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</p><h3 id="ã‚µãƒ¼ãƒã®æ¥ç¶šã‚’ä½œæˆ"><a href="#ã‚µãƒ¼ãƒã®æ¥ç¶šã‚’ä½œæˆ" class="headerlink" title="ã‚µãƒ¼ãƒã®æ¥ç¶šã‚’ä½œæˆ"></a>ã‚µãƒ¼ãƒã®æ¥ç¶šã‚’ä½œæˆ</h3><p>ã‚µãƒ¼ãƒã®æ¥ç¶šã‚’ä½œæˆã—ã€ãã®æ¥ç¶šã‚’ç›£è¦–ã™ã‚‹ã“ã¨ã§æ‹¡å¼µæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚</p><ul><li>ã‚µãƒ¼ãƒã®æ¥ç¶šã®ä½œæˆ<br><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L26">GitHub</a></li></ul><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connection = <span class="title function_">createConnection</span>(<span class="title class_">ProposedFeatures</span>.<span class="property">all</span>);</span><br></pre></td></tr></table></figure><ul><li>æ¥ç¶šã®ç›£è¦–<br><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L229-L230">GitHub</a></li></ul><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connection.<span class="title function_">listen</span>();</span><br></pre></td></tr></table></figure><h3 id="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã®ä½œæˆ"><a href="#ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã®ä½œæˆ" class="headerlink" title="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã®ä½œæˆ"></a>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã®ä½œæˆ</h3><p>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã¨ã¯ã‚µãƒ¼ãƒã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’åŒæœŸã™ã‚‹ã‚‚ã®ã§ã™ã€‚<br>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã‚’ä½œæˆã—ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç›£è¦–ã‚’è¡Œã„ã¾ã™ã€‚</p><ul><li>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã®ä½œæˆ<br><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L29">GitHub</a></li></ul><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">documents</span>: <span class="title class_">TextDocuments</span>&lt;<span class="title class_">TextDocument</span>&gt; = <span class="keyword">new</span> <span class="title class_">TextDocuments</span>(<span class="title class_">TextDocument</span>);</span><br></pre></td></tr></table></figure><ul><li>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã®ç›£è¦–<br><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L227">GitHub</a></li></ul><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">documents.<span class="title function_">listen</span>(connection);</span><br></pre></td></tr></table></figure><p>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’é–‹ãã‚¤ãƒ™ãƒ³ãƒˆã€é–‰ã˜ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã€å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œçŸ¥ã—ã¾ã™ã€‚</p><h3 id="åˆæœŸåŒ–"><a href="#åˆæœŸåŒ–" class="headerlink" title="åˆæœŸåŒ–"></a>åˆæœŸåŒ–</h3><p>æœ€åˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡æ™‚ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã“ã§ã‚µãƒ¼ãƒã®è¨­å®šã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚</p><p><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L35-L69">GitHub</a></p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">connection.<span class="title function_">onInitialize</span>(<span class="function">(<span class="params">params: InitializeParams</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> capabilities = params.<span class="property">capabilities</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        ä¸­ç•¥ (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šã‚’å–å¾—)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">InitializeResult</span> = &#123;</span><br><span class="line">        <span class="comment">// ã‚µãƒ¼ãƒã®æ©Ÿèƒ½</span></span><br><span class="line">        <span class="attr">capabilities</span>: &#123;</span><br><span class="line">            <span class="comment">// ãƒ†ã‚­ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®åŒæœŸæ–¹æ³•ã®è¨­å®š</span></span><br><span class="line">            <span class="comment">// ä»Šå›ã¯æœ€åˆã«é–‹ã„ãŸã¨ãã®ã¿ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã‚’èª­ã¿è¾¼ã¿ã€ãã®å¾Œã¯å·®åˆ†æ›´æ–°ãŒé€ä¿¡ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã‚‹</span></span><br><span class="line">            <span class="attr">textDocumentSync</span>: <span class="title class_">TextDocumentSyncKind</span>.<span class="property">Incremental</span>,</span><br><span class="line">            <span class="comment">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã“ã®ã‚µãƒ¼ãƒã¯è£œå®Œã«å¯¾å¿œã—ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹</span></span><br><span class="line">            <span class="attr">completionProvider</span>: &#123;</span><br><span class="line">                <span class="attr">resolveProvider</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«å¯¾å¿œã—ã¦ã„ã‚‹å ´åˆ</span></span><br><span class="line"><span class="keyword">if</span> (hasWorkspaceFolderCapability) &#123;</span><br><span class="line">result.<span class="property">capabilities</span>.<span class="property">workspace</span> = &#123;</span><br><span class="line"><span class="attr">workspaceFolders</span>: &#123;</span><br><span class="line"><span class="attr">supported</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="è­¦å‘Šè¡¨ç¤ºæ©Ÿèƒ½ã®å®Ÿè£…"><a href="#è­¦å‘Šè¡¨ç¤ºæ©Ÿèƒ½ã®å®Ÿè£…" class="headerlink" title="è­¦å‘Šè¡¨ç¤ºæ©Ÿèƒ½ã®å®Ÿè£…"></a>è­¦å‘Šè¡¨ç¤ºæ©Ÿèƒ½ã®å®Ÿè£…</h3><p>lsp-sampleã§ã¯ãƒ†ã‚­ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å¤‰æ›´æ™‚ã«å…¨ã¦å¤§æ–‡å­—ã§ã€ã‹ã¤é•·ã•ãŒ2ä»¥ä¸Šã®å˜èªã‚’ç‰¹å®šã—ã€ãã®ç®‡æ‰€ã«è­¦å‘Šã‚’è¡¨ç¤ºã—ã¾ã™ã€‚<br>ã“ã®æ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</p><p>ãƒ†ã‚­ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå¤‰æ›´ã€ã¾ãŸã¯åˆã‚ã¦é–‹ã‹ã‚ŒãŸå ´åˆã«ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚</p><p><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L131-L135">GitHub</a></p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">documents.<span class="title function_">onDidChangeContent</span>(<span class="function">(<span class="params">change</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">validateTextDocument</span>(change.<span class="property">document</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§å‘¼ã³å‡ºã—ã¦ã„ã‚‹é–¢æ•°<code>validateTextDocument</code>ã®å‡¦ç†ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p><p><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L137-L182">GitHub</a></p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">validateTextDocument</span>(<span class="params">textDocument: TextDocument</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line"><span class="comment">// ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨­å®šã‚’å–å¾—</span></span><br><span class="line"><span class="keyword">const</span> settings = <span class="keyword">await</span> <span class="title function_">getDocumentSettings</span>(textDocument.<span class="property">uri</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é•·ã•ãŒ2ä»¥ä¸Šã®å…¨ã¦å¤§æ–‡å­—ã®å˜èªã«å¯¾ã—ã¦è¨ºæ–­ã‚’ç™ºè¡Œã™ã‚‹</span></span><br><span class="line"><span class="keyword">const</span> text = textDocument.<span class="title function_">getText</span>();</span><br><span class="line"><span class="keyword">const</span> pattern = <span class="regexp">/\b[A-Z]&#123;2,&#125;\b/g</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">m</span>: <span class="title class_">RegExpExecArray</span> | <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> problems = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class="line"><span class="keyword">while</span> ((m = pattern.<span class="title function_">exec</span>(text)) &amp;&amp; problems &lt; settings.<span class="property">maxNumberOfProblems</span>) &#123;</span><br><span class="line">problems++;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class="line">            <span class="comment">// è¨ºæ–­ã®å¼·ã•ã€‚ä»Šå›ã¯è­¦å‘Šã€‚</span></span><br><span class="line"><span class="attr">severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class="property">Warning</span>,</span><br><span class="line">            <span class="comment">// è¨ºæ–­ã®ç¯„å›²ã€‚ä»Šå›ã¯è©²å½“ã®å˜èªã®é–‹å§‹ä½ç½®ã‹ã‚‰çµ‚äº†ä½ç½®ã¾ã§ã‚’ç¯„å›²ã¨ã—ã¦ã„ã‚‹ã€‚</span></span><br><span class="line"><span class="attr">range</span>: &#123;</span><br><span class="line"><span class="attr">start</span>: textDocument.<span class="title function_">positionAt</span>(m.<span class="property">index</span>),</span><br><span class="line"><span class="attr">end</span>: textDocument.<span class="title function_">positionAt</span>(m.<span class="property">index</span> + m[<span class="number">0</span>].<span class="property">length</span>),</span><br><span class="line">&#125;,</span><br><span class="line">            <span class="comment">// è¨ºæ–­ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span></span><br><span class="line"><span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;m[<span class="number">0</span>]&#125;</span> is all uppercase.`</span>,</span><br><span class="line">            <span class="comment">// è¨ºæ–­ãŒã©ã“ã‹ã‚‰ç™ºè¡Œã•ã‚ŒãŸã‹ã‚’ç¤ºã™æ–‡å­—åˆ—</span></span><br><span class="line"><span class="attr">source</span>: <span class="string">&#x27;ex&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line">        <span class="comment">// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè¨ºæ–­ã®é–¢é€£æƒ…å ±ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã‚‹å ´åˆã€é–¢é€£æƒ…å ±ã‚’ä»˜ä¸ã™ã‚‹ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (hasDiagnosticRelatedInformationCapability) &#123;</span><br><span class="line">diagnostic.<span class="property">relatedInformation</span> = [</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">location</span>: &#123;</span><br><span class="line"><span class="attr">uri</span>: textDocument.<span class="property">uri</span>,</span><br><span class="line"><span class="attr">range</span>: <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, diagnostic.<span class="property">range</span>),</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">message</span>: <span class="string">&#x27;Spelling matters&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">location</span>: &#123;</span><br><span class="line"><span class="attr">uri</span>: textDocument.<span class="property">uri</span>,</span><br><span class="line"><span class="attr">range</span>: <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, diagnostic.<span class="property">range</span>),</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">message</span>: <span class="string">&#x27;Particularly for names&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">];</span><br><span class="line">&#125;</span><br><span class="line">diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¨ºæ–­ã‚’è¡¨ç¤ºã™ã‚‹</span></span><br><span class="line">connection.<span class="title function_">sendDiagnostics</span>(&#123; <span class="attr">uri</span>: textDocument.<span class="property">uri</span>, diagnostics &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¨ºæ–­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€è¨ºæ–­ã®ç™ºè¡Œå…ƒã€é–¢é€£æƒ…å ±ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br><img src="/images/20221124a/warning.drawio.png" alt="warning.drawio.png" width="644" height="268" loading="lazy"></p><h3 id="è£œå®Œæ©Ÿèƒ½ã®å®Ÿè£…"><a href="#è£œå®Œæ©Ÿèƒ½ã®å®Ÿè£…" class="headerlink" title="è£œå®Œæ©Ÿèƒ½ã®å®Ÿè£…"></a>è£œå®Œæ©Ÿèƒ½ã®å®Ÿè£…</h3><p>lsp-sampleã§ã¯â€TypeScriptâ€ã€â€JavaScriptâ€ã¨ã„ã†2ã¤ã®å˜èªã®è£œå®Œã‚’æä¾›ã—ã¾ã™ã€‚</p><p>è£œå®Œã¯<code>connection</code>ã®<code>onCompletion</code>ãƒ¡ã‚½ãƒƒãƒ‰ã§æä¾›ã—ã¾ã™ã€‚<br><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L189-L208">GitHub</a></p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">connection.<span class="title function_">onCompletion</span>(</span><br><span class="line">(<span class="attr">_textDocumentPosition</span>: <span class="title class_">TextDocumentPositionParams</span>): <span class="title class_">CompletionItem</span>[] =&gt; &#123;</span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">label</span>: <span class="string">&#x27;TypeScript&#x27;</span>,</span><br><span class="line"><span class="attr">kind</span>: <span class="title class_">CompletionItemKind</span>.<span class="property">Text</span>,</span><br><span class="line"><span class="attr">data</span>: <span class="number">1</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">label</span>: <span class="string">&#x27;JavaScript&#x27;</span>,</span><br><span class="line"><span class="attr">kind</span>: <span class="title class_">CompletionItemKind</span>.<span class="property">Text</span>,</span><br><span class="line"><span class="attr">data</span>: <span class="number">2</span>,</span><br><span class="line">&#125;,</span><br><span class="line">];</span><br><span class="line">&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ã¾ãŸã€<code>onCompletionResolve</code>ãƒ¡ã‚½ãƒƒãƒ‰ã«å„è£œå®ŒãŒé¸æŠã•ã‚ŒãŸå ´åˆã«è¡¨ç¤ºã™ã‚‹æƒ…å ±ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚<br><a href="https://github.com/microsoft/vscode-extension-samples/blob/fdd3bb95ce8e38ffe58fc9158797239fdf5017f1/lsp-sample/server/src/server.ts#L210-L223">GitHub</a></p><figure class="highlight ts"><figcaption><span>server.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">connection.<span class="title function_">onCompletionResolve</span>((<span class="attr">item</span>: <span class="title class_">CompletionItem</span>): <span class="function"><span class="params">CompletionItem</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (item.<span class="property">data</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// &quot;TypeScript&quot;ãŒé¸æŠã•ã‚ŒãŸå ´åˆ</span></span><br><span class="line">item.<span class="property">detail</span> = <span class="string">&#x27;TypeScript details&#x27;</span>;</span><br><span class="line">item.<span class="property">documentation</span> = <span class="string">&#x27;TypeScript documentation&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">data</span> === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="comment">// &quot;JavaScript&quot;ãŒé¸æŠã•ã‚ŒãŸå ´åˆ</span></span><br><span class="line">item.<span class="property">detail</span> = <span class="string">&#x27;JavaScript details&#x27;</span>;</span><br><span class="line">item.<span class="property">documentation</span> = <span class="string">&#x27;JavaScript documentation&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> item;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è£œå®Œã€è¿½åŠ æƒ…å ±ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br><img src="/images/20221124a/hokan.drawio_(1).png" alt="" width="816" height="205" loading="lazy"></p><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>LSPã‚’ç”¨ã„ãŸVSCodeã®æ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¨ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã‚’è¡Œã„ã¾ã—ãŸã€‚</p><p><a href="/articles/20221125a/">å¾Œç·¨</a> ã§ã¯lsp-sampleã«æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ul><li><a href="https://qiita.com/Ikuyadeu/items/98458f9ab760d09660ff">Language Server Protocolé–‹ç™ºãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« - Qiita</a></li><li><a href="https://code.visualstudio.com/api/language-extensions/language-server-extension-guide">Language Server Extension Guide | Visual Studio Code Extension API</a></li><li><a href="https://qiita.com/atsushieno/items/ce31df9bd88e98eec5c4">language server protocolã«ã¤ã„ã¦ (å‰ç·¨) - Qiita</a></li><li><a href="https://future-architect.github.io/articles/20220303a/">Pyright ã‚’ LSP ã‚µãƒ¼ãƒã¨ã—ãŸè‡ªä½œ LSP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆå®Ÿè£…ç·¨ï¼‰ | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li><li><a href="https://future-architect.github.io/articles/20220302a/">Pyright ã‚’ LSP ã‚µãƒ¼ãƒã¨ã—ãŸè‡ªä½œ LSP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆèª¿æŸ»ç·¨ï¼‰ | ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æŠ€è¡“ãƒ–ãƒ­ã‚°</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="SQL" scheme="https://future-architect.github.io/tags/SQL/"/>
    
    <category term="ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼" scheme="https://future-architect.github.io/tags/%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%82%BF%E3%83%BC/"/>
    
    <category term="TypeScript" scheme="https://future-architect.github.io/tags/TypeScript/"/>
    
    <category term="VSCode" scheme="https://future-architect.github.io/tags/VSCode/"/>
    
    <category term="LSP" scheme="https://future-architect.github.io/tags/LSP/"/>
    
  </entry>
  
  <entry>
    <title>AzureADï¼‹MSAL for Goã§ãƒãƒƒãƒã‚³ãƒãƒ³ãƒ‰ã®èªè¨¼</title>
    <link href="https://future-architect.github.io/articles/20221122a/"/>
    <id>https://future-architect.github.io/articles/20221122a/</id>
    <published>2022-11-21T15:00:00.000Z</published>
    <updated>2022-12-20T02:11:14.949Z</updated>
    
    <content type="html"><![CDATA[<p><a href="/articles/20221118a/">å‰å›ã®è¨˜äº‹</a>ã§ã¯MSAL.jsã‚’ä½¿ã„ã€ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èªè¨¼ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚</p><p>æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ã§æ‰±ã†èªè¨¼ã«ã¯ã„ã‚ã„ã‚ãªç¨®é¡ãŒã‚ã‚Šã¾ã™ãŒã€ã ã„ãŸã„ä»¥ä¸‹ã®ã©ã‚Œã‹ã«è©²å½“ã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚</p><ul><li>Webã‚µãƒ¼ãƒ“ã‚¹ãƒ»ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³</li><li>ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§å‹•ã‹ã™ãƒãƒƒãƒã‚³ãƒãƒ³ãƒ‰: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³</li><li>ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚„ã‚µãƒ¼ãƒãƒ¼ã§å‹•ã‹ã™ãƒãƒƒãƒã‚³ãƒãƒ³ãƒ‰: ç„¡äººé‹ç”¨</li></ul><p>Webã‚µãƒ¼ãƒ“ã‚¹ã®ã†ã¡ã€SPAã¯å‰å›ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã§èª¬æ˜ã—ã¾ã—ãŸã€‚Webã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼ã¯å‰å›èª¬æ˜ã—ã¾ã—ãŸã€‚ä»Šæ™‚ã®å‹•çš„ãƒšãƒ¼ã‚¸ã¯SPAãŒä¸»æµã¨è€ƒãˆã‚Œã°æ—§æ¥ã®OpenID Connectï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã§å—ã‘ã¦ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œã¯ã‚µãƒ¼ãƒãƒ¼ã§è¡Œã†ï¼‰ã¯èª¬æ˜ä¸è¦ã§ã—ã‚‡ã†ã€‚ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦ã¯ä½¿ã†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã£ã¦ã‚‚å¤‰ã‚ã‚‹ã®ã§å‰²æ„›ã—ã¾ã™ã€‚</p><p>æœ¬ç¨¿ã§ã¯ã€ãã‚Œä»¥å¤–ã®ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã€ãƒãƒƒãƒã‚³ãƒãƒ³ãƒ‰ã®èªè¨¼ã«ã¤ã„ã¦æ‰±ã„ã¾ã™ã€‚ä»Šåº¦ã¯ã‚¦ã‚§ãƒ–ä»¥å¤–ã®èªè¨¼ã¨ã„ã†ã“ã¨ã§ã€MSAL for Goã‚’ä½¿ã£ã¦èªè¨¼ã—ã¾ã™ã€‚ä¸Šã«ã‚ã’ãŸã‚ˆã†ã«ã€ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã‚±ãƒ¼ã‚¹ã¨ã€ç„¡äººé‹ç”¨ã®2ã¤ã®ã‚±ãƒ¼ã‚¹ã‚’å–ã‚Šä¸Šã’ã¾ã™ã€‚</p><h1 id="ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼"><a href="#ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼" class="headerlink" title="ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼"></a>ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼</h1><p>ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Windowsã¨ã‹Office 365ã¨ã‹ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€ã„ã‚ã‚†ã‚‹æ™®é€šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™ã€‚ã“ã®æ¨©é™ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã¨ã£ã¦APIã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã—ãŸã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã‚³ãƒãƒ³ãƒ‰ã‚’å‹•ã‹ã—ãŸäººã®åå‰ãŒãƒ­ã‚°ãŒæ®‹ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã¯ã€ã‚³ãƒãƒ³ãƒ‰ã¯ã¾ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€ŒãŠå‰èª°ã‚ˆã€ã¨èãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ã‚³ãƒãƒ³ãƒ‰ãŒè‡ªå‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›æ¬„ã‚’å‡ºã—ã¦å…¥åŠ›ã•ã›ã€ãã‚Œã‚’èªè¨¼ã§ä½¿ã†ãƒ•ãƒ­ãƒ¼ï¼ˆResource Owner Password Credentials Flowï¼‰ã¯ä»¥å‰ã¯ã‚ã‚Šã¾ã—ãŸãŒã€OAuth 2.1ã§ç„¡ããªã‚‹ã“ã¨ãŒç¢ºå®šã—ã¦ã„ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‚’è¡¨ç¤ºã—ã¦AzureADèªè¨¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡Œã£ã¦ã‚‚ã‚‰ã„ã€ãã®çµæœã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ãŒOAuth 2.1æ™‚ä»£ã«å”¯ä¸€ç¾å­˜ã™ã‚‹æ–¹æ³•ã§ã™ã€‚ãã®ãŸã‚ã€é€šä¿¡æ–¹å¼ã¨ã—ã¦ã¯ã€å‰å›ã®SPAãƒ¢ãƒ¼ãƒ‰ã¨åŒã˜ãã€Authorization Code Flowã¨ãªã‚Šã¾ã™ã€‚ã“ã®æ–¹å¼ã¯SPAã¨åŒæ§˜ã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã®ãƒ¢ãƒ¼ãƒ‰ãªã®ã§ãƒãƒƒãƒã‚³ãƒãƒ³ãƒ‰ã‚’æ‚ªæ„ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¥ªå–ã•ã‚Œã¦è§£æã•ã‚ŒãŸã¨ã—ã¦ã‚‚ç›´æ¥ãã‚ŒãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ›ãƒ¼ãƒ«ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚</p><p>ã¾ãšã¯ã€AzureADã®ç®¡ç†ç”»é¢ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™ï¼ˆå‰å›åŒæ§˜ï¼‰ã€‚å‰å›åŒæ§˜ã€ãƒ†ãƒŠãƒ³ãƒˆIDã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¯ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚</p><p>ãã®å¾Œã€èªè¨¼ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§èªè¨¼æ–¹å¼ã‚’è¿½åŠ ã—ã¾ã™ãŒã€ä»Šå›ã¯ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã€ã‚«ã‚¹ã‚¿ãƒ ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒãƒ¼ãƒˆã‚‚æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€<code>/callback</code>ãªã©ã®ãƒ‘ã‚¹ã¯ä¸è¦ã§ã™ï¼ˆå¾Œè¿°ï¼‰ã€‚</p><img src="/images/20221122a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-10_16.45.58.png" alt="" width="1200" height="570" loading="lazy"><p>Goç‰ˆã®MSALã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/AzureAD/microsoft-authentication-library-for-go</span><br></pre></td></tr></table></figure><p>ãªãŠã€è¿½åŠ ã§ã„ãã¤ã‹importã—ãªã„ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚ä¸æ€è­°ãªæ§‹æˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/AzureAD/microsoft-authentication-library-for-go/apps/internal/oauth/ops/accesstokens@v0.7.0</span><br><span class="line">$ go get github.com/AzureAD/microsoft-authentication-library-for-go/apps/errors@v0.7.0</span><br><span class="line">$ go get github.com/AzureAD/microsoft-authentication-library-for-go/apps/public@v0.7.0</span><br></pre></td></tr></table></figure><p>ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã¨ã‹ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯<code>.../apps/public</code>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ã‚Šã¾ã™ã€‚å‰å›ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã§ã‚‚ç´¹ä»‹ã—ãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ãŸãƒã‚¤ãƒŠãƒªã¯ãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã•ã‚Œã¦ã‚‚ã€ä¸æ­£ãƒ­ã‚°ã‚¤ãƒ³ã•ã‚Œã‚‹ææ–™ã¯æä¾›ã—ã¾ã›ã‚“ã€‚</p><p>ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã€JavaScriptç‰ˆã¨ã»ã¼åŒã˜APIã§ä¼¼ãŸã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚</p><figure class="highlight go"><figcaption><span>main.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/AzureAD/microsoft-authentication-library-for-go/apps/public&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pc, err := public.New(<span class="string">&quot;&#123;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID&#125;&quot;</span>, public.WithAuthority(<span class="string">&quot;https://login.microsoftonline.com/&#123;ãƒ†ãƒŠãƒ³ãƒˆID&#125;&quot;</span>))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">result, err := pc.AcquireTokenInteractive(context.Background(), []<span class="type">string</span>&#123;<span class="string">&quot;User.Read&quot;</span>&#125;, public.WithRedirectURI(<span class="string">&quot;&#123;ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URL&#125;&quot;</span>))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">log.Println(result.AccessToken)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ã“ã‚Œã ã‘ã§å®Ÿç¾ã§ãã¾ã—ãŸã€‚</p><h2 id="ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼æ–¹å¼ã®è›‡è¶³ãªèª¬æ˜"><a href="#ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼æ–¹å¼ã®è›‡è¶³ãªèª¬æ˜" class="headerlink" title="ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼æ–¹å¼ã®è›‡è¶³ãªèª¬æ˜"></a>ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼æ–¹å¼ã®è›‡è¶³ãªèª¬æ˜</h2><p>Goç‰ˆã®ã‚³ãƒ¼ãƒ‰ã‚’ã¿ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã€ãƒãƒ¼ãƒˆç•ªå·ã‚’å–ã‚Šå‡ºã—ã¦è‡ªåˆ†ã§ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’å—ã‘ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚µãƒ¼ãƒãƒ¼ã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ãƒ‘ã‚¹ã®éƒ¨åˆ†ã‚’èªè­˜ã—ã¦ãã‚Œãªã„ãŸã‚ã€AzureADã®ç™»éŒ²ã§ã¯<code>http://localhost:5173</code>ã®ã‚ˆã†ãªå½¢å¼ã«ã—ãªã„ã¨ã€Œã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç™»éŒ²ã¨é•ã†ã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ã¾ãŸã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã—ãªã„ã¨ã€ãƒ©ãƒ³ãƒ€ãƒ ãªãƒãƒ¼ãƒˆç•ªå·ã§èµ·å‹•ã—ã¾ã™ã€‚ãŸã ã€ãƒãƒ¼ãƒˆç•ªå·ãŒä¸€è‡´ã—ãªã„ã¨å¤±æ•—ã¨ãªã‚‹ã®ã§ã€ä½•ã‹ã—ã‚‰ã®ãƒãƒ¼ãƒˆã‚’ç™»éŒ²ã—ãªã„ã¨ã„ã‘ãªã„ã¯ãšã§ã™ã€‚</p><p>èªè¨¼æ–¹å¼ã§ãŠæ‰‹è»½ã ã£ãŸSPAã‚’é¸ã¶ã¨ã‚ˆã•ãã†ã§ã™ãŒã€ã“ã‚Œã¯ã€Œcross-origin requestsã˜ã‚ƒãªã„ã¨ãƒ€ãƒ¡ã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚ã¾ãŸã€ä¸€èˆ¬ã®ã‚¦ã‚§ãƒ–ã‚’é¸ã¶ã¨ã€Œclient_assertionâ€™ or â€˜client_secretã€ãŒå¿…è¦ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã®ã§ã€ä»Šå›é¸ã‚“ã ã€Œãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ä¸€æŠã§ã™ã€‚</p><p>ã¾ãŸã€ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³äº‘ã€…ã§ã¯ã€ç‹¬è‡ªã®ã‚¹ã‚­ãƒ¼ãƒã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã‚’è‡ªå‹•ã§ä½œã£ã¦ãã‚Œã¦ã„ã¾ã—ãŸã€‚MSALç”¨ã¨ã‚ã‚‹ã®ã§ä½¿ãˆãã†ã§ã™ãŒã€ã“ã‚Œã¯in app browserãªã©ã€ç‰¹å®šã®ã‚¹ã‚­ãƒ¼ãƒã®é€šä¿¡ã‚’æ¨ªå–ã‚Šã§ãã‚‹ç’°å¢ƒç”¨ã«ãªã£ã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ä¸€èˆ¬ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã“ã®æ–¹å¼ã¯ä½¿ãˆã¾ã›ã‚“ã€‚</p><h1 id="ç„¡äººé‹ç”¨ã®èªè¨¼"><a href="#ç„¡äººé‹ç”¨ã®èªè¨¼" class="headerlink" title="ç„¡äººé‹ç”¨ã®èªè¨¼"></a>ç„¡äººé‹ç”¨ã®èªè¨¼</h1><p>ãƒãƒƒãƒå‡¦ç†ãªã©ã§ã¯ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’å‡ºã—ãŸã‚Šã¯ã§ãã¾ã›ã‚“ã€‚ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®IDã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç„¼ãè¾¼ã‚“ã§ä½¿ã„ã€é€€è·ã«ã¨ã‚‚ãªã£ã¦åœæ­¢ã—ã¦å›°ã£ãŸã€ã¿ãŸã„ãªè©±ã¯æ˜”ã‹ã‚‰ä½•åº¦ã‚‚èãã¾ã™ã€‚ã“ã‚Œã¯é‹ç”¨ã¨ã—ã¦é–“é•ã£ã¦ã„ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼çš„ãªã‚‚ã®ã‚’ä½¿ã£ã¦é‹ç”¨ã™ã‚‹ã®ãŒãƒ™ã‚¹ãƒˆã§ã™ã€‚ã—ã‹ã—ã€å‰è¿°ã®ã‚ˆã†ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ„ãƒ¼ãƒ«ãŒç›´æ¥æ‰±ã†èªè¨¼ã¯éæ¨å¥¨ã§ã™ã€‚OAuth 2.1æ™‚ä»£ã«ä½¿ãˆã‚‹æ–¹å¼ã¨ã—ã¦ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ã£ãŸèªè¨¼æ–¹å¼ã«ãªã‚Šã¾ã™ã€‚</p><p>ã¾ãšã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã€Œè¨¼æ˜æ›¸ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã€ã‚’é¸æŠã—ã€æ–°ã—ã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’é¸æŠã—ã¦ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œã‚Šã¾ã™ã€‚</p><img src="/images/20221122a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-11_20.14.23.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-11_20.14.23.png" width="1200" height="497" loading="lazy"><p>å‡ºæ¥ä¸ŠãŒã‚‹ã¨ã€ã€Œå€¤ã€ã¨ã€Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆIDã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€å€¤ã®æ–¹ãŒå¿…è¦ãªã‚‚ã®ãªã®ã§ã€ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã¾ã™ã€‚</p><img src="/images/20221122a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-11_21.34.44.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-11_21.34.44.png" width="1200" height="563" loading="lazy"><p>ã“ã‚Œã‚’çµ„ã¿è¾¼ã‚“ã ã‚³ãƒ¼ãƒ‰ãŒä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚å‰å›ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚„å‰è¿°ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚±ãƒ¼ã‚¹ã¨ã¯ç•°ãªã‚Šã€ä»Šå›ã¯<code>.../confidential</code>ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã‚³ãƒ³ãƒ•ã‚£ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã€æ”»æ’ƒè€…ãŒãƒã‚¤ãƒŠãƒªã«ã•ã‚ã‚Œãªã„ç’°å¢ƒã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å¥ªå–ã•ã‚Œã¦ã—ã¾ã†ã¨ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¦ã—ã¾ã†ã®ã§ã“ã®ãƒãƒƒãƒã‚³ãƒãƒ³ãƒ‰ã¯ï¼ˆåºƒãé…å¸ƒã—ãªã„å‰æã®ï¼‰ç¤¾å†…å°‚ç”¨ãƒ„ãƒ¼ãƒ«ã ã£ãŸã‚Šã€ãƒãƒƒãƒã‚µãƒ¼ãƒãƒ¼ã§ã®ã¿é‹ç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹ã§ã—ã‹ä½¿ã£ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/AzureAD/microsoft-authentication-library-for-go/apps/confidential&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s, err := confidential.NewCredFromSecret(<span class="string">&quot;&#123;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">cc, err := confidential.New(<span class="string">&quot;&#123;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID&#125;&quot;</span>, s,</span><br><span class="line">        confidential.WithAuthority(<span class="string">&quot;https://login.microsoftonline.com/&#123;ãƒ†ãƒŠãƒ³ãƒˆID&#125;&quot;</span>))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">result, err := cc.AcquireTokenByCredential(context.Background(), []<span class="type">string</span>&#123;<span class="string">&quot;https://graph.microsoft.com/.default&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">log.Println(result.AccessToken)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„ãƒã‚¤ãƒ³ãƒˆã¯ã‚¹ã‚³ãƒ¼ãƒ—ã®æŒ‡å®šã§ã™ã€‚ã€Œãƒªã‚½ãƒ¼ã‚¹ã®URLã€ã¨ã€Œæ¨©é™ï¼ˆãƒ‘ã‚¹å½¢å¼ï¼‰ã€ã‚’çµ„ã¿åˆã‚ã›ãŸURLå½¢å¼ã§æŒ‡å®šã—ã¾ã™ã€‚SharePointã ã¨ã€<code>https://&#123;ã‚µã‚¤ãƒˆå&#125;.sharepoint.com/&#123;æ¨©é™&#125;</code>ã§ã™ã€‚æ¨©é™éƒ¨åˆ†ã¯<code>/.default</code>ã‹ã€<a href="https://learn.microsoft.com/en-us/graph/permissions-reference#sites-permissions">ã“ã“</a>ã«æ›¸ã„ã¦ã‚ã‚‹ã‚ˆã†ãª<code>Sites.FullControl.All</code>ã®ã‚ˆã†ãªæ–‡å­—åˆ—ã‚’ä½¿ã„ã¾ã™ã€‚ãªãœãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ™‚ã¨é•ã†åå‰ãªã®ã‹ãƒ»ãƒ»ãƒ»</p><h1 id="èªè¨¼ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥"><a href="#èªè¨¼ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥" class="headerlink" title="èªè¨¼ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥"></a>èªè¨¼ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥</h1><p>ãƒãƒƒãƒå‡¦ç†ã‚’æ¯ç§’å®Ÿè¡Œã™ã‚‹ã¨ã—ã¦ã€æ¯ç§’èªè¨¼ã™ã‚‹ã®ã¯ç„¡é§„ãŒå¤šã„ã§ã—ã‚‡ã†ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœ‰åŠ¹ãªé–“ã¯åŒã˜ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã„ã¾ã‚ã—ãŸã„ã¨ã“ã‚ã§ã™ã€‚MSAL for Goã§ã¯è‡ªåˆ†ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ã‚’ä½œã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã¨ã„ã£ã¦ã‚‚ã€å¤§ä½“ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®èª­ã¿æ›¸ãã ã¨æ€ã†ã®ã§ã€æ¬¡ã®ã‚µãƒ³ãƒ—ãƒ«ã®é€šã‚Šã«å®Ÿè£…ã™ã‚Œã°ãŠã—ã¾ã„ã§ã™ã€‚</p><p><a href="https://github.com/AzureAD/microsoft-authentication-library-for-go/blob/dev/apps/tests/devapps/sample_cache_accessor.go">https://github.com/AzureAD/microsoft-authentication-library-for-go/blob/dev/apps/tests/devapps/sample_cache_accessor.go</a></p><p>ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å ´åˆã¯æ¬¡ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’<code>New</code>ã«è¿½åŠ ã—ã¾ã™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public.WithCache(&amp;TokenCache&#123;<span class="string">&quot;ãƒ•ã‚¡ã‚¤ãƒ«å&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><p>ã‚³ãƒ³ãƒ•ã‚£ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å ´åˆã¯æ¬¡ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’<code>New</code>ã«è¿½åŠ ã—ã¾ã™ã€‚ãªãœé•ã†åå‰ãªã®ã‹ãƒ»ãƒ»ãƒ»</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">confidential.WithAccessor(cache)</span><br></pre></td></tr></table></figure><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>ä»Šå›ã‚‚ãƒãƒƒãƒã‚³ãƒãƒ³ãƒ‰ã‚’æƒ³å®šã—ã¦AzureADã¨èªè¨¼ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸèªè¨¼ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚</p><p>ã“ã®æ‰‹ã®æ¤œè¨¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ¼ãƒ‰å´ã ã‘ã§ã¯ãªãã€æ¥ç¶šå…ˆã®AzureADã®è¨­å®šã«ã‚ˆã£ã¦ã‚‚æ¥ç¶šãŒå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ã“ã®ã‚ãŸã‚Šã®è¨­å®šã¯ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«åº¦ãŒé«˜ã„ãŸã‚ã€ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹äººã¯ãªã‚‹ã¹ãå°‘ãªãã™ã‚‹é‹ç”¨ãŒã•ã‚Œã‚‹ã“ã¨ãŒã»ã¨ã‚“ã©ã§ã™ã€‚ç‰¹ã«å—è¨—é–‹ç™ºã§ã€ãŠå®¢ã•ã‚“å´ã§AzureADã®è¨­å®šã‚’ç®¡ç†ã—ã¦ã„ã‚‹å ´åˆãªã©ã€é–‹ç™ºå´ã§ã¯ç›´æ¥ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒè§¦ã‚Œãšã«ã€ã‚¨ã‚¹ãƒ‘ãƒ¼ã—ãªãŒã‚‰è©¦è¡ŒéŒ¯èª¤ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„å ´é¢ãŒã‚ã‚Šã¾ã™ã€‚ãŠå®¢ã•ã‚“å´ã«ã‚‚æ™‚é–“ã‚’å–ã£ã¦ã‚‚ã‚‰ã‚ãªã„ã¨ã„ã‘ãªã„ã—ã€è‡ªç”±ãªè©¦è¡ŒéŒ¯èª¤ãŒé›£ã—ã‹ã£ãŸã‚Šã¨ã€é´ã®è£ã‹ã‚‰è¶³ã®è£ã‚’æ»ãã‚ˆã†ãªã‚‚ã©ã‹ã—ã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚<br>å‰å›ã¨ä»Šå›ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¯ã€ãã®ã‚ˆã†ãªå ´åˆã«ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ã€AzureADå´ã®è¨­å®šã®ä¾é ¼ãŒæŠ•ã’ã‚„ã™ã„ã‚ˆã†ã«ã€é–‹ç™ºã®ã‚¹ãƒˆãƒ¬ã‚¹ã‚’ä¸‹ã’ãŸã„ã€ã¨ã„ã†æ€ã„ã§ç®¡ç†ç”»é¢å´ã®è¨­å®šã‚‚ãªã‚‹ã¹ãå…·ä½“çš„ã«æ›¸ã„ã¦ã„ã¾ã™ã€‚</p><p>MSALç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ãŸãã•ã‚“ã®å®Ÿè£…ãŒã‚ã‚Šã¾ã™ãŒã€ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚‚Goã‚‚ã€APIã¯ã»ã¼ä¸€ç·’ã§ã—ãŸã€‚Javaã¨ã‹ã¿ã¦ã¿ã¦ã‚‚ã™ãã«ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã§ããã†ã§ã™ã€‚ç°¡å˜ã§å®‰å…¨ãªæ¥ç¶šãŒã§ãã‚‹ãŸã‚ã€æ¥ç¶šå…ˆãŒAzureADã§ã‚ã‚Œã°ç©æ¥µçš„ã«MSALã‚·ãƒªãƒ¼ã‚ºã‚’æ´»ç”¨ã—ã¦ã¿ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã—ãŸã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;&lt;a</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="Go" scheme="https://future-architect.github.io/tags/Go/"/>
    
    <category term="Azure" scheme="https://future-architect.github.io/tags/Azure/"/>
    
    <category term="AD" scheme="https://future-architect.github.io/tags/AD/"/>
    
    <category term="MSAL.js" scheme="https://future-architect.github.io/tags/MSAL-js/"/>
    
    <category term="AzureAD" scheme="https://future-architect.github.io/tags/AzureAD/"/>
    
  </entry>
  
  <entry>
    <title>IPAã®éå»å•ã§å­¦ã¶C &amp; C(Command &amp; Control)ã‚µãƒ¼ãƒã®æ‰‹æ³•ã¨å¯¾å¿œç­–</title>
    <link href="https://future-architect.github.io/articles/20221121a/"/>
    <id>https://future-architect.github.io/articles/20221121a/</id>
    <published>2022-11-20T15:00:00.000Z</published>
    <updated>2022-11-21T01:19:57.507Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221121a/candc.png" alt="" width="1200" height="700" loading="lazy"><h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ã€‚TIG æ‘ç€¬ã§ã™ã€‚<br><a href="/articles/20220511a/">å‰å›</a>ã«å¼•ãç¶šãã€æƒ…å ±å‡¦ç†æ¨é€²æ©Ÿæ§‹(IPA)ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆè©¦é¨“ã®éå»å•ã‹ã‚‰C&amp;C(Command &amp; Control)ã‚µãƒ¼ãƒã®æ‰‹æ³•ã¨å¯¾å¿œç­–ãŒèˆˆå‘³æ·±ã‹ã£ãŸã®ã§è‡ªåˆ†ã®çŸ¥è­˜ã‚’æ•´ç†ã™ã‚‹ãŸã‚ãƒ–ãƒ­ã‚°ã«ã—ã¦ã¿ã¾ã—ãŸã€‚</p><p>å¯¾è±¡ã®è©¦é¨“ã¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆè©¦é¨“ ä»¤å’Œå…ƒå¹´åº¦ åˆå¾Œâ…¡ å•2<br>éå»å•ã¯<a href="https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2019h31.html#01aki">ã“ã¡ã‚‰</a>ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™ã€‚</p><p>å½“ãŸã‚Šå‰ã§ã™ãŒã€ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯çŠ¯ç½ªè¡Œç‚ºã‚’æ¨å¥¨ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ„è­˜ã€å¯¾ç­–ã®å‘ä¸Šã‚’ç›®çš„ã¨ã—ã¦è¨˜è¼‰ã—ã¦ãŠã‚Šã¾ã™ã€‚</p><h1 id="C-amp-C-Command-amp-Control-ã‚µãƒ¼ãƒã¨ã¯"><a href="#C-amp-C-Command-amp-Control-ã‚µãƒ¼ãƒã¨ã¯" class="headerlink" title="C&amp;C(Command &amp; Control)ã‚µãƒ¼ãƒã¨ã¯"></a>C&amp;C(Command &amp; Control)ã‚µãƒ¼ãƒã¨ã¯</h1><p>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã—ã¦ãƒœãƒƒãƒˆãƒãƒƒãƒˆã‚„PCä¸Šã®ãƒãƒ«ã‚¦ã‚§ã‚¢ã«å¯¾ã—ã¦å‘½ä»¤(Command)ã‚’é€ä¿¡ã—ã€é éš”æ“ä½œ(Control)ã™ã‚‹ã‚µãƒ¼ãƒã§ã™ã€‚</p><h1 id="ãªãœã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å†…éƒ¨LANã®PCã«é éš”æ“ä½œã§ãã‚‹ã®ã‹"><a href="#ãªãœã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å†…éƒ¨LANã®PCã«é éš”æ“ä½œã§ãã‚‹ã®ã‹" class="headerlink" title="ãªãœã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å†…éƒ¨LANã®PCã«é éš”æ“ä½œã§ãã‚‹ã®ã‹"></a>ãªãœã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å†…éƒ¨LANã®PCã«é éš”æ“ä½œã§ãã‚‹ã®ã‹</h1><p>é©åˆ‡ã«ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®è¨­å®šãŒã•ã‚Œã¦ã„ã‚Œã°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å†…éƒ¨LANä¸Šã®PCã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã¯ãšã§ã™ã€‚ã—ã‹ã—ãªãŒã‚‰å†…éƒ¨LANã®PC(ã®ãƒãƒ«ã‚¦ã‚§ã‚¢)ã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®C&amp;Cã‚µãƒ¼ãƒã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’çªç ´ã—Commandã‚’å–å¾—ã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯HTTPS,HTTPãªã©ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã®ã§ä¸€èˆ¬ã®WEBãƒšãƒ¼ã‚¸ã¨è¦‹åˆ†ã‘ãŒã¤ãã¾ã›ã‚“ã€‚WEBãƒšãƒ¼ã‚¸ã®é–²è¦§ã¯è¨±å®¹ã•ã‚Œã¦ã„ã‚‹ä¼æ¥­ãŒå¤šã„ãŸã‚ã€ä¸€åº¦ãƒãƒ«ã‚¦ã‚§ã‚¢ã®ä¾µå…¥ã‚’è¨±ã—ã¦ã—ã¾ã†ã¨ç¶™ç¶šçš„ã«Commandã‚’å—ã‘ä»˜ã‘ã¦ã—ã¾ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p><img src="/images/20221121a/candc1.png" alt="candc1.png" width="1186" height="669" loading="lazy"><h1 id="è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³•-IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ãŸé®æ–­"><a href="#è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³•-IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ãŸé®æ–­" class="headerlink" title="è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³• IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ãŸé®æ–­"></a>è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³• IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ãŸé®æ–­</h1><p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆè©¦é¨“ ä»¤å’Œå…ƒå¹´åº¦ åˆå¾Œâ…¡ å•2 ã‹ã‚‰æŠœç²‹</p><blockquote><p>C&amp;Cã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç‰¹å®šã§ãã‚Œã°ã€FPã‚µãƒ¼ãƒã§C&amp;Cã‚µãƒ¼ãƒã¨ã®é€šä¿¡ã¯é®æ–­ã§ãã‚‹ã€‚</p></blockquote><p>å•é¡Œæ–‡ã«ã‚ã‚‹ã¨ãŠã‚Šã€C&amp;Cã‚µãƒ¼ãƒã¨ã®é€šä¿¡ã¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç‰¹å®šã§ãã‚Œã°FP(ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·)ã‚µãƒ¼ãƒã§é®æ–­ã§ãã¾ã™ã€‚</p><img src="/images/20221121a/candc2.png" alt="candc2.png" width="1017" height="464" loading="lazy"><h1 id="æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ”ªä¹±-Fast-Flux"><a href="#æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ”ªä¹±-Fast-Flux" class="headerlink" title="æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ”ªä¹± Fast Flux"></a>æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ”ªä¹± Fast Flux</h1><p>é€šä¿¡é®æ–­ã®ãŸã‚ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç‰¹å®šã—ãŸã„ã®ã§ã™ãŒã€æ”»æ’ƒè€…ã¯Fast Fluxã¨å‘¼ã°ã‚Œã‚‹æ‰‹æ³•ã‚’ç”¨ã„ã¦IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç‰¹å®šã‚’å›°é›£ã«ã—ã¾ã™ã€‚</p><h2 id="Fast-Fluxã¨ã¯"><a href="#Fast-Fluxã¨ã¯" class="headerlink" title="Fast Fluxã¨ã¯"></a>Fast Fluxã¨ã¯</h2><p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆè©¦é¨“ ä»¤å’Œå…ƒå¹´åº¦ åˆå¾Œâ…¡ å•2 ã‹ã‚‰æŠœç²‹</p><blockquote><p>Fast Fluxã¯ã€ç‰¹å®šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã™ã‚‹DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’çŸ­æ™‚é–“ã«å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ã‚µãƒ¼ãƒã®è¿½è·¡ã‚’å›°é›£ã«ã•ã›ã‚‹æ‰‹æ³•ã§ã‚ã‚‹ã€‚</p></blockquote><blockquote><p>ãƒãƒ«ã‚¦ã‚§ã‚¢ãŒã€ä¸€å®šé–“éš”ã§fast-flux.example.comã¸ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œãˆã°ã€æ¯å›ã€ç•°ãªã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã€ãƒœãƒƒãƒˆã‚’çµŒç”±ã—ã¦C&amp;Cã‚µãƒ¼ãƒã¨é€šä¿¡ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚</p></blockquote><p>å•é¡Œæ–‡ã«ã‚ã‚‹ã¨ãŠã‚Šfast-flux.example.comã«å¯¾ã™ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¤‡æ•°è¨­å®šã—ã€ã‹ã¤çŸ­æ™‚é–“ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¤‰æ›´ã—ã¾ã™ã€‚<br>å‰å›èª¬æ˜ã—ãŸDNSã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°ã§ã¯æ”»æ’ƒè€…ã‹ã‚‰æ”»æ’ƒã‚’å—ã‘ã«ããã™ã‚‹ãŸã‚ã®æ–½ç­–ã¨ã—ã¦å¤§é‡ã®é€ä¿¡å…ƒãƒãƒ¼ãƒˆç•ªå·ã‚’åˆ©ç”¨ã—ã¾ã—ãŸãŒã€åå¯¾ã«ãã‚Œã‚’æ‚ªç”¨ã•ã‚ŒãŸæ„Ÿã˜ãŒã—ã¾ã™ã­ã€‚<br>ã“ã‚Œã‚’ã‚„ã‚‰ã‚Œã‚‹ã¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç‰¹å®šãŒå›°é›£ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚</p><img src="/images/20221121a/candc3.png" alt="candc3" width="915" height="577" loading="lazy"><h1 id="è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³•-FQDNã‚’æŒ‡å®šã—ãŸé®æ–­"><a href="#è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³•-FQDNã‚’æŒ‡å®šã—ãŸé®æ–­" class="headerlink" title="è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³• FQDNã‚’æŒ‡å®šã—ãŸé®æ–­"></a>è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³• FQDNã‚’æŒ‡å®šã—ãŸé®æ–­</h1><p>IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç‰¹å®šãŒå›°é›£ãªã®ã§ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã¯ãªããƒãƒ«ã‚¦ã‚§ã‚¢ãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹FQDN(fast-flux.example.com)ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ã§é€šä¿¡ã®é®æ–­ã‚’è©¦ã¿ã¾ã™ã€‚</p><h1 id="æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ”ªä¹±-Domain-Flux"><a href="#æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ”ªä¹±-Domain-Flux" class="headerlink" title="æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ”ªä¹± Domain Flux"></a>æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ”ªä¹± Domain Flux</h1><p>æ”»æ’ƒè€…ã¯ã“ã‚Œã‚’é¿ã‘ã‚‹ãŸã‚ã«Domain Fluxã¨å‘¼ã°ã‚Œã‚‹æ‰‹æ³•ã‚’ç”¨ã„ã¾ã™ã€‚</p><h2 id="Domain-Fluxã¨ã¯"><a href="#Domain-Fluxã¨ã¯" class="headerlink" title="Domain Fluxã¨ã¯"></a>Domain Fluxã¨ã¯</h2><p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆè©¦é¨“ ä»¤å’Œå…ƒå¹´åº¦ åˆå¾Œâ…¡ å•2 ã‹ã‚‰æŠœç²‹</p><blockquote><p>Domain Fluxã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’ç”¨ã„ã¦ã€ã‚ã‚‰ã‚†ã‚‹ãƒ›ã‚¹ãƒˆåã«å¯¾ã—ã¦ã€åŒä¸€ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¿œç­”ã™ã‚‹æ‰‹æ³•ã§ã‚ã‚‹ã€‚Fast Fluxã¨Domain Fluxã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€C&amp;Cã‚µãƒ¼ãƒã®FQDNã¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸¡æ–¹ã‚’éš è”½ã§ãã‚‹ã€‚</p></blockquote><p>ãªã‚“ã¨ã„ã†ã“ã¨ã§ã—ã‚‡ã†ã€‚FQDNãŒç‰¹å®šã§ãã¾ã›ã‚“ã€‚ãƒãƒ«ã‚¦ã‚§ã‚¢ã¯ãã£ã¨ãƒ›ã‚¹ãƒˆåã®éƒ¨åˆ†(fast-flux)ã‚’å®šæœŸçš„ã«å¤‰æ›´ã—ã¦C&amp;Cã¨é€šä¿¡ã™ã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚<br><img src="/images/20221121a/candc4.png" alt="candc4" width="1127" height="652" loading="lazy"></p><p>ã“ã‚Œã«é–¢ã—ã¦ã¯ç¢ºã‹ã«FQDNã¯ç‰¹å®šã§ãã¾ã›ã‚“ãŒãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’ç”¨ã„ã¦*.example.comã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é®æ–­ã™ã‚Œã°ã‚ˆã•ãã†ã§ã™ã€‚<br>ã™ã”ã„æ‰‹æ³•ã ã¨æ€ã„ã¾ã—ãŸãŒã€ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’æŒ‡å®šã—ã¦é®æ–­ã§ãã‚‹ã®ã§æ€–ããªã„ã§ã™ã­ã€‚</p><img src="/images/20221121a/candc5.png" alt="candc5" width="1159" height="654" loading="lazy"><h1 id="è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³•-ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®å°å…¥"><a href="#è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³•-ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®å°å…¥" class="headerlink" title="è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³• ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®å°å…¥"></a>è©¦é¨“å•é¡Œã«åŸºã¥ãå¯¾å¿œæ–¹æ³• ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®å°å…¥</h1><p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆè©¦é¨“ ä»¤å’Œå…ƒå¹´åº¦ åˆå¾Œâ…¡ å•2 ã‹ã‚‰æŠœç²‹</p><blockquote><p>ã“ã®ã‚ˆã†ãªæ”»æ’ƒãŒè¡Œã‚ã‚ŒãŸå ´åˆã‚’æƒ³å®šã—ã€2äººã¯ã€ç¾è¡Œã®FPã‚µãƒ¼ãƒã‚’HTTPSé€šä¿¡ã®å¾©å·æ©Ÿèƒ½ã‚’ã‚‚ã¤æ©Ÿç¨®ã«äº¤æ›ã—ã€ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã‚’ä½µã›ã¦è¡Œã†ã“ã¨ã«ã—ãŸã€‚</p></blockquote><p>ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã‚’è¨­ã‘ã‚‹ã“ã¨ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„FQDNãŒä½•ã§ã‚ã‚Œã€ãƒ—ãƒ­ã‚­ã‚·ã®èªè¨¼æƒ…å ±ã‚’çŸ¥ã‚‰ãªã„ãƒãƒ«ã‚¦ã‚§ã‚¢ã¯C&amp;Cã‚µãƒ¼ãƒã¨é€šä¿¡ã§ããªããªã‚Šã¾ã™ã€‚<br>ãƒãƒ«ã‚¦ã‚§ã‚¢ãŒã‚‚ã—å‹•ä½œã—ã¦ã„ãŸã‚‰FPã‚µãƒ¼ãƒã®ãƒ­ã‚°ã«èªè¨¼å¤±æ•—ã®ãƒ­ã‚°ãŒçŸ­æ™‚é–“ã«å¤§é‡ã«å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚<br>ã“ã®å¯¾å¿œã«ã‚ˆã‚Šé€šä¿¡ã®é®æ–­ã¨æ„ŸæŸ“ã®æ¤œçŸ¥ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p><img src="/images/20221121a/candc6.png" alt="candc6" width="1151" height="645" loading="lazy"><h1 id="å¯¾å¿œã«é–¢ã—ã¦"><a href="#å¯¾å¿œã«é–¢ã—ã¦" class="headerlink" title="å¯¾å¿œã«é–¢ã—ã¦"></a>å¯¾å¿œã«é–¢ã—ã¦</h1><p>è©¦é¨“å•é¡Œã¨ã„ã†ç‰¹æ€§ä¸Šã€åŠ¹æœã®ä½ã„å¯¾å¿œã‹ã‚‰ã—ã¦ã„ãã¾ã—ãŸãŒã€æœ¬æ¥ã§ã‚ã‚Œã°è²»ç”¨å¯¾åŠ¹æœãŒé«˜ã„æ–½ç­–ã‹ã‚‰æ‰“ã¦ã‚‹ã¨è‰¯ã„ã§ã™ã­ã€‚<br>ã¾ãŸã€å•é¡Œæ–‡ã«ãŠã„ã¦ã‚‚ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚’äº¤æ›ã—ã¦ã„ã¾ã—ãŸã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é‡è¦ã•ã‚’åˆ†ã‹ã£ãŸäººãŒã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ãƒ¼ã«å¯¾å¿œã§ãã‚‹çµ„ç¹”ã¯å¼·ã„ã§ã™ã­ã€‚</p><h1 id="ã•ã„ã”ã«"><a href="#ã•ã„ã”ã«" class="headerlink" title="ã•ã„ã”ã«"></a>ã•ã„ã”ã«</h1><p>è©¦é¨“å•é¡Œãªã®ã§é€šå¸¸ã¯èª­ã¿ç‰©ã¨ã—ã¦é¢ç™½ãã‚ã‚Šã¾ã›ã‚“ãŒã€ã“ã®å•é¡Œã«é–¢ã—ã¦ã¯æ”»æ’ƒè€…ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é‹ç”¨æ‹…å½“ã®æ”»é˜²ãŒè¦‹ã‚‰ã‚Œã€ãƒãƒ©ãƒãƒ©ãƒ‰ã‚­ãƒ‰ã‚­ã—å°èª¬ã‚’èª­ã‚“ã§ã„ã‚‹ã‹ã®ã‚ˆã†ã«é¢ç™½ã‹ã£ãŸã§ã™ã€‚</p><p>åŠ ãˆã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã ã‘ã§ã¯ãªãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®çŸ¥è­˜å‘ä¸Šã«ç¹‹ãŒã‚‹ã®ã§ã¨ã¦ã‚‚è‰¯ã„å•é¡Œã ã¨æ€ã„ã¾ã—ãŸã€‚</p><p>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯é‡è¦ã§ã™ãŒã€ã‚„ã¿ãã‚‚ã«æã‚Œã¦ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚³ã‚¹ãƒˆãŒã„ãã‚‰ã‚ã£ã¦ã‚‚è¶³ã‚Šã¾ã›ã‚“ã€‚ã©ã†ã„ã£ãŸä»•çµ„ã¿ã§æ”»æ’ƒãŒæˆåŠŸã™ã‚‹ã‹ã‚’é©åˆ‡ã«ç†è§£ã—ã¦ãŠãã“ã¨ã§ã€è²»ç”¨å¯¾åŠ¹æœã®é«˜ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚„ã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã™ã€‚</p><p>æ—¥ã€…æ–°ãŸãªè„†å¼±æ€§ãŒè¦‹ã¤ã‹ã‚‹çŠ¶æ³ã§ã‚ã‚‹ãŸã‚ã€100%å®‰å…¨ã¨è¨€ã„åˆ‡ã‚Œã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚ã—ã‹ã—ãã®ã‚ˆã†ãªçŠ¶æ³ã§ã‚ã£ã¦ã‚‚æ”»æ’ƒã«åˆã†ç¢ºç‡ã‚’å¦‚ä½•ã«0%ã«è¿‘ã¥ã‘ã‚‹ã‹ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®è…•ã®è¦‹ã›æ‰€ã‹ã¨æ€ã„ã¾ã™ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221121a/candc.png&quot; alt=&quot;&quot; width=&quot;1200&quot; height=&quot;700&quot; loading=&quot;lazy&quot;&gt;


&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="Security" scheme="https://future-architect.github.io/categories/Security/"/>
    
    
    <category term="Network" scheme="https://future-architect.github.io/tags/Network/"/>
    
    <category term="IPA" scheme="https://future-architect.github.io/tags/IPA/"/>
    
    <category term="Security" scheme="https://future-architect.github.io/tags/Security/"/>
    
    <category term="C&amp;Cã‚µãƒ¼ãƒ" scheme="https://future-architect.github.io/tags/C-C%E3%82%B5%E3%83%BC%E3%83%90/"/>
    
  </entry>
  
  <entry>
    <title>MSAL.jsã‚’ä½¿ã£ã¦ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã ã‘ã§AzureADèªè¨¼ã™ã‚‹</title>
    <link href="https://future-architect.github.io/articles/20221118a/"/>
    <id>https://future-architect.github.io/articles/20221118a/</id>
    <published>2022-11-17T15:00:00.000Z</published>
    <updated>2022-12-03T06:05:02.726Z</updated>
    
    <content type="html"><![CDATA[<p><strong>11&#x2F;30æ›´æ–°</strong> ã‚¹ã‚³ãƒ¼ãƒ—ã‚’<code>[&quot;User.Read&quot;]</code>ã¨ã—ã¦ã„ã¾ã—ãŸãŒã€<code>[&#39;&#123;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID&#125;/.default&#39;]</code>ã«ã—ãªã„ã¨ç½²åãŒvalidãªãƒˆãƒ¼ã‚¯ãƒ³ã«ãªã‚‰ãªã„ã¨ã„ã†ç½ ãŒã‚ã‚Šã¾ã—ãŸã®ã§ä¿®æ­£ã—ã¦ã„ã¾ã™ã€‚</p><p>AzureADã‚’ä½¿ã£ã¦èªè¨¼ã‚’è¡Œã£ã¦ã„ã‚‹ä¼æ¥­ã¯å¤šã„ã¨æ€ã„ã¾ã™ã€‚ã“ã®AzureADã‚’ä½¿ã£ãŸå ´åˆã«ã¯MSAL.jsã‚’ä½¿ãˆã°èªè¨¼ã¯æ¥½ã ãã€ã¨ã„ã†ã®ã¯AzureADã®ã‚µã‚¤ãƒˆã«ã¯æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€OpenID Connectã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å‹•ãã®ç†è§£ã¨ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®APIãŒã©ã†å¯¾å¿œã¥ã„ã¦ã„ã‚‹ã®ã‹ãŒã‚ã‹ã‚‰ãšã«ã¡ã‚‡ã£ã¨è©¦è¡ŒéŒ¯èª¤ã—ãŸã®ã§ã€ãã®ãƒ¡ãƒ¢ã‚’æ®‹ã—ã¦ãŠãã¾ã™ã€‚</p><p>OAuth 2.1(ç¾åœ¨ç­–å®šä¸­)ã§ã¯Implicit Code FlowãŒéæ¨å¥¨ã«ãªã‚Šã€Authorization Code Flowã«PKCEãŒè¿½åŠ ã•ã‚Œã¦ã€ã‚³ãƒ¼ãƒ‰æ¨ªå–ã‚Šæ”»æ’ƒã¸ã®è€æ€§ãŒå¼·åŒ–ã•ã‚Œã¦ã€ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã€ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãªã©ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å´ã§å‹•ä½œã™ã‚‹ãŸã‚æ”»æ’ƒè€…ãŒè‡ªç”±ã«ã„ã˜ã‚Œã‚‹ï¼‰ã§ã‚‚å®‰å…¨ã«èªè¨¼ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚OAuth 2.1è‡ªä½“ã¯ã¾ã ä½œæ¥­ä¸­ã§ã¯ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯OAuth 2.0ã‹ã‚‰å°‘ã—ãšã¤è¿½åŠ ã•ã‚ŒãŸã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ã¾ã¨ã‚ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚ã‚Šã€ç¾åœ¨ã§ã‚‚ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯ä½¿ãˆã¾ã™ã€‚</p><p>MSAL.js 2.0ã¨ã„ã†Microsoftè£½ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã“ã®PKCEå¯¾å¿œã‚’ã†ãŸã£ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã®ã§ã€ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ãˆã°ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§ç”¨æ„ã›ãšã¨ã‚‚ã€ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã ã‘ã§èªè¨¼ãŒå¯èƒ½ã¨ãªã‚‹ã¯ãšã§ã™ã®ã§ã€å®Ÿé¨“ã—ã¦ã¿ã¾ã—ãŸã€‚</p><p>å®Ÿç¾ã—ãŸã„ã“ã¨ã¯</p><ul><li>MSAL.js (npmã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯<a href="https://www.npmjs.com/package/@azure/msal-browser">@azure&#x2F;msal-browser</a>)ã‚’çµ„ã¿è¾¼ã‚€</li><li>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã ã‘ã§èªè¨¼ã™ã‚‹</li></ul><p>ãªãŠã€ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ã€Reactã¨Angularå‘ã‘ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å‘ã‘ã®ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ãŒã€å‹•ãã‚’çŸ¥ã‚‹ãŸã‚ã«ç›´æ¥ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p><h1 id="ã¾ãšã¯å®Ÿé¨“ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’AzureADã«ç™»éŒ²ã™ã‚‹"><a href="#ã¾ãšã¯å®Ÿé¨“ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’AzureADã«ç™»éŒ²ã™ã‚‹" class="headerlink" title="ã¾ãšã¯å®Ÿé¨“ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’AzureADã«ç™»éŒ²ã™ã‚‹"></a>ã¾ãšã¯å®Ÿé¨“ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’AzureADã«ç™»éŒ²ã™ã‚‹</h1><p>ã¾ãšã¯Azureã®Active Directoryã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™ã€‚</p><ul><li>åå‰ã¯é©å½“ã«(azuread-testã§ã‚‚ãªã‚“ã§ã‚‚)</li><li>ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç¨®é¡ã‚‚ä»»æ„</li><li>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ç¨®é¡ã¯ <strong>ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³(SPA)</strong> ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã¯<code>http://localhost:5173/callback</code>ã«ã™ã‚‹ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ã‹ã™é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã§å—ã‘ã‚‹ãŸã‚ï¼‰</li></ul><p>ãªãŠã€ã™ã¹ã¦ã®é …ç›®ã¯ã‚ã¨ã§ä¿®æ­£ã§ãã¾ã™ã®ã§(ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¨®é¡ã¯ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§JSONã„ã˜ã‚‹å¿…è¦ãŒã‚ã£ã¦é¢å€’ã§ã™ãŒï¼‰ã€æ°—è»½ãªæ°—æŒã¡ã§ä½œæˆã§ãã¾ã™ã€‚ã¾ãŸã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæƒ…å ±ã¯è¤‡æ•°ç™»éŒ²ã§ãã¾ã™ã€‚</p><img src="/images/20221118a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-09_12.34.58.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-09_12.34.58.png" width="1200" height="818" loading="lazy"><p>ä½œæˆã—ãŸã‚ã¨ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸ã¶ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€æ¬¡ã®2ã¤ã®UUIDå‹å¼ã®IDã¯ã‚ã¨ã§å¤§äº‹ã«ãªã‚Šã¾ã™ã€‚</p><ul><li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ) ID</li><li>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª (ãƒ†ãƒŠãƒ³ãƒˆ) ID</li></ul><img src="/images/20221118a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-09_12.37.10.png" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2022-11-09_12.37.10.png" width="1200" height="710" loading="lazy"><h1 id="ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä½œæˆ"><a href="#ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä½œæˆ" class="headerlink" title="ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä½œæˆ"></a>ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä½œæˆ</h1><p>ä»Šå›ã¯Vue.jsã§ä½œã£ã¦ã¿ã¾ã—ãŸã€‚èªè¨¼éƒ¨åˆ†ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åŒ–ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚Reactã§ã‚ã‚Œã°ContextåŒ–ã™ã‚Œã°ã‚ˆã„æ°—ãŒã—ã¾ã™ã€‚Vueã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©å½“ã«ä½œã‚Šã¾ã™ã€‚åƒ•ã¯Vite.jsã§ä½œã‚Šã¾ã—ãŸãŒã€vue-cliã§ã‚‚Nuxt.jsã§ã‚‚ãªã‚“ã§ã‚‚OKã§ã™ã€‚</p><p>ã¾ãšã¯MSAL.jsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install @azure/msal-browser</span><br></pre></td></tr></table></figure><p>æ¬¡ã«èªè¨¼æƒ…å ±ã‚’è¨­å®šã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚å…ˆã»ã©ä½œã£ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æƒ…å ±ã‚’ç™»éŒ²ã—ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>authConfig.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Configuration</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@azure/msal-browser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">config</span>: <span class="title class_">Configuration</span> = &#123;</span><br><span class="line">    <span class="attr">auth</span>: &#123;</span><br><span class="line">        <span class="attr">authority</span>: <span class="string">&quot;https://login.microsoftonline.com/&#123;ãƒ†ãƒŠãƒ³ãƒˆID&#125;&quot;</span>,</span><br><span class="line">        <span class="attr">clientId</span>: <span class="string">&quot;&#123;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID&#125;&quot;</span>,</span><br><span class="line">        <span class="attr">redirectUri</span>: <span class="string">&quot;http://localhost:5173/callback&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">cache</span>: &#123;</span><br><span class="line">        <span class="attr">cacheLocation</span>: <span class="string">&quot;localStorage&quot;</span>,</span><br><span class="line">        <span class="attr">storeAuthStateInCookie</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ¬¡ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã‚Šã¾ã™ã€‚ä»Šå›ã¯åŸºæœ¬çš„ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã£ã±ãªã—ã®æƒ³å®šã§ã€æœªãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å®¹ã—ãªã„å‰æã§ã„ã¾ã™ã€‚ã‚‚ã—ã€ãƒšãƒ¼ã‚¸ã«ã‚ˆã£ã¦ã¯æœªãƒ­ã‚°ã‚¤ãƒ³ã‚’è¨±å¯ã—ã¦Vue Routerã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã™ã‚‹ã®ã§ã‚ã‚Œã°ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆauth.getAllAccounts()ãŒ1ã¤ã‚‚ãªã„ï¼‰ã‚’è¿½åŠ ã—ã¦ãŠã‘ã°çµ„ã¿è¾¼ã¿ãŒã—ã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚</p><figure class="highlight ts"><figcaption><span>authPlugin.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Configuration</span>, <span class="title class_">PublicClientApplication</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@azure/msal-browser&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">auth</span>: <span class="title class_">PublicClientApplication</span>;</span><br><span class="line"><span class="keyword">let</span> accessToken = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">config: Configuration</span>) &#123;</span><br><span class="line">    auth = <span class="keyword">new</span> <span class="title class_">PublicClientApplication</span>(config);</span><br><span class="line">    <span class="keyword">await</span> auth.<span class="title function_">handleRedirectPromise</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AuthPluginType</span> = &#123;</span><br><span class="line">    <span class="title function_">login</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">    <span class="title function_">logout</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">    <span class="title function_">accessToken</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">AuthPlugin</span> = &#123;</span><br><span class="line">    <span class="title function_">install</span>(<span class="params">app: App, config: Configuration</span>) &#123;</span><br><span class="line">        app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$auth</span> = &#123;</span><br><span class="line">            <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (auth.<span class="title function_">getAllAccounts</span>().<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    auth.<span class="title function_">setActiveAccount</span>(auth.<span class="title function_">getAllAccounts</span>()[<span class="number">0</span>]);</span><br><span class="line">                    <span class="keyword">const</span> result = <span class="keyword">await</span> auth.<span class="title function_">acquireTokenSilent</span>(&#123;</span><br><span class="line">                        <span class="attr">scopes</span>: [<span class="string">&quot;&#123;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID&#125;/.default&quot;</span>], <span class="comment">// 11/30ä¿®æ­£</span></span><br><span class="line">                        <span class="attr">redirectUri</span>: config.<span class="property">auth</span>.<span class="property">redirectUri</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                    accessToken = result.<span class="property">accessToken</span>;</span><br><span class="line">                    <span class="keyword">return</span> accessToken;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">await</span> auth.<span class="title function_">acquireTokenRedirect</span>(&#123;</span><br><span class="line">                        <span class="attr">redirectStartPage</span>: location.<span class="property">href</span>,</span><br><span class="line">                        <span class="attr">scopes</span>: [<span class="string">&quot;&#123;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID&#125;/.default&quot;</span>], <span class="comment">// 11/30ä¿®æ­£</span></span><br><span class="line">                        <span class="attr">redirectUri</span>: config.<span class="property">auth</span>.<span class="property">redirectUri</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">await</span> auth.<span class="title function_">logoutRedirect</span>();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">accessToken</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> accessToken;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã“ã®<code>login()</code>ãƒ¡ã‚½ãƒƒãƒ‰ãŒè‚ã§ã™ã€‚</p><ul><li>ã™ã§ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯<code>PublicClientApplication.getAllAccounts()</code>ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’è¿”ã™ã®ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦è¨­å®šã™ã‚‹ã€‚æœ¬å½“ã¯idTokenClaims.audãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‚‚ã®ã‚’æ¢ã™ã¨ã„ã†ã®ã‚’ä¸å¯§ã«ã‚„ã£ãŸæ–¹ãŒã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã‘ã©ã€ä»Šå›ã®ã‚±ãƒ¼ã‚¹ã§ã¯ãã‚‚ãã‚‚é•ã†ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã“ã“ã«å…¥ã‚‹ã“ã¨ã¯ä»Šã®ã¨ã“ã‚ãªã„ã®ã§é›‘ã«æœ€åˆã®è¦ç´ ã‚’ãƒ”ãƒƒã‚¯ã€‚</li><li><code>PublicClientApplication.acquireTokenSilent()</code>ã¯ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã‚ã‚Œã°ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’AzureADã«å•ã„åˆã‚ã›ã‚‹ã“ã¨ãªãå–å¾—ã—ã¦Vue.jså†…ã§ä½¿ãˆã‚‹å½¢ã§è¿”ã™ãŒã€æœªãƒ­ã‚°ã‚¤ãƒ³ã ã¨ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã€‚</li><li>æœªãƒ­ã‚°ã‚¤ãƒ³ã ã£ãŸå ´åˆã«<code>PublicClientApplication.acquireTokenRedirect()</code>ã‚’ä½¿ã£ã¦AzureADã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¡Œã†ã€‚</li></ul><p>ã„ã‚ã„ã‚è©¦è¡ŒéŒ¯èª¤ã—ã¾ã—ãŸãŒã€ãŸã¶ã‚“ã“ã‚ŒãŒæœ€å°ã‚±ãƒ¼ã‚¹ã§ã™ã€‚</p><p>ãªãŠã€MSAL.jsã«ã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã ã‘ã§ãªãã€SPAå‘ã‘ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ãŒã€Chromeã§ã¯å‹•ã‹ãšã€Edgeã§ã—ã‹å‹•ãã¾ã›ã‚“ã§ã—ãŸã€‚ãã‚‚ãã‚‚åˆ¥ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã§ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒå‡ºã‚‹ãŸã‚ã€æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ç”»é¢ã®ãƒ–ãƒ­ãƒƒã‚¯ã¨ã‹ã‚’å®Ÿè£…ã™ã‚‹ã®ã¯æ‰‹é–“ãªã®ã§ã€ä»Šå›ç´¹ä»‹ã—ãŸãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã®æ–¹ãŒæ‰‹é–“ãŒå°‘ãªãã¦æ¸ˆã‚€ã‹ã¨æ€ã„ã¾ã™ã€‚ã‚ã¨ã€Chromeã‚‚Edgeã‚‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§åˆ¥ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¯ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã¨ã„ã†å•é¡Œã‚‚ã‚ã‚Šã¾ã™ã€‚ä»Šã®ã¨ã“ã‚é¸ã¶ç†ç”±ãŒè¦‹å½“ãŸã‚‰ãªã„ã§ã™ã€‚</p><p>**(11&#x2F;30è¿½è¨˜)**ãªãŠã€ã‚¹ã‚³ãƒ¼ãƒ—ã¯<code>[&#39;&#123;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID&#125;/.default&#39;]</code>ã¯<code>[&quot;User.Read&quot;]</code>ã§ã‚‚ãƒˆãƒ¼ã‚¯ãƒ³ã¯å–å¾—ã§ãã‚‹ã®ã§ã™ãŒã€ç”Ÿæˆã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’validationã™ã‚‹ã¨å¿…ãšã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§æ¤œè¨¼ã™ã‚‹ã“ã¨ã§ãƒ­ã‚°ã‚¤ãƒ³ãŒæ­£å¸¸ã«è¡Œã‚ã‚ŒãŸã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ã®ãŒãƒ­ã‚°ã‚¤ãƒ³ã®è‚ãªã®ã§ã€ã“ã®ã‚¹ã‚³ãƒ¼ãƒ—åã«ã¯æ³¨æ„ã—ã¦ãã ã•ã„ã€‚Microsoftã®æä¾›ã™ã‚‹APIã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ãã®è©²å½“ã™ã‚‹APIã‚’ã‚¹ã‚³ãƒ¼ãƒ—ã«ã™ã‚Œã°OKã§ã™ã€‚ã“ã®å ´åˆã¯è‡ªåˆ†ã§ã®æ¤œè¨¼ã¯ã§ãã¾ã›ã‚“ã€‚è©³ã—ãã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯å…ˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><ul><li><a href="https://stackoverflow.com/questions/45317152/invalid-signature-while-validating-azure-ad-access-token-but-id-token-works">https://stackoverflow.com/questions/45317152/invalid-signature-while-validating-azure-ad-access-token-but-id-token-works</a></li></ul><p>TypeScriptç”¨ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‹å®šç¾©ã‚‚æ›¸ã„ã¦ãŠãã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>auth.d.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AuthPluginType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./authPlugin&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&quot;vue&quot;</span> &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">ComponentCustomProperties</span> &#123;</span><br><span class="line">    <span class="attr">$auth</span>: <span class="title class_">AuthPluginType</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="çµ„ã¿è¾¼ã¿"><a href="#çµ„ã¿è¾¼ã¿" class="headerlink" title="çµ„ã¿è¾¼ã¿"></a>çµ„ã¿è¾¼ã¿</h1><p><code>PublicClientApplication</code>ã®åˆæœŸåŒ–ã¯Vue.jsã¨ã‹ã‚ˆã‚Šã‚‚å…ˆã«è¡Œã„ã¾ã™ã€‚</p><figure class="highlight ts"><figcaption><span>main.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AuthPlugin</span>, init &#125; <span class="keyword">from</span> <span class="string">&#x27;./authplugin&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">&#x27;./authconfig&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> <span class="title function_">init</span>(config);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">AuthPlugin</span>, config);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><p>MSAL.jsã¯åˆæœŸåŒ–æ™‚ã«ã€AzureADã‹ã‚‰ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒå‘¼ã°ã‚ŒãŸå ´åˆã®ã€ã‚¯ã‚¨ãƒªãƒ¼æ–‡å­—åˆ—ã«OAuthã®èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã¯ã€ã€Œã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒæ¥ãŸãï¼ã€ã¨æ¤œçŸ¥ã—ã¦ã€OpenID Connectã®èªè¨¼å‡¦ç†ã®ç¶šãã‚’è¡Œã£ã¦ãã‚Œã¾ã™ã€‚ãã—ã¦ã€ãã®å¾Œ<code>redirectStartPage</code>ã§æŒ‡å®šã—ãŸURLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¾ã§ã‚„ã£ã¦ãã‚Œã¾ã™ã€‚ãã®ãŸã‚ã«ã€<code>init()</code>ã§å¾…ã¡ï¼ˆæ­£ç¢ºã«ã¯<code>auth.handleRedirectPromise()</code>ã‚’å¾…ã¤)ã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚<code>await</code>ã‚’å¿˜ã‚Œã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦èªè¨¼ã«å¤±æ•—ã—ã¾ã™ã€‚</p><p>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®çµ„ã¿è¾¼ã¿ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ä½œæˆã—ãŸ<code>login()</code>ã¨<code>logout()</code>ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã‚ã¨ã¯ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµŒç”±ã§å–å¾—ã§ãã¾ã™ã®ã§ã€ã‚ã¨ã¯ã“ã‚Œã‚’ã‚µãƒ¼ãƒãƒ¼APIãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¨­å®šã™ã‚Œã°OKã§ã™ã€‚</p><figure class="highlight html"><figcaption><span>App.vue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$auth</span>.<span class="title function_">logout</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">async</span> <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$auth</span>.<span class="title function_">login</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$auth</span>.<span class="title function_">accessToken</span>());ã€€<span class="comment">// ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³è¡¨ç¤º</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    login test</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;logout&quot;</span>&gt;</span>logout<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="ãƒ‡ãƒãƒƒã‚°"><a href="#ãƒ‡ãƒãƒƒã‚°" class="headerlink" title="ãƒ‡ãƒãƒƒã‚°"></a>ãƒ‡ãƒãƒƒã‚°</h1><p>çµæ§‹ã¯ã¾ã£ãŸã®ã§ã™ãŒã€ãƒ­ã‚°ã‚¤ãƒ³ã®é€”ä¸­ã§ã¨ã¾ã£ãŸã¨ãã¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚´ãƒŸãŒæ®‹ã‚Šã¾ã™ã€‚ã“ã®çŠ¶æ…‹ã§MSAL.jsã®APIã‚’å‘¼ã‚“ã§ã‚‚ã€å‡¦ç†ä¸­ã®ã‚‚ã®ãŒã‚ã‚‹ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èµ·å‹•ã™ã‚‹ã‹ã€é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æƒé™¤ã—ã¾ã™ã€‚</p><p>ã‚ã¨ã¯ã€ <code>auth.handleRedirectPromise()</code> ã®Promiseã®ã‚¨ãƒ©ãƒ¼ã¨ã‹è¿”ã‚Šå€¤ã‚’è¦‹ã¦ã¿ã‚‹ã®ã‚‚è‰¯ã„ã§ã™ã€‚</p><h1 id="ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åº¦ã‚’å¤‰ãˆã‚‹ãŸã‚ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°"><a href="#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åº¦ã‚’å¤‰ãˆã‚‹ãŸã‚ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°" class="headerlink" title="ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åº¦ã‚’å¤‰ãˆã‚‹ãŸã‚ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°"></a>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åº¦ã‚’å¤‰ãˆã‚‹ãŸã‚ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°</h1><p>ä»Šå›ã¯1äºº1å°å°‚ç”¨ã®ãƒã‚·ãƒ³ãŒã‚ã‚‹å‰æã®ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶å†èµ·å‹•ã§ã‚‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ®‹ã‚‹ã‚ˆã†ã«localStorageã«å…¥ã‚Œã¦ã„ã¾ã™ãŒã€ãã†ã§ãªã„å ´åˆã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‚’è½ã¨ã—ãŸã‚‰èªè¨¼æƒ…å ±ã‚‚ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«sessionStorageã«ã—ã¦ã‚ã’ãŸæ–¹ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚ä¸Šè¨˜ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®<code>authConfig.ts</code>ã§å¤‰æ›´ã§ãã¾ã™ã€‚</p><p>ã‚ã¨ã¯ã“ã®å½¢å¼ã ã¨ã‚µãƒ¼ãƒãƒ¼ã‚’ä»‹ã•ãšã«ãƒ•ãƒ­ãƒ³ãƒˆã ã‘ã§èªè¨¼ã™ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã®ç„¡åŠ¹åŒ–ãªã©ãŒã§ãã¾ã›ã‚“ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã§ä½œã£ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ã£ã¦ã€Œä½¿ã£ã¦ã„ã„ã‚ˆã€ã¨ã„ã†ãŠå¢¨ä»˜ãã‚’ä¸ãˆã‚‹ï¼ˆã‚ã‚‹ã„ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«1ã‚»ãƒƒã‚·ãƒ§ãƒ³ã—ã‹èªã‚ãšã€å¾Œã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã‚‰å…ˆã®ãƒ­ã‚°ã‚¤ãƒ³ã¯ç„¡åŠ¹)ã¿ãŸã„ãªãƒ­ã‚¸ãƒƒã‚¯ã¨ã‹ã‚’ä½œã‚Œã°ãã®ã‚ˆã†ãªå•é¡Œã«ã¯å¯¾å‡¦ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãã‚Œã§ã‚ã‚Œã°ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã ã‘ã§èªè¨¼ã¨ã„ã†æ–¹å¼ã§ã¯ãªãã€æœ€åˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œã¯ã‚µãƒ¼ãƒãƒ¼ã«ä»»ã›ãŸæ–¹ãŒè‰¯ã„æ°—ã‚‚ã—ã¾ã™ã€‚</p><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>PKCEã®æ©æµã§ã€ã‚µãƒ¼ãƒãƒ¼ã„ã‚‰ãšã®èªè¨¼ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ã§èªè¨¼ã™ã‚‹å ´åˆã€ã‚µãƒ¼ãƒãƒ¼å´ã«è¨­å®šã‚’å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã€ãƒ€ãƒ¡ã ã£ãŸå ´åˆã«ä½•åº¦ã‚‚ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãƒ†ã‚¹ãƒˆã—ãŸã‚Šä¸ä¾¿ã§ã—ãŸãŒã€ã¨ã¦ã‚‚ç°¡å˜ã«å®Ÿè£…ã§ãã¾ã—ãŸã€‚</p><p>ã‚µãƒ¼ãƒãƒ¼å´ã¨ã—ã¦ã¯ã€JWTã®æ¤œè¨¼ã ã‘ã¯å¿…è¦ã¨ãªã‚Šã¾ã™ã®ã§ã€ãã“ã ã‘å®Ÿè£…ãŒå¿…è¦ã§ã™ã€‚MSAL.jsã®ãƒªãƒã‚¸ãƒˆãƒªã«<a href="https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/samples/msal-node-samples/on-behalf-of/web-api/index.js#L40-L61">ã‚µãƒ¼ãƒãƒ¼å´ã§ã®ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã®ã‚µãƒ³ãƒ—ãƒ«</a>(Expressåˆ©ç”¨)ãŒã‚ã‚‹ã®ã§ã€è¦‹ã¦ã¿ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;&lt;strong&gt;11&amp;#x2F;30æ›´æ–°&lt;/strong&gt;</summary>
        
      
    
    
    
    <category term="èªè¨¼èªå¯" scheme="https://future-architect.github.io/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/"/>
    
    
    <category term="Azure" scheme="https://future-architect.github.io/tags/Azure/"/>
    
    <category term="AD" scheme="https://future-architect.github.io/tags/AD/"/>
    
    <category term="MSAL.js" scheme="https://future-architect.github.io/tags/MSAL-js/"/>
    
    <category term="AzureAD" scheme="https://future-architect.github.io/tags/AzureAD/"/>
    
  </entry>
  
  <entry>
    <title>åˆã‚ã¦ã®é•·æœŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã§Webã‚¢ãƒ—ãƒªé–‹ç™ºã‚’çµŒé¨“ã—ã¾ã—ãŸï¼</title>
    <link href="https://future-architect.github.io/articles/20221117a/"/>
    <id>https://future-architect.github.io/articles/20221117a/</id>
    <published>2022-11-16T15:00:00.000Z</published>
    <updated>2022-11-17T03:54:01.488Z</updated>
    
    <content type="html"><![CDATA[<img src="/images/20221117a/toppage.jpg" alt="" width="1200" height="675" loading="lazy"><h1 id="ã¯ã˜ã‚ã«"><a href="#ã¯ã˜ã‚ã«" class="headerlink" title="ã¯ã˜ã‚ã«"></a>ã¯ã˜ã‚ã«</h1><p>ã“ã‚“ã«ã¡ã¯ï¼ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã®ã‚µãƒãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³2022 Engineer Campã«å‚åŠ ã„ãŸã—ã¾ã—ãŸã€å±±å²¸æ¶¼ã§ã™ã€‚</p><p>å¤§å­¦ã§ã¯ã€æƒ…å ±ç³»ã®å­¦ç§‘ã«æ‰€å±ã—ã¦ãŠã‚Šã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚„ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã‚’å­¦ã‚“ã§ã„ã¾ã™ã€‚èª²å¤–æ´»å‹•ã§ã¯ã€ã‚µãƒƒã‚«ãƒ¼ã‚µãƒ¼ã‚¯ãƒ«ã¨ã€ä¼æ¥­ãŒé‹å–¶ã—ã¦ã„ã‚‹å¤§å­¦ç”Ÿãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«æ‰€å±ã—ã¦ã„ã¾ã™ã€‚</p><p>ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã¯ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§æä¾›ã•ã‚ŒãŸèª²é¡Œã«å¯¾ã—ã€2ãƒ¶æœˆé–“ã®ãƒãƒ¼ãƒ é–‹ç™ºã‚„ãƒãƒƒã‚«ã‚½ãƒ³çµŒé¨“ã‚’ã—ã¦ãã¾ã—ãŸã€‚ã—ã‹ã—ã€æ¥­å‹™çš„ãªçµŒé¨“ãŒãªã„ãŸã‚ã€é•·æœŸã§ä½“é¨“ã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚’çµŒé¨“ã—ãŸã„ã¨æ€ã„ã¾ã—ãŸã€‚ãã®ä¸­ã§ã€ç¾å ´ã§ã®ä½œæ¥­ã®é€²ã‚æ–¹ã‚„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å–ã‚Šæ–¹ãªã©ã‚’ä½“é¨“ã—ãŸã„ã¨è€ƒãˆã¾ã—ãŸã€‚ITæ¥­ç•Œã‚’ä¸­å¿ƒã«å°±è·ã‚’è€ƒãˆã¦ã„ã‚‹ç§ã«ã¨ã£ã¦ã€æ¥­å‹™ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãã‚‹è‰¯ã„çµŒé¨“ã«ãªã‚‹ã¨è€ƒãˆå¿œå‹Ÿã—ã¾ã—ãŸã€‚</p><p>ã“ã®è¨˜äº‹ã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã§å­¦ã‚“ã ã“ã¨ã‚’ã¾ã¨ã‚ã¦ã„ãã¾ã™ï¼</p><h1 id="å‚åŠ å‰ã®ã‚¹ã‚­ãƒ«ãƒ»çµŒé¨“"><a href="#å‚åŠ å‰ã®ã‚¹ã‚­ãƒ«ãƒ»çµŒé¨“" class="headerlink" title="å‚åŠ å‰ã®ã‚¹ã‚­ãƒ«ãƒ»çµŒé¨“"></a>å‚åŠ å‰ã®ã‚¹ã‚­ãƒ«ãƒ»çµŒé¨“</h1><ul><li>ç‹¬å­¦ã‚„ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ç¿’å¾—<ul><li>HTML, CSS, JavaScript, PHP, Git</li></ul></li><li>å¤§å­¦ã®æˆæ¥­ã§ç¿’å¾—ï¼ˆåŸºæœ¬æ–‡æ³•ã¯æ›¸ã‘ã‚‹ç¨‹åº¦ï¼‰<ul><li>C, C++, Python, Java</li></ul></li><li>ãƒãƒ¼ãƒ é–‹ç™ºçµŒé¨“ã‚ã‚Š</li><li>æŠ€è¡“ç³»ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®çµŒé¨“ãªã—</li><li>è³‡æ ¼ ãªã—</li></ul><p>å¤§å­¦ã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å­¦ã³å§‹ã‚ã¾ã—ãŸã€‚</p><p>æœ€åˆã¯Cè¨€èªã‹ã‚‰å­¦ã³ã¾ã—ãŸãŒã€printæ–‡ãŒç†è§£ã™ã‚‹ã®ã«3æ—¥ã‹ã‹ã£ãŸãƒ¬ãƒ™ãƒ«ã§ã—ãŸã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã‚ã‚‹ç¨‹åº¦æ›¸ã‘ã‚‹ãŒã€å®Ÿè·µçµŒé¨“ã®ãªã„ã€å…¸å‹çš„ãªå¤§å­¦ç”Ÿã®ã‚¹ã‚­ãƒ«ã‚»ãƒƒãƒˆã ã¨æ€ã„ã¾ã™ã€‚</p><h1 id="ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®æ¦‚è¦"><a href="#ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®æ¦‚è¦" class="headerlink" title="ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®æ¦‚è¦"></a>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®æ¦‚è¦</h1><p>ç§ã¯<a href="/articles/20220606b/"><strong>ã‚µãƒ–ã‚¹ã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã®Webã‚¢ãƒ—ãƒªé–‹ç™º</strong></a> ã«å‚åŠ ã—ã¾ã—ãŸã€‚</p><p>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å‹ã‚µãƒ¼ãƒ“ã‚¹ã«ãŠã‘ã‚‹ãƒãƒ¼ãƒ é–‹ç™ºã‚’çµŒé¨“ã—ã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºçµŒé¨“ï¼ˆHTML CSS JavaScriptãªã©ï¼‰ãŒã‚ã‚‹å‰æã§ã€Vueã‚„Gitã€Slackã‚’ä½¿ã£ãŸçµŒé¨“ï¼ˆãªãã¦ã‚‚OKï¼‰ãŒã‚ã‚Œã°å¤§ä¸ˆå¤«ã§ã™ã€‚</p><p>æ¥­å‹™å†…å®¹ã¯<strong>ãƒ¡ãƒ‡ã‚£ã‚¢æ¥­ç•Œå‘ã‘ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ã®ç§»è¡Œ</strong>ã§ã™ã€‚ã“ã®ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã¯<strong>HTML, CSS, JavaScript</strong>ã§ä½œã‚‰ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚’ã™ã¹ã¦<strong>Vue.js</strong>ã«ç§»è¡Œã—ã¦ã„ãã¾ã™ã€‚</p><p>å¾“æ¥ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ä¿å®ˆæ€§ãŒä½ã„ã“ã¨ã‚„ã€æ¡ˆä»¶è€…ã‹ã‚‰ã®è¦æœ›ã«æ²¿ã£ãŸã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå®¹æ˜“ã§ã¯ãªã„ã“ã¨ã‹ã‚‰ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆ·æ–°ã—ã€ä¿å®ˆæ€§ã®ç¢ºä¿ã™ã‚‹ã“ã¨ãŒæ€¥å‹™ã§ã—ãŸã€‚ãã®ãŸã‚ã€å¤ã„ã‚³ãƒ¼ãƒ‰ã‚’Vueã§ä½œã‚Šç›´ã™å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</p><p>ãªãœVueãªã®ã‹ã«ã¤ã„ã¦ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ãŒä¸­è¦æ¨¡ã®é–‹ç™ºã§ã‚ã‚‹ã“ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ã®ä¿å®ˆæ€§ã®ç¢ºä¿ã€ã‚«ã‚¹ã‚¿ãƒ ã®æŸ”è»Ÿæ€§ã€å­¦ç¿’ã‚³ã‚¹ãƒˆãŒä½ã„ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†åˆ©ç”¨ãŒå¯èƒ½ã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚</p><h1 id="å…·ä½“çš„ã«ã‚„ã£ãŸã“ã¨"><a href="#å…·ä½“çš„ã«ã‚„ã£ãŸã“ã¨" class="headerlink" title="å…·ä½“çš„ã«ã‚„ã£ãŸã“ã¨"></a>å…·ä½“çš„ã«ã‚„ã£ãŸã“ã¨</h1><p>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã§ã¯ã€ãƒ¡ãƒ³ã‚¿ãƒ¼2åã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ç”Ÿï¼’åã®ãƒãƒ¼ãƒ ã§é–‹ç™ºã‚’è¡Œã„ã¾ã—ãŸã€‚</p><p>åŸºæœ¬ã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã§ã€åˆæ—¥ã‚„æœ€çµ‚æ—¥ã€åŒã˜é…å±å…ˆã®ç¤¾å“¡ã¨ã®äº¤æµä¼šãŒã‚ã‚‹æ—¥ã¯å‡ºç¤¾ã—ã¾ã—ãŸã€‚</p><ul><li>ç’°å¢ƒæ§‹ç¯‰ã¨Vueã®åŸºç¤ç†è§£</li><li>é–‹ç™º</li><li>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨ä¿®æ­£</li><li>ãƒ†ã‚¹ãƒˆ</li></ul><h2 id="ç’°å¢ƒæ§‹ç¯‰ã¨Vueã®åŸºç¤ç†è§£"><a href="#ç’°å¢ƒæ§‹ç¯‰ã¨Vueã®åŸºç¤ç†è§£" class="headerlink" title="ç’°å¢ƒæ§‹ç¯‰ã¨Vueã®åŸºç¤ç†è§£"></a>ç’°å¢ƒæ§‹ç¯‰ã¨Vueã®åŸºç¤ç†è§£</h2><p>åˆé€±ã¯PCã®ãƒ—ãƒ­ã‚­ã‚·å‘¨ã‚Šã®è¨­å®šã¨ç’°å¢ƒæ§‹ç¯‰ã‚’è¡Œã„ã¾ã™ã€‚PCã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãŒæº–å‚™ã•ã‚Œã¦ãŠã‚Šã€ãƒ¡ãƒ³ã‚¿ãƒ¼ã®æ–¹ã®ã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ã¤ã¤è¡Œã„ã¾ã™ã€‚æ¬¡ã¯Vueã®ç’°å¢ƒæ§‹ç¯‰ã§ã™ã€‚Node.jsã§ä»®æƒ³DOMã‚’æ§‹ç¯‰ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«è½ã¨ã—è¾¼ã¿ã¾ã™ã€‚</p><p>ç’°å¢ƒæ§‹ç¯‰ãŒçµ‚ã‚ã‚‹ã¨ã€æ¥­å‹™å†…å®¹ã‚„ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®æ¦‚è¦ã«ã¤ã„ã¦ã®ç†è§£ã«æ™‚é–“ã‚’ã‚ã¦ã¾ã™ã€‚</p><p>ç§ã¯VueãŒæœªçµŒé¨“ã§ã—ãŸã®ã§ã€Vueã®åŸºç¤çŸ¥è­˜ã‚„ç¤¾å†…ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ¦‚è¦ãŒã¾ã¨ã¾ã£ãŸãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’æ´»ç”¨ã—ã¦ã€åŸºç¤çŸ¥è­˜ã‚’å­¦ã‚“ã§ã„ãã¾ã—ãŸã€‚</p><h2 id="é–‹ç™º"><a href="#é–‹ç™º" class="headerlink" title="é–‹ç™º"></a>é–‹ç™º</h2><p>ã“ã“ã‹ã‚‰ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®æœ¬é¡Œã§ã™ã€‚<br>æ¥­å‹™ã§ç”¨ã„ãŸæŠ€è¡“ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚</p><ul><li>è¨€èª : HTML, CSS, JavaScript, Vue.js</li><li>ãã®ä»– : GitLab, Slack</li><li>ã‚¨ãƒ‡ã‚£ã‚¿ : VsCode</li></ul><p>ãƒ¡ãƒ³ã‚¿ãƒ¼ã‹ã‚‰ã‚¿ã‚¹ã‚¯ã‚’æ¸¡ã•ã‚Œã€ç‹¬è‡ªã®ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã€é–‹ç™ºã«å–ã‚Šæ›ã‹ã‚Šã¾ã™ã€‚</p><p>ç¤¾å†…ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç”¨ã„ã¦ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ãªãŒã‚‰ã€ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚„ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ãªã©ã®æ©Ÿèƒ½ã‚’é–‹ç™ºã—ã¦ã„ãã¾ã—ãŸã€‚</p><p>è³ªå•ã‚„æ¥­å‹™å†…å®¹ã®èª¬æ˜ãªã©ã®ã‚„ã‚Šã¨ã‚Šã¯Slackã§è¡Œã„ã¾ã—ãŸã€‚é–‹ç™ºãŒä¸€ç•ªæ¥½ã—ã„ã§ã™ï¼</p><h2 id="ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨ä¿®æ­£"><a href="#ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨ä¿®æ­£" class="headerlink" title="ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨ä¿®æ­£"></a>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨ä¿®æ­£</h2><p>ä¸€é€šã‚Šé–‹ç™ºãŒçµ‚ã‚ã‚‹ã¨ã€å®Ÿè£…ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã€ãƒªãƒ¢ãƒ¼ãƒˆä¸Šã«åæ˜ ã•ã›ã¾ã™ã€‚ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã€ãƒ¡ãƒ³ã‚¿ãƒ¼ã®æ–¹ã‹ã‚‰GitLabä¸Šã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã„ãŸã ãã¾ã™ã€‚<br>ç´°ã‹ãªä¿®æ­£ç®‡æ‰€ã‚„ã€ãƒŸã‚¹ã‚’æŒ‡æ‘˜ã•ã‚Œã‚‹ã®ã§ã€ä¿®æ­£ã‚’é‡ã­ã¦ã„ãã€å®Œæˆã«è¿‘ã¥ã‘ã¦ã„ãã¾ã™ã€‚</p><h2 id="ãƒ†ã‚¹ãƒˆ"><a href="#ãƒ†ã‚¹ãƒˆ" class="headerlink" title="ãƒ†ã‚¹ãƒˆ"></a>ãƒ†ã‚¹ãƒˆ</h2><p>æœ€çµ‚ãƒã‚§ãƒƒã‚¯ã§ã€è¦‹ãŸç›®ã‚„å‹•ä½œãŒãŠã‹ã—ããªã„ã‹ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã€å•é¡ŒãŒãªã‘ã‚Œã°ãƒ¡ãƒ³ã‚¿ãƒ¼ãŒè¦ªãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã—ã¦çµ‚äº†ã§ã™ã€‚</p><p>ãã—ã¦æ¬¡ã®ã‚¿ã‚¹ã‚¯ãŒæ¸¡ã•ã‚Œã€ã“ã‚Œã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãã¾ã™ã€‚</p><p>ã‚„ã‚‹ã“ã¨ã¯å¤§ããå¤‰ã‚ã‚‰ãªã„ã®ã§ã€ã ã‚“ã ã‚“ã¨ä½œæ¥­ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒã ã‚“ã ã‚“ã¨ä¸ŠãŒã£ã¦ã„ãã€å°‘ã—é›£ã—ã„ã‚¿ã‚¹ã‚¯ã«ã‚‚æŒ‘æˆ¦ã—ã¾ã—ãŸï¼</p><h1 id="ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ä¸­ã®1æ—¥"><a href="#ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ä¸­ã®1æ—¥" class="headerlink" title="ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ä¸­ã®1æ—¥"></a>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ä¸­ã®1æ—¥</h1><h3 id="10-00-é–‹å§‹"><a href="#10-00-é–‹å§‹" class="headerlink" title="10:00~ é–‹å§‹"></a>10:00~ é–‹å§‹</h3><p>ã¾ãšæœ€åˆã«ã€Œä»Šæ—¥ã®äºˆå®šã€ä»Šæ—¥ã®ç›®æ¨™ã€ã‚„ã‚‹ã“ã¨ã€ã‚’Slackã§ç¤¾å“¡ã«å ±å‘Šã—ã€ã‚„ã‚‹ã¹ãã“ã¨ã‚’æ•´ç†ã—ã¾ã™ã€‚</p><h3 id="12-00-13-00-ä¼‘æ†©"><a href="#12-00-13-00-ä¼‘æ†©" class="headerlink" title="12:00~13:00 ä¼‘æ†©"></a>12:00~13:00 ä¼‘æ†©</h3><p>åŸºæœ¬ã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã¨ã£ã¦ã‚‚OKã§ã™ã€‚</p><p>ç§ã¯ã€ä»•äº‹ã®åŒºåˆ‡ã‚ŠãŒã„ã„ã¨ã“ã‚ã§ä¼‘æ†©ã‚’ã—ã€æ˜¼é£Ÿã‚„æ˜¼å¯ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚</p><p>å‡ºç¤¾ã—ãŸå ´åˆã¯ã€ç¤¾å“¡ã®æ–¹ã¨ãƒ©ãƒ³ãƒã«ã„ãã¾ã—ãŸã€‚</p><h3 id="13-00-17-00-æ¥­å‹™å†é–‹"><a href="#13-00-17-00-æ¥­å‹™å†é–‹" class="headerlink" title="13:00~17:00 æ¥­å‹™å†é–‹"></a>13:00~17:00 æ¥­å‹™å†é–‹</h3><p>ã²ãŸã™ã‚‰é–‹ç™ºã§ã™ã€‚</p><h3 id="17-00-17-30-æ—¥æ¬¡å ±å‘Š"><a href="#17-00-17-30-æ—¥æ¬¡å ±å‘Š" class="headerlink" title="17:00~17:30 æ—¥æ¬¡å ±å‘Š"></a>17:00~17:30 æ—¥æ¬¡å ±å‘Š</h3><p>ä»Šæ—¥å–ã‚Šçµ„ã‚“ã ã“ã¨ã€ç›®æ¨™ãŒé”æˆã§ããŸã‹ã‚’ãƒ¡ãƒ³ã‚¿ãƒ¼ã¨å…±æœ‰ã—ã¾ã™ã€‚</p><p>ãã®ä»–ã®æ¥­å‹™é€£çµ¡ã‚„ã€é›‘è«‡ãªã©ã‚’ã—ã¾ã™ã€‚æ¥­å‹™å¤–ã§ã®è©±ã§ç››ã‚Šä¸ŠãŒã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸç¬‘</p><h3 id="ã€œ19-00-çµ‚äº†"><a href="#ã€œ19-00-çµ‚äº†" class="headerlink" title="ã€œ19:00 çµ‚äº†"></a>ã€œ19:00 çµ‚äº†</h3><p>æ—¥å ±ã¨å‹¤å‹™æ™‚é–“ã‚’ç™»éŒ²ã—ã¦ã€å‹¤å‹™çµ‚äº†ã§ã™ã€‚</p><h1 id="ã¾ã¨ã‚"><a href="#ã¾ã¨ã‚" class="headerlink" title="ã¾ã¨ã‚"></a>ã¾ã¨ã‚</h1><p>Vueã‚’ä½¿ã£ã¦ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ã®ç§»è¡Œã‚’è¡Œã„ã¾ã—ãŸã€‚ç¤¾å†…ç‹¬è‡ªã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ‰±ã£ãŸãŸã‚ã€ã‚³ãƒ¼ãƒ‰ã‚„ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãªã©ã‹ã‚‰Vueã®æ‰±ã„æ–¹ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒå¤§å¤‰ã§ã—ãŸãŒã€Slackã‚’é€šã˜ã¦ãƒ¡ãƒ³ã‚¿ãƒ¼ã®æ–¹ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ãã ã•ã‚Šã€ã¾ãŸã¯ç¤¾å†…å‹‰å¼·ä¼šã«å‚åŠ ã—ã¦ç†è§£ã‚’æ·±ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚</p><p>é–‹ç™ºã§ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ãŸã ã‘ã§ä¼ã‚ã‚‹æ›¸ãæ–¹ã‚„ã€å³æ ¼ãªå‘½åè¦å‰‡ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã“ã¨ã‚’æ•™ã‚ã‚Šã¾ã—ãŸã€‚ä»–ã®ç¤¾å“¡ãŒæ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã‚‚ã€æ˜ç¤ºçš„ãªé–¢æ•°åã‚„ã€ã‚³ãƒ¡ãƒ³ãƒˆã§ã‚³ãƒ¼ãƒ‰ã®å‹•ãã®èª¬æ˜ãŒãªã•ã‚Œã¦ãŠã‚Šã€ä»Šå¾Œèº«ã«ä»˜ã‘ã‚‹ã¹ãåŠ›ã ã¨æ„Ÿã˜ã¾ã—ãŸã€‚</p><p>ã¾ãŸã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«å¿…è¦ãªãƒã‚¤ãƒ³ãƒ‰ã‚»ãƒƒãƒˆã¨ã—ã¦ã€é–‹ç™ºã«æºã‚ã‚‹éš›ã«ã€ãã“ã§ä½¿ã‚ã‚Œã‚‹æŠ€è¡“ã®ä»•çµ„ã¿ã‚’ç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹ãƒã‚¤ãƒ³ãƒ‰ã‚’ã‚‚ã¤ã“ã¨ãŒå¤§åˆ‡ã§ã‚ã‚‹ã“ã¨ã‚’æ•™ã‚ã‚Šã¾ã—ãŸã€‚</p><p>ãã®ãƒã‚¤ãƒ³ãƒ‰ã‚’æŒã£ã¦é–‹ç™ºã«å–ã‚Šçµ„ã‚€ã“ã¨ã§ã€é•ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ç•°ãªã‚‹æŠ€è¡“ã‚’ä½¿ã†æ©Ÿä¼šãŒã‚ã£ãŸã¨ã—ã¦ã‚‚ã€æŠ€è¡“ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãŒæ—©ãã€å¿œç”¨ãŒåŠ¹ãã“ã¨ã‚’å­¦ã³ã¾ã—ãŸã€‚</p><p>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³å¾Œã‚‚ã€èº«ã«ã¤ã‘ãŸVueã®çŸ¥è­˜ã‚’è‡ªåˆ†ã®ã‚‚ã®ã«ã—ã¦ã„ãã¾ã™ã€‚ä»•çµ„ã¿ã®éƒ¨åˆ†ã‚„ã€å‹•ãã‚’å­¦ã¶ã¨ã„ã†æ„è­˜ã‚’æŒã£ã¦å‹‰å¼·ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚ä»–ã«ã‚‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‘¨ã‚Šã®è¨€èªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆReact, Firebaseï¼‰ã‚’è©³ã—ãå­¦ã³ã€æŠ€è¡“ã®é¸å®šã‚„è¨€èªæ¯”è¼ƒãŒã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã¾ã§å–ã‚Šçµ„ã‚“ã§ã„ãã¾ã™ï¼</p><h1 id="æœ€å¾Œã«"><a href="#æœ€å¾Œã«" class="headerlink" title="æœ€å¾Œã«"></a>æœ€å¾Œã«</h1><p>1ãƒ¶æœˆã¨ã„ã†é•·æœŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã§ä¸å®‰ãªæ°—æŒã¡ã§ã„ã£ã±ã„ã§ã—ãŸãŒã€æ¥­å‹™ã ã‘ã§ãªãã€åŒå¹´ä»£ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã®äº¤æµä¼šã‚„å…ˆè¼©ç¤¾å“¡ã‹ã‚‰ã®è¬›ç¾©ã€ãƒ©ãƒ³ãƒã‚„ãƒ‡ã‚£ãƒŠãƒ¼ãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒãŸãã•ã‚“è©°ã‚è¾¼ã¾ã‚Œã¦ãŠã‚Šã€å­˜åˆ†ã«ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã‚’ä½“æ„Ÿã§ãã€åˆºæ¿€ã¨æº€è¶³æ„Ÿã§å¿ƒãŒãŠè…¹ã„ã£ã±ã„ã§ã—ãŸã€‚</p><p>ã“ã®ã‚ˆã†ãªç´ æ™´ã‚‰ã—ã„çµŒé¨“ã‚’ã•ã›ã¦ã„ãŸã ã„ãŸãƒ¡ãƒ³ã‚¿ãƒ¼ã®å‰ç”°ã•ã‚“ã€ä¸­æ‘ã•ã‚“ã‚’ã¯ã˜ã‚ã€HRã®æ–¹ã€…ã€åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ç”Ÿã®æ£®ã•ã‚“ã«ã¯å¤§å¤‰ãŠä¸–è©±ã«ãªã‚Šã¾ã—ãŸã€‚</p><p>æœ¬å½“ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;img src=&quot;/images/20221117a/toppage.jpg&quot; alt=&quot;&quot; width=&quot;1200&quot; height=&quot;675&quot; loading=&quot;lazy&quot;&gt;

&lt;h1 id=&quot;ã¯ã˜ã‚ã«&quot;&gt;&lt;a href=&quot;#ã¯ã˜ã‚ã«&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="Programming" scheme="https://future-architect.github.io/categories/Programming/"/>
    
    
    <category term="ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³" scheme="https://future-architect.github.io/tags/%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%B3/"/>
    
    <category term="ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³2022" scheme="https://future-architect.github.io/tags/%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%B32022/"/>
    
  </entry>
  
</feed>
